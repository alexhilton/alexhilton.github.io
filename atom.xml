<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[稀有猿诉]]></title>
  <link href="http://toughcoder.net/atom.xml" rel="self"/>
  <link href="http://toughcoder.net/"/>
  <updated>2015-08-16T09:21:09+08:00</updated>
  <id>http://toughcoder.net/</id>
  <author>
    <name><![CDATA[Alex Hilton]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[如何跳过Nexus 7二代的开机设置]]></title>
    <link href="http://toughcoder.net/blog/2015/08/15/skip-setup-wizard-for-nexus-7/"/>
    <updated>2015-08-15T16:47:55+08:00</updated>
    <id>http://toughcoder.net/blog/2015/08/15/skip-setup-wizard-for-nexus-7</id>
    <content type="html"><![CDATA[<h2>事情是酱紫的</h2>

<p>Neuxs 7二代，2013年款，14年某宝上面买的，为了体验最新的Android版本，以及奶七的高性价比，于是就买了一个，之后也一直用着比较爽，电影，游戏，看书，看代码，体验原生Android，体验GMS，都是相当不错，直到今年4月份，突然有一天，触摸屏失灵了，在重启了之后，触摸能用了，但是反应不灵，有时要点好几次才有反应，有时则是好的。当时错误以为是装的软件太多了，反应慢，于是干了一件蠢事，做了Factory reset，重启后，一直卡在开机设置页面，网络连接始终不行，无法完成开机设置。</p>

<p><a href="http://toughcoder.net/blog/2015/08/15/skip-setup-wizard-for-nexus-7/"><img src="http://images.anandtech.com/doci/6048/GoogleIO2012-116.jpg" width="480" height="320"></a></p>

<!-- more -->


<p>想尽各种办法，使用代理，等，最终还是没用。刷了各种版本的Image都一个鸟样，有人说多试几次，就可以跳过，但是始终无法跳过。后来有人说可能Google那个服务可能不在了，所以即使翻了墙，也还是无法连接上。无奈刷了MIUI，但是版本只是4.4，也失去了奶七的特色。想着刷其他ROM的时候，有了新的发现。</p>

<p>最后发现了<a href="http://forum.xda-developers.com/showthread.php?t=1909602">这篇神贴</a>，讲述如何跳过Nexus 7的开机设置，虽然是2012看款奶七，也就是Nexus 7一代，但是仍然值得一试。</p>

<p>它的思路就是系统相关的特性都会存在系统的配置文件（/system/build.prop）之中，如果以ROOT方式连接ADB，那么我们就能修改此文件。也就能跳过开机设置的网络连接，甚至跳过开机设置。而高级的recovery都支持ADB，且是以ROOT身份，所以就有了如下的方法：</p>

<h2>具体方法</h2>

<p><em>注意</em>: 这是在Ubuntu下面进行，Mac平台的操作是一样的。对于Windows也差不多，只是需要安装手机的驱动程序，驱动程序可以到Goolge官方去下载。</p>

<p><em>注意</em>: 前提条件是要有ADB和fastboot命令，安装了SDK后就都有了</p>

<ol>
<li><p>先解锁bootloader</p>

<p>这个对于奶七还是很简单的，先重启到fastboot模式，关机，按Power+Volumn down来启动，就会启动到fastboot模式，这个模式可以做很多事情。</p>

<p><em>注意</em>: 对于Windows系统，需要安装手机的驱动程序，不会的可自行Google</p>

<p><em>fastboot oem unlock</em> 就可以解锁bootload</p></li>
<li>下载<a href="http://www.clockworkmod.com/">CWM recovery</a></li>
<li><p>安装recovery</p>

<p>fastboot flash recovery &lt;<em>clockworkmod-recovery.img</em>&gt;</p></li>
<li><p>更改配置</p>

<p>安装完recovery后，重启到recovery模式，在fastboot模式下，用Volumn up/down来选择recovery，按Power选中，就可以重启到recovery mode</p>

<p>连接到电脑，就可以执行ADB命令了，需要注意的是，要先mount一下/system分区，recovery会有一个菜单叫mount storage，进去，选择mount /system，如果不mount /system，你会找不到build.prop文件，因为所在的shell及文件系统是recovery的，并不安卓系统的。</p>

<p>之后adb shell cat /system/build.prop就能看到配置信息了</p>

<p>adb shell sed -i &rsquo;s/ro.setupwizard.network_required=true/ro.setupwizard.network_required=false/g&#8217; /system/build.prop</p>

<p><em>注意</em>: 上面是针对最新5.1.1 (LMY48I)的image。对于早期版本，比如4.4 （JSS15Q），配置项是ro.setupwizard.wifi_required，但是改此项并不管用，而是要跳过开机设置才管用也即添加ro.setupwizard.mode=DISABLED到/system/build.prop</p></li>
<li><p>重启</p>

<p>adb命令重启木有用，还是用recovery上面的菜单来重启。因为这个ADB是recovery提供的，你会发现里面有很多安卓本身没有的比如像find像sed，因为这个Shell是由recovery里的busybox提供的，安卓系统还没有加载，自然reboot木鸟用。</p></li>
</ol>


<h2>总结与评论</h2>

<p>首先说Google酱紫的做法还是蛮恶心的，完全不考虑我大天朝的人怎么办！连接网络可以有，但至少可以跳过或者忽略啊！不能强制用户，网上也有其他人有此报怨（米国人），因为买奶七的人不一都有网络（那个报怨的米国人就是，大意是给他老爹买的，老爹那里木WiFi，所以很郁闷，无法激活）。</p>

<p>其次，就是解决问题的思路，惭愧虽搞了安卓几年，但是没想出通过设置来跳过开机设置这等高招。XDA论坛还是高手云集的地方，ROOT，recovery和各种Hack基本上都源自XDA论坛。以后遇到这种完全无思路 的问题还是要多救助网络和社区，否则自己搞鼓一辈子，可能也想不到好方案。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[实战技巧：Android异步指南]]></title>
    <link href="http://toughcoder.net/blog/2015/05/25/effective-android-asynchrony/"/>
    <updated>2015-05-25T23:49:19+08:00</updated>
    <id>http://toughcoder.net/blog/2015/05/25/effective-android-asynchrony</id>
    <content type="html"><![CDATA[<p>异步向来都是提高性能的必要手段，当然也是引发问题的常见根源。Android之中更是如此，主线程事关应用的流畅程度，所以把更多能放在工作线程中事，放到工作线程中去，是提升App性能之必经之路。Android中使用线程有多种方式，我们该如何选择，以及在使用过程中要注意哪些问题，今天就来探讨一下。</p>

<p><a href="http://toughcoder.net/blog/2015/05/25/effective-android-asynchrony/"><img src="http://image.slidesharecdn.com/scandev-120418025620-phpapp02/95/threading-in-android-1-728.jpg?cb=1334718039"></a></p>

<!-- more -->


<h2>Bitmap处理</h2>

<p>在Android中显示图片，<a href="http://developer.android.com/reference/android/graphics/Bitmap.html">Bitmap</a>是必须要学会的。Bitmap是Android中抽象出来代表图片的类，把图片文件或者数据转化成Bitmap进而再放置到视图系统中显示。Bitmap的处理也常常会引发OOM问题。</p>

<p>关于Bitmap的处理，遵守二个原则，就是按需解析和及时释放。现在的图片文件都很大，但很多时候我们需要展示的区域（目标View的大小）却不是很大，这个时候就需要在解析的时候，适当的降低帧率，以减小所需要申请的内存。及时释放时也需要注意，要确定不用了，再释放，如果有View仍在显示时，在另外的地方把Bitmap释放了，那会引发异常的。</p>

<p>对于Bitmap的使用，<a href="http://developer.android.com/training/displaying-bitmaps/index.html">官方文档</a>有着比较详细的教程。现在的Android文档是很齐全的，相比较2010年代时2.0和2.1时多了很多最佳实践，所以不要浪费。</p>

<p>除内存外，Bitmap的处理也是比较耗时的，因为它经常涉及IO，以及压缩和处理，即使不耗时，因为它跟UI没关系，所以也是可以放在工作线程中去做的。Android中记住一个准则就是主线程做的事情越少越好，越少你的应用就越流畅。至于如何具体的去做也建议参考<a href="http://developer.android.com/training/displaying-bitmaps/process-bitmap.html">官方教程</a>。</p>

<h2>异步的方式</h2>

<p>在Android中异步实现的方式非常多：</p>

<ul>
<li>Thread</li>
<li>AsyncTask</li>
<li>Executors</li>
<li>Handler, Looper</li>
</ul>


<p>各种方式的使用方法参阅相关文档或者查阅网上浆料就可以了。这里主要说一下区别和适用的场景：</p>

<h3>Thread</h3>

<p>这是Java的简单粗暴的方式，优点就是简单，方便。对于某些简单的，一次性的，不需要与主线程通信和操作UI，不是很频繁（一次启动执行一次），的费时操作，直接使用Thread方式还是相当方便的。</p>

<h3>AsyncTask</h3>

<p>这是Android中专门针对平台本身的特性而封装的一个类，它的优势在于与主线程通信方便，能非常方便的操作UI。所以使用AsyncTask的理由就是当你需要在异步操作完成时直接操作UI时，除此外，你不应该使用它。</p>

<p>使用AsyncTask时，最好使用AsyncTask.executeOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR);以免任务不能及时获得执行，详细原因可以看<a href="http://blog.csdn.net/hitlion2008/article/details/8194510">这篇文章</a>。</p>

<h3>Executors</h3>

<p>当有大量的任务，或者重复性的任务需要执行时，就要使用线程池来复用和管理线程。</p>

<h3>Handler与Looper</h3>

<p>这是Android事件循环的基础类，也是AsyncTask的实现方式，是线程间通信的利器。所以如果你有复杂的线程通信（通常是工作线程和主线程之间），可以使用这二个类来自行进行定义。</p>

<h3>其他的高级工具</h3>

<p>对于多线程，已经有足够的工具供我们使用比如java.util.concurrent.*，以及Universal Image Loader，或者EventBus，所以当设计时首先要看现在的工具能否满足我们的需求。而不是自己去实现，子曰：不能重复造轮子，就是就是这个道理。</p>

<h2>异步时要注意Activity的生命周期</h2>

<p>异步时最容易出错的就是忽略Activity的生命周期。比如，当异步执行完成了，Activity却退出了前台，或者已经结束，如果异步完成时要操作UI，那么这种情况下肯定会报错，具体的错误取决于场景。这个问题的解法就是在异步操作完成后要用Activity.isFinishing()来判断下Activity是否还是alive的。或者设置一个变量来查看Activity是否还在前台。</p>

<p>另外，即使异步操作中不涉及UI，那么当Activity转入后台，或者退出时，也要及时的终止工作线程，否则也会造成Activity的对象无法及时销毁而最终导致内存泄露。这个问题需要在设计异步task时把可取消考虑进去，当Activity退出前台时发送消息给线程，让其终止执行。对于常见的费时操作，比如IO，网络，复杂计算等在都要考虑取消，每一个小步骤执行前都要判断取消标志位，以及时终止操作。通常这需要在Activity中持有任务的引用，或者使用Executors来管理任务，或者有一个类似的对象来管理异步任务，当Activity退出时，来终止任务。或者使用EventBus这类工具来降低耦合。</p>

<h2>有用的资源</h2>

<p>关于Android中的异步已经有了一本专门的书了<a href="http://shop.oreilly.com/product/0636920029397.do">《Efficient Android Threading》</a>，内容还是比较丰富的，可以看一看。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[初级前端的专业的CSS技巧]]></title>
    <link href="http://toughcoder.net/blog/2015/05/22/css-pro-tricks-for-starters/"/>
    <updated>2015-05-22T21:14:26+08:00</updated>
    <id>http://toughcoder.net/blog/2015/05/22/css-pro-tricks-for-starters</id>
    <content type="html"><![CDATA[<p>这篇文章的读者应该是刚开始开发，或者准备开始开发前端的有经验的开发者，总结了一些非常有用的可以快速上手的CSS布局技巧。</p>

<p><a href="http://toughcoder.net/blog/2015/05/22/css-pro-tricks-for-starters/"><img src="http://acodez.in/blog/wp-content/uploads/2013/10/banner-565x326.jpg"></a></p>

<h2>HTML的布局特点</h2>

<p>要理解默认的布局流，块级元素是从上到下，行内元素是从左到右。都是左对齐。</p>

<!-- more -->


<h2>一切皆为框，块级元素与行内元素</h2>

<p>HTML的元素分为二个种类，一个是块级元素，一个是行内元素。块级元素的特点是独自开启一行，且独自中据一行；行内元素的特点是在一行内显示，自己多大就占据多大空间。可以通过display属性来改变元素默认的显示属性。</p>

<p>常见的块级元素是：div, p, ol, ul, li</p>

<p>常见的行内元素是: a, img, span</p>

<h2>元素和容器</h2>

<p>对于常见的GUI框架，都有二种东西来做布局，一个是元素（通常叫Widget），另一个是布局管理器，也就是用于管理或者组合Widget用的。在安卓里就是View和ViewGroup。</p>

<p>使用布局管理器的目的也很简单，就是为了把部分变成整体，方便操作。</p>

<p>div是用来组合和管理块级元素的。而span是用来组合和管理行内元素。</p>

<p>建议多多使用div和span来组合和管理你的布局，就像使用ViewGroup来管理和组合View一样。</p>

<h2>理解盒子模型</h2>

<p>其实，有过其他GUI框架经验的人理解盒子模型很容易，margin是border外的间距，padding是border内间距，整体元素占据的空间就是margin+border+padding+元素本身的大小。</p>

<p><img src="http://www.w3school.com.cn/i/ct_boxmodel.gif"></p>

<h2>父元素的大小与子元素的关系</h2>

<p>比如安卓，父元素的大小是受子元素影响的，父元素可是基于子元素大小来计算（wrap_content），当子元素超出父元素时，子元素是会被clip的。</p>

<p>CSS里却灵活的多，默认的，父元素的大小与子元素没有关系，需要分别单独指定，也无法让其wrap_content。当子元素的大小超过了父元素时，是通过overflow属性的决定如何显示的：hidden，表示clip；scoll表示用scrollbar来滚动。</p>

<h2>对齐方式</h2>

<p>左对齐或者右对齐也是布局中常见的需求。对于块元素可以通过float属性来控制，默认的float是left。当设置为right时，就可以把元素右对齐。通常后面跟一个clear: both来清除float属性。因为float会改变默认的布局流，后面所有的元素都将按此方式来排，当然这不是期望的。<a href="http://www.w3schools.com/css/css_float.asp">float的介绍</a>以及<a href="https://css-tricks.com/all-about-floats/">关于float</a>都是很好的文章。</p>

<p>当然，对于position不是static的，就要通过left/right来控制了。</p>

<h2>居中方式</h2>

<p>居中也是非常常见的一个需求。</p>

<h3>让某一个元素在整个屏幕中完全居中</h3>

<p>比如显示一个Dialog，肯定是要在屏幕中央显示的了。
让元素在整体屏幕居中，肯定要把元素从整体文档中拿出来，也就是不能用正常的文档流。所以这个元素应该是position: fixed，然后它的left和top要设置为50%，但是这样子后是元素的左上角是在屏幕正中，所以为了让元素居中还要把元素向左和向上移动其大小的50%，可以通过transform来实现，完整的CSS如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='CSS'><span class='line'><span class="nc">.center</span> <span class="p">{</span>
</span><span class='line'>   <span class="k">display</span><span class="o">:</span> <span class="k">block</span><span class="p">;</span>
</span><span class='line'>   <span class="k">position</span><span class="o">:</span> <span class="k">fixed</span><span class="p">;</span>
</span><span class='line'>   <span class="k">top</span><span class="o">:</span> <span class="m">50%</span><span class="p">;</span>
</span><span class='line'>   <span class="k">left</span><span class="o">:</span> <span class="m">50%</span><span class="p">;</span>
</span><span class='line'>   <span class="n">transform</span><span class="o">:</span> <span class="n">translate</span><span class="p">(</span><span class="m">-50%</span><span class="o">,</span> <span class="m">-50%</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>详细的解释请参阅<a href="https://css-tricks.com/quick-css-trick-how-to-center-an-object-exactly-in-the-center/">这篇文章</a>。</p>

<h3>块级元素的居中方式</h3>

<p>把margin设置为auto一般情况下可以把块级元素居中，但需要指定元素的宽和高，这样浏览器才能计算出来，比如：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='CSS'><span class='line'><span class="nc">.title</span> <span class="p">{</span>
</span><span class='line'>   <span class="k">margin</span><span class="o">:</span> <span class="k">auto</span><span class="p">;</span>
</span><span class='line'>   <span class="k">width</span><span class="o">:</span> <span class="m">1</span><span class="n">rem</span><span class="p">;</span>
</span><span class='line'>   <span class="k">height</span><span class="p">;</span> <span class="m">0</span><span class="o">.</span><span class="m">4</span><span class="n">rem</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3><p>元素内的文字居中</h3>

<p>上面的方法只能让p元素在其父元素内居中，但是它内部的文字仍然不居中，比如当有四个文字时，调好了，居中，但是当只有一个文字时却又不能居中了。这里就要用到一个新的显示属性flex，是flexible的缩写，意思是灵活的布局。比如：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='CSS'><span class='line'><span class="nc">.title</span> <span class="p">{</span>
</span><span class='line'>   <span class="k">display</span><span class="o">:</span> <span class="n">flex</span><span class="p">;</span>
</span><span class='line'>   <span class="k">justify</span><span class="o">-</span><span class="k">content</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span> <span class="c">/* align horizontal */</span>
</span><span class='line'>   <span class="n">align</span><span class="o">-</span><span class="n">items</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span> <span class="c">/* align vertical */</span>
</span><span class='line'>   <span class="c">/* the following are for Browser compatibility */</span>
</span><span class='line'>   <span class="k">display</span><span class="o">:</span> <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">box</span><span class="p">;</span>
</span><span class='line'>   <span class="k">display</span><span class="o">:</span> <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">flex</span><span class="p">;</span>
</span><span class='line'>   <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">box</span><span class="o">-</span><span class="n">align</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span>
</span><span class='line'>   <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">flex</span><span class="o">-</span><span class="n">align</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span>
</span><span class='line'>   <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="n">align</span><span class="o">-</span><span class="n">items</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>具体解释可以参考<a href="http://stackoverflow.com/questions/17213113/vertical-centering-flexbox-overlay-in-ios-safari">原文</a>以及<a href="http://stackoverflow.com/questions/8865458/how-to-align-text-vertically-center-in-div-with-css">这里</a>。</p>

<h2>定位方式</h2>

<p>默认的流式布局，块级元素从上往下排，一个接着一个的。如果想要让某个元素固定在某个位置，或者想要层叠元素怎么办。现在的Web越来越像客户端，有顶部菜单栏，有侧面菜单栏，有弹出式菜单，在层叠式菜单等等。这些常用且又好用的交互方式又是如何实现的呢?
这就要用到position属性了。position也就是给元素定位，确定其在文档(document)中的位置，默认值是static，也就是从上到下，一个挨着一个。</p>

<ul>
<li>relative &ndash; 相对于这个元素在正常文档流中的位置，正常流中的位置仍然保留。</li>
<li>absolute &ndash; 这个元素会从自觉流中移除，就好像它不存在一样。这个元素的定位会相对于它的第一个定位不是static的父元素，也就是从它的父元素向上找，找到第一个定位属性不是static的元素，如果找不到就使用根元素（html）。</li>
<li>fixed &ndash; 固定在窗口中，从正常流拿出来，其他元素布局就好像属性为fixed的不存在一样，不会随着文档滚动页滚动，可以重叠，用z-index来指定谁在上面，谁在下面。流行的侧面菜单，顶部菜单等都是用此方式实现。</li>
</ul>


<p>relative，absolute以及fixed属性都要同时使用top/right/left/bottom来为元素指定位置，它们的含义是元素距离父元素上/右/左/下的距离。</p>

<h2>大小的度量单位</h2>

<p>元素的宽和高，以及字体大小的单位：</p>

<ul>
<li>px &ndash; 像素，像素就是一个屏幕可显示的是小单元，通常视觉给出的标注都是以像素为单位</li>
<li>em &ndash; 相对于父元素的大小，通常这个值会是继承自父元素。所以如果以它为单位，会随着元素的深入这个单位会变得越来越大。</li>
<li>rem &ndash; 根元素字体高度，通常就是HTML的字体高度。这个值更为通用，因为对于一个Document来说这个值是黑固定的，适配性和通用性更好。</li>
<li>pt &ndash; 是点的意思(point)，是在打印设备中常用的单位，一个pt等于1/72英寸。它跟像素（px）一样，都是绝对单位，通用性和适配性不好，一般用的比较少。</li>
</ul>


<p>对于这些单位的详细解释可以参考<a href="http://kyleschaeffer.com/development/css-font-size-em-vs-px-vs-pt-vs/">这篇文章</a>和<a href="http://snook.ca/archives/html_and_css/font-size-with-rem">这篇</a>以及<a href="https://css-tricks.com/rems-ems/">这篇</a>。</p>

<h2>用相对单位控制图片的大小</h2>

<p>不要用img元素的属性width和height，而是用CSS的width，height，因为img属性width和height仅能使用px作为单位，适配性要差一些，而CSS中的width和height是可以使用rem这种相对单位，适配性要好。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='CSS'><span class='line'><span class="nc">.icon</span> <span class="nt">img</span> <span class="p">{</span>
</span><span class='line'>   <span class="k">width</span><span class="o">:</span> <span class="m">1</span><span class="n">rem</span><span class="p">;</span>
</span><span class='line'>   <span class="k">height</span><span class="o">:</span> <span class="n">rem</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>横向显示一个列表</h2>

<p>把&lt;li&gt;的display属性设置为inline-block即可：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='CSS'><span class='line'><span class="nc">.nav</span> <span class="nt">ol</span> <span class="nt">li</span> <span class="p">{</span>
</span><span class='line'>   <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
</span><span class='line'>   <span class="k">text-align</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>控制元素的可见性</h2>

<p>有二种方式，一种是把display设置为none，这会让浏览器忽略此元素就好像它不存在一样，在渲染时；另一种方式就是通过visibility属性：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='CSS'><span class='line'><span class="nc">.show</span> <span class="p">{</span>
</span><span class='line'>   <span class="k">visibility</span><span class="o">:</span> <span class="k">visible</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nc">.hide</span> <span class="p">{</span>
</span><span class='line'>   <span class="k">visibility</span><span class="o">:</span> <span class="k">hidden</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>注意兼容性</h2>

<p>对于一般的属性或者值最好要注意一下子它的兼容性，一般就是在前面加上-webkit-前缀，因为现在四分之三的浏览器都是Webkit系。</p>

<h2>工具</h2>

<p>欲想事，必先利其器。工具对于开发的重要性对于有经验的人不用多说，是事半功倍的。</p>

<h3>开发工具</h3>

<p>开发工具首选Webstorm。这是JetBrains的作品，IDEA IntellJ，PyCharm都是深受广大开发者喜欢的作品，也是我首选的IDE（NotePad和Vim偏执狂请走开），虽然我也喜欢Vim的简洁和高效，但是对于堆代码来说IDE是最高效的。跟IDEA和PyCharm不一样，WebStorm没有社区版本，这意味着试用了30天后就必须想办法了。。</p>

<h3>调试工具</h3>

<p>到今天，几个流行的浏览器都已经有了调度功能，Firefox的Firebugs，Opera的DragonFly，以及Chrome的devtools，Safari也内置了调试工具，至于IE，我还不知道。它们的功能基本上都是一致的：都能实时查看并修改元素，以及元素的CSS属性；能设置JavaScript的断点，单步调试；能查看Console，以及查看Network网络请求以及storage的使用情况。</p>

<p>可能最受欢迎的还是Chrome的devTools，至少，我是喜欢它。它内置，使用方便，不用装其他的东西，不用什么开发者模式。</p>

<p>详细的可以看<a href="https://developer.chrome.com/devtools/index">官网介绍</a>（自备梯子）。</p>

<p>在调试的时候多使用使用感受一下子就好了。多用”审查元素“找到元素，然后在devtools中修改样式，得到合适的样式的值，然后再去修改源码，能大大提高效率。</p>

<h3>移动端的工具</h3>

<p>如今移动端的流量已经超越PC，而且势头还在增长。一大半的前端都是为移动端而生的。</p>

<h4>Chrome DevTools的移动设备模拟器Emulator</h4>

<p>打开DevTools后，可以在左上角看一一个PC和移动设备的小Icon，点了后就进入了移动设备模拟器，它有各种模拟器：iPhone5, 6, 6s, Nexus 5, 6，iPad， iPad Mini等等，还可以模拟网络条件，良心工具啊。</p>

<p>可以到官方查看<a href="https://developer.chrome.com/devtools/docs/device-mode">更多信息</a>。</p>

<h4>Chrome远端调试</h4>

<p>Chrome和Android都是Google的产品，所以难免结合紧密。对于4.3以上的设备，用Chrome可以像调试PC网页那样来调试设备上的网页。只要在PC的Chrome上打开chrome://inpsect，选择网页就可以了。详细信息也请参考<a href="https://developer.chrome.com/devtools/docs/remote-debugging">官方网站</a>。</p>

<h2>参考</h2>

<ul>
<li><a href="https://css-tricks.com/all-about-floats/">https://css-tricks.com/all-about-floats/</a></li>
<li><a href="https://css-tricks.com/rems-ems/">https://css-tricks.com/rems-ems/</a></li>
<li><a href="http://stackoverflow.com/questions/8865458/how-to-align-text-vertically-center-in-div-with-css">http://stackoverflow.com/questions/8865458/how-to-align-text-vertically-center-in-div-with-css</a></li>
<li><a href="https://css-tricks.com/quick-css-trick-how-to-center-an-object-exactly-in-the-center/">https://css-tricks.com/quick-css-trick-how-to-center-an-object-exactly-in-the-center/</a></li>
</ul>


<h2>应该经常访问的网站</h2>

<ul>
<li><a href="http://www.w3schools.com/">http://www.w3schools.com/</a></li>
<li><a href="http://www.w3school.com.cn/index.html">http://www.w3school.com.cn/index.html</a></li>
<li><a href="http://www.css3maker.com/index.html">http://www.css3maker.com/index.html</a></li>
<li><a href="https://developer.mozilla.org/en-US/">https://developer.mozilla.org/en-US/</a></li>
<li><a href="https://css-tricks.com/">https://css-tricks.com/</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android布局技巧：使用TextView的drawable属性]]></title>
    <link href="http://toughcoder.net/blog/2015/05/20/android-layout-trick-drawable-of-textview/"/>
    <updated>2015-05-20T23:07:29+08:00</updated>
    <id>http://toughcoder.net/blog/2015/05/20/android-layout-trick-drawable-of-textview</id>
    <content type="html"><![CDATA[<p>在布局中Icon+文字组成一个视觉上的元素是非常普遍的需求，或者是成为一个可点击的整体，或者是展示某种信息。比如顶部导航栏（ActionBar或者是自已定义实现的类似功能的）都会有一个返回，通常都是一个向左的Icon加上一个文字标签。</p>

<p><a href="http://toughcoder.net/blog/2015/05/20/android-layout-trick-drawable-of-textview/"><img src="http://www.gaditek.com/blog/wp-content/uploads/2013/08/Android-App-Development-Tips-Tricks-for-Beginners.jpg" title="auto auto" ></a></p>

<p>这种需求实现起来也是非常的简单，初学安卓的同学也能很快的写出来，一个ImageView加上一个TextView，外面再包一层LinearLayout或者RelativeLayout。Okay，这没有问题，但有更好的实现方式，这需要三个View对象，一个外层group，一个ImageView一个TextView，可以仅使用一个TextView对象，达到同样的效果。</p>

<!-- more -->


<h2>TextView的drawable属性</h2>

<p>TextView有一些属性可以在Text的四周设置一个drawable对象，图片,shape等合法的drawable都可以用。</p>

<ul>
<li> drawableStart API 14才有</li>
<li> drawableLeft</li>
<li> drawableTop</li>
<li> drawableBottom</li>
<li> drawableRight</li>
<li> drawableEnd  API 14才有</li>
<li> drawablePadding 用以设置drawable与text之间的空间</li>
</ul>


<p><a href="http://developer.android.com/reference/android/widget/TextView.html#attr_android:drawableStart">它们的含义</a>就像其名字所暗示的那样，left/top/right/bottom就是在文字的上下左右放置drawable。而drawableStart和drawableEnd则有特殊的意义，虽然它们是API 14加上去的，但是要在API 17后才能真正的生效，它们的作用是当语言方向发生变化时，会换边，LTR语言drawableStart在左边，而drawableEnd在右边；但对于RTL语言来说就会反过来drawableStart在右，drawableEnd在左。可以看<a href="http://stackoverflow.com/questions/13907618/whats-the-different-between-drawableleft-and-drawablestart-in-edittext">这个解释</a>。</p>

<p><img src="http://7u2scv.com1.z0.glb.clouddn.com/tctextview-drawable.png"></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;TextView</span> <span class="na">android:text=</span><span class="s">&quot;Text along with Image\nsecond\nthird\nforth\nfifth&quot;</span> <span class="na">android:layout_width=</span><span class="s">&quot;400dip&quot;</span>
</span><span class='line'>        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>        <span class="na">android:drawableStart=</span><span class="s">&quot;@drawable/ic_launcher&quot;</span>
</span><span class='line'>        <span class="na">android:drawableLeft=</span><span class="s">&quot;@drawable/ic_launcher&quot;</span>
</span><span class='line'>        <span class="na">android:textSize=</span><span class="s">&quot;16sp&quot;</span>
</span><span class='line'>        <span class="na">android:paddingTop=</span><span class="s">&quot;10dip&quot;</span>
</span><span class='line'>        <span class="na">android:paddingBottom=</span><span class="s">&quot;10dip&quot;</span>
</span><span class='line'>        <span class="na">android:paddingLeft=</span><span class="s">&quot;10dip&quot;</span>
</span><span class='line'>        <span class="na">android:gravity=</span><span class="s">&quot;center&quot;</span>
</span><span class='line'>        <span class="na">android:drawablePadding=</span><span class="s">&quot;5dip&quot;</span><span class="nt">/&gt;</span>;
</span></code></pre></td></tr></table></div></figure>


<h2>TextView的drawable的一些注意事项</h2>

<ol>
<li>TextView的padding作用在drawable之外</li>
<li>TextView的高度或宽度为wrap_content时将是文字和drawable中较大的那一个，再加上padding和margin</li>
<li>gravity只对文字起作用，对drawable不起作用</li>
<li>drawable会在其所在的维度居中显示，比如drawableLeft是上下垂直居中的，以此类推</li>
</ol>


<h2>局限性</h2>

<p>有些时候它也有一些局限性而没有办法用它：</p>

<ol>
<li>当drawable本身没有高度时（比如shape），这个drawable高度就会依赖于文字，因为padding是加在drawable之外，所以只会依赖于文字的高度。有些时候这不是想要的结果。</li>
<li>当Icon需要与文字分开单独控制时，很显示这要分成二个View。</li>
<li>当需要对Icon进行特殊的个性化时，比如添加背景，特效等。</li>
<li>其他一些造成无法使用的。</li>
<li>除上述情况外，就要考虑使用drawable了。</li>
</ol>


<h2>why bother?</h2>

<p>有同学可能会问，有什么区别，为啥费这么大劲折腾，也就省了二个view对象而已嘛？这位同学可以坐下了，孤来说明下：首先，作为开发者要有永不止境的学习和优化的意识，即使带来的效果是微小的，能用一个对象搞定的，为啥用三个呢？其次，对于整体不复杂的页面，这样带来的效果确实不明显，但是对于超复杂的页面，页面的布局有上百个View时，比如Launcher或者淘宝系的应用，就会带来明显的收益。还有，汇集小溪而成大河，把所有小的点都优化到了极致，那么整体肯定会得到质的飞跃。</p>

<p>子曰：学无止境，技术和优化也无止境啊，各位同学可以多用用Google系的应用，以及国外的优质应用(Facebook, Twitter等），你会发现，虽然应用也很复杂，比如Google+它的页面里展示的元素也非常多，但是为什么用起来是那么流畅。就在于Google里的Android开发都是专家级的人物，他们牛在什么地方，就牛在他们总能用最好的方式来实现，就在于他们总能找到一个对象就能解决我们靠三个对象才能搞定的方法。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CSS Animation初探]]></title>
    <link href="http://toughcoder.net/blog/2015/05/04/introduction-to-css-animation/"/>
    <updated>2015-05-04T23:47:21+08:00</updated>
    <id>http://toughcoder.net/blog/2015/05/04/introduction-to-css-animation</id>
    <content type="html"><![CDATA[<p>动画在交互设计中是一个十分能加分的东西，用以平滑过度，会让用户体验上几个台阶。对于Web开发也是如此，恰当的使用动画可以让网页使用起来更加的用户友好。这里就来探讨一下CSS中一些动画的实现方式，初识前端，不足之处敬请指正。</p>

<p><a href="http://toughcoder.net/blog/2015/05/04/introduction-to-css-animation/"><img src="http://cssanimation.net/wp-content/uploads/2013/01/css3animation-banner.jpg" title="auto auto" ></a></p>

<!-- more -->


<h2>使用transition来实现动画</h2>

<p><a href="http://www.w3schools.com/css/css3_transitions.asp">transition</a>是CSS3中的属性，它的作用就是让CSS的属性以平滑的渐变动画方式来展现而非突然变化，因此可以用来实现一些简单动画。</p>

<p>语法：transition: property duration timing-function delay</p>

<table>
<thead>
<tr>
<th>Value               </th>
<th> Description </th>
</tr>
</thead>
<tbody>
<tr>
<td>property            </td>
<td> 要平滑过度的CSS属性</td>
</tr>
<tr>
<td>duration            </td>
<td> 平滑过度的时长（动画时长）</td>
</tr>
<tr>
<td>timing-function     </td>
<td> 定义过度效果的速度曲线</td>
</tr>
<tr>
<td>delay               </td>
<td> 过度效果何时开始</td>
</tr>
</tbody>
</table>


<p>像其他的CSS写法一样，这四个值也可以单独指定：</p>

<ul>
<li> transition-property</li>
<li> transition-duration</li>
<li> transition-timing</li>
<li> transition-delay</li>
</ul>


<h3>transition的特点</h3>

<ul>
<li> 每当有transtion所指定的属性发生变化时，动画就会被触发，当然也受transition-delay的控制</li>
<li> transition生效的前提是元素在DOM中，所以对于属性display: none之类的是不会起作用的</li>
</ul>


<p>更多关于transition的使用请参考<a href="https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Using_CSS_transitions">这篇文章</a>，相当的详细。</p>

<h2>使用transform来实现动画</h2>

<p><a href="http://www.w3schools.com/cssref/css3_pr_transform.asp">transform</a>是CSS3中新加的属性，用以对元素进行2D或3D的变换，这里变换的意思是几何变换，包括旋转，缩放，移动和倾斜旋转等。</p>

<ul>
<li> translate，translate3d, translateX, translateY, translateZ</li>
<li> rotate, rotate3d, rotateX, rotateY, rotateZ</li>
<li> scale, scale3d, scaleX, scaleY, scaleZ</li>
<li> skew, skewX, skewY</li>
</ul>


<p>用这些来指定是进行什么变换，就像名字所指的，translate是进行2D移动，如translate(10, 11)，translate3d是进行3d移动, 如translate3d(1, 0, 10)，后面带坐标轴就是在某一特定方向上移动，其他几个类似。</p>

<p>需要注意几点：</p>

<ul>
<li> transform只能定义几何变换，不能进行其他的，比如颜色，背景，透明度等非几何属性</li>
<li><p> 指定了transform会立即发生，所以要配合transition一起来使用
 用transition来为transform指定时长，变化曲线以及delay的等关键的动画参数，才能成为真正的动画，否则transform也不会有动画效果。如：</p>

<pre><code class="`css"> transform: translate3d(10, 20, 30);
 transition: transform 300 ease-in;
</code></pre></li>
<li> translate移动的距离是相对于没有transform时的位置
 比如说某元素原来位置是100， 100, 那么translate(10, 10)，后的位置是110, 110，接着再translate(-10, -10)，后位置是90, 90.</li>
<li> 还有就是对于translate最好使用translate3d，尽管可能只是一维的移动，translate3d要更平滑一些。</li>
</ul>


<h2>使用key-frame来实现动画</h2>

<p><a href="http://www.w3schools.com/cssref/css3_pr_animation-keyframes.asp">@keyframe</a>规则是专门用来做动画的，它可以指定具体到某一帧的状态是什么样子的，以整数百分比来指定帧数，再给定CSS属性，就组成了一组状态的变化。比如：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="k">@keyframes</span> <span class="nt">mymove</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">0</span><span class="o">%</span>   <span class="p">{</span><span class="k">top</span><span class="o">:</span> <span class="m">0px</span><span class="p">;}</span>
</span><span class='line'>    <span class="nt">25</span><span class="o">%</span>  <span class="p">{</span><span class="k">top</span><span class="o">:</span> <span class="m">200px</span><span class="p">;}</span>
</span><span class='line'>    <span class="nt">50</span><span class="o">%</span>  <span class="p">{</span><span class="k">top</span><span class="o">:</span> <span class="m">100px</span><span class="p">;}</span>
</span><span class='line'>    <span class="nt">75</span><span class="o">%</span>  <span class="p">{</span><span class="k">top</span><span class="o">:</span> <span class="m">200px</span><span class="p">;}</span>
</span><span class='line'>    <span class="nt">100</span><span class="o">%</span> <span class="p">{</span><span class="k">top</span><span class="o">:</span> <span class="m">0px</span><span class="p">;}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>就是一个简单的移动动画。
具体的可以参考<a href="http://www.smashingmagazine.com/2011/05/17/an-introduction-to-css3-keyframe-animations/">这篇文章</a>，讲述的还是很清楚的。</p>

<h2>如何选择</h2>

<p>一般来说，如果是移动，旋转或者缩放就使用transform就够了。如果要变化颜色，或者背景色或者可见度，就使用transition就好了。如果是复杂的动画，比如控制多个元素同时做动画，或者动画本身比较复杂还是使用@keyframes。</p>

<h2>流行的动画库</h2>

<p><a href="http://codegeekz.com/css-effect-libraries-creating-beautiful-animations/">这个文章</a>列的很详细，就不再单独的列出来了。如果你知道有其他的库也请与我分享。</p>

<h2>一些不错的资源和网站</h2>

<ul>
<li> <a href="http://www.css3maker.com/index.html">CSS3 Maker</a></li>
<li> <a href="https://css-tricks.com/">CSS tricks</a></li>
<li> <a href="http://caniuse.com/">Can I Use</a></li>
</ul>


<h2>参考</h2>

<ul>
<li> <a href="http://www.smashingmagazine.com/2011/05/17/an-introduction-to-css3-keyframe-animations/">An Introduction To CSS3 Keyframe Animations</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android实战技巧：Fragment的那些坑]]></title>
    <link href="http://toughcoder.net/blog/2015/04/30/android-fragment-the-bad-parts/"/>
    <updated>2015-04-30T00:40:26+08:00</updated>
    <id>http://toughcoder.net/blog/2015/04/30/android-fragment-the-bad-parts</id>
    <content type="html"><![CDATA[<p>Fragment是Android在3.0（Homeycomb)版本时加入的用以更灵活的构建多屏幕界面的可UI组件。关于Fragment以基本使用方法可以参考官方的<a href="http://developer.android.com/guide/components/fragments.html">教程</a>和<a href="http://developer.android.com/training/basics/fragments/index.html">最佳实践</a>，以及<a href="http://toughcoder.net/blog/2014/10/22/effective-android-ui-architecture/">选择Activity还是Fragment</a>。
但是Fragment使用起来却远没有教程中说的那样简单，也远比Activity要复杂一些，这里总结了孤在使用Fragment时所遇到的坑。</p>

<p><a href="http://toughcoder.net/blog/2015/04/30/android-fragment-the-bad-parts/"><img src="http://www.opensourceforu.com/wp-content/uploads/2011/05/Figure-1-Design-Principle.png" width="480" height="320"></a></p>

<!-- more -->


<h2>嵌套Fragment时Duplicated id或者Tag之痒</h2>

<p>这是一个小坑，但是初学者很容易遇到，特别是在Fragment之中套有Fragment时，且又是布局中添加子Fragment时更容易遇到。</p>

<h3>现象：</h3>

<p>Fragment中套有另一个Fragment，当第二次进入父Fragment时或者由Fragment创建的界面时会抛异常，大致意思是子Fragment的Id或Tag重复了。如果你在layout中给子fragment加了id或者tag，那么一定会遇到此异常。</p>

<h3>原因：</h3>

<p>在添加Fragment时都可以为Fragment指定一个Id或者Tag用以标识这个Fragment。因为每个Activity所附带的Fragment都是放在一个对象池中，在Activity的生命周期里，Fragment仍然在池中，即使是把某一个Fragment从Activity中detach掉（也即用FragmentManager pop掉），这个池是由FragmentManager来管理的。当你再次要以某个id或者Tag添加Fragment时，FragmentManager会在池中检索，如果发现已经存在Fragment对象带有此Id或者Tag时，就会抛此异常并报怨Id重复。这么做的目的就是减少对象的创建，尽可以的复用对象。</p>

<h3>如何破解：</h3>

<ol>
<li>在布局中写fragment时，不要添加id或者tag；</li>
<li><p>如果非要添加id或者tag，就在代码中添加fragment，如使用Id或者Tag时，先到FragmentManager中查找对象是否存在，不存在时再创建，也即：</p>

<pre><code class="java">  Fragment target = getFragmentManager().findFragmentByTag("tag");
  if (target == null) {
      targe = new SomeFragment();
  }
  FragmentTransaction ft = getFragmentManager().beginTransaction();
  ft.add(R.id.content, target, "tag");
  ft.commit();
</code></pre></li>
</ol>


<h2>replace之痛</h2>

<h3>现象：</h3>

<p>当有二个相同的整体页面层叠时，想把最后一个布局中的某个用Fragment来replace，会发现，它把前面的replace，后面的没效果。</p>

<h3>原因：</h3>

<p>布局的Id在一个窗体（Activity)中是唯一的，Fragment的replace也是使用此唯一的Id来把相应布局替换成Fragment的。当相同的页面层叠时，同一个Id的布局出现了二次，但Id是一样的。所以FragmentTransaction在replace时仅替换了一个。而不会像期待的那样，替换最后一个页面。</p>

<h3>如何破解：</h3>

<p>如果相同的页面非要层叠，要么不使用Fragment，要么为布局设置不同的Id。这种情况多出现在布局的复用上面，比如某二个页面长的像，所以复用了同一整体布局。但实际的逻辑上不是相同的页面，完全可以为布局设置不同的Id。</p>

<h2>可见性之疼</h2>

<h3>现象：</h3>

<p>当有多个Fragment层叠在一起时，每个Fragment如何能感知其对用户的可见性。比如应用有三个页面，A，B和C，比如A是整体类别列表，B是每个类别的详情，C又是类别的某种更详细的信息，当C显示出来时，A和B怎么能知道它其实对于用户已经不可见了，所以就可以不刷新，不加载数据等等。当C被用户BACK后，B又如何感觉它变成可见了？</p>

<h3>原因：</h3>

<p>Fragment的生命周期与Activity是一样的，添加到Activity会把OnCreate类似的回调走一遍，然后，Activity onResume/onPause/onstart/onStop时，其所持有的Fragment也走相应的onResume/onPause/onstart/onPause。但是Fragment与Activity非常不同的是，Activity当有另一个Activity显示时，当前的Activity会走onPause/onStop，而Fragment则完全没有感知。最多只能从FragmentManager那里知道BackStackState改变了，但是是Fragment增加了，还是减少了，并不能知道。</p>

<h3>如何破解：</h3>

<p>这个一个非常令人蛋疼的问题，简单的页面还好，但是涉及到数据加载或者要针对某些事件（网络）刷新时就有问题了，对用户不可见的页面没必要刷新。可行的解法就是：</p>

<ol>
<li>监听FragmentManager的BackStackState的改变</li>
<li>定义页面路径深度然后与BackStack深度比较，以感知是否对用户可见
  如前面A是一级，其path为1，B是2，C是3。当前Stack深度为3时，C是可见的，A与B不可见，以此类推。</li>
</ol>


<h2>空白区域的点击之脓</h2>

<h3>现象:</h3>

<p>一个Fragment，层叠在另外一个Fragment或者Activity之上，此Fragment中有一些空白区域，也即Widget之外的空白区域，当点击这些空白区域的时候发现这个Fragment下面的Fragment或者Activity中的View收到了事件并且响应了点击事件。</p>

<h3>原因：</h3>

<p>Fragment的本质就是一个View布局的管理器，当Fragment attach到Activity时，其实就是把Fragment#onCreateView()返回的View，替换掉(如果是用replace)FragmentTransaction#replace中指定的View，或者添加到(如果是add)FragmentTransaction#add()中指定的ViewGroup里面。</p>

<p>当我们以层叠方式显示多个Fragment时，通常的做法就是弄一个FrameLayout，然后每次把Fragment add到此布局。因此，这时Activity的页面布局树实际上就是一个FrameLayout里面包含几个View。</p>

<p>所以，当点击上面Fragment的空白区域时，如果事件没被吃掉，就会向下传递。</p>

<h3>如何破解：</h3>

<p>在Fragment的根布局加上一个clickable=true，这会让根布局把点击事件吃掉，以防止事件会继续传递下去，造成上面的情况。</p>

<h2>Activity重新创建之殇</h2>

<h3>现象：</h3>

<p>这个没有一般性的错误，只会有与项目相关的具体的错误异常，或者页面显示不正确。以及为什么教程中都有这么一句：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="n">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstance</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>   <span class="k">if</span> <span class="o">(</span><span class="n">savedIntance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="c1">// create fragment and add it to Activity.</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>原因：</h3>

<p>Activity除了正常启动走到onCreate，还有另外的入口，比如系统配置信息发生变化时，或者Activity在栈比较深的地方，系统会把Activity杀掉，然后再<em>重新创建</em>它，问题就是在这个重新创建。重新创建与新建一个Activity不同，它是要尽可能的恢复先前所在的状态，因为这对用户来说是透明的，也就是说不能让用户感知到，否则体验会相当差。唯一与常规创建的区别就在于传给onCreate的参数savedInstanceState是不是null.</p>

<h3>如何破解：</h3>

<p>为了能在Activity重建时恢复状态，需要：</p>

<ol>
<li><p>对于Activity</p>

<p>要在onSaveInstanceState()时，把一些变量保存，然后在onCreate时恢复</p></li>
<li><p>对于Fragment</p>

<p>告诉系统，你想恢复状态Fragment#setRetainInstance(true)。然后，也在onSavedInstance()中保存状态，在onCreate时恢复。
这就够了，系统会在重新创建Activity时把其所持有的Fragment也创建出来。所以为什么每个Fragment子类都需要定义一个默认的Constructor。更多的可以参考<a href="http://www.androiddesignpatterns.com/2013/04/retaining-objects-across-config-changes.html">这篇文章</a>。</p></li>
</ol>


<h2>FragmentTransaction的异步操作之殇</h2>

<p>FragmentTransaction是异步的，commit()仅是相当于把操作加入到FragmentManager的队列，然后FragmentManager会在某一个时刻来执行，并不是立即执行。所以，真正开始执行commit()时，如果Activity的生命周期发生了变化，比如走到了onPause，或者走到了onStop，或者onDestroy都走完了，那么就会报出IllegalStateException。具体的原因，以及如何避免可以参考大牛的<a href="http://www.androiddesignpatterns.com/2013/08/fragment-transaction-commit-state-loss.html">这篇文章</a>。</p>

<h2>参考</h2>

<ul>
<li><a href="http://developer.android.com/guide/components/fragments.html">Fragments</a></li>
<li><a href="http://developer.android.com/training/basics/fragments/index.html">Building a Dynamic UI with Fragments</a></li>
<li><a href="http://www.androiddesignpatterns.com/2013/08/fragment-transaction-commit-state-loss.html">Fragment Transactions &amp; Activity State Loss</a></li>
<li><a href="http://www.androiddesignpatterns.com/2013/04/retaining-objects-across-config-changes.html">Handling Configuration Changes with Fragments</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android NDK开发的一些技巧]]></title>
    <link href="http://toughcoder.net/blog/2015/04/27/android-ndk-backward-compatibility/"/>
    <updated>2015-04-27T23:34:58+08:00</updated>
    <id>http://toughcoder.net/blog/2015/04/27/android-ndk-backward-compatibility</id>
    <content type="html"><![CDATA[<p>Android NDK(Native Development Kit)是基于Java JNI的使用C/C++和Java来混合开发应用的一种方式，甚至在Android 2.3(API 9)以后可以用Native(Native这个字在不同的语境中意义是不一样的，这里指的是JNI中的C/C++的代码；如果放在Hybrid中Native就是指平台原生的语言和API)代码来创建标准界面组件Activity，换句话说就可以用纯C/C++来写一个Android应用，但是貌似还没有人这么干过，这只是一种理论上的可能性。因为除了Activity以外很多东西比如权限，广播通知等等很多东西在Native中还是不够方便。</p>

<p><a href="http://toughcoder.net/blog/2015/04/27/android-ndk-backward-compatibility/"><img src="http://androids.zone/wp-content/uploads/2014/06/android-ndk.jpg" title="auto auto" ></a></p>

<!-- more -->


<h2>函数签名的写法</h2>

<p>Java代码中调用Native的代码还是比较简单的，把方法声明成为native，然后可以当作普通的Java方法一样来使用，只不过这个native的方法的实现是在Native中。</p>

<p>JNI是一个桥梁，让不同的语言能够在一起使用，不但Java能调用Native层代码，在Native层也是能够调用Java的代码。但是JNI的最初目的是能够让Java使用C/C++语言来解决Java做不到的事情，所以在Native中调用Java的方法要稍微费一点劲。要获取JNI的执行环境(JNIEnv)，要找到类和对象，更重要的是要写对函数签名，否则是找不到的。</p>

<h3>函数签名的写法</h3>

<p>&ldquo;(<em>[type1]</em>;<em>[type2]</em>&hellip;)<em>[return types]</em>&rdquo;</p>

<p>type包括：</p>

<ul>
<li> B = byte</li>
<li> C = char</li>
<li> D = double</li>
<li> F = float</li>
<li> I = int</li>
<li> J = long</li>
<li> S = short</li>
<li> V = void</li>
<li> Z = boolean</li>
<li> V = void</li>
<li> Lfully-qualified-class = fully qualified class. For instance String &ndash; Ljava/lang/String;</li>
<li> [type = array of type</li>
</ul>


<p>Samples:
   * &ldquo;(Ljava/lang/String;I)V&rdquo; // void foo(String str, int limit);</p>

<h2>线程解惑</h2>

<p>Native的代码是执行在其直接调入的Java的方法所在的调用栈里的，比较绕，简单来说吧，JNI的方法也是一个方法，只不过它是在Native层实现的，所以都是一系列的方法的调用，因此调用栈从Java层开始，一直到Native，JNI不会改变调用栈，因此也不会改变线程环境，除非你让它改变。</p>

<p>当你改变线程时，就要注意了，如果你在Native用pthread开启了一个新的线程，且这个线程又需要与Java通信，要调用Java层的方法，那么常规的方式是不行的，要先把线程attach到JNI环境，findClass也不会找到相应的类，因为这个线程是pthread_create出来的，不具备JNI的环境，甚至常规的类，方法和对象的引用在新衍生出的线程中统统都是无效的。</p>

<p>那么该如何做呢？首先，要先调用AttachCurrentThread来把线程attach到JVM；然后，把要在此线程里访问的Java类，方法和对象生成JVM的Global引用，也就是NewGlobalRef来保存引用；最后，当完成与Java的通信后要调用DetachCurrentThread来做detach。</p>

<h2>注意内存问题</h2>

<p>到了Native的环境，就要注意内存问题，因为Native的代码都是要手动的申请内存，手动的释放。当然，业务逻辑里面的申请和释放用标准的new/delete或者malloc/free，或者用智能指针之类的。JNI部分是有封装好的方法的，比如NewGlobalRef，NewLocalRef, DeleteGlobalRef, DeleteLocalRef等。</p>

<p>需要注意的是用这些方法创建出来的引用要及时的删除。因为这些引用都是在JVM中一个表中存放的，而这个表是有容量限制，当到达一定数量后就不能再存放了，就会报出异常。所以要及时删除创建出来的引用。</p>

<h2>版本的兼容性</h2>

<p>使用SDK开发应用时可以用minsdk和targetsdk来解决版本的兼容性问题，minsdk指定最低SDK版本要求，targetsdk指定目标的版本。但在NDK，只能用一个android-target来指定最低的版本要求，其实这就是限定了在NDK你能使用的API的范围。为了保证最好的兼容性，要保证NDK中的android-target与minsdk保持一致。</p>

<p>SDK中的做法是指定了minsdk后，选择尽可能高的targetsdk，这样可以获取最好和最新的编译toolchains的支持。但是NDK中不建议这样做，尽管你没有使用高版本的API，但是使用高版本来编译会链到高版本的库，有可能会导致问题，因为高版本的某些API实现方式会变。比如signal.h中的signal函数，如果使用android-21编译，那么在低于5.0 版本的手机上是跑不起来，错误是无法找到signal函数，原因就是5.0以后signal.h中的signal函数的实现方式变了。</p>

<h2>支持64位</h2>

<p>5.0开始，Android有了64位处理器了。对于以Java作为平台语言的Android来说，特别是广大的应用开发者来说，这并不需要做什么特殊的处理。但是对于涉及到Native的代码时就要注意了，在编译的时候要为arm64准备东西了。在编译的时候要为arm64编译出一个target。</p>

<p>但是问题来了，arm64只有当android-target设置为21时才能编译出来，而我们的应用不可能只target到5.0，前面讲到了我们要对齐到最低版本。解决方案就是构建二次：</p>

<ul>
<li> 第一次正常target到最低版本构建出arm和armeabi-v7a的库</li>
<li> 第二次target到21，编译出arm64的库</li>
</ul>


<p>再把这些so打包起来就可以了。</p>

<h2>多多参考NDK文档以及官方教程和指导</h2>

<p>使用任何的别人提供的东西，最好获取帮助的方式就是看人家给你的文档和指导。现在的文档都写的很详细了。Android开发者官网上面也有很多关于NDK开发的<a href="http://developer.android.com/training/articles/perf-jni.html">教程</a>，都值得仔细读一读的。</p>

<h2>使用第三方工具来简化开发</h2>

<p>最好的开发方式不是自己写，而是去用别人现有的东西，子曰：不能重复造轮子。NDK的开发，也是有一些第三方的工具来帮助我们减少开发量的。<a href="http://swig.org/">SWIG</a>就是一个优秀的工具，它能免去写丑陋的JNI方法的痛苦，而且SWIG是编译工具链的一个组件，不是运行时，所以不会带来性能上的损失。</p>

<h2>不错的书籍</h2>

<p><a href="http://www.apress.com/9781430248279">《Pro Android C++ with NDK》</a>是一本相当不错的书籍，有中文版本了，可以好好的读一读。</p>

<h2>参考资料</h2>

<ul>
<li><a href="http://docs.oracle.com/javase/6/docs/technotes/guides/jni/spec/invocation.html">The Invocation API</a></li>
<li><a href="http://docs.oracle.com/javase/7/docs/technotes/guides/jni/spec/functions.html">The JNI Functions</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用Octopress和Github Pages搭建博客的高级技巧]]></title>
    <link href="http://toughcoder.net/blog/2015/04/22/advanced-tricks-of-github-pages-with-octopress/"/>
    <updated>2015-04-22T23:40:13+08:00</updated>
    <id>http://toughcoder.net/blog/2015/04/22/advanced-tricks-of-github-pages-with-octopress</id>
    <content type="html"><![CDATA[<p>如何果还不知道如何使用Octopress和Github Pages搭建的同学可以参考<a href="http://toughcoder.net/blog/2014/10/16/blogging-like-a-hacker-with-github-pages/">码农的救赎：使用Github Pages搭建博客</a></p>

<p><a href="http://toughcoder.net/blog/2015/04/22/advanced-tricks-of-github-pages-with-octopress/"><img src="http://blog.robinchutaux.com/images/blog/octopress-logo.png" title="auto auto" ></a></p>

<!-- more -->


<h2>提升速度</h2>

<p>按照教程搭建好的博客，访问起来总是很慢很慢，即使把什么Google Plus和Google Analyze之类的都关闭掉后，仍然很慢。原因就是在HTML中的某些资源，比如脚本或者字体什么的是使用Google提供的，所以就会慢，那么怎么解决呢？就是用国内的替代品。<a href="http://libs.useso.com/">360</a>提供了几个Google的替代库，跟Google是一样的，只需要找到代码，把链接替换360的就可以了。至此发现360还真是一个良心企业。
具体的就是把source/<em>include/head.html和source/</em>include/custom/head.html中的fonts.google.com和ajax.google.com都替换成userso.com然后就Okay，速度哗哗的。</p>

<h2>为图片选择存储</h2>

<p>Github为我们的博客提供免费的存储空间，其实也可以把图片直接在我们博客的源码里，这样就会传到Github上面去。但是这样子会有问题，一是增加博客占用的空间，虽然Github免费，且没有限制，但是天长是久以后就不好说了； 另外就是Github访问速度要慢一些，至少对于我大天朝是如此。所以选择国内的云存储就显得百分有必要了。
推荐使用<a href="http://www.qiniu.com/">七牛</a>，原因是：</p>

<ol>
<li>有免费空间</li>
<li>可以对每个文件进行公开，且有稳定链接，即使文件后来编辑过</li>
<li>有命令行工具可以进行批处理</li>
</ol>


<p>使用方法的话看官方的<a href="http://developer.qiniu.com/docs/v6/tools/qrsync.html">文档</a>就可以了，安装下它的命令行工具，把图片放到要同步的目录，然后同步。创建一个公开的Bucket，然后放图片于其中，同步上传后就可以得到链接了。</p>

<h2>Mac下的优质Markdown编辑器</h2>

<p><a href="http://25.io/mou/">Mou</a>是我先前推荐的，但是最近发现Mou总是莫名的卡顿，总是会卡上个几秒钟，无论做什么操作，很是让人难以忍受。
于是<a href="http://macdown.uranusjr.com/">MacDown</a>就出现了，它免费而且开源，与Mou的体验类似，其实它是参考了Mou也是受Mou启发而开发的。速度相当不错。</p>

<h2>One more thing&hellip;</h2>

<p>Octopress的<a href="http://octopress.org/">新版本</a>正在紧锣密鼓的开发，相传会有质的改变，喜欢像写代码一样写作的人可以期待与关注。</p>

<h2>参考</h2>

<ul>
<li><a href="http://diufanshu.github.io/blog/2015/01/03/you-guan-bo-ke-dao-jia-zai-su-du/">有关博客的加载速度</a></li>
<li><a href="http://www.jianshu.com/p/6c157af09e84">Mac 下两款 Markdown 编辑器 Mou/MacDown 大 PK</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[在安卓设备与PC之间传递文件]]></title>
    <link href="http://toughcoder.net/blog/2015/04/21/transfer-files-between-android-phone-and-pc/"/>
    <updated>2015-04-21T23:01:11+08:00</updated>
    <id>http://toughcoder.net/blog/2015/04/21/transfer-files-between-android-phone-and-pc</id>
    <content type="html"><![CDATA[<p>现在智能手机（这里的手机是广义的，包括手机，平板电脑等移动智能设备）在生活中的角色越来越重要，人们使用手机的时间远远大于电脑，由于手机的便携性，所以很多时候我们会需要用手机来携带数据或文件，或者用于娱乐。比如乘坐火车或者汽车时，用手机来看个电影还是相当不错的，现在的手机屏幕也够大，存储空间充足，完全不成问题。虽然移动端也有足够多的客户端可以下载视频等，但是远没有PC资源多，也没有PC下载方便。但是下载后如何把视频弄到手机上面，以及当需要把其他一些文件弄到手机上面时，也是一个技术问题，今天就来探讨一下。</p>

<p><a href="http://toughcoder.net/blog/2015/04/21/transfer-files-between-android-phone-and-pc/"><img src="http://image.pavtube.com/img/guide/2013/2013-02/android-file-transfer.jpg" title="auto auto" ></a></p>

<!-- more -->


<h2>用第三方的软件</h2>

<p>比如说QQ之类的，它都有一个功能就是在不同设备之间传递文件特别是PC端与移动端，只要在PC上面和移动设备上面都安装了QQ较新版本的客户端，就可以用其传递文件。孤没有亲测，但估计效果还是可以的，但是对于像高清电影这样的G级别的大文件不知道效果如何了。</p>

<h3>优点</h3>

<p>  使用简单方便，不需要任何技术基础或折腾技术相关的东西</p>

<h2>直接把手机当成U盘（2.3及以下版本适用）</h2>

<p>以前的安卓版本当手机连接上电脑以后，是直接可以把连接的存储方式设置成为大容量存储，这样手机就直接相当于一个U盘。具体的操作方法就是手机连上电脑后，通知栏会有一个通知是存储相关的，点击后就可以把手机挂载成为一个U盘，再次点击之后会关闭。绝大多数手机只有当插入有SD扩展卡时才能如此做。</p>

<h3>优点</h3>

<p>   使用简单方便</p>

<h3>缺点</h3>

<p>   Android 2.3及以下版本才可以</p>

<h2>使用ADB命令</h2>

<p>我相信大多数Android用户对于adb命令并不会陌生，即使没有开发经验或者不懂技术，如何折腾过刷机或者Root的同学应该至少对adb命令有一个印象。对于有开发经验的同学就更不用说了，如果连adb都不知道那你的安卓开发肯定是体育老师教的。
ADB的使用是比较折腾的，非技术的同学可能会有些困难：</p>

<ol>
<li>下载Android SDK</li>
<li>对于Windows要安装设备的驱动，Linux和Mac则不用</li>
<li>对于Linux要配置udev权限，可参考官方文档</li>
<li>手机要激活USB调试：设置->开发者选项->USB调试</li>
</ol>


<h3>优点</h3>

<p>   其实没什么优点，对于开发者同学们来说这只是没有额外的事情折腾，传递一些小文件来说ADB命令还是非常方便的</p>

<h3>缺点</h3>

<ol>
<li>非常的折腾，特别是针对不是安卓开发者同学来说</li>
<li>对于百兆以上的大文件 来说，速度非常慢</li>
<li>需要对手机的存储机制在所了解，因为adb push是需要指定手机上目标文件夹</li>
</ol>


<h2>使用MTP协议传输</h2>

<p>这是本文的重点。
Android 4.0及以上的版本当连接到PC时，通知栏也会有一个与存储机制相关的通知可以选择是以相机方式还是MTP方式挂载手机的存储：如果是相机模式，那么可以直接访问手机里的相册；MTP则用于传递文件。
<a href="http://en.wikipedia.org/wiki/Media_Transfer_Protocol">MTP</a>是媒体传输协议(Media Transfer Protocol)的简称，它是一种在设备之间传输媒体文件的协议，这是一种标准的公开的协议，理论上讲能与任何支持MTP协议的设备进行传输。当安卓设备连接到电脑时，选择MTP方式后，即可以使用MTP协议来传送文件。</p>

<h3>Windows和Mac</h3>

<p>对于Windows和Mac，Google有专门的客户端，可以到<a href="http://www.android.com/filetransfer/index.html">官网</a>了解详情，使用不难，安装客户端，连接手机选择MTP模式即可。</p>

<h3>Linux</h3>

<p>Linux（这里以Ubuntu为例，其他发行版本类似）稍微折腾一点，因为没有官方的客户端，所以需要安装第三方的工具：</p>

<ol>
<li>安装工具：sudo apt-get install mtp-tools mtpfs</li>
<li><p>配置</p>

<pre><code>  sudo service udev start
    sudo mkdir /media/nexus
    sudo chmod a+xrw /media/nexus
    sudo adduser $USER fuse
</code></pre>

<p>  sudo vim /etc/fuse.conf并把最后一行&#8217;user_allow_other&#8217;打开注释（删除行首的‘#’）</p></li>
<li><p>创建命令别名
  vim ~/.bashrc在其中添加：</p>

<pre><code>   alias android-connect='mtpfs -o allow_other /media/nexus'
   alias android-disconnect='fusermount -u /media/nexus'
</code></pre></li>
<li><p>重启电脑</p></li>
<li>连接手机，运行android-connect后，/media/nexus/即是手机的存储，可以自由的传递文件了</li>
</ol>


<p>使用MTP方式对于大文件或者多文件的文件夹都是毫无压力的，速度略逊于U盘。</p>

<h2>参考</h2>

<ul>
<li> <a href="http://askubuntu.com/questions/207569/how-do-i-connect-a-nexus-7-to-transfer-files">How do I connect a Nexus 7 to transfer files?</a></li>
<li> <a href="http://en.wikipedia.org/wiki/Media_Transfer_Protocol">Media Transfter Protocol</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[诡异的EOF Exception]]></title>
    <link href="http://toughcoder.net/blog/2015/01/31/unexpected-eof-exception/"/>
    <updated>2015-01-31T17:00:39+08:00</updated>
    <id>http://toughcoder.net/blog/2015/01/31/unexpected-eof-exception</id>
    <content type="html"><![CDATA[<p>近日在写一个简单的HTTP代码中遇到了诡异的EOFException,当读取ResponseCode的时候就抛出了EOF异常,感觉很诡异,下面进行问题还原,以及分析和解决过程.</p>

<h2>问题</h2>

<p>有问题的代码如下:</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kt">void</span> <span class="nf">testEcho</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">payload</span> <span class="o">=</span> <span class="s">&quot;The quick brown fox jumps over the lazy dog.&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">HttpURLConnection</span> <span class="n">conn</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>        <span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">ep</span> <span class="o">=</span> <span class="n">Base64</span><span class="o">.</span><span class="na">encodeToString</span><span class="o">(</span><span class="n">payload</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">Base64</span><span class="o">.</span><span class="na">URL_SAFE</span><span class="o">);</span>
</span><span class='line'>            <span class="n">URL</span> <span class="n">u</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">URL</span><span class="o">(</span><span class="s">&quot;http://httpbin.org/get?p=&quot;</span> <span class="o">+</span> <span class="n">ep</span> <span class="o">+</span> <span class="s">&quot;&amp;key=testEcho&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="n">conn</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpURLConnection</span><span class="o">)</span> <span class="n">u</span><span class="o">.</span><span class="na">openConnection</span><span class="o">();</span>
</span><span class='line'>            <span class="n">conn</span><span class="o">.</span><span class="na">setRequestMethod</span><span class="o">(</span><span class="s">&quot;GET&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="n">conn</span><span class="o">.</span><span class="na">setDoInput</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>            <span class="n">conn</span><span class="o">.</span><span class="na">setDoOutput</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>            <span class="n">conn</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">conn</span><span class="o">.</span><span class="na">getResponseCode</span><span class="o">()</span> <span class="o">!=</span> <span class="n">HttpURLConnection</span><span class="o">.</span><span class="na">HTTP_OK</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;http res &quot;</span> <span class="o">+</span> <span class="n">conn</span><span class="o">.</span><span class="na">getResponseCode</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;, msg : &quot;</span> <span class="o">+</span> <span class="n">conn</span><span class="o">.</span><span class="na">getResponseMessage</span><span class="o">());</span>
</span><span class='line'>                <span class="k">return</span><span class="o">;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>            <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nf">InputStreamReader</span><span class="o">(</span><span class="n">conn</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">buf</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>            <span class="k">while</span> <span class="o">((</span><span class="n">buf</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;HTTP res: &quot;</span> <span class="o">+</span> <span class="n">buf</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">br</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">br</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">conn</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">conn</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;ioexception &quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这段代码进行后会在getResponseCode()这行抛出EOFException:
<a href=""><img src="http://7u2scv.com1.z0.glb.clouddn.com/eof.png" title="auto auto" ></a>
很疑惑,百思不得解,这是一个简单的GET请求,却抛出了这样难以理解的异常.于是去Google,发现都认为是Android本身的问题,要加上connection close</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">conn</span><span class="o">.</span><span class="na">setRequestProperty</span><span class="o">(</span><span class="s">&quot;Connection&quot;</span><span class="o">,</span> <span class="s">&quot;close&quot;</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>比如,<a href="http://stackoverflow.com/questions/19258518/android-httpurlconnection-eofexception">这个讨论</a>,以及<a href="http://stackoverflow.com/questions/15411213/android-httpsurlconnection-eofexception">这个讨论</a>.
尝试了,但仍没有解决掉抛出的EOFException.</p>

<h2>分析与解决</h2>

<p>这个时候就要冷静的分析下,先从根本开始,怀疑一切,把请求的每一句都打印出来,突然发现URL竟然含有一个CRLF换行符(\r\n). 感觉奇怪,于是查阅文档,发现Base64在编码的时候会默认给结果加上CRLF以换行,于是再加一个Flag, NO_WRAP后,问题解决:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="n">String</span> <span class="n">ep</span> <span class="o">=</span> <span class="n">Base64</span><span class="o">.</span><span class="na">encodeToString</span><span class="o">(</span><span class="n">payload</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="n">Base64</span><span class="o">.</span><span class="na">URL_SAFE</span> <span class="o">|</span> <span class="n">Base64</span><span class="o">.</span><span class="na">NO_WRAP</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<h2>深入分析</h2>

<p>问题是解决了,但感觉没有完全弄明白.于是做了多次尝试,发现只要URL中部含有换行(\n或\r\n)都会引发此问题,而在尾部则没事.
<a href="http://7u2scv.com1.z0.glb.clouddn.com/eof_req.png"><img src="http://7u2scv.com1.z0.glb.clouddn.com/eof_req.png" title="auto auto" ></a>
这是请求包
<a href="http://7u2scv.com1.z0.glb.clouddn.com/eof_res.png"><img src="http://7u2scv.com1.z0.glb.clouddn.com/eof_res.png" title="auto auto" ></a>
这是Server回应</p>

<p>通过抓包可以看出,换行符会导致发送的HTTP请求包不完整,Server返回也认为HTTP是trunk的,所以期待更多的数据,因此这个时候是没有response的,任何对response的读操作(getResponseCode(), getResponseMessage(), getInputStream())都会立即抛出EOFException.</p>

<h2>总结</h2>

<p>虽然这个问题不大,但是也还值得总结一下:</p>

<ol>
<li><p>遇到问题先检查没犯低级错误</p>

<p>也就是说,当遇到诡异的问题时,先查看文档,检查参数,确保是否是在按正确的方式在做事情,这很关键,因为很多时候都是我们犯了低级错误,比如拼写错误,或者没传正确的参数,或者解错了API等.因为越是简单的错误越容易被忽略.</p></li>
<li><p>问Google和其他人</p>

<p>Google一下或者问下身边的人,可能会很有帮助</p></li>
<li>如果还搞不定,那就真的是遇到难题了,这个时候只能去查阅源码和书籍,定位出问题,分析原因,解不解得了,就看造化了.</li>
<li><p>找Plan B</p>

<p>不用认死理儿,一条路不通,可走另外的路,或者搭个桥什么的.</p></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[从手机丢失看数据安全]]></title>
    <link href="http://toughcoder.net/blog/2015/01/30/security-concerns-after-phone-stollen/"/>
    <updated>2015-01-30T21:30:39+08:00</updated>
    <id>http://toughcoder.net/blog/2015/01/30/security-concerns-after-phone-stollen</id>
    <content type="html"><![CDATA[<p>手机在现代生活中扮演重要角色，里面有大量的隐私和数据，手机银行，支付宝等都能操作个人的财产，所以手机的安全也越来越重要，一旦手机丢失，造成的不仅仅是一部手机的损失，还可能造成隐私的泄露，重要数据的丢失以及财产的损失。</p>

<h2>手机丢失后应该做的事情</h2>

<p>2015年1月28日下班，晚上七点左右在挤公交车，可能上车时，手机（红米Note）被偷，由于平日里都是骑自行车上下班，只是偶尔遇到不好的天气才会坐公交，刚好那天是2015年的第一场雪，下了一天多没停，不方便骑车，所以就坐公交，正值下班时人又多又挤，估计是上车时被小偷钻了空子。</p>

<p><a href="http://toughcoder.net/blog/2015/01/30/security-concerns-after-phone-stollen/"><img src="http://cdn.techpatio.com/wp-content/uploads/2012/12/cellphone-lock-safety-security.jpg" title="auto auto" ></a></p>

<p>先是打了个电话，确认手机的状态，因为也有可能是忘在公司了。电话关机，可以确认被偷。然后马上采取安全补救措施：</p>

<!-- more -->


<ol>
<li>先冻结支付宝
   这个是最关键的一个，因为支付宝有钱，支付宝也关联了很多银行卡，所以要第一时间处理它。具体策略就是：

<ol>
<li>先取消无线支付功能，这个会关闭手机平板等支付功能，方法是登录网页支付宝，支付方式，关闭无线支付</li>
<li>修改登录密码，并且修改支付密码</li>
</ol>
</li>
<li>再冻结微信
   微信也很关键进入到110.qq.com冻结微信帐号，如果已关联QQ，可以用QQ号来冻结，如果手机卡已重新办理，可以用手机号冻结。不过这里要说一下，手机刚丢失，肯定没有办法用手机来冻结，所以一般是用QQ号。但是也有一些情况：1. 你要把QQ号关联到微信。2. 就是新版本的QQ有移动锁定功能，而且默认开启，也就是说你在电脑上还无法登录QQ。这时就相当被动了。从这里也可以看出移动QQ锁定电脑登录这个功能是多么的不好。相对来说手机要比电脑容易丢失，一旦丢失，电脑上就无法登录QQ，这是多么悲剧的事情。</li>
<li>冻结QQ
   先要改密码，不过改QQ密码要手机短信验证，对于手机丢失，这又是一个大悲剧。不光是QQ，很多帐户都要有手机短信验证来修改密码。</li>
<li>打电话给运营商让号码停机
   这个也要越快越好，打10086（我是移动的号码），按指引停掉手机，无需人工，自动可完成。</li>
<li>修改所有的手机上安装应用的密码
   首先是跟钱有关的应用，如银行客户端，股票，基金 等等，优先处理。
 然后是重要社交帐户，然后是笔记帐户，因为笔记里可能有重要的信息</li>
<li>发消息给亲人朋友同事，注意安全
   通过其他方式了，比如QQ或者用别的电话</li>
<li>查找手机
   比如苹果或者小米之类的用户可以用查找手机来找手机，不过希望不大。如果是聪明的小偷，得手后第一件事就是关机，扔SIM卡，扣掉电池。偷我手机的小偷应该 就是惯贼。找不到，确定被偷了，就擦除数据,但是查找手机与擦除数据都需要手机处于可用状态，因为小米的方式就是向手机发送特殊内容的短信，查找以及擦除数据的指令就是短信内容。</li>
</ol>


<p>以上安全措施都做完后，就报警。不指望能找回手机，只求能惩治一下猖狂的小偷。不过一般都没什么用处。只能是自己多加小心，保护好自己的财产。</p>

<h2>评价各大重量级应用对安全的保护</h2>

<h3>支付宝</h3>

<p>支付宝做的还蛮赞的，在网页版本能控制手机端的支付，这个很重要，而且也合理。毕竟手机可能丢，而网页在哪里都能登录，无所谓丢与不丢的问题，所以网页应该 是最根本最保险的，并且能控制无线的支付方式。另外，支付宝也有手势密码功能，这个也能在一定程度上防止财产受损，为补救争取更多时间。</p>

<h3>腾讯</h3>

<p>腾讯做的就不太好，首先它鼓励手机QQ锁定PC和WEB的登录，所谓的安全，让手机QQ扫二维码来登录PC，这个太弱了，而且有问题，一旦手机丢失PC端都无法登录，也就很难修改密码和冻结帐户。这会让人很被动。很不幸的是新版本QQ还在鼓励启用这个功能。
微信也是如此，提供的冻结功能，必须要QQ或者手机验证来辅助，这也会影响冻结帐户的速度，手机刚丢，手机验证用不了，有上面的问题QQ也用不了，这就叫天天不应，叫地地不灵了。另外，QQ和微信都没有启动密码，或者进入客户端的密码，这也会让QQ和微信更容易产生损失。</p>

<h3>其他应用：淘宝，百度等</h3>

<p>另外还有很多的帐户比如百度帐户，银行客户端帐户和淘宝帐户等，修改密码也需要手机验证，只能等手机卡重新办理后才能修改。</p>

<h3>应用的安全策略</h3>

<p>可以看出业务的发起点对安全的依赖也不一样，支付宝起源于PC网页，后有支付宝钱包，所以，最后的防线，或者说最高级的控制中心是在PC网页，因此，一旦手机丢了，没关系，上PC在网页可以关掉无线支付，所以安全性较高。</p>

<p>而微信则不一样，它起源于手机，后有PC端和WEB端，所以最高级的控制中心是在手机应用上，这样就不方便了，一旦手机丢失很难把帐户锁定，于是腾讯专门有<a href="http://110.qq.com">110.qq.com</a>来处理帐户的冻结。如上面说微信的PC上是弱端，所以微信的冻结必须依赖于外部帐号，这会让一部分用户无法进行冻结，假如用户没有绑定QQ号，那就只能等死。</p>

<p>而QQ的做法却很让人难受，手机丢失，无法立即通过手机号来冻结微信，那么只剩下QQ号，前提是要绑定QQ号（这是一个坑），所以你必须在PC上登录PC上的QQ，但手机QQ有一个非常二的功能就是锁定PC的登录，话说为了安全，但这种情况下就会造成PC上无法登录QQ。这个功能太二了，QQ起源于PC，所以应该PC上有最高控制权，不应试让后者（手机端）有最高的控制权。更加二的是，解冻微信需要修改QQ密码，而修改QQ密码又需要手机短信验证码，所以直到手机卡补办前，很多密码还是改不了。</p>

<p>这次手机被盗，由于小偷目的在于手机，且是惯贼，补救也及时，没有造成额外的财产损失和其他损失。</p>

<h3>移动应用如何设计安全措施</h3>

<p>常规的帐户补救措施比如手机验证码，等方法就目前来讲都还可以接受，但是必须要为手机丢失这种情况做相应的替代措施。
如果太依赖于手机短信验证码，那么安全隐患也大，一旦手机丢失，用户就只能等死。所以必须要有替代方案，就是一定要有PC端的登录方式和PC端的冻结和解救帐户的方式，比如邮箱验证，密保问题等方式。这是一个相互依赖的过程。PC端可能需要手机短信验证码来做身份验证，但是反过来，手机上的帐户在PC的帮忙下也必须能够解救。</p>

<h2>提高安全意识，加强对数据的保护</h2>

<p>但是为了防止再次损失，要提高安全意识：</p>

<ul>
<li>要保护好手机，尽量放在裤子前面，不要放在外衣的口袋中。人多的时候比如公交站地铁等，最好把手机放手里。但有时提东西，没办法。</li>
<li><p>手机要做好安全防范，简单来说就是多设密码：</p>

<p>  # 解锁一定要开，最好用图案，Android手机都支持图案，设置的不要太简单</p>

<p>  # 重要应用，比如支付宝等要开启应用启动密码，为了安全，所有支持进入 密码的应用都要把它开启，不要怕麻烦，因为手机一旦丢失，麻烦更大。</p>

<p>  # 另外，各种银行的客户端最好不要安装，因为银行客户端的安全措施可能没那么好，所以一旦丢失，很容易造成损失。</p></li>
<li>还有，手机里不要存放重要文件，重要文件还是用电脑来存放。手机里的文件，也最好备份到云端，以防止丢失。重要的帐户和密码也最好不要使用手机短信，微信或者起手机QQ之类的来存放。</li>
<li>联系人尽量用名字，不要用老爸，老妈，老婆，老公之类的，反正这些人你也分得清。试想小偷得手后给老爸发一短信要五千块，这怎么办？</li>
<li>另外，就是要定期更新所有网络帐户的密码。</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[训服你的Mac]]></title>
    <link href="http://toughcoder.net/blog/2014/11/13/tame-mac/"/>
    <updated>2014-11-13T22:15:58+08:00</updated>
    <id>http://toughcoder.net/blog/2014/11/13/tame-mac</id>
    <content type="html"><![CDATA[<p>天下武功唯快不破，提升效率是提升战斗力的唯一途径，而一个舒适且高效的开发环境是保证效率的重要方面，对于习惯了Windows和Linux的人来说，习惯使用Mac还是需要一定的时间的，这是就总结一些，如何配置并习惯Mac。</p>

<p><a href="http://toughcoder.net/blog/2014/11/13/tame-mac/"><img src="http://applethis.com/wp-content/uploads/2012/06/Apple-OS-X.jpg"></a></p>

<!-- more -->


<h2>Mac上面的常用快捷键</h2>

<p>在Windows上面有一些常用的快捷键，比如像Ctrl+W, Ctrl+F等等，还是非常有用的。在Mac上很多快捷键都是CMD键加上其他键组合的（如果是虚拟机的话，就是Windows的那个键）。</p>

<ul>
<li>CMD+R（先按CMD，再按r键）&ndash; 刷新Safari当前页，与Windows上的F5一样</li>
<li>CMD+UP或者HOME&ndash;滚动网面到最上端</li>
<li>CMD+DOWN或者END&ndash;滚动网页到最下面</li>
<li>CMD + LEFT &ndash; 把光标跳到行首，这个在编辑时常用</li>
<li>CMD + RIGHT &ndash; 把光标跳到行尾</li>
<li>CMD + W &ndash; 关闭当前的TAB</li>
<li>CMD + S &ndash; 保存文档</li>
<li>但是经终端里面的快捷键是跟Linux是一样的，比如Ctrl+W是删除掉一个字, Ctrl+C终止一个进程</li>
</ul>


<h2>配置终端</h2>

<p>对于开发者来讲，命令行始终都是一个非常好的工具，无论是什么平台，虽然苹果以GUI著称，但是命令行还是很有用处。Mac的Shell默认是bash，因为它是Unix的一个分支，所以使用起来跟Ubuntu几乎一样，常用的命令，常见的配置完全一样。</p>

<p>但是默认的终端很难看，也不好用，需要一些配置，打开终端的Preferences，选择一个Profile，然后进行一些颜色，字体，大小可以按照自己的风格来，在Shell一栏的“When the shell exits:”选择Close if the shell exited cleanly。然后，Prompt before closing选择Only if there are processes other than the login shell and …</p>

<p>安装XCode时，一定要把命令行工具集也都安装上。</p>

<h3>给终端配色</h3>

<p>在$HOME目录下，编辑.bash_profile文件，如果没有就自己创建一个，在里面最下面输入：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">CLICOLOR</span><span class="o">=</span>1
</span><span class='line'><span class="nb">export </span><span class="nv">LSCOLORS</span><span class="o">=</span>GxFxCxDxBxegedabagaced
</span></code></pre></td></tr></table></div></figure>


<p>具体这是啥意思，可以参考<a href="http://osxdaily.com/2012/02/21/add-color-to-the-terminal-in-mac-os-x/">这篇文章</a></p>

<h3>添加alias</h3>

<p>同样，在.bash_profile文件中添加一些自己喜欢的alias</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">alias </span><span class="nv">grep</span><span class="o">=</span><span class="s1">&#39;grep -rnIE&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>配置vim</h2>

<p>默认的Mac带有vim，但是还需要一些配置：</p>

<p>在$HOME下面创建一个.vimrc文件，并在里面输入：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="s2">&quot; An example for a vimrc file.</span>
</span><span class='line'><span class="s2">&quot;</span>
</span><span class='line'><span class="s2">&quot; Maintainer:   Bram Moolenaar &lt;Bram@vim.org&gt;</span>
</span><span class='line'><span class="s2">&quot;</span> Last change:   <span class="m">2011</span> Apr 15
</span><span class='line'><span class="s2">&quot;</span>
</span><span class='line'><span class="s2">&quot;</span> To use it, copy it to
</span><span class='line'><span class="s2">&quot;     for Unix and OS/2:  ~/.vimrc</span>
</span><span class='line'><span class="s2">&quot;</span>          <span class="k">for</span> Amiga:  s:.vimrc
</span><span class='line'><span class="s2">&quot;  for MS-DOS and Win32:  $VIM\_vimrc</span>
</span><span class='line'><span class="s2">&quot;</span>        <span class="k">for</span> OpenVMS:  sys<span class="nv">$login</span>:.vimrc
</span><span class='line'>
</span><span class='line'><span class="s2">&quot; When started as &quot;</span>evim<span class="s2">&quot;, evim.vim will already have done these settings.</span>
</span><span class='line'><span class="s2">if v:progname =~? &quot;</span>evim<span class="s2">&quot;</span>
</span><span class='line'><span class="s2">  finish</span>
</span><span class='line'><span class="s2">endif</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&quot;</span> Use Vim settings, rather than Vi settings <span class="o">(</span>much better!<span class="o">)</span>.
</span><span class='line'><span class="s2">&quot; This must be first, because it changes other options as a side effect.</span>
</span><span class='line'><span class="s2">set nocompatible</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&quot;</span> allow backspacing over everything in insert mode
</span><span class='line'><span class="nb">set </span><span class="nv">backspace</span><span class="o">=</span>indent,eol,start
</span><span class='line'>
</span><span class='line'><span class="k">if</span> has<span class="o">(</span><span class="s2">&quot;vms&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="nb">set </span>nobackup        <span class="s2">&quot; do not keep a backup file, use versions instead</span>
</span><span class='line'><span class="s2">else</span>
</span><span class='line'><span class="s2">  set backup     &quot;</span> keep a backup file
</span><span class='line'>endif
</span><span class='line'><span class="nb">set history</span><span class="o">=</span>50     <span class="s2">&quot; keep 50 lines of command line history</span>
</span><span class='line'><span class="s2">set ruler        &quot;</span> show the cursor position all the <span class="nb">time</span>
</span><span class='line'><span class="nb">set </span>showcmd       <span class="s2">&quot; display incomplete commands</span>
</span><span class='line'><span class="s2">set incsearch        &quot;</span> <span class="k">do</span> incremental searching
</span><span class='line'>
</span><span class='line'><span class="s2">&quot; For Win32 GUI: remove &#39;t&#39; flag from &#39;guioptions&#39;: no tearoff menu entries</span>
</span><span class='line'><span class="s2">&quot;</span> <span class="nb">let</span> <span class="p">&amp;</span><span class="nv">guioptions</span> <span class="o">=</span> substitute<span class="o">(</span><span class="p">&amp;</span>guioptions, <span class="s2">&quot;t&quot;</span>, <span class="s2">&quot;&quot;</span>, <span class="s2">&quot;g&quot;</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&quot; Don&#39;t use Ex mode, use Q for formatting</span>
</span><span class='line'><span class="s2">map Q gq</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&quot;</span> CTRL-U in insert mode deletes a lot.  Use CTRL-G u to first <span class="nb">break </span>undo,
</span><span class='line'><span class="s2">&quot; so that you can undo CTRL-U after inserting a line break.</span>
</span><span class='line'><span class="s2">inoremap &lt;C-U&gt; &lt;C-G&gt;u&lt;C-U&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&quot;</span> In many terminal emulators the mouse works just fine, thus <span class="nb">enable </span>it.
</span><span class='line'><span class="k">if</span> has<span class="o">(</span><span class="s1">&#39;mouse&#39;</span><span class="o">)</span>
</span><span class='line'>  <span class="nb">set </span><span class="nv">mouse</span><span class="o">=</span>a
</span><span class='line'>endif
</span><span class='line'>
</span><span class='line'><span class="s2">&quot; Switch syntax highlighting on, when the terminal has colors</span>
</span><span class='line'><span class="s2">&quot;</span> Also switch on highlighting the last used search pattern.
</span><span class='line'><span class="k">if</span> <span class="p">&amp;</span>t_Co &gt; <span class="m">2</span> <span class="o">||</span> has<span class="o">(</span><span class="s2">&quot;gui_running&quot;</span><span class="o">)</span>
</span><span class='line'>  syntax on
</span><span class='line'>  <span class="nb">set </span>hlsearch
</span><span class='line'>endif
</span><span class='line'>
</span><span class='line'><span class="s2">&quot; Only do this part when compiled with support for autocommands.</span>
</span><span class='line'><span class="s2">if has(&quot;</span>autocmd<span class="s2">&quot;)</span>
</span><span class='line'>
</span><span class='line'><span class="s2">  &quot;</span> Enable file <span class="nb">type </span>detection.
</span><span class='line'>  <span class="s2">&quot; Use the default filetype settings, so that mail gets &#39;tw&#39; set to 72,</span>
</span><span class='line'><span class="s2">  &quot;</span> <span class="s1">&#39;cindent&#39;</span> is on in C files, etc.
</span><span class='line'>  <span class="s2">&quot; Also load indent files, to automatically do language-dependent indenting.</span>
</span><span class='line'><span class="s2">  filetype plugin indent on</span>
</span><span class='line'>
</span><span class='line'><span class="s2">  &quot;</span> Put these in an autocmd group, so that we can delete them easily.
</span><span class='line'>  augroup vimrcEx
</span><span class='line'>  au!
</span><span class='line'>
</span><span class='line'>  <span class="s2">&quot; For all text files set &#39;textwidth&#39; to 78 characters.</span>
</span><span class='line'><span class="s2">  autocmd FileType text setlocal textwidth=78</span>
</span><span class='line'>
</span><span class='line'><span class="s2">  &quot;</span> When editing a file, always jump to the last known cursor position.
</span><span class='line'>  <span class="s2">&quot; Don&#39;t do it when the position is invalid or when inside an event handler</span>
</span><span class='line'><span class="s2">  &quot;</span> <span class="o">(</span>happens when dropping a file on gvim<span class="o">)</span>.
</span><span class='line'>  <span class="s2">&quot; Also don&#39;t do it when the mark is in the first line, that is the default</span>
</span><span class='line'><span class="s2">  &quot;</span> position when opening a file.
</span><span class='line'>  autocmd BufReadPost *
</span><span class='line'>    <span class="se">\ </span><span class="k">if</span> line<span class="o">(</span><span class="s2">&quot;&#39;\&quot;&quot;</span><span class="o">)</span> &gt; <span class="m">1</span> <span class="o">&amp;&amp;</span> line<span class="o">(</span><span class="s2">&quot;&#39;\&quot;&quot;</span><span class="o">)</span> &lt;<span class="o">=</span> line<span class="o">(</span><span class="s2">&quot;$&quot;</span><span class="o">)</span> <span class="p">|</span>
</span><span class='line'>    <span class="se">\ </span>  exe <span class="s2">&quot;normal! g`\&quot;&quot;</span> <span class="p">|</span>
</span><span class='line'>    <span class="se">\ </span>endif
</span><span class='line'>
</span><span class='line'>  augroup END
</span><span class='line'>
</span><span class='line'><span class="k">else</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">set </span>autoindent      <span class="s2">&quot; always set autoindenting on</span>
</span><span class='line'>
</span><span class='line'><span class="s2">endif &quot;</span> has<span class="o">(</span><span class="s2">&quot;autocmd&quot;</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&quot; Convenient command to see the difference between the current buffer and the</span>
</span><span class='line'><span class="s2">&quot;</span> file it was loaded from, thus the changes you made.
</span><span class='line'><span class="s2">&quot; Only define it when not defined already.</span>
</span><span class='line'><span class="s2">if !exists(&quot;</span>:DiffOrig<span class="err">&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="nb">command </span>DiffOrig vert new <span class="p">|</span> <span class="nb">set </span><span class="nv">bt</span><span class="o">=</span>nofile <span class="p">|</span> r ++edit <span class="c"># | 0d_ | diffthis</span>
</span><span class='line'>        <span class="se">\ </span><span class="p">|</span> wincmd p <span class="p">|</span> diffthis
</span><span class='line'>endif
</span><span class='line'>
</span><span class='line'><span class="nb">set </span>nu
</span><span class='line'><span class="nb">set </span>sm
</span><span class='line'><span class="nb">set </span>si
</span><span class='line'><span class="nb">set </span>cindent
</span><span class='line'><span class="nb">set </span>smarttab
</span><span class='line'><span class="nb">set </span><span class="nv">ts</span><span class="o">=</span>4
</span><span class='line'><span class="nb">set </span><span class="nv">shiftwidth</span><span class="o">=</span>4
</span><span class='line'><span class="nb">set </span>expandtab
</span><span class='line'><span class="nb">set </span><span class="nv">mouse</span><span class="o">=</span>a
</span><span class='line'><span class="nb">set </span>nobackup
</span><span class='line'><span class="nb">let </span>g:neocomplcache_enable_at_startup <span class="o">=</span> 1
</span><span class='line'>colorscheme desert
</span></code></pre></td></tr></table></div></figure>


<p>如果对自带的vim不满意，可以使用<a href="http://code.google.com/p/macvim/">MacVim</a>，这个功能更为强大，且支持GUI操作。</p>

<h2>配置git</h2>

<p>这个就是配置常用的git属性：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>color<span class="o">]</span>
</span><span class='line'>  <span class="nv">diff</span> <span class="o">=</span> <span class="nb">true</span>
</span><span class='line'><span class="nb"> </span><span class="nv">status</span> <span class="o">=</span> <span class="nb">true</span>
</span><span class='line'><span class="nb">    </span><span class="nv">interactive</span> <span class="o">=</span> auto
</span><span class='line'>  <span class="nv">branch</span> <span class="o">=</span> <span class="nb">true</span>
</span><span class='line'><span class="o">[</span>core<span class="o">]</span>
</span><span class='line'>  <span class="nv">editor</span> <span class="o">=</span> /usr/bin/vim
</span><span class='line'>  <span class="nv">autocrlf</span> <span class="o">=</span> <span class="nb">false</span>
</span><span class='line'><span class="nb"> </span><span class="nv">filemode</span> <span class="o">=</span> <span class="nb">false</span>
</span><span class='line'><span class="o">[</span>merge<span class="o">]</span>
</span><span class='line'>  <span class="nv">tool</span> <span class="o">=</span> vimdiff
</span><span class='line'><span class="o">[</span><span class="nb">alias</span><span class="o">]</span>
</span><span class='line'>  <span class="nv">co</span> <span class="o">=</span> checkout
</span><span class='line'>  <span class="nv">ci</span> <span class="o">=</span> commit
</span><span class='line'>  <span class="nv">st</span> <span class="o">=</span> status
</span><span class='line'>  <span class="nv">br</span> <span class="o">=</span> branch
</span><span class='line'><span class="o">[</span>push<span class="o">]</span>
</span><span class='line'>  <span class="nv">default</span> <span class="o">=</span> upstream
</span></code></pre></td></tr></table></div></figure>


<p>如果你也有使用Mac的一些技巧，请与我分享。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Java 7和8的新特性以及与Android开发的关系]]></title>
    <link href="http://toughcoder.net/blog/2014/11/12/java-7-and-8-and-android/"/>
    <updated>2014-11-12T21:54:11+08:00</updated>
    <id>http://toughcoder.net/blog/2014/11/12/java-7-and-8-and-android</id>
    <content type="html"><![CDATA[<p>Oracle一直在推动Java的发展，到目前最新的Java SE是Java 8以及JDK8，但是目前貌似很多人还在使用Java 6（JDK6)，于是就花时间小研究了下Java 7与Java 8。</p>

<p><a href="http://toughcoder.net/blog/2014/11/12/java-7-and-8-and-android/"><img src="http://nerdsmagazine.com/wp-content/uploads/2013/06/Run-Android-Apps-and-Games-on-Android.jpg"></a></p>

<!-- more -->


<h2>Java 7（JDK 7)的语言新特性</h2>

<p>Java SE 7新增的语言特性并不是很多，主要有：</p>

<ul>
<li>try 语句资源管理(The try-with-resources Statement)</li>
<li>同一catch捕获多个异常(Catching Multiple Exception Types)</li>
<li>创建泛型对象时的类型推测(Type inferenes for Generic Instance Creation)</li>
<li>二进制的字面常量(Binary Literals)</li>
<li>数值字面常量里的可以有下划线(Underscores in Numeric Literals)</li>
<li>switch语句支持String(Strings in switch Statements)</li>
</ul>


<p>下面来个实例：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.net.*</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Switch</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">// Underscores in numeric literals</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">USER_COUNT_LIMIT</span> <span class="o">=</span> <span class="mi">1_000_000_000</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// Type inference when creating generics</span>
</span><span class='line'>        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">fruits</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">args</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">a</span> <span class="o">:</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">fruits</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="c1">// Strings in switch</span>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">a</span> <span class="o">:</span> <span class="n">fruits</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">switch</span> <span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">case</span> <span class="s">&quot;apple&quot;</span><span class="o">:</span>
</span><span class='line'>                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;eat an apple a day, the doctors go away&quot;</span><span class="o">);</span>
</span><span class='line'>                <span class="k">break</span><span class="o">;</span>
</span><span class='line'>            <span class="k">case</span> <span class="s">&quot;orange&quot;</span><span class="o">:</span>
</span><span class='line'>                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;orange juice&quot;</span><span class="o">);</span>
</span><span class='line'>                <span class="k">break</span><span class="o">;</span>
</span><span class='line'>            <span class="k">default</span><span class="o">:</span>
</span><span class='line'>                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;i do not know what you want&quot;</span><span class="o">);</span>
</span><span class='line'>                <span class="k">break</span><span class="o">;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// With &#39;try-with-resources&#39; no longer need finally to clean up resources.</span>
</span><span class='line'>        <span class="k">try</span> <span class="o">(</span><span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nf">FileReader</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">])))</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">());</span>
</span><span class='line'>            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
</span><span class='line'>        <span class="c1">// Catch multiple exceptions</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="o">|</span> <span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// binary literals</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">userCount</span> <span class="o">=</span> <span class="mi">0</span><span class="n">b1010101</span><span class="o">;</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Current we have &quot;</span> <span class="o">+</span> <span class="n">userCount</span> <span class="o">+</span> <span class="s">&quot; users, while limit is &quot;</span> <span class="o">+</span> <span class="n">USER_COUNT_LIMIT</span><span class="o">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">userCount</span> <span class="o">&lt;</span> <span class="n">USER_COUNT_LIMIT</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;We are okay, it is under control&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Alert alert alert&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>编译并运行：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>alex:jdk1.7.0_71<span class="o">]</span><span class="nv">$.</span>/bin/javac Switch.java -Xlint
</span><span class='line'><span class="o">[</span>alex:jdk1.7.0_71<span class="o">]</span><span class="nv">$.</span>/bin/java Switch apple Switch.java README.html
</span><span class='line'>eat an apple a day, the doctors go away
</span><span class='line'>i <span class="k">do</span> not know what you want
</span><span class='line'>i <span class="k">do</span> not know what you want
</span><span class='line'>&lt;html&gt;
</span><span class='line'>Current we have <span class="m">85</span> users, <span class="k">while</span> limit is 1000000000
</span><span class='line'>We are okay, it is under control
</span></code></pre></td></tr></table></div></figure>


<p>可以看出，其实Java 7并无太大改进，只是多了些语法糖而已。</p>

<h2>Java 8(JDK 8）的语言新特性</h2>

<p>Java 8最大的改进就是增加了lambda表达式(Lambda Expression)，来看个实例：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">java.util.*</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Lambda</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">apply</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">Action</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">action</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="n">T</span> <span class="n">t</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">action</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">stuff</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">s</span> <span class="o">:</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">stuff</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Lambda</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">lambda</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Lambda</span><span class="o">&lt;&gt;();</span>
</span><span class='line'>        <span class="c1">// Use lambda expression to specify action</span>
</span><span class='line'>        <span class="n">lambda</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">stuff</span><span class="o">,</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Another example of lambda expression for threading</span>
</span><span class='line'>        <span class="k">new</span> <span class="nf">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;working &quot;</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&quot; seconds&quot;</span><span class="o">);</span>
</span><span class='line'>                <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
</span><span class='line'>                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">interface</span> <span class="nc">Action</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">perform</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>编译并运行：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>alex:jdk1.8.0_25<span class="o">]</span><span class="nv">$.</span>/bin/javac Lambda.java -Xlint
</span><span class='line'><span class="o">[</span>alex:jdk1.8.0_25<span class="o">]</span><span class="nv">$.</span>/bin/java Lambda apple orange
</span><span class='line'>apple
</span><span class='line'>orange
</span><span class='line'>working <span class="m">0</span> seconds
</span><span class='line'>working <span class="m">1</span> seconds
</span><span class='line'>working <span class="m">2</span> seconds
</span><span class='line'>working <span class="m">3</span> seconds
</span><span class='line'>working <span class="m">4</span> seconds
</span><span class='line'>working <span class="m">5</span> seconds
</span><span class='line'>working <span class="m">6</span> seconds
</span><span class='line'>working <span class="m">7</span> seconds
</span><span class='line'>working <span class="m">8</span> seconds
</span><span class='line'>working <span class="m">9</span> seconds
</span></code></pre></td></tr></table></div></figure>


<p>在Java 8中，可以比用匿名内部类更加方便的方式来设置回调。</p>

<h2>Android中的Java</h2>

<p>那么，Android到底与Java是什么关系呢？<a href="http://www.vaikan.com/android-java/">有人说</a>它们是一样的。其实没啥关系，Android虽然使用Java语言作为它的主要开发语言，但是它并完全等同于Java SE JDK，JDK中关于UI的AWT和Swing在Android都没有，所以它的API是标准JDK 6的一个子集。Android中的Java是基于<a href="http://www.apache.org/">Apache</a>的<a href="http://harmony.apache.org/">Apache Harmony</a>，与标准Java SE 6语法完全一样，可以看看它们之间的<a href="http://en.wikipedia.org/wiki/Comparison_of_Java_and_Android_API">异同</a>，以及<a href="http://www.zhihu.com/question/20207106">Dalvik与Java VM</a>。</p>

<h2>Java 7和Java 8与Andoid开发</h2>

<p>Java在进步，语法上越来越人性化，那么Android开发能否得益呢？Java 7是可以的，在最新的开发工具（ADT 23和Kitkat）下，可以使用Java 7。但对于Java 8不能直接使用，只能借助第三方工具来翻译bytecode。所以对于Android开发者同学们来说，尝一尝Java最新的语法糖就可以了，想要天天使用，还要慎重考虑哦！</p>

<h2>参考</h2>

<ul>
<li><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/language/enhancements.html">Java Programming Language Enhancements</a></li>
<li><a href="http://stackoverflow.com/questions/16921337/why-apache-harmony-or-how-to-use-java-8-on-android">“Why Apache Harmony” or “How to use Java 8 on Android”</a></li>
<li><a href="http://stackoverflow.com/questions/23318109/is-it-possible-to-use-java-8-for-android-development">Is it possible to use Java 8 for Android development?</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Introduction to Swift]]></title>
    <link href="http://toughcoder.net/blog/2014/11/04/introduction-to-swift/"/>
    <updated>2014-11-04T21:22:33+08:00</updated>
    <id>http://toughcoder.net/blog/2014/11/04/introduction-to-swift</id>
    <content type="html"><![CDATA[<p><a href="https://developer.apple.com/swift/">Swift</a>是水果平台新引进的一个开发语言，可以用它来取代Objective-C来开发Mac OS X以及iOS上面的应用程序。这门语言引入了大量的具有时代气息的新型编程语言特性，具有动态语言的简洁方便，是未来的发展方向。这是一门新的语言，今年六月才问世，所以如果今天开始学习Swift，三五年后，孤将是“有着五年经验的Swift砖家”了，错过了C，C++，Java，Python等，这回可以跟所有人站在同一起跑线上了。</p>

<p><a href="http://toughcoder.net/blog/2014/11/04/introduction-to-swift/"><img src="http://rack.1.mshcdn.com/media/ZgkyMDE0LzA3LzEyLzJhL3N3aWZ0bG9nb2hlLjU3NzBhLmpwZwpwCXRodW1iCTk1MHg1MzQjCmUJanBn/99456315/0f8/swift-logo-hero.jpg" width="640" height="480"></a></p>

<!-- more -->


<h2>必备的工具</h2>

<p>很显然，要想玩水果的东西，就必须有Mac电脑，而且<a href="https://developer.apple.com/xcode/downloads/">XCode 6</a>和以后的版本才支持Swift，而XCode 6需要Mac Mavericks（10.9）以后的版本才可以。所以，如果是旧的Mac还不一定可行。</p>

<p>孤作为穷人，无法支付死贵死贵的Mac机，所以只能用虚拟机对付了。VMWare可以搞定一切，具体方法请百度，网络上面有很多已经安装好的VMWare的Mac镜像，下载解压后就可以使用。等发达了，孤再买Mac。</p>

<p>其实，如果你只是想学习Swift，而不是iOS或Mac开发，那么完全没有必要这么麻烦，用一个浏览器就能搞定，<a href="https://swiftstub.com/">SwiftStub</a>是一个在线即时Swift编译器，用起来相当爽。</p>

<p>至于教程，看官方的就好了，<a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/Swift_Programming_Language/GuidedTour.html#//apple_ref/doc/uid/TP40014097-CH3-XID_0">浏览器（网站）</a>，iBooks都可以方便的看到。</p>

<p>这方面，水果比谷歌强多了，更为重要的是水果在中国访问无压力，谷歌就蛋疼了，上半年<a href="http://developer.android.com/index.html">Android的文档</a>都无法访问，现在<a href="http://source.android.com/">Android源码</a>也时常抽风，不说了。</p>

<h2>初体验</h2>

<p>先来个高大上的第一个程序：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">println</span><span class="p">(</span><span class="s">&quot;Hello, world&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>我想都能猜出来会输出啥吧。
建议把<a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/Swift_Programming_Language/GuidedTour.html#//apple_ref/doc/uid/TP40014097-CH3-XID_0">A Swift Tour</a>的代码全都敲一遍，虽然可能你没有理解，至少有个初级印象。</p>

<h2>基本语法结构</h2>

<p>可以说Swift与<a href="https://www.python.org/">Python</a>的语法结构是比较接近。每一行语句结尾处不用写分号。如果一行有多条语句，要用分号隔开。</p>

<h3>变量的定义是用var关键字</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">var</span> <span class="n">slideCount</span>
</span><span class='line'><span class="n">slideCount</span> <span class="o">=</span> <span class="n">countSlides</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h3>常量用let关键字</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">slideLimit</span> <span class="o">=</span> <span class="mi">10</span>
</span></code></pre></td></tr></table></div></figure>


<h3>注释与C/C++和Java以及Objective-C是一样的</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1">// in seconds</span>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Send a email to destination</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="n">sendEmail</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h3>数据类型</h3>

<p>这个也跟其他语言没啥大区别，String, Int, Bool, Double等。</p>

<h3>运算符号</h3>

<p>+, -, *, /, %, &amp;&amp;, ||, !, ==, : ?跟其他语言一致</p>

<h3>控制语句</h3>

<p>分支，循环跟其他语言也基本一致。只是条件判断的地方，跟Python一样，不用写括号：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Who are you&quot;</span>
</span><span class='line'><span class="k">if</span> <span class="n">message</span> <span class="o">==</span> <span class="s">&quot;Unlock me&quot;</span> <span class="p">{</span>
</span><span class='line'>   <span class="c1">// something happen</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>   <span class="c1">// ignored</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">var</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// sleep for another i mins</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">var</span> <span class="n">done</span> <span class="o">=</span> <span class="nb">false</span>
</span><span class='line'><span class="k">do</span> <span class="p">{</span>
</span><span class='line'>   <span class="c1">// continue coding</span>
</span><span class='line'><span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">done</span><span class="p">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">fruits</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="s">&quot;Pear&quot;</span><span class="p">,</span> <span class="s">&quot;Cherry&quot;</span><span class="p">,</span> <span class="s">&quot;Peach&quot;</span><span class="p">]</span>
</span><span class='line'><span class="k">for</span> <span class="n">f</span> <span class="k">in</span> <span class="n">fruits</span> <span class="p">{</span>
</span><span class='line'>   <span class="c1">// eat it</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>函数</h3>

<p>函数的形式就是func name()->，括号中放参数，箭头后面是返回值，无参数就是空括号，无返回值不用写箭头。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">countSlides</span><span class="p">(</span><span class="nl">slide</span><span class="p">:</span> <span class="n">Slide</span><span class="p">,</span> <span class="nl">mine</span><span class="p">:</span> <span class="n">Bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Int</span> <span class="p">{</span>
</span><span class='line'>   <span class="k">return</span> <span class="mi">10</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Swift的特性</h2>

<p>除了有所有编程语言所共有的特性以外，Swift有一些比较不太常见的语言特性，是学习的时候需要特别学习和理解的。</p>

<h3>选项型变量(Optionals)</h3>

<p>可能翻译的不准确。Optionals的意思就是这个变量有一个有意义的值，或者什么都不是。简单来讲，或者通俗的来理解，就是一个对象是不是nil。</p>

<p>Optional的表达方式是在类型后面加个问号，如String?表示一个字串，Int?表示一个整型。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">var</span> <span class="nl">possibleString</span><span class="p">:</span> <span class="n">String</span><span class="o">?</span> <span class="c1">// default set to nil</span>
</span><span class='line'><span class="n">possibleString</span> <span class="o">=</span> <span class="s">&quot;Beijing&quot;</span>
</span><span class='line'><span class="k">let</span> <span class="nl">count</span><span class="p">:</span> <span class="n">Int</span><span class="o">?</span> <span class="o">=</span> <span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure>


<p>获取Optional变量的值可以用叹号，如<strong>possibleString!</strong>就是取它的值。但是如果变量是没有值的(nil)，取值时会得到异常。</p>

<p>其实可以用C语言的指针来简单理解这玩意，Optional就相当于指针，取值*操作对于空指针（NULL）肯定会挂。</p>

<p>这玩意这么不好理解，到底有啥用？就是专门用在判断语句中的，可以消除== nil的这种判断：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">var</span> <span class="nl">possibleString</span><span class="p">:</span> <span class="n">String</span><span class="o">?</span> <span class="o">=</span> <span class="s">&quot;Impossible is nothing&quot;</span>
</span><span class='line'><span class="k">if</span> <span class="k">let</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">possibleString</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">println</span><span class="p">(</span><span class="n">msg</span><span class="o">!</span><span class="p">)</span> <span class="c1">// or println(msg), they are equal</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">var</span> <span class="nl">possibleNumber</span><span class="p">:</span> <span class="n">Int</span><span class="o">?</span> <span class="o">=</span> <span class="mi">4</span>
</span><span class='line'><span class="k">if</span> <span class="k">var</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">possibleNumber</span> <span class="p">{</span>
</span><span class='line'>   <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">10</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这意思就是如果possibleString有值（不是nil），则赋给msg，并执行分支，等价于如下：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">if</span> <span class="n">possibleString</span> <span class="o">!=</span> <span class="nb">nil</span> <span class="p">{</span>
</span><span class='line'>   <span class="n">println</span><span class="p">(</span><span class="n">possibleString</span><span class="o">!</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>   <span class="n">println</span><span class="p">(</span><span class="s">&quot;it is null&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>怎么样，对于C/C++和Java语言来说，这的确优雅很多。而普通的定义变量的方式就不能这么用。</p>

<h3>判断空的操作符</h3>

<p>??操作如果操作数是合法值，则返回它的值，否则返回nil，这有啥用？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">a</span> <span class="o">??</span> <span class="n">b</span>
</span><span class='line'><span class="c1">// is equal to </span>
</span><span class='line'><span class="n">a</span> <span class="o">!=</span> <span class="n">nill</span> <span class="o">?</span> <span class="n">a</span><span class="o">!</span> <span class="o">:</span> <span class="n">b</span>
</span></code></pre></td></tr></table></div></figure>


<p>比如，设置字体大小，默认是32，从用户取值，fallback成默认值，可以这么写：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">defaultFontSize</span> <span class="o">=</span> <span class="mi">32</span>
</span><span class='line'><span class="k">var</span> <span class="nl">userValue</span><span class="p">:</span> <span class="n">Int</span><span class="o">?</span> <span class="o">=</span> <span class="n">getUserFontSize</span><span class="p">()</span>
</span><span class='line'><span class="k">let</span> <span class="n">fontSize</span> <span class="o">=</span> <span class="n">userValue</span> <span class="o">??</span> <span class="n">defaultFontSize</span>
</span></code></pre></td></tr></table></div></figure>


<p>怎么样，又省去了nil判断，优雃了不少。</p>

<h3>引用判断操作符</h3>

<p>对象的等值性(Equivalence)与指向对象的引用的等值性一直是一个困扰很多人的问题，特别是初学者，对于Java更是这样，很多隐蔽性的Bug都出现在了等值的判断上。对于Java，==是判断引用是否指向同一个对象，而equals方法则是判断二个对象是否相同，而对象的相同则是需要自己去定义的。</p>

<p>同样，这里也是==是检查对象是否相同，而===是检查引用是否相同.</p>

<h3>范围操作符</h3>

<p>…是范围操作符，类似Python中的range()函数。</p>

<p>a…b是表示[a, b]，都是闭区间（希望数学区间的概念都没有忘记）</p>

<p>a..&lt;b是表示[a, b)，后面是开区间</p>

<p>必须保证a &lt; b，开始比结束小.</p>

<h3>函数外参数名</h3>

<p>与Objective-C一样，Swift的函数也支持外部参数名(External Parameter Names)，就是调用函数的时候也指定参数的名字，以加强程序的可读性，对于同一类型参数的函数来说特别重要。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">countSlide</span><span class="p">(</span><span class="err">#</span><span class="nl">slide</span><span class="p">:</span> <span class="n">Slide</span><span class="p">,</span> <span class="err">#</span><span class="nl">mime</span><span class="p">:</span> <span class="n">Bool</span><span class="p">,</span> <span class="err">#</span><span class="nl">message</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Int</span> <span class="p">{</span>
</span><span class='line'>   <span class="c1">/// ….</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="n">countSlide</span><span class="p">(</span><span class="nl">slide</span><span class="p">:</span> <span class="n">aslide</span><span class="p">,</span> <span class="nl">mine</span><span class="p">:</span> <span class="nb">false</span><span class="p">,</span> <span class="nl">message</span><span class="p">:</span> <span class="s">&quot;Go to bed&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>怎么样，这是不是大大的增加了程序的可读性呢！起码我觉得是的。相比Java（或者其他语言）：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="kt">int</span> <span class="nf">countSlide</span><span class="p">(</span><span class="n">Slide</span> <span class="n">slide</span><span class="p">,</span> <span class="n">boolean</span> <span class="n">mine</span><span class="p">,</span> <span class="n">String</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="n">countSlide</span><span class="p">(</span><span class="n">aslide</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="s">&quot;Not now&quot;</span><span class="p">);</span> <span class="c1">// cannot guess what parameters mean and for</span>
</span></code></pre></td></tr></table></div></figure>


<p>对于函数声明，可以大致明白参数的用途。但是看着函数的调用，完全不知道参数都是用来干嘛的，特别是对于boolean, int等基本的数据类型。</p>

<h3>闭包</h3>

<p>闭包(Closure)是现代编程语言必不可少一个特性，它能有效的减少代码，减少对成员状态的依赖。这是函数式编程的必要特性，用闭包可以不用成员或者全局变量。</p>

<p>闭包的数学上的定义比较复杂，头发多的人都看不懂。通俗来讲闭包就是所定义的函数或者类持有它所在的定义域内的所有变量，常量和方法的引用。还是有点绕，说白了，就是一个内部定义的函数或者类，持有对外部类的所有成员的引用。</p>

<p>闭包的通常的呈现形式：</p>

<ul>
<li>（匿名）内部类</li>
<li>（匿名）内部函数</li>
<li>Lamda表达式，通常是指短小的匿名函数</li>
<li>全局类和函数其实也是闭包，只不过它们没有闭合任何外部引用而已</li>
</ul>


<p><strong>捕获</strong>的概念，当闭包引用外部变量时，就称作捕获外部变量。也就是说当你在内部函数里面访问外部变量时，就是在捕获变量。</p>

<p>各种语言中，闭包使用最多的形式就是Lamda表达式，就是一些短小的命名或匿名函数体。这也是闭包的意义所在。</p>

<p>在Swift中闭包的主要形式就是匿名或者命名函数体。对于命名函数体的定义和使用方式跟普通函数一样，只不过可以捕获变量。如：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="n">makeIncrementor</span><span class="p">(</span><span class="err">#</span><span class="nl">step</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Int</span> <span class="p">{</span>
</span><span class='line'>   <span class="k">var</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>   <span class="k">func</span> <span class="n">incrementor</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Int</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">total</span> <span class="o">+=</span> <span class="n">step</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">step</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>   <span class="k">return</span> <span class="n">incrementor</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">var</span> <span class="n">a</span> <span class="o">=</span> <span class="n">makeIncrementor</span><span class="p">(</span><span class="nl">step</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span>
</span><span class='line'><span class="n">a</span><span class="p">()</span> <span class="c1">// 10</span>
</span><span class='line'><span class="n">a</span><span class="p">()</span> <span class="c1">// 20</span>
</span><span class='line'><span class="n">a</span><span class="p">()</span> <span class="c1">// 30</span>
</span></code></pre></td></tr></table></div></figure>


<p>但更多时候还是使用匿名函数体或者叫做Lamda表达式，因为这是最方便的。形式：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="p">{</span> <span class="p">(</span> <span class="o">**</span><span class="n">parameters</span><span class="o">**</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="o">**</span><span class="k">return</span> <span class="n">types</span><span class="o">**</span> <span class="k">in</span>
</span><span class='line'>  <span class="o">**</span><span class="n">statements</span><span class="o">**</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>比如，定义一个遍历数组，并对每一个元素都做某种操作的函数，调用者使用时就可以用闭包来完成这某种操作：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="nf">apply</span><span class="p">(</span><span class="err">#</span><span class="nl">list</span><span class="p">:</span> <span class="p">[</span><span class="n">Int</span><span class="p">],</span> <span class="err">#</span><span class="nl">action</span><span class="p">:</span> <span class="p">(</span><span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">())</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">list</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">action</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">var</span> <span class="n">primes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Standard closure</span>
</span><span class='line'><span class="n">println</span><span class="p">(</span><span class="s">&quot;Standard closure&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">apply</span><span class="p">(</span><span class="nl">list</span><span class="p">:</span> <span class="n">primes</span><span class="p">,</span> <span class="nl">action</span><span class="p">:</span> <span class="p">{(</span><span class="nl">item</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span> <span class="n">println</span><span class="p">(</span><span class="n">item</span><span class="p">)})</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Simplified by removing return type</span>
</span><span class='line'><span class="n">println</span><span class="p">(</span><span class="s">&quot;Removing return type&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">apply</span><span class="p">(</span><span class="nl">list</span><span class="p">:</span> <span class="n">primes</span><span class="p">,</span> <span class="nl">action</span><span class="p">:</span> <span class="p">{(</span><span class="nl">item</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="k">in</span> <span class="n">println</span><span class="p">(</span><span class="n">item</span><span class="p">)})</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Simplified by removing type</span>
</span><span class='line'><span class="n">println</span><span class="p">(</span><span class="s">&quot;Removeing type&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">apply</span><span class="p">(</span><span class="nl">list</span><span class="p">:</span> <span class="n">primes</span><span class="p">,</span> <span class="nl">action</span><span class="p">:</span> <span class="p">{(</span><span class="n">item</span><span class="p">)</span>  <span class="k">in</span> <span class="n">println</span><span class="p">(</span><span class="n">item</span><span class="p">)})</span>
</span><span class='line'>
</span><span class='line'><span class="n">println</span><span class="p">(</span><span class="s">&quot;Removing parentheses&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">apply</span><span class="p">(</span><span class="nl">list</span><span class="p">:</span> <span class="n">primes</span><span class="p">,</span> <span class="nl">action</span><span class="p">:</span> <span class="p">{</span><span class="n">item</span> <span class="k">in</span> <span class="n">println</span><span class="p">(</span><span class="n">item</span><span class="p">)})</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Simplified again with shorthand</span>
</span><span class='line'><span class="n">println</span><span class="p">(</span><span class="s">&quot;Removing param and use shorthands&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">apply</span><span class="p">(</span><span class="nl">list</span><span class="p">:</span> <span class="n">primes</span><span class="p">,</span> <span class="nl">action</span><span class="p">:</span> <span class="p">{</span><span class="n">println</span><span class="p">(</span><span class="err">$</span><span class="mi">0</span><span class="p">)})</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果，闭包是函数的最后一个参数，还有另外一种写法，叫做尾后闭包(Trailing Closure)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">someFunction</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>   <span class="n">closure</span> <span class="n">goes</span> <span class="n">here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>如：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// With trailing closure</span>
</span><span class='line'><span class="n">println</span><span class="p">(</span><span class="s">&quot;With trailing closure&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">apply</span><span class="p">(</span><span class="nl">list</span><span class="p">:</span> <span class="n">primes</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">item</span> <span class="k">in</span>
</span><span class='line'>    <span class="n">println</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">apply</span><span class="p">(</span><span class="nl">list</span><span class="p">:</span> <span class="n">primes</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">println</span><span class="p">(</span><span class="err">$</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>结构体</h3>

<p>struct几乎与class有同样的功能，都能定义复杂数据结构，添加行为方法，但它们还是有区别的：</p>

<p>最大的区别就是struct是按值拷贝赋值，而class是按引用拷贝。因此，大多数情况下，还是要使用class，效率上至少会有收益。那么为啥还要有struct呢?它适用于<a href="http://en.wikipedia.org/wiki/Plain_old_data_structure">Plain old data structure or PoD</a>，也就是说一个纯数据结构，里面全都是基本类型。</p>

<p>其他场合，还是用class吧。
（是不是想起了C++著名的面试题struct vs class）</p>

<h2>这才仅仅是冰山一角</h2>

<p>这里仅是简单的介绍了Swift的一些语言特性，仅够入门使用，但足可以开始iOS之旅，光有语言还是不够的，对于任何一个平台，编程语言仅能占三成，剩下的大部分还是要学习平台提供的东西，包括开发环境，IDE，和平台提供的API（库）。对于CocoaTouch来说，它跟语言（Swift和Objective-C）基本上是无关的，现在的<a href="https://developer.apple.com/library/ios/navigation/#section=Resource%20Types&amp;topic=Reference">官方文档</a>的API说明都给出了二种语言的接口，而且Swift和Objective-C基本上可以无缝切换，所以如果已熟悉iOS的框架的，可以轻松转换。</p>

<h2>参考及资源</h2>

<ul>
<li><a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/Swift_Programming_Language/TheBasics.html#//apple_ref/doc/uid/TP40014097-CH3-XID_0">The Swift Programming Language</a></li>
<li><a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/BuildingCocoaApps/">Using Swift with Cocoa and Objective-C</a></li>
<li><a href="http://www.devtalking.com/">程序员说</a></li>
<li><a href="http://helloswift.com.cn/">Swift中文社区</a></li>
<li><a href="http://swiftist.org/">Swiftist</a></li>
<li><a href="http://letsswift.com/">Let&rsquo;s Swift</a></li>
<li><a href="http://www.swift-open.com/">Swift开发者</a></li>
<li><a href="http://www.iswifting.com/">iSwifting</a></li>
<li><a href="http://www.swiftv.cn/">SwiftV</a></li>
<li><a href="http://swift.sh/">SwiftChina</a></li>
<li><a href="http://www.infoq.com/news/2014/06/apple-swift-learning-resources">Online Resources to Learn Apple&rsquo;s Swift Language</a></li>
<li><a href="http://swiftlang.eu/">Swift Language</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[下载并编译CyanogenMod源代码]]></title>
    <link href="http://toughcoder.net/blog/2014/11/01/play-with-cyanogenmod/"/>
    <updated>2014-11-01T00:40:55+08:00</updated>
    <id>http://toughcoder.net/blog/2014/11/01/play-with-cyanogenmod</id>
    <content type="html"><![CDATA[<p>CyanogenMod是除了Android官方源码之外的最受欢迎的Android的一个分支，它是干净，几乎接近原生Android，且方便为设备进行定制，在编译和制作ROM上面较原生有很大改进，是开发者学习源码和自己制作ROM的最佳选择。</p>

<p>官方网站在<a href="http://www.cyanogenmod.com/">这里</a>.</p>

<p>repo在<a href="https://github.com/CyanogenMod/android/">这里</a>.</p>

<p>环境说明，本次所有操作都是在Ubuntu 12.04(Precise)里面进行的。另外需要说明的是，我的环境访问谷歌和谷歌相关的服务都是没有问题的，关于如何访问谷歌可以参考这位牛人写的<a href="http://strongme.github.io/2014-09-01-Add-Hosts-For-Google.html">博客</a></p>

<p><a href="http://toughcoder.net/blog/2014/11/01/play-with-cyanogenmod/"><img src="http://img.wonderhowto.com/img/30/47/63519976076208/0/install-cyanogenmod-htc-one-even-faster-now-without-rooting-unlocking-first.w654.jpg"></a></p>

<!-- more -->


<h2>下载源码</h2>

<p>下载源代码是第一步，这跟很多教程是不太一样的。因为我觉得，你源码都没有拿到，还搞个毛线啊！有了源码即使无法编译，也至少还可以看源码的，否则安装了toolschain又有啥用。
其实，源码的下载按道理讲是很简单的事情的，但是很多事情到了我大天朝就会变得很复杂，甚至搞不定，特别要从Google的服务器上搞点东西。因为CyanogenMode的源码是在<a href="http://github.com/">Github</a>上面，所以源码的下载还是很方便的，但是对于一些必要的工具，因为是要从Google取，所以就很蛋疼。</p>

<h3>下载repo</h3>

<p>因为Android的源码非常多，巨大的源码不可能放在一个git的repo里面，是每个模块都有自己单独的git仓库，但是为了成功编译，又需要所有的源码，但是不可能手动的一个一个的去clone啊，因此就有了repo这个工具，它就是一个Python实现的脚本，先从Server读出来一个所有仓库的配置信息XML文件，然后按这个文件一个一个的把git仓库clone下来。
这个文件是Android官方提供的，CyanogenMod也只是使用了它。所以它还要从官方来取。它就是一个脚本，所以谈不到安装，下载下来，改变文件属性就可以运行了。关键是下载啊！</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo
</span><span class='line'>chmod a+x !<span class="err">$</span>
</span></code></pre></td></tr></table></div></figure>


<p>因为Google的连接不稳定，甚至是无法连接，所以下载这个脚本就要八仙过海，各显神通了，为了方便后来的兄弟们，可以从<a href="http://pan.baidu.com/s/1mgytKYO">这里</a>下载。别高兴太早，这才刚开始。后面还会有一大把问题呢。</p>

<h3>初始化仓库和分支信息</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkdir -p /work/cyanogenmod
</span><span class='line'><span class="nb">cd</span> /work/cyanogenmod
</span><span class='line'>repo init -u git://github.com/CyanogenMod/android.git -b stable/cm-11.0
</span></code></pre></td></tr></table></div></figure>


<p>注意，为了方便，最好把你的Github帐户配置好ssh，以方便直接以git方式clone。另外，<a href="http://www.cyanogenmode.com/">CyanogenMod</a>的仓库在<a href="http://github.com/CyanogenMod/android">这里</a>，你会发现，这里只有二个配置文件。如前面所说，这里只是列出其他仓库的配置文件，以文件抓取所有的源码。</p>

<p>另外，-b后面跟的是你要抓取的分支, cm-11.0是最新的分支，对应Android 4.4。查看其他的分支可以看<a href="https://github.com/CyanogenMod/android/branches">这里</a>。</p>

<p>如果没有任何错误，那么要恭喜你，但是通常都会遇到错误：</p>

<blockquote><p>repo init -u git://github.com/CyanogenMod/android.git -b stable/cm-11.0</p>

<p>gpg: key 920F5C65: &ldquo;Repo Maintainer <a href="&#109;&#x61;&#105;&#108;&#116;&#111;&#58;&#x72;&#x65;&#112;&#111;&#64;&#x61;&#110;&#100;&#x72;&#x6f;&#x69;&#x64;&#x2e;&#107;&#101;&#114;&#x6e;&#x65;&#108;&#x2e;&#111;&#114;&#x67;">&#114;&#101;&#x70;&#x6f;&#64;&#x61;&#x6e;&#x64;&#x72;&#111;&#x69;&#x64;&#x2e;&#107;&#x65;&#x72;&#110;&#x65;&#108;&#x2e;&#111;&#114;&#103;</a>&rdquo; not changed</p>

<p>gpg: key 692B382C: public key &ldquo;Conley Owens <a href="&#109;&#97;&#x69;&#108;&#x74;&#x6f;&#58;&#99;&#x63;&#111;&#x33;&#64;&#x61;&#x6e;&#x64;&#114;&#111;&#105;&#x64;&#x2e;&#x63;&#x6f;&#x6d;">&#99;&#x63;&#111;&#51;&#x40;&#97;&#110;&#x64;&#x72;&#111;&#105;&#x64;&#x2e;&#x63;&#111;&#109;</a>&rdquo; imported</p>

<p>gpg: Total number processed: 2</p>

<p>gpg:               imported: 1  (RSA: 1)</p>

<p>gpg:              unchanged: 1</p>

<p>fatal: Cannot get <a href="https://gerrit.googlesource.com/git-repo/clone.bundle">https://gerrit.googlesource.com/git-repo/clone.bundle</a></p>

<p>fatal: error [Errno 101] Network is unreachable</p></blockquote>

<p>第一眼看上去貌似是网络连接问题，搜了一下，网站有各种版本，<a href="http://www.cnblogs.com/javawebsoa/p/3235315.html">有的</a>说要unset代理，变量，<a href="http://blog.csdn.net/jianguo_liao19840726/article/details/9774357">有的</a>说要登录<a href="https://android.googlesource.com/new-password">androidsource</a>然后把登录信息加入到.netrc中。但是这些对我的情况都不管用；还有<a href="http://blog.sina.com.cn/s/blog_a9c55dfd0101jcz6.html">这篇</a>。我的情况与最后一个类似，多试几次，然后就init成功了。看来真的是网络抽风。</p>

<h3>下载源码</h3>

<p>然后就可以下载源码了：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>repo sync
</span></code></pre></td></tr></table></div></figure>


<p>因为是在github上面，而github一向是比较给力的，所以只要等待就好了，一般都会成功下载的。这跟官方Android就不同了。记得以前下载官方源码时，经常出现网络问题，下载了几个晚上才搞定。</p>

<h2>安装编译所需要的toolschain</h2>

<p>CyanogenMod本质上也是Android，所以这个可以参考<a href="http://source.android.com/source/initializing.html">官方文档</a>，就可以了。</p>

<p>几个关键的点是：</p>

<ul>
<li>使用Oracle的Java SDK(JDK)，至于版本，最新的Android可以用Java 7，所以就装个Java 6吧，2.3到4.4都是使用Java 6</li>
<li>安装需要的软件包</li>
<li>配置ccache</li>
</ul>


<h2>编译</h2>

<h3>编译模拟器</h3>

<p>模拟器在学习和研究代码的时候还是比较有用的，如果你没有一个专门用作测试的手机的话。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>. build/envsetup.sh
</span><span class='line'>lunch
</span></code></pre></td></tr></table></div></figure>


<p>这时会出现一个菜单，仔细寻找cm_goldfish-eng，输入前面的数字，这会对模拟器进行一些配置。这里有一个坑，不要用source build/envsetup.sh，而要用上面的命令，否则会没有goldfish相关的配置项出现在lunch的菜单里。</p>

<p>然后，再到vendor/cm/里面，执行./get-prebuilts，这会把一些需要的东西拉下来。然后就可以正式的编译了：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>make -j8
</span></code></pre></td></tr></table></div></figure>


<p>之后是漫长的等待。</p>

<h3>运行模拟器</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>emulator -system ./out/target/product/generic/system.img -data ./out/target/product/generic/userdata.img -ramdisk ./out/target/product/generic/ramdisk.img
</span></code></pre></td></tr></table></div></figure>


<p>还可以指定skin，skin可以到SDK里面去找。如果多次使用可以把上面的命令保存成Bash脚本。但是这个模拟器会奇慢无比。</p>

<h2>参考资料</h2>

<ul>
<li><a href="http://hualang.iteye.com/blog/1139269">Android ROM研究&mdash;CyanogenMod源代码下载及编译</a></li>
<li><a href="http://sunzeduo.blog.51cto.com/2758509/1538557">基于 cm-11 源码编译模拟器</a></li>
<li><a href="http://www.yinqisen.cn/blog-321.html">CyanogenMod 11.0模拟器goldfish的编译方法及下载地址</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[让Android模拟器飞一会]]></title>
    <link href="http://toughcoder.net/blog/2014/10/31/boosts-android-emulator/"/>
    <updated>2014-10-31T17:27:29+08:00</updated>
    <id>http://toughcoder.net/blog/2014/10/31/boosts-android-emulator</id>
    <content type="html"><![CDATA[<p>Android模拟器是公认的慢，而且不是一般的慢，即使在高性能的PC上，跟开发环境没关系，因为它就是慢。但是我们又必须使用模拟器，比如在测试Android不同版本的兼容性时，或者在测试不同屏幕尺寸的UI显示问题时，都是需要的。当然我们还是鼓励使用一个真机来调试和测试，模拟器无法取代真机。但是在测试兼容性时，我们还是要使用模拟器，因为即使是BAT也不可能把各种版本，各种屏幕的Android手机都买一个。</p>

<p><a href="http://toughcoder.net/blog/2014/10/31/boosts-android-emulator/"><img src="http://codebutler.com/img/posts/2012-10-10-configuring-a-usable-android-emualtor/android-emulator-ugly.png" width="320" height="480"></a></p>

<!-- more -->


<h2>为啥模拟器会这么慢</h2>

<p>关键就是在模拟这二个字。PC啊，我们所使用的开发环境的CPU都是x86架构的，而手机呢一般都是ARM架构，这就产生问题了，这个手机的系统无法像PC上面的一个应用程序那样直接运行在PC里，所以就需要一个虚拟的ARM机器。Android模拟器是基于QEMU的，QEMU可以模拟ARM指令，另外，存储，等等所有模拟器的硬件，都是由软件实现的。总之，为了能让PC上跑起来ARM，就慢了很多。</p>

<p>详细的可以看<a href="http://www.developer.com/ws/android/development-tools/supercharge-your-android-emulator-speed-with-intel-emulation-technologies.html">这篇文章</a></p>

<p>我们可能不关心它为啥慢，我们要关心的是如何能让它跑的更快一些！</p>

<h2>使用x86架构</h2>

<p>既然它慢是因为必须在x86上面模拟ARM，那么让它快起来第一个方法就是直接使用x86架构，这样子的话，就能够直接使用开发环境的CPU了，性能肯定会大幅的提升，正如<a href="http://www.developer.com/ws/android/development-tools/supercharge-your-android-emulator-speed-with-intel-emulation-technologies.html">这篇文章</a>所说。</p>

<p>配置方法也不难，主要是：</p>

<ul>
<li>安装Intel的<a href="https://software.intel.com/en-us/android/articles/intel-hardware-accelerated-execution-manager">加速驱动HAXM</a></li>
<li>下载和使用x86版本的Android System images</li>
</ul>


<p>使用起来并不难，只是可能会遇到坑，借助<a href="https://www.google.com.hk/">Google</a>和<a href="http://www.baidu.com/">百度</a>都能解决。唯一需要注意的是，Intel的HAEM对硬件的配置要求比较苛克，要求CPU必须支持虚拟化VT，具体的可以参考官方和Google进行解决。</p>

<h2>使用<a href="http://www.genymotion.com/">Genymotion</a></h2>

<p>Genymotion是一个全功能的Android模拟器，它不但能测试应用，还有同步等功能，在PC上面跑的非常快。先去注册成为它的用户，然后就可以下载了。它的安装，也比较方便，直接看官方的文档就可以了。</p>

<h3>快速功能列表</h3>

<ul>
<li>支持主流的三种平台Windows, Mac OS X和Linux</li>
<li>需要注册成为它的用户才可下载</li>
<li>高级功能的版本需要付费</li>
<li>不能安装在虚拟机中，因为它要使用硬件加速，而且本身也要运行在虚拟机(VMWare, VirtualBox)之中，所以，它是不能安装在已经是虚拟中的系统中的</li>
</ul>


<h3>安装与使用方法</h3>

<ul>
<li>Windows
    下载安装文件后直接安装即可，会把所有的依赖（Virtualbox）都装上</li>
<li>Linux(Ubuntu 64)

<ul>
<li>下载genymotion-[version]_[arch].bin</li>
<li>chmod +x genymotion-[version]_[arch].bin</li>
<li>./genymotion-[version]_[arch].bin（注意一下子安装的路径，是放在$PWD/genymotion/下面</li>
<li>安装Virtualbox，如果还没安装的话sudo apt-get install virtualbox</li>
<li>启动cd genymotion; ./genymotion。登录帐户然后选择设备进行下载，之后就可以使用了，都是GUI页面，有问题可以Google。</li>
</ul>
</li>
</ul>


<h2>使用<a href="http://www.andyroid.net/">Andy the Android Emulator</a></h2>

<p>貌似官方网站不能下载。</p>

<h3>快速功能列表</h3>

<ul>
<li>支持Windows和Mac</li>
<li>支持开发所需要的所有功能</li>
<li>支持同步</li>
</ul>


<h2>使用<a href="http://www.bluestacks.com/">Blue Stacks App Player</a></h2>

<h3>功能列表</h3>

<ul>
<li>仅支持Windows</li>
</ul>


<h2>使用<a href="https://www.manymo.com/">Manymo</a></h2>

<p>这个网站经常打不开，因为访问量太大。</p>

<p>它不是运行在本地的，它是一个运行在浏览器中的Android模拟器，注册用户以后，就可以上传应用，然后在浏览器中运行Android应用了，听起很酷，但是这个并不适合开发者用。这个适合测试人员用。或者开发完成后做一些兼容性测试之类的场景。</p>

<h3>快速功能列表</h3>

<ul>
<li>运行在浏览器之中</li>
<li>适合测试，而不是实时的调试</li>
<li>缺点就是网站经常打不开</li>
</ul>


<h2>总结与推荐</h2>

<p>其实，所有的加速的模拟器，也都是以x86为基础建立起来的，只不过他们做了更多的封装，让它的安装和使用更加的方便而已。</p>

<p>最出名的，也是最方便好用当属Genymotion，推荐使用。</p>

<p>如果你有更好的秘密武器，也请与我分享。</p>

<h2>参考</h2>

<ul>
<li><a href="http://stackoverflow.com/questions/1554099/why-is-the-android-emulator-so-slow">Why is the Android emulator so slow?</a></li>
<li><a href="http://stackoverflow.com/questions/2662650/making-the-android-emulator-run-faster">Making the Android emulator run faster</a></li>
<li><a href="http://www.techbate.com/5-best-android-emulator-for-windows-87xp/">5 Best Android Emulator For Windows 8,7,XP</a></li>
<li><a href="http://techapple.net/2014/05/3-best-android-emulators-for-mac-os-macbook-run-and-install-android-app-on-your-mac-os-x-macbook-airpro/">3 Best Android Emulators for Mac OS / Macbook </a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[不断更新，保持高效]]></title>
    <link href="http://toughcoder.net/blog/2014/10/26/stay-tune-with-state-of-art/"/>
    <updated>2014-10-26T22:13:51+08:00</updated>
    <id>http://toughcoder.net/blog/2014/10/26/stay-tune-with-state-of-art</id>
    <content type="html"><![CDATA[<p>正所谓学历代表过去，学习力代表未来。柯维大师的七个习惯之中的终极习惯就是要“不断更新”，今天的你再牛B，知道的再，如果不去学习，不去提升，不去更新自己，那么总有一天也会被超越，时代在进步，别人在进步，发逆水行舟，不进则退，你停止了学习，就表明你退步了，因为别人在进步。
那么，为了保持能够高效的进行Android开发，我们就必须不断的学习，不断的充电，这些列出一些，能够提高Android开发的进阶教程，注意是进阶教程，而非入门教程。</p>

<p><a href="http://toughcoder.net/blog/2014/10/26/stay-tune-with-state-of-art/"><img src="http://www.bvsc.org/sites/default/files/images/5%20ways-KEEP%20LEARNING.png"></a></p>

<!-- more -->


<h2>书箱</h2>

<p>虽然说现代人忙的都没有时间看书了，虽然说，我们浮躁的没有耐心把一本书看完，但是书籍仍然是学习和获取知识的最佳途径，前提是你选对了书。对于Android的进阶学习，这些书籍是非常好的：</p>

<ul>
<li><p>《50 Android Hacks》</p>

<p> 这本书有点类似《Effective Java》和《Effective C++》，它是以话题形式来讨论提升Android开发的技巧，每个话题一个技巧，非常实用的一本书，里面有很多干货，有实例，拿来就可以用</p></li>
<li><p>《Smashing Android UI》</p>

<p> 这本书重点讨论如何提升UI，包括动画，布局，UI性能，定制Widget等。</p></li>
<li><p>《Pro Android Apps Performance Optimization》</p>

<p> 这本书是讲如何提升应用的性能。</p></li>
<li><p>《Decompiling Android》</p>

<p> 这本书比较有意思，是从另外一个角度来讲Android开发，从逆向工程角度，主要讲如何逆向工程一个应用，以及如何从开发层面来防止应用被逆向。里面讲了很多工具，很实用。</p></li>
<li><p>《Android Design Patterns: Interaction Design Solution for Developers》</p>

<p> 这本书的话题跟开发比较远，主要是从UX角度来讲解Android上面的用户体验的模式，比如现在非常流行的Drawer等等。孤认为开发者也要懂一些用户体验方面的东西，而且这些东西跟开发者关系更大一些。因为UXD并不清楚什么可以实现，什么难以实现，什么无法实现，以及实现起来的代价有多大。现在不是流行全栈工程师吗。Anyway，多了解点知识总是没坏处的。</p></li>
</ul>


<p>这些书随便就能搜索到，就不提供下载链接了。至于说为什么这里都是英文的，因为都是外国人写的啊！推荐直接看原版，因为翻译有些时候不会太准，因为译者的理解可能会不一样。并不需要多牛B的英文水平才能读懂英文书。这些都是专业的书籍，语言都非常的通俗易懂，对于常见的一些专业术语，查几次词典就记住了。关键还是态度。</p>

<h2>网络博客资源</h2>

<p>光看书，也还不够，因为最新的技术总是先出现在网络，尔后由人总结才能出现在书中。</p>

<ul>
<li><p><a href="http://developer.android.com/develop/index.html">Android Developers</a></p>

<p> 这个不用多说，开发Android，无论是新手还是老手，官方的文档总是一个必须要常访问的地方。今日的官方文档已经10时的大不一样，那时里面除了API Reference外，几乎有很少其他内容，但是现在从Tutorials, Training Docs, References, Articles, Videos, Best Practices and Samples可以说凡是能用来学习的全都有了，里面已是相当的丰富了。</p></li>
<li><p><a href="http://blog.jobbole.com">伯乐在线</a></p>

<p> 这里每天会汇集一些优质的网络博客，各个方面的，当然也包括Android。</p></li>
<li><p><a href="http://android-developers.blogspot.com">Android Developer Blogs</a></p>

<p> 这个貌似是一群Android系统的开发者所定的博客，里面的文章相当有深度和权威，都是一等一的干货。</p></li>
<li><p><a href="http://blog.stylingandroid.com">Styling Android</a></p>

<p> 这个博客主要讲高级的UI定制，比如实现颜色选择器那种高级复杂的UI。</p></li>
<li><p><a href="https://www.youtube.com/playlist?list=PLWz5rJ2EKKc_XOgcRukSoKKjewFJZrKV0">Android Dev Bytes</a></p>

<p> 这个是YouTube上面的一个频道，是由Android系统的开发者做的一些教程类的视频，讲述如何进行开发，和提升的技巧。视频的内容非常丰富，从新的API，到游戏，再到UX，和Android Design。每个视频都算长，几十分钟。其中有几个哥们是Framework图形库的，讲述的如何做各种非常炫和酷的动画，相当的赞。这可以世界上最优秀的工程师，且是Android的维护者做的教程，错不了。</p></li>
<li><p><a href="http://www.androiddesignpatterns.com">Android Design Patterns</a></p>

<p> 这个博客的内容都是关于深度解析Frameworks中某些组件的工作原理的，很有深度。</p></li>
</ul>


<h2>优质的网站和社区</h2>

<ul>
<li><p><a href="http://hao.jobbole.com/category/android/">伯乐资源</a></p>

<p> 这里面有非常全的Android相关的资源。</p></li>
<li><p><a href="http://www.android-studio.org">Android Studio</a></p>

<p> 这个是AndroidStudio的中文社区，主要关注AS，但也有开发相关内容。</p></li>
<li><p><a href="http://androidweekly.net">Android Weekly</a></p>

<p> 这个网站会像周报一样，每周更新Android开发相关的新闻，技术等。</p></li>
<li><p><a href="http://www.androidpatterns.com">Android Patterns</a></p>

<p> 这个主要是UX相关的。</p></li>
<li><p><a href="http://www.android-app-patterns.com">Android App Patterns</a></p>

<p> 这个也是UX设计相关的。</p></li>
</ul>


<h2>线下社区</h2>

<p>这个要看具体的城市而定，现在大多数城市都有谷歌开发者社区<a href="http://www.chinagdg.com/forum.php">GDG(Google Developer Group)</a>他们都会定期的举办活动，因为是关于Google的，所以肯定有Android相关的。对于像北京，上海，杭州这些移动互联网热门城市，各种社区应该很多的。</p>

<h2>请分享你常常使用的好的资源</h2>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[适配多屏幕的最佳实践]]></title>
    <link href="http://toughcoder.net/blog/2014/10/26/best-practices-to-support-multiple-screen/"/>
    <updated>2014-10-26T19:58:10+08:00</updated>
    <id>http://toughcoder.net/blog/2014/10/26/best-practices-to-support-multiple-screen</id>
    <content type="html"><![CDATA[<p>对于Android应用开发来讲，比较头疼的，也是比较重要的一个工作就是要尽可能多的支持市场上的Android设备，由于Android的开放性，各种奇奇怪怪的设备都有，符合标准的，不符合标准的，行货，水货，山寨货鱼龙混杂，防不胜防。为了让我们的应用能够得到尽可能多的用户，我们就必须能让应用以超强的适应性，以能在混乱的手机里生存。而适配设备，GUI屏幕的适配又是重中之中，如果用户都无法正确的看到你的UI页面，那还用个毛线啊！</p>

<p>之前曾经写过<a href="http://blog.csdn.net/hitlion2008/article/details/9200135">一篇文章</a>，介绍了一下子如何使用dimen资源来适配多屏幕，随着Android版本的演进，有些概念已经过时，需要重新整理一下。</p>

<p><a href="http://toughcoder.net/blog/2014/10/26/best-practices-to-support-multiple-screen/"><img src="http://developer.android.com/images/resources/resource_devices_diagram2.png"></a></p>

<p>其实对于多屏幕适配，一个核心的原则就是要对布局做好抽象的分离，把可变与不可变分开，把与屏幕相关的尺度dimen写在单独的dimen文件中，然后使用引用。如果不这样做，就会造成更多的代码重复。</p>

<!-- more -->


<h2>以最佳的方式来提供资源</h2>

<p>通常我们的做法是以屏幕密度(<a href="http://developer.android.com/guide/topics/resources/providing-resources.html">Screen Density</a>)，做为区分来提供不同的资源，以达到支持和适配不同的屏幕，比如我们会为mdpi, hdpi, xhdpi，各准备一套图片和dimen，大多数情况下，这很好，能对付了大多数设备，但这还不够。</p>

<p>比如说，480x800, 480x854, 540x960这三种设备，都是同样的屏幕密度hdpi，但是屏幕尺寸并不相同，对于qHD(540x960)，它的可用空间要比标准hdpi(480x800)要多得多，如果以qHD为基准来调的布局，那么放到480x800上，有些元素会被挤扁，或者显示不完全。而且目前，540x960的设备要多于480x800的，因为屏幕都是越来越大，精度越来越高的。</p>

<p>那么如何解决呢？
现在推荐的做法是用屏幕的可用高度(注意是可用高度，不包括状态栏和底部硬键)来区分不同的资源。以前是可以在屏幕密度后面指定具体的分辨率来区分，比如values-hdpi-960x540。但是现在这种做法已被废弃，<a href="http://developer.android.com/guide/practices/screens_support.html">官方文档</a>中都不会提及了。很显然它的问题在于不够通用。</p>

<p>现在推荐的做法是用可用高度或者可用宽度来指定：</p>

<ul>
<li>values-h&lt;sw&gt;dp</li>
<li>values-h&lt;sh&gt;dp</li>
</ul>


<p>这里面的sw和sh就是屏幕的可用宽度和可用高度。这种方式的适配规则是：用小于且最接近设备屏幕高度或宽度的那个资源，比如设备可用高度是610dp，则选择values-h600dp，以此类推。用这个方式就能区分同为hdpi的480x800和540x960，因为：</p>

<ul>
<li>480x800     533dp</li>
<li>540x960     640dp</li>
</ul>


<p>所以，可以用values-h600dp来区分二者。
使用此的方法为：</p>

<ul>
<li>计算某个设备的高度或者宽度，以dp为单位。高度dp=可用高度px/density</li>
<li>创建可以区分不同设备的资源目录，如values-h500dp, values-h600dp等</li>
</ul>


<h2>增加适配性的更多技巧</h2>

<p>除了上面提到的，还有一些在适配时需要注意的事情。</p>

<ol>
<li>尽量多用WRAP_CONTENT和MATCH_PARENT，特别是对于像文字图片等元素的度量</li>
<li>对于页面的边框距离，最好用最外层的ViewGroup来指定，或者使用margin或者使用padding。
这点的主要意思是，如果你想要页边框距是20dip，那么用一个ViewGroup来指定，要么是最外层的，要么是最里层的，千万不要是外面的5dp，中间的5dp，里面的5dp，最里面的5dp，虽然整体效果看起来是一致的，但是当适配时就会蛋疼了。固定在某个上面，这样既方便调试，也方便适配和移植。</li>
<li>同一个应用，边框距等最好做到一致，起码对于同一类型的页面更是如此。</li>
</ol>


<h2>一些常见设备的参数</h2>

<ul>
<li>320x480   1   mdpi  480dp</li>
<li>480x800   1.5 hdpi  533dp</li>
<li>540x960   1.5 hdpi  640dp</li>
<li>720x1280  2   xhdpi 640dp</li>
<li>1080x1920 3 xxhdpi 640dp</li>
</ul>


<h2>参考</h2>

<ul>
<li><a href="http://developer.android.com/guide/topics/resources/providing-resources.html">http://developer.android.com/guide/topics/resources/providing-resources.html</a></li>
<li><a href="http://developer.android.com/guide/topics/resources/providing-resources.html#Compatibility">http://developer.android.com/guide/topics/resources/providing-resources.html#Compatibility</a></li>
<li><a href="http://developer.android.com/guide/topics/resources/runtime-changes.html">http://developer.android.com/guide/topics/resources/runtime-changes.html</a></li>
<li><a href="http://stackoverflow.com/questions/16907023/best-way-to-support-540x960-and-480x800-both-hdpi">http://stackoverflow.com/questions/16907023/best-way-to-support-540x960-and-480x800-both-hdpi</a></li>
<li><a href="http://forums.xamarin.com/discussion/2784/best-way-to-support-540x960-and-480x800-both-hdpi">http://forums.xamarin.com/discussion/2784/best-way-to-support-540x960-and-480x800-both-hdpi</a></li>
<li><a href="http://developer.android.com/guide/practices/screens_support.html">http://developer.android.com/guide/practices/screens_support.html</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[如何有效的减少重复的代码]]></title>
    <link href="http://toughcoder.net/blog/2014/10/25/tricks-to-remove-duplicates/"/>
    <updated>2014-10-25T21:59:26+08:00</updated>
    <id>http://toughcoder.net/blog/2014/10/25/tricks-to-remove-duplicates</id>
    <content type="html"><![CDATA[<p>重复的代码一直都是可维护性的大敌，重构的重要任务之一也就是要去除掉重复的代码，有效的减少重复代码，可以大大提高软件的扩展性。</p>

<p>在Android开发中，很容易产生重复的代码。因为Android是组件，模板式开发，每个页面都是独立用Activity或Fragment实现，布局文件都是用XML方式去写，所以很容易造成代码的重复，虽然二个页长的差不多，但毕竟是二个Activity，于是就拷一份出来，改吧改吧就成了。</p>

<p><a href="http://toughcoder.net/blog/2014/10/25/tricks-to-remove-duplicates/"><img src="https://cdn.tutsplus.com/mobile/uploads/legacy/134_Android-User-Interface-Design_Relative-Layouts/fig2.png" width="600" height="320"></a></p>

<p>那么我们如何做才能去掉重复的代码呢？</p>

<!-- more -->


<h2>为你的项目定义一个基Activity或Fragment</h2>

<p>无论你的项目大或小，定义一个基Activity或Fragment总是有好处的。随着项目的发展，会有大量的公共代码可以抽出来放到基类里去。或者在基类里面做一些项目特色的事情。再或者添加一些统计，崩溃反馈等等。在一个基类里面改动总比把每个Activity或Fragment里面都改一遍要好的多。</p>

<h2>代码的去重复技巧</h2>

<p>从代码上去除重复的代码就是用通用的重构技巧，比如提炼方法，抽象基类，提炼常量等。但是光是代码还不够，因为Android的页面代码跟布局文件的关联非常大，通常Activity或者Fragment都是为了操作布局页写的，所以要想彻底的减少代码的重复，还必须先减少布局的重复。</p>

<h2>用<a href="http://developer.android.com/training/improving-layouts/reusing-layouts.html">include</a>减少局部布局的重复</h2>

<p><include/>标签是减少布局重复的利器，它的作用是把另外一个布局文件全部无修改式的嵌入到标签所在的位置。这与C/C++语言的预处理指令#include是一样的。在WEB框架式开发中，也非常常用HTML模板，其中也有类似的include。目的也是减少代码的重复。</p>

<p>要想把include用的恰到好处，首先要做的就是把整体布局模块化，从整体的布局出发，找出可复用的局部布局或布局组合，把它们放入单独一个布局文件中，然后在其他的地方就可以include了。</p>

<h2>用<a href="http://developer.android.com/reference/android/view/ViewStub.html">ViewStub</a>减少整体的布局的重复</h2>

<p>前面是找出布局中的可复用布局组合，include以减少重复。但有些时候是反过来的，也就是说有几个页面，它们整体的一样的，但是某个局部是不同的，这个时候include就不行了。这个时候就可以使用一样的整体布局+ViewStub来做布局。</p>

<p>ViewStub是一个轻量级别的，不可见的View，当ViewStub被设为visible时，或者显示调用layout()时，才会去把它所指向的布局渲染出来，所以它非常适合处理整体相同，局部不同的情况。关于ViewStub的使用可以参考<a href="http://blog.csdn.net/hitlion2008/article/details/6737537">这篇博客</a>。
具体的策略是：</p>

<ul>
<li>规划整体布局，抽象出共同的布局，把可变的布局识别出来</li>
<li>写整体布局，对于可变的局部布局用ViewStub替代</li>
<li>用一个基Fragment来操作整体布局。</li>
<li>创建基Fragment的子类，每个子类，用真正的布局来替换ViewStub。</li>
</ul>


<h2>多用引用而不是写死</h2>

<p>这点是非常重要的，Android的强大之处在于，所有的资源的指定都可以用引用，而非直接写死，直接写死就会出现重复代码，比如颜色，背影，字串，布局，ID，度量(dimen)，风格等等。那么，我们在使用的时候，也尽可能的使用引用，这样非常易于复用，修改和定制，从而也就更方便复用。</p>

<h2>分析，分离变与不变</h2>

<p>其实代码的去重复的关键都在于要分析出可变与不可变，共性和特性，这是抽象与封装的基础。这个没有直接可操作性的建议，只能靠自己平时多多积累，以及遇到问题时多多思考。</p>

<p>另外，就是对于重复的定义是达到三次及三次以上。如果仅出现二次，并且，无可能出现别一次，这个时候其时，要不要去重复有在商榷，写第二次时，花时间重构，与拷贝或重新实现，其实代码差不多。当发现第三次实现某个东西时，就要考虑好好的重构一下，减少重复。</p>

<p>还有，就是，在项目开始不要考虑的太多，不要过度设计。孤认为，不过过度设计，更不要过早优化，就根据需求和进度和发展状况综合来看。当出现了重复，需要重构时就立马去做，这样就不会出问题。但如果没能及时去做重构，欠了债，那么由于涉及代码，功能和模块都比较多时，再去重构，难度大，风险也大。就好比房屋的维护保养，当出现灰尘时就去打扫，很容易，个把小时就搞定了，但如果一直拖着，一年才打扫一次，可能要十天半个月才能完事。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用工具来提升Android开发效率]]></title>
    <link href="http://toughcoder.net/blog/2014/10/24/boosts-android-development-with-tools/"/>
    <updated>2014-10-24T18:15:56+08:00</updated>
    <id>http://toughcoder.net/blog/2014/10/24/boosts-android-development-with-tools</id>
    <content type="html"><![CDATA[<p>正所谓工欲善其事，必先利其器。学习并应用优秀的轮子，可以让我们跑的更快，走的更远。这里所指的工具是广义的，泛指能帮助我们开发的东西，或者能提高我们效率的东西，包括：开发工具，监测工具，第三方代码库等。
<a href="http://toughcoder.net/blog/2014/10/24/boosts-android-development-with-tools/"><img src="http://img.clubic.com/05250064-photo-apple-tools.jpg" width="600" height="320"></a></p>

<h2>优质的第三方开源类库</h2>

<!-- more -->


<h3>图片加载与缓存</h3>

<p>现代的应用程序难免会有图片显示给用户，对于资讯类，旅游类，购物类等应用程序而言，图片的展示更是应用里面关键的一环。而图片从加载，到缓存再到显示是一个比较复杂的过程，中间还要处理网络异常，解析异常等。图片又是极其耗费内存的，稍不注意就会出现OutOfMemory（OOM）的错误。如果你的图片在你的应用中不是主要的东西，仅是偶尔显示个Icon和图标之类的，那还好，普通的异步加载和解析（<a href="http://developer.android.com/reference/android/graphics/BitmapFactory.html">BitmapFactory</a>）就好。但如果要在应用中展示大量的图片时，甚至应用的主要内容就是图片时，这时就要借助于优秀的开源库了：</p>

<ul>
<li><p><a href="https://github.com/nostra13/Android-Universal-Image-Loader">Universal Image Loader</a></p>

<p> 这个库非常强大，从加载，到解析到显示，你只配置参数，告诉它如何做，再给它一个ImageView就可以了，然后你就可以去喝茶去了。</p></li>
<li><a href="https://github.com/square/picasso">Picasso</a></li>
</ul>


<h3>EventBus完全解耦模块</h3>

<p>观察者模式，或者生产者消费者模型在开发中是很常见的，比如说异步加载数据，之类的都会用到类似的结构。通常的做法就是创建一个Listener用于回调，以返回数据。如果有一个二个还好，但如果多了，应用需要获取大量的不同的数据，就会出现大量的线程和Listener，到处是addListener和implements Listener，这会造成大量的代码和依赖，程序会变得混乱，业务逻辑会迷失在Listener之中，而且还要及时的unregisterListener，以防不该被回调到时能取消。这还会造成代码和模块之间的强耦合，也就是写代码的时候必要在有另一方，否则不会编译过。这时就可以用EventBus来解耦了，它是一个框架能让双方很容易的进行通讯，而不必知道彼此的存在与否：</p>

<ul>
<li><a href="https://github.com/greenrobot/EventBus">EventBus</a>
 这个库非常的高效与方便，它完全不依赖于注解。</li>
<li><a href="http://square.github.io/otto/">Otto</a>
 这个要使用注解，所以在效率上可能会略差一些。</li>
<li><a href="https://code.google.com/p/guava-libraries/wiki/EventBusExplained">Guava</a>
 这个是Google Java增加库Guava中的一个</li>
</ul>


<p>这些的库的基思想和目的都是一致的，都是以总线的方式，让强耦合的双方解耦，不妨在你的应用中使用一下，体验一下。</p>

<h3><a href="https://github.com/hdodenhof/CircleImageView">CirclImageView</a></h3>

<p>这似乎是一个比较小型的库，它只是一个特殊的ImageView用圆形的方式来显示图片。</p>

<h3><a href="https://github.com/Maxwin-z/XListView-Android">XListView</a></h3>

<p>这是一个支持下拉刷新(PulltoRefresh)和上拉加载更多(Load more)的定制ListView。</p>

<h3><a href="https://github.com/JakeWharton/Android-ViewPagerIndicator">ViewPageIndicator</a></h3>

<p>这个是要与官方的<a href="http://developer.android.com/reference/android/support/v4/view/ViewPager.html">ViewPager</a>一起使用的，为ViewPager添加indicator的类库，非常的有名，很多应用都在使用。</p>

<h3><a href="https://github.com/JakeWharton/ActionBarSherlock">ActionbarSherlock</a></h3>

<p>这个库非常的有名，很多优秀的应用都基于此。<a href="http://developer.android.com/reference/android/app/ActionBar.html">ActionBar</a>是一个不错的用户体验，它能集导航，操作和信息于一体的导航栏，Google也极力推荐使用它。但是有一个问题就是它是<a href="http://developer.android.com/about/versions/android-3.0-highlights.html">HoneyCombe</a>（API 11）才引及的一个组件，而对于大多数开发者来说，GingerBread(2.3)还是不能放弃的肉，所以这个类库应运而生。这个库易于使用，根据手机版本来选择实现方式，如果是3.0以上就直接使用系统的Actionbar。其中的代码也是值得所有开发者去拜读。</p>

<h3><a href="https://github.com/bauerca/drag-sort-listview">DragSortListView</a></h3>

<p>用过iOS设备的人可能会注意到iOS里面的所有列表都有一个非常酷的功能，那就是在编辑模式下，可以任意对列表进行重新排库。但是令开发沮丧的是，这是iOS中UITableView的标准内嵌功能。而Android的ListView只提供最基本的功能。因此就有了此类库的出现。其实除了此库，还有很多其他的库的出现也都是为了实现类似iOS体验而做的。
当然这个类库有一个小问题需要注意，就是它内部会创建一个ItemView来Wrapper客户代码提供的ItemView，而在Wrapper时，它会使用WRAP_CONTENT做为高和宽，所以，用了这个类库会发现宽度不会Match整个屏幕。解决的办法就是在创建Adapter#getView时再用代码指定一扁LayoutParams，把宽设为MatchParent就好了。</p>

<h3><a href="http://nineoldandroids.com">NineOldAndroid</a></h3>

<p>这个库也是解决低版本之痛的。从3.0开始，Google引入了新的动画库，称作Property动画，使实现动画不但变得非常简单，同时也能实现更加复杂的动画。只要对对象的属性进行计算，就能让这个对象动起来。但是同样，对于2.3以前就只能用旧的补间动画(Tween Animation)，这种动画复杂，需要写大量的代码。这个库就能统一操作，让动画变得简单
这里介绍的，只是一些比较常用的也是比较有名的类库。这些库不但优秀，好用，而且最重要的是还开源，你可以去学习，去研究，甚至去改进。那么，这些还远远不够，我们的应用日益复杂，各种需求，怎么办呢？</p>

<h2>如何获取更多的类库</h2>

<p>学习编程的第一天起，前辈们就说，不要重复制造轮子，老手与新手的区别也在于，老手善于利用已有的东西，而不是一起都从0开始，无数的优秀的类库已经能帮忙解决很多问题，它们健壮，方便，好用，所以为什么还要自己费劲去重新造轮子呢？</p>

<h3>二个开发者必备之神器</h3>

<p>现在的开源类库非常之多，有些我们可能不知道，即使看到一个类库的主页或者源码，也要花时间研究下，它究竟能干什么，适合干什么，以及能否解决我们遇到的问题，这是介绍三款神器：</p>

<ul>
<li> <a href="https://play.google.com/store/apps/details?id=com.indianic.coslib">Developer Library for Android</a></li>
<li> <a href="https://play.google.com/store/apps/details?id=com.inappsquared.devappsdirect">DevAppsDirect</a></li>
<li> <a href="https://play.google.com/store/apps/details?id=com.limecreativelabs.app">LiME Creative Labs</a></li>
</ul>


<p>这三款都是Android应用，只是它们的内容是介绍众多优质的开源类库，它会列出每个类库的信息，如作者，源友位置，简要说明。最最重要的是它把类库的例子也集成起来了，你可以立马运行类库的Demo以体验这个类库到底是干啥的，这真的是良心之作。等什么呢，赶快去下载安装吧。</p>

<h3>Github</h3>

<p>提起开源，<a href="https://github.com/">Github</a>当然是首届一指的，其上托管着无数的优秀的开源库，没事常去逛逛总会有好处，甚至是惊喜的。唯一麻烦的就是，里面的内容太多了，容易看花眼和找不到想要的东西。所以还是上面的应用来的干脆直接。</p>

<h3>优质的聚合平台</h3>

<p>除此之外，还有一些优秀的网络社区和博客会收集和整理优秀的开源类库，这也是我们需要关注的，比如：</p>

<ul>
<li> <a href="http://hao.jobbole.com/category/android/">伯乐</a>
  这里面罗列了大量的优秀的库和工具，这里不仅有库还有工具。此外这个网站也值得所有开发者收藏，里面会聚合优秀的博客和资源。</li>
<li> <a href="http://guides.codepath.com/android">CodePath</a></li>
</ul>


<h2>每个应用程序必不可少的组件</h2>

<p>现在的应用程序有一些东西是必要的，比如分享功能，比如推送消息，比如应用程序统计和崩溃报告等，如果你是一个大型公司，拥有大团队，或者已经发现成为行业领头羊，那么这些东西最好自己实现，以达到更好的控制和运营，也防止数据外泄。但对于小团队，或者个人开发者，来说，还是利用现成的解决方案比如靠谱。</p>

<h3>分享到社交平台</h3>

<p><a href="http://www.mob.com/">ShareSDK</a>和<a href="http://www.umeng.com">友盟</a>都提供了免费的SDK用以实现分享到各大社交平台。
其实每个社交平台都有提供了SDK，但是有些麻烦的是开发者必须要一一去注册，以获取APP_KEY，同时还要处理用户授权以获得访问社交数据，不同的SDK，虽然基本思想是一致的，但是具体开发过程难免会有坑。ShareSDK就是帮助开发者解决了这些问题，它在各个媒体平台上都注册了，也封装处理了授权过程，但是带来方便的同时，它有缺点：
   * 分享到社交媒体上的信息会显示“来自ShareSDK”，而非你的应用。这个通常是显示开发者在社交媒体上注册的信息。
   * ShareSDK的授权方式是通过网页形式，而非API，过于简单且授权信息不容易持久化，也就是用户可能会经常（甚至每次）分享时都需要授权。而如果直接使用媒体授权API，可以直接获取APP_SECRETE，在未过期（一般Expiration会比较长）之前都可以直接分享，无需授权。</p>

<p>所以你看所有的用户量超大的应用，各大新闻客户端等，都是自己集成和绑定社交媒体，不会通过第三方的库。</p>

<h3>推送消息</h3>

<p>现在的应用程序基本上都会有后台服务提供数据，也会增加推送消息，这个是运营的重要手段，能保持应用的活跃，虽然我不喜欢推送消息，因为早上一打开手机，全都是推送消息。但是推送还是必要的，也有现成的方案可以用：</p>

<ul>
<li> <a href="http://www.igetui.com">个推</a></li>
<li> <a href="http://www.umeng.com/">友盟</a></li>
</ul>


<p>这二个也都非常好用，它包括客户端SDK和Server端后台，是全套的，非常方便实用。
除此之外，如果是面向海外用户，可以用Google提供的，<a href="http://developer.android.com/google/gcm/index.html">Google Clould Messaging</a>，它也非常好用，因为毕竟是官方的，可以与Apple的推送服务媲美。但是它的最大的缺点在于，Google Services都依赖于Google Play，也就是说运行时手机上必须要有Google Play Services，也即必须要安装有GMS才可以。但中国大陆的手机全部没有GMS，因此GCM也用不了。所以个推和友盟也才有机会。</p>

<h3>应用统计信息</h3>

<p>移动开发不单单只有开发出一个出色的APP这么简单，开发完了还要运营，而应用的统计绝对是运营的一个重要手段，后期的新功能，以及发展方向要取决于应用的统计数据，统计能看出用户的特征，分布，使用习惯等。当然了，在统计方面友盟绝对是最好的，它开始的最好，现在也是做的最好的，使用也非常的简单。</p>

<h3>应用崩溃报告</h3>

<p>现在的Android手机种类极其之多，各种奇葩的设备都有，在标准的手机和模拟器上运行没有问题，但是在某些定制ROM的手机上可能就会挂。另外，程序也会有你想不到Bug导致崩溃。因此我们需要收集应用的崩溃信息，以后期改进。如果你集成了友盟统计，它会自动收集崩溃信息，但是它只能收集Java层的，且信息比较简单，只有一个StackTrace。如果想要收集Native层的，以及获得更多的信息的话，就要使用其他库，或者自己实现。自己实现也不难，就是要处理unhandledException，然后把客户端的信息，如版本，配置，再把手机的信息收集一下，发到后台，后台再做个报表，能查看错误信息就可以了。但如果不想自己做，可以使用<a href="https://github.com/ACRA/acra">Application Crash Reports for Android</a>这个库可以解决客户端的问题，也就是说它能在发生Crash时，收集足够的信息(哪配置要收集哪些信息)，然后发送，它可以配置成发送到Server后台，也可以发送到开发者的邮箱，很方便和实用，特别是对于个人开发者来说。需要注意的是，要想能发送到邮箱，手机用户必须配置了Email帐户，国内用户貌似没有这习惯，因为国内用户不习惯用邮件，更不要说给手机配置邮件帐户。但是对于国外用户，这是没有问题的，国外用户习惯电子邮件，而且手机上都会配置。</p>
]]></content>
  </entry>
  
</feed>
