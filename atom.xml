<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[ç¨€æœ‰çŒ¿è¯‰]]></title>
  <link href="https://alexhilton.github.io/atom.xml" rel="self"/>
  <link href="https://alexhilton.github.io/"/>
  <updated>2025-04-26T21:33:36+08:00</updated>
  <id>https://alexhilton.github.io/</id>
  <author>
    <name><![CDATA[Alex Hilton]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Shortest-Path-in-Graph]]></title>
    <link href="https://alexhilton.github.io/blog/2025/04/26/shortest-path-in-graph/"/>
    <updated>2025-04-26T21:28:55+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/04/26/shortest-path-in-graph</id>
    <content type="html"><![CDATA[<p>å›¾ä¸­çš„è·¯å¾„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯æœ€çŸ­è·¯å¾„é—®é¢˜æ˜¯å›¾è®ºä¸­ç®—æ³•çš„æ ¸å¿ƒï¼Œä»Šå¤© å°±æ¥æ€»ç»“ ä¸€ä¸‹ã€‚</p>

<p><a href="https://alexhilton.github.io/blog/2025/04/26/shortest-path-in-graph/"><img src="https://www.mbloging.com/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2Fyynr1uml%2Fproduction%2F0b7098c6c641f29656d920a12b6a36feade61e38-1024x576.jpg%3Fw%3D1024%26auto%3Dformat&w=1920&q=75" title="auto auto" ></a></p>

<!-- more -->


<h2>BFSæ±‚æ— æƒæœ€çŸ­å¾„</h2>

<p>å¯¹äº æ— æƒå›¾ï¼Œç”¨BFSå°±èƒ½æ‰¾åˆ°ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼Œè¿™æ˜¯BFSçš„å¤©ç„¶ä¼˜åŠ¿ã€‚éå† çš„æ—¶å€™ è¦æ³¨æ„ ç”¨ã€Œåœˆå±‚å¼ã€éå†ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äº å½“å‰èŠ‚ç‚¹ï¼ŒæŠŠå…¶ç›¸é‚»èŠ‚ç‚¹éå† å®Œï¼Œæ‰èƒ½ç®—èµ°äº†ä¸€æ­¥ã€‚</p>

<h2>Dijkstraæ±‚æœ‰å‘æ— ç¯å¸¦æƒå›¾çš„æœ€çŸ­è·¯å¾„</h2>

<p>å¯¹äºæœ‰å‘æ— ç¯å›¾DAGï¼Œå¸¦æœ‰æƒé‡çš„æœ€çŸ­è·¯å¾„é—®é¢˜å¯ä»¥ç”¨Dijkstraç®—æ³•æ¥æ±‚è§£ã€‚å…·ä½“å‚è§<a href="https://alexhilton.github.io/blog/2022/09/12/understanding-dijkstra-algorithm/">Understanding Dijkstra Algorithm</a>ã€‚</p>

<h2>Floyd</h2>

<ul>
<li><p><a href="https://www.programiz.com/dsa/floyd-warshall-algorithm">Floyd-Warshall Algorithm</a></p></li>
<li><p><a href="https://en.wikipedia.org/wiki/Floyd%E2%80%93Warshall_algorithm">Floydâ€“Warshall algorithm(Wikipedia)</a></p></li>
<li><a href="https://www.tutorialspoint.com/data_structures_algorithms/floyd_warshall_algorithm.htm">Floyd Warshall Algorithm</a></li>
</ul>


<h2>Bellman Ford</h2>

<p>Bellman Fordç®—æ³•èƒ½å¤„ç†è´Ÿæƒé‡ï¼Œè¿™æ˜¯ä¸å…¶ä»–ç®—æ³•ä¸åŒä¹‹å¤„ã€‚</p>

<ul>
<li><a href="https://en.wikipedia.org/wiki/Bellman%E2%80%93Ford_algorithm">Bellmanâ€“Ford algorithm(Wikipedia)</a></li>
<li><a href="https://www.programiz.com/dsa/bellman-ford-algorithm">Bellman Ford&rsquo;s Algorithm</a></li>
<li><a href="https://brilliant.org/wiki/bellman-ford-algorithm/">Bellman-Ford Algorithm</a></li>
</ul>


<h2>SPFA</h2>

<p>Shortest Path Faster Algorithmï¼ŒSPFAï¼ŒåŸºäºBellman Fordä¼˜åŒ–å‡ºæ¥çš„æ›´å¿«é€Ÿçš„ç®—æ³•ã€‚SPFA is an optimization of Bellman Ford algorithm.</p>

<ul>
<li><a href="https://cp-algorithms.com/graph/bellman_ford.html">Bellman-Ford Algorithm</a></li>
<li><a href="https://stackoverflow.com/questions/7710995/shortest-paths-faster-spfa-algorithm">Shortest Paths Faster - SPFA Algorithm?</a></li>
<li><a href="https://www.ultipa.com/document/ultipa-graph-analytics-algorithms/spfa/v5.0">Shortest Path Faster Algorithm (SPFA)</a></li>
</ul>


<h2>å…¸å‹é—®é¢˜</h2>

<table>
<thead>
<tr>
<th style="text-align:left;"> é¢˜ç›® </th>
<th style="text-align:left;"> é¢˜è§£ </th>
<th style="text-align:left;"> è¯´æ˜ </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> <a href="https://leetcode.cn/problems/cheapest-flights-within-k-stops/description/">787. K ç«™ä¸­è½¬å†…æœ€ä¾¿å®œçš„èˆªç­</a></td>
<td style="text-align:left;"> <a href="https://leetcode.cn/problems/cheapest-flights-within-k-stops/solutions/3637197/xi-you-yuan-su-787-k-zhan-zhong-zhuan-ne-xik1/">é¢˜è§£</a> </td>
<td style="text-align:left;"> </td>
</tr>
<tr>
<td style="text-align:left;"> <a href="https://leetcode.cn/problems/minimum-cost-to-reach-destination-in-time/description/">1928. è§„å®šæ—¶é—´å†…åˆ°è¾¾ç»ˆç‚¹çš„æœ€å°èŠ±è´¹</a></td>
<td style="text-align:left;"> <a href="https://leetcode.cn/problems/minimum-cost-to-reach-destination-in-time/solutions/3661240/xi-you-yuan-su-1928-gui-ding-shi-jian-ne-omo5/">é¢˜è§£</a> </td>
<td style="text-align:left;"> 787çš„å˜ç§ </td>
</tr>
<tr>
<td style="text-align:left;"> <a href=""></a></td>
<td style="text-align:left;"> <a href="">é¢˜è§£</a> </td>
<td style="text-align:left;"> </td>
</tr>
<tr>
<td style="text-align:left;"> <a href=""></a></td>
<td style="text-align:left;"> <a href="">é¢˜è§£</a> </td>
<td style="text-align:left;"> </td>
</tr>
</tbody>
</table>


<h2>References</h2>

<ul>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&amp;mid=2247488007&amp;idx=1&amp;sn=9d0dcfdf475168d26a5a4bd6fcd3505d&amp;chksm=fd9cb918caeb300e1c8844583db5c5318a89e60d8d552747ff8c2256910d32acd9013c93058f&amp;token=754098973&amp;lang=zh_CN&amp;poc_token=HBXK_Wej6Ul4b-A49RUuWn8ZDe0YvHMH9w7EGTxA">ã€æœ€çŸ­è·¯/å¿…èƒŒæ¨¡æ¿ã€‘æ¶µç›–æ‰€æœ‰çš„ã€Œå­˜å›¾æ–¹å¼ã€ä¸ã€Œæœ€çŸ­è·¯ç®—æ³•ï¼ˆè¯¦å°½æ³¨é‡Šï¼‰ã€</a></li>
<li><a href="https://leetcode.cn/problems/cheapest-flights-within-k-stops/solutions/955290/gong-shui-san-xie-xiang-jie-bellman-ford-dc94/">ã€å®«æ°´ä¸‰å¶ã€‘è¿ç”¨ Bellman Ford æ±‚è§£æœ‰é™åˆ¶çš„æœ€çŸ­è·¯é—®é¢˜</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æ·±å…¥ç†è§£Jetpack Composeä¸­çš„å‡½æ•°çš„æ‰§è¡Œé¡ºåº]]></title>
    <link href="https://alexhilton.github.io/blog/2025/04/26/understanding-execution-order-in-jetpack-compose/"/>
    <updated>2025-04-26T21:21:31+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/04/26/understanding-execution-order-in-jetpack-compose</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ªã€ŒUnderstanding Execution Order in Jetpack Compose: DisposableEffect, LaunchedEffect, and Composablesã€ï¼ŒåŸæ–‡é“¾æ¥<a href="https://proandroiddev.com/understanding-execution-order-in-jetpack-compose-disposableeffect-launchedeffect-and-composables-d2d0b75b7ec8">https://proandroiddev.com/understanding-execution-order-in-jetpack-compose-disposableeffect-launchedeffect-and-composables-d2d0b75b7ec8</a>ï¼Œç”±Sahil Thakarå‘å¸ƒäº2025å¹´4æœˆ13æ—¥ã€‚</p></blockquote>

<p><a href="https://alexhilton.github.io/blog/2025/04/26/understanding-execution-order-in-jetpack-compose/"><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*44_HTD27S8k-mxkIc_A9zg.png" title="auto auto" ></a></p>

<!-- more -->


<p>å¤§å®¶å¥½ï¼Œä»Šå¤©æˆ‘ä»¬åˆæ¥èŠèŠJetpack-Composeçš„å°è¯é¢˜ã€‚æ— è®ºå¯¹äºæ–°æ‰‹è¿˜æ˜¯ç»éªŒä¸°å¯Œçš„å¼€å‘è€…æ¥è¯´ï¼Œè¿™éƒ½æ˜¯ä¸€ä¸ªå°è¯é¢˜ï¼Œä½†å´æ˜¯å¾ˆå…³é”®çš„ã€‚æˆ‘ä»¬å°†è®¨è®ºä¸€ä¸‹Jetpack Composeä¸­å‰¯ä½œç”¨å’Œå¯ç»„åˆé¡¹ï¼ˆcomposablesï¼‰çš„æ‰§è¡Œé¡ºåºï¼Œç‰¹åˆ«æ˜¯ DisposableEffectã€LaunchedEffect å’Œå¯ç»„åˆå‡½æ•°çš„æ‰§è¡Œé¡ºåºä»¥åŠå…¶ç”Ÿå‘½å‘¨æœŸäº¤äº’è¿‡ç¨‹ã€‚</p>

<p>æˆ‘ä»¬å°†ä»”ç»†æ¢ç©¶ DisposableEffect å’Œ LaunchedEffect åœ¨å¯ç»„åˆé¡¹ä¹‹é—´å¯¼èˆªåˆ‡æ¢æ—¶æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Œç‰¹åˆ«å…³æ³¨å®ƒä»¬åœ¨è¿”å›ä¹‹å‰è®¿é—®è¿‡çš„é¡µé¢æ—¶çš„è¡Œä¸ºã€‚ï¼ˆè®¸å¤šç»éªŒä¸°å¯Œçš„å¼€å‘è€…ä¼šå‘Šè¯‰æˆ‘æˆ‘çŸ¥é“è¿™ä¸€ç‚¹ï¼Œä½†æˆ‘æ•¢æ‰“èµŒï¼Œä½ ä»¬ä¸­çš„å¾ˆå¤šäººå¹¶ä¸çŸ¥é“ï¼‰ã€‚</p>

<p>é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">MyComposable</span><span class="p">(</span><span class="n">cartId</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">lifecycleOwner</span> <span class="p">=</span> <span class="n">LocalLifecycleOwner</span><span class="p">.</span><span class="n">current</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// DisposableEffect observes the lifecycleOwner</span>
</span><span class='line'>    <span class="n">DisposableEffect</span><span class="p">(</span><span class="n">lifecycleOwner</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="s">&quot;Init&quot;</span><span class="p">,</span> <span class="s">&quot;DisposableEffect&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">onDispose</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="s">&quot;Init&quot;</span><span class="p">,</span> <span class="s">&quot;DisposableEffect - onDispose&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// LaunchedEffect triggers when cartId changes</span>
</span><span class='line'>    <span class="n">LaunchedEffect</span><span class="p">(</span><span class="n">key1</span> <span class="p">=</span> <span class="n">cartId</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="s">&quot;Init&quot;</span><span class="p">,</span> <span class="s">&quot;LaunchedEffect&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Scaffold is the UI container</span>
</span><span class='line'>    <span class="n">Column</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Log</span><span class="p">.</span><span class="n">e</span><span class="p">(</span><span class="s">&quot;Init&quot;</span><span class="p">,</span> <span class="s">&quot;Column&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="c1">// You can add your screen content here</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">Output</span><span class="p">:-</span>
</span><span class='line'>
</span><span class='line'><span class="n">E</span><span class="p">/</span><span class="n">Init</span><span class="p">:</span> <span class="n">Column</span>
</span><span class='line'><span class="n">E</span><span class="p">/</span><span class="n">Init</span><span class="p">:</span> <span class="n">DisposableEffect</span>
</span><span class='line'><span class="n">E</span><span class="p">/</span><span class="n">Init</span><span class="p">:</span> <span class="n">LaunchedEffect</span>
</span></code></pre></td></tr></table></div></figure>


<h2>æ‰§è¡Œé¡ºåºè¿·é¢˜ï¼šä¸ºä»€ä¹ˆColumnå…ˆæ‰§è¡Œï¼Ÿ</h2>

<p>ç­”æ¡ˆåœ¨äºè¿™äº›å‰¯ä½œç”¨ APIï¼ˆDisposableEffectã€LaunchedEffectï¼‰ç›¸å¯¹äºç»„åˆ(Composition)çš„å®é™…æ‰§è¡Œæ—¶é—´ã€‚</p>

<h3>1. ç»„åˆé˜¶æ®µä¼˜å…ˆ</h3>

<ul>
<li>Jetpack Compose é¦–å…ˆåœ¨ç»„åˆæœŸé—´æ„å»ºUIæ ‘ã€‚</li>
<li>æ­¤æ—¶ï¼ŒColumn æ˜¯ä¸€ä¸ªå¯ç»„åˆå‡½æ•°ã€‚å®ƒä¼šåœ¨ç»„åˆé˜¶æ®µç«‹å³æ‰§è¡Œï¼Œä»¥æ„å»º UIã€‚</li>
<li>å› æ­¤ï¼šColumn() é¦–å…ˆè¿è¡Œ â†’ æ‰“å‡ºæ—¥å¿— â€œColumnâ€ã€‚</li>
</ul>


<h3>2. å‰¯ä½œç”¨åœ¨ç»„åˆæœŸé—´æ³¨å†Œï¼Œä½†åœ¨ç»„åˆå®Œæˆåæ‰§è¡Œ</h3>

<ul>
<li>DisposableEffect å’Œ LaunchedEffect åœ¨ç»„åˆæœŸé—´æ³¨å†Œå…¶å·¥ä½œï¼Œ
ä½†å®ƒä»¬çš„å®é™…æ‰§è¡Œå‘ç”Ÿåœ¨ç»„åˆå®Œæˆåã€‚</li>
<li>Compose ä½¿ç”¨å†…éƒ¨è°ƒåº¦ç¨‹åºï¼ˆé€šè¿‡ Recomposerï¼‰åœ¨æäº¤å¸§åè¿è¡Œå‰¯ä½œç”¨ã€‚</li>
</ul>


<p>å› æ­¤ï¼Œå®é™…æ—¶é—´çº¿å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='Bash'><span class='line'>ç»„åˆï¼ˆCompositionï¼‰ å¼€å§‹
</span><span class='line'>   â†’ Column<span class="o">()</span> è¿è¡Œ â†’ æ‰“å°æ—¥å¿— <span class="s2">&quot;Column&quot;</span>
</span><span class='line'>   â†’ æ³¨å†Œ DisposableEffect ä»£ç å—
</span><span class='line'>   â†’ æ³¨å†Œ LaunchedEffect ä»£ç å—
</span><span class='line'>ç»„åˆ ç»“æŸ
</span><span class='line'>â†’ å‰¯ä½œç”¨å‡½æ•°å¼€å§‹æ‰§è¡Œ
</span><span class='line'>   â†’ DisposableEffect æ‰§è¡Œ â†’ æ‰“å°æ—¥å¿— <span class="s2">&quot;DisposableEffect&quot;</span>
</span><span class='line'>   â†’ LaunchedEffect å¯åŠ¨åç¨‹ â†’ æ‰“å°æ—¥å¿— <span class="s2">&quot;LaunchedEffect&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™é‡Œæˆ‘ä»¬è®¨è®ºäº†composableså’Œå‰¯ä½œç”¨ä¹‹é—´çš„æ‰§è¡Œé¡ºåºã€‚
é‚£ä¹ˆåœ¨ LaunchedEffectå’Œ DisposableEffectå‰¯ä½œç”¨å‡½æ•°ä¹‹é—´ï¼Œè°åˆå°†å…ˆæ‰§è¡Œå‘¢ï¼Ÿ</p>

<p>è®©æˆ‘ä»¬æ¥ä»”ç»†çœ‹çœ‹ã€‚</p>

<p><strong>å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œé¡ºåºï¼ˆç»„åˆå®Œæˆåï¼‰ï¼š</strong></p>

<ol>
<li>DisposableEffect â†’ é¦–å…ˆè¿è¡Œ</li>
<li>LaunchedEffect â†’ éšåè¿è¡Œ</li>
</ol>


<p>ä¸ºå•¥å­å‘¢ï¼Ÿ</p>

<p>æ­¤é¡ºåºç”±Composeè¿è¡Œæ—¶å®šä¹‰çš„ï¼š</p>

<ul>
<li>DisposableEffect æ˜¯åŒæ­¥çš„ï¼Œç”¨äºåœ¨ç»„åˆåç«‹å³å¤„ç†è®¾ç½®/æ¸…ç†ã€‚</li>
<li>LaunchedEffect ä¼šå¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œè€Œåç¨‹çš„å¯åŠ¨æ˜¯å¼‚æ­¥çš„ï¼Œè®¡åˆ’åœ¨å…¶ä»–åŒæ­¥æ•ˆæœï¼ˆä¾‹å¦‚ DisposableEffectï¼‰ä¹‹åè¿è¡Œã€‚</li>
</ul>


<p>å†…éƒ¨æœºåˆ¶ï¼šJetpack Compose ç»´æŠ¤äº†æ˜ç¡®å®šä¹‰çš„æ•ˆæœåº”ç”¨é¡ºåºã€‚</p>

<ol>
<li>DisposableEffectã€SideEffectã€SnapshotFlow ç­‰å‰¯ä½œç”¨ä¼šåœ¨ç»„åˆåç«‹å³è§¦å‘ï¼ˆåŒæ­¥ï¼‰ã€‚</li>
<li>ç„¶åï¼ŒåŸºäºåç¨‹çš„æ•ˆæœï¼ˆä¾‹å¦‚ LaunchedEffectï¼‰ä¼šè¢«è°ƒåº¦åˆ°ä¸‹ä¸€ä¸ªè¿è¡Œï¼ˆå¼‚æ­¥ï¼Œé€šè¿‡ Recomposerï¼‰ã€‚</li>
</ol>


<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹åœ¨å¯ç»„åˆé¡¹ä¹‹é—´å¯¼èˆªåˆ‡æ¢æ—¶ DisposableEffect å’Œ LaunchedEffect æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Œå°¤å…¶å…³æ³¨å®ƒä»¬åœ¨è¿”å›ä¹‹å‰è®¿é—®è¿‡çš„å±å¹•æ—¶çš„è¡Œä¸ºã€‚</p>

<p>è¾“å‡ºç»“æœä¼šè®©ä½ å¤§åƒä¸€æƒŠã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">MyApp</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">navController</span> <span class="p">=</span> <span class="n">rememberNavController</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">NavHost</span><span class="p">(</span><span class="n">navController</span> <span class="p">=</span> <span class="n">navController</span><span class="p">,</span> <span class="n">startDestination</span> <span class="p">=</span> <span class="s">&quot;screenA&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">composable</span><span class="p">(</span><span class="s">&quot;screenA&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">ScreenA</span><span class="p">(</span>
</span><span class='line'>                <span class="n">cartId</span> <span class="p">=</span> <span class="s">&quot;123&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="n">onNavigateToB</span> <span class="p">=</span> <span class="p">{</span> <span class="n">navController</span><span class="p">.</span><span class="n">navigate</span><span class="p">(</span><span class="s">&quot;screenB&quot;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">composable</span><span class="p">(</span><span class="s">&quot;screenB&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">ScreenB</span><span class="p">(</span>
</span><span class='line'>                <span class="n">cartId</span> <span class="p">=</span> <span class="s">&quot;456&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="n">onNavigateBack</span> <span class="p">=</span> <span class="p">{</span> <span class="n">navController</span><span class="p">.</span><span class="n">popBackStack</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">ScreenA</span><span class="p">(</span><span class="n">cartId</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">onNavigateToB</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">DisposableEffect</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ˜‡ ScreenA -&gt; DisposableEffect&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">onDispose</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ˜‡ ScreenA -&gt; DisposableEffect - onDispose&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">LaunchedEffect</span><span class="p">(</span><span class="n">cartId</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ˜‡ScreenA -&gt; LaunchedEffect&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Column</span><span class="p">(</span><span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="n">top</span> <span class="p">=</span> <span class="m">100.</span><span class="n">dp</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Button</span><span class="p">(</span><span class="n">onClick</span> <span class="p">=</span> <span class="n">onNavigateToB</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">Text</span><span class="p">(</span><span class="n">text</span> <span class="p">=</span> <span class="s">&quot;Navigate To ScreenB&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">ScreenB</span><span class="p">(</span><span class="n">cartId</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">onNavigateBack</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">lifecycleOwner</span> <span class="p">=</span> <span class="n">LocalLifecycleOwner</span><span class="p">.</span><span class="n">current</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">DisposableEffect</span><span class="p">(</span><span class="n">lifecycleOwner</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ˜‡ ScreenB -&gt; DisposableEffect&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">onDispose</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ˜‡ ScreenB -&gt; DisposableEffect - onDispose&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">LaunchedEffect</span><span class="p">(</span><span class="n">cartId</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">println</span><span class="p">(</span><span class="s">&quot;ğŸ˜‡ ScreenB -&gt; LaunchedEffect&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Column</span><span class="p">{</span>
</span><span class='line'>        <span class="n">Column</span><span class="p">(</span><span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">Button</span><span class="p">(</span><span class="n">onClick</span> <span class="p">=</span> <span class="n">onNavigateBack</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">Text</span><span class="p">(</span><span class="s">&quot;Back to Screen A&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">Output</span><span class="p">:-</span>
</span><span class='line'>
</span><span class='line'><span class="k">when</span> <span class="n">ScreenA</span> <span class="n">init</span>
</span><span class='line'><span class="err">ğŸ˜‡</span> <span class="n">ScreenA</span> <span class="p">-&gt;</span> <span class="n">DisposableEffect</span>
</span><span class='line'><span class="err">ğŸ˜‡</span> <span class="n">ScreenA</span> <span class="p">-&gt;</span> <span class="n">LaunchedEffect</span>
</span><span class='line'>
</span><span class='line'><span class="n">Navigate</span> <span class="n">To</span> <span class="n">ScreenA</span> <span class="p">-&gt;</span> <span class="n">ScreenB</span>
</span><span class='line'><span class="err">ğŸ˜‡</span> <span class="n">ScreenB</span> <span class="p">-&gt;</span> <span class="n">DisposableEffect</span>
</span><span class='line'><span class="err">ğŸ˜‡</span> <span class="n">ScreenB</span> <span class="p">-&gt;</span> <span class="n">LaunchedEffect</span>
</span><span class='line'><span class="err">ğŸ˜‡</span> <span class="n">ScreenA</span> <span class="p">-&gt;</span> <span class="n">DisposableEffect</span> <span class="p">-</span> <span class="n">onDispose</span>
</span><span class='line'>
</span><span class='line'><span class="n">Navigate</span> <span class="n">back</span> <span class="n">to</span> <span class="n">ScreenB</span> <span class="p">-&gt;</span> <span class="n">ScreenA</span>
</span><span class='line'><span class="err">ğŸ˜‡</span> <span class="n">ScreenA</span> <span class="p">-&gt;</span> <span class="n">DisposableEffect</span>
</span><span class='line'><span class="err">ğŸ˜‡</span> <span class="n">ScreenA</span> <span class="p">-&gt;</span> <span class="n">LaunchedEffect</span>
</span><span class='line'><span class="err">ğŸ˜‡</span> <span class="n">ScreenB</span> <span class="p">-&gt;</span> <span class="n">DisposableEffect</span> <span class="p">-</span> <span class="n">onDispose</span>
</span></code></pre></td></tr></table></div></figure>


<h2>å®ƒï¼ˆJetpack Composeå¯¼èˆªï¼‰å†…éƒ¨å®é™…å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h2>

<p>Compose Navigationåœ¨ NavHostä¸­å›´ç»•å¯ç»„åˆé¡¹çš„è¡Œä¸ºéµå¾ªä»¥ä¸‹é€»è¾‘ï¼š</p>

<ol>
<li>é¦–å…ˆè¿›è¡Œæ–°ç›®çš„åœ°ï¼ˆæ­¤å¤„ä¸º ScreenAï¼‰çš„ç»„åˆã€‚

<ul>
<li>å¯¼èˆªåˆ‡æ¢æ—¶ï¼ŒComposeä¼šç«‹å³ä¸ºæ–°å±å¹•åˆ›å»ºUIã€‚</li>
<li>æ–°é¡µé¢ï¼ˆæ­¤å¤„ä¸º ScreenAï¼‰çš„ DisposableEffect å’Œ LaunchedEffect ä¼šåœ¨æ–°é¡µé¢ç»„åˆæœŸé—´æˆ–ä¹‹åç«‹å³æ‰§è¡Œã€‚</li>
</ul>
</li>
<li>åœ¨æ–°ç›®çš„åœ°æˆåŠŸç»„åˆå¹¶æäº¤åˆ° UI å±‚æ¬¡ç»“æ„åï¼Œä¼šå¤„ç†ä¸Šä¸€ä¸ªé¡µé¢çš„å¯ç»„åˆé¡¹ï¼ˆæ­¤å¤„ä¸º ScreenBï¼‰ã€‚

<ul>
<li>Compose ä¼šä¿æŒä¸Šä¸€ä¸ªå¯ç»„åˆé¡¹ï¼ˆæ­¤å¤„ä¸º ScreenBï¼‰çŸ­æš‚å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œç›´åˆ°æ–°å¯ç»„åˆé¡¹ï¼ˆæ­¤å¤„ä¸º ScreenAï¼‰ç¨³å®šï¼Œä»¥ç¡®ä¿å¯¼èˆªé¡ºç•…ã€‚</li>
<li>åªæœ‰åœ¨æ–°çš„å¯ç»„åˆé¡¹ï¼ˆæ­¤å¤„ä¸º ScreenAï¼‰å®Œå…¨ç»„åˆåï¼ŒCompose æ‰ä¼šæ¸…ç†å¹¶ç§»é™¤ï¼ˆdisposeï¼‰ä¸Šä¸€ä¸ªå¯ç»„åˆé¡¹ï¼ˆæ­¤å¤„ä¸º ScreenBï¼‰ã€‚</li>
</ul>
</li>
</ol>


<p>å› æ­¤ï¼Œå¯¼èˆªæœŸé—´çš„å®é™…ç”Ÿå‘½å‘¨æœŸæµç¨‹æ˜¯é…±å©¶å„¿çš„ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='Bash'><span class='line'>å¯¼èˆªè¿”å› <span class="o">(</span>ScreenB â†’ ScreenA<span class="o">)</span>
</span><span class='line'>â”‚
</span><span class='line'>â”œâ”€â”€ 1ï¸âƒ£ Compose ç«‹å³åˆ›å»º ScreenA
</span><span class='line'>â”‚      â”œâ”€ ScreenA DisposableEffect executes instantly.
</span><span class='line'>â”‚      â””â”€ ScreenA LaunchedEffect coroutine launched.
</span><span class='line'>â”‚
</span><span class='line'>â””â”€â”€ 2ï¸âƒ£ åœ¨ScreenAæˆåŠŸè¿è¡Œä¹‹å:
</span><span class='line'>       â””â”€ ScreenB DisposableEffect onDispose runs.
</span></code></pre></td></tr></table></div></figure>


<h2>ä¸ºå•¥Composeè¦é…±ç´« æï¼Ÿ</h2>

<p>Compose Navigation ä¼šè°¨æ…å¤„ç†é¡µé¢çš„ç»„åˆï¼Œä»¥ç¡®ä¿ä¸æ»‘ï¼ˆseamlessï¼‰çš„ç”¨æˆ·ä½“éªŒå’Œç¨³å®šæ€§ï¼š</p>

<ul>
<li>å®ƒä¸ä¼šåœ¨ç¡®ä¿ç›®æ ‡é¡µé¢ (ScreenA) å·²ç»„åˆå¹¶å‡†å¤‡å°±ç»ªä¹‹å‰è¿‡æ—©åœ°å¤„ç†ä¸Šä¸€ä¸ªå¯ç»„åˆé¡¹ (ScreenB)ã€‚</li>
<li>è¿™å¯ä»¥é¿å…åœ¨å¯¼èˆªåˆ‡æ¢è¿‡ç¨‹ä¸­å‡ºç°è§†è§‰æ•…éšœæˆ–ç©ºç™½å±å¹•ã€‚</li>
<li>åªæœ‰åœ¨ç¡®ä¿æ–°é¡µé¢å®‰å…¨åˆ°ä½åï¼ŒCompose æ‰ä¼šè§¦å‘å¤„ç†ä¸Šä¸€ä¸ªå±å¹•çš„æ“ä½œã€‚</li>
</ul>


<h2>Jetpack Compose NavHostå†…éƒ¨æœºåˆ¶ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰ï¼š</h2>

<p>åœ¨è°ƒç”¨ popBackStack() æˆ– navigate() æ—¶ï¼ŒCompose çš„ NavHost å†…éƒ¨çš„å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼š</p>

<ul>
<li>æ–°çš„è·¯ç”±ç»„åˆå¼€å§‹ï¼ˆå¯ç»„åˆé¡¹åˆ›å»ºï¼‰ã€‚</li>
<li>æˆåŠŸç»„åˆå¹¶æäº¤å¸§åï¼Œä¸å†ä½äº NavHost åæ ˆä¸­çš„æ—§å¯ç»„åˆé¡¹èŠ‚ç‚¹å°†è¢«æ ‡è®°ä¸ºå¾…å¤„ç†ã€‚</li>
<li>ç„¶åï¼ŒCompose ä¼šåœ¨ä¸‹ä¸€å¸§ä¸­è¿è¡Œè¿™äº›å·²ç§»é™¤å¯ç»„åˆé¡¹çš„å¤„ç½®é€»è¾‘ (onDispose)ã€‚</li>
</ul>


<p>å› æ­¤ï¼Œå³ä½¿ä½ åœ¨è§†è§‰ä¸Šç«‹å³å¯¼èˆªå›åŸç‚¹ï¼Œé”€æ¯å¼çš„æ“ä½œï¼ˆå¦‚onDisposeï¼‰ä¹Ÿä¼šç•¥å¾®å»¶è¿Ÿæ‰§è¡Œï¼Œä»¥ä¿è¯ç•Œé¢çš„æ•´ä½“ç¨³å®šæ€§ã€‚</p>

<p>å¦‚æœä½ æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·ç•™è¨€ï¼Œæˆ‘ä¼šå°½å¿«å›å¤ä½ ã€‚ğŸ’¬âœ¨
æˆ‘ä»¬å¾ˆå¿«ä¼šæ·±å…¥æ¢è®¨Jetpack Composeï¼Œæ•¬è¯·æœŸå¾…ï¼ğŸš€
åœ¨æ­¤ä¹‹å‰ï¼Œç¥ä½ codingæ„‰å¿«ï¼ğŸ‰ğŸ‘¨â€ğŸ’»</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Jetpack Composeçš„æ€§èƒ½ä¼˜åŒ–å»ºè®®]]></title>
    <link href="https://alexhilton.github.io/blog/2025/04/22/performance-optimization-in-jetpack-compose/"/>
    <updated>2025-04-22T22:34:25+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/04/22/performance-optimization-in-jetpack-compose</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ªã€ŒPerformance Optimization in Jetpack Composeã€ï¼ŒåŸæ–‡é“¾æ¥<a href="https://carrion.dev/en/posts/performance-optimization-compose/">https://carrion.dev/en/posts/performance-optimization-compose/</a>ï¼Œç”±Ignacio CarriÃ³nï¼Œå‘å¸ƒäº2025å¹´4æœˆ8æ—¥ã€‚</p></blockquote>

<p><a href="https://alexhilton.github.io/blog/2025/04/22/performance-optimization-in-jetpack-compose/"><img src="https://www.itmob.cn/upload/2023/01/banner-jetpack-compose-a452c3e8f1ad489a8560a4f0a9f88e07.jpg" title="auto auto" ></a></p>

<!-- more -->


<p><strong>è¯‘è€…æŒ‰ï¼š</strong> Jetpack Composeæ˜¯ä¸€ä¸ªä¼˜ç§€çš„å£°æ˜å¼UIæ¡†æ¶ï¼Œå¯¹å¼€å‘è€…éå¸¸å‹å¥½ï¼Œå¯ä»¥é«˜æ•ˆç‡çš„æ’¸å„ç§UIé¡µé¢å’ŒUIå…ƒç´ ã€‚ä½†å®ƒä»ç„¶å¹¶ä¸æ˜¯å¾ˆæˆç†Ÿï¼Œæœ‰äº›äº‹æƒ…è¿˜åšä¸äº†ï¼Œè€Œä¸”æ¸²æŸ“æ€§èƒ½ä¹Ÿç•¥è¾“äºåŸç”Ÿçš„Viewæ–¹å¼ï¼Œæ¯•ç«Ÿå®ƒæ¯”åŸç”Ÿçš„Viewå¤šäº†ä¸€å±‚ç»„åˆæ ‘å’Œæ¸²æŸ“æ ‘ã€‚å› æ­¤ï¼Œåœ¨äº«å—å£°æ˜å¼UIå¸¦æ¥çš„ä¾¿æ·çš„åŒæ—¶ï¼Œå°±éœ€è¦æ·±å…¥åœ°äº†è§£å…¶å†…éƒ¨çš„å·¥ä½œæœºåˆ¶ï¼Œå’Œå­¦ä¹ ä¸€äº›é«˜çº§æŠ€å·§ï¼Œä»¥æå‡è¿è¡Œæ—¶çš„æ¸²æŸ“æ€§èƒ½ã€‚å¦å¤–ï¼Œéœ€è¦ æ³¨æ„è™½ç„¶è¿™ç¯‡æ–‡ç« æ˜¯é’ˆå¯¹for Androidçš„Jetpack Composeï¼Œä½†å¤§éƒ¨åˆ†ä¹Ÿé€‚ç”¨äºCompose Multiplatformã€‚</p>

<p>æ€§èƒ½ä¼˜åŒ–å¯¹äºåœ¨Jetpack Composeåº”ç”¨ä¸­æä¾›æµç•…çš„ç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ã€‚æœ¬æ–‡æ¢è®¨äº†å…³é”®æŠ€æœ¯å’Œæœ€ä½³å®è·µï¼Œä»¥ç¡®ä¿ä½ çš„å¯ç»„åˆå‡½æ•°é«˜æ•ˆä¸”æ€§èƒ½å“è¶Šã€‚</p>

<h2>ç†è§£ç»„åˆï¼ˆCompositionï¼‰å’Œé‡ç»„ï¼ˆReCompositionï¼‰</h2>

<p><strong>è¯‘æ³¨ï¼š</strong> ç»„åˆä¸é‡ç»„æ˜¯Composeä¸­éå¸¸é‡è¦ çš„æ¦‚å¿µï¼Œå¦‚æœä¸ç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥å¤ä¹ ä¸€ä¸‹ä¹‹å‰çš„æ–‡ç« <a href="https://juejin.cn/post/7379437165486112805">é™Composeåå…«æŒä¹‹ã€æ½œé¾™å‹¿ç”¨ã€| Thinking in Compose</a>å’Œ<a href="https://juejin.cn/post/7401358349877346338">é™Composeåå…«æŒä¹‹ã€æŸåˆ™æœ‰å­šã€| Lifecycle</a>ã€‚</p>

<p>Compose æ€§èƒ½çš„ä¸€ä¸ªåŸºæœ¬æ–¹é¢æ˜¯äº†è§£åˆæˆå’Œé‡ç»„çš„å·¥ä½œåŸç†ï¼š</p>

<h3>æ™ºèƒ½é‡ç»„ï¼ˆSmart Recompositionï¼‰</h3>

<p>Compose ä½¿ç”¨æ™ºèƒ½é‡ç»„åŠŸèƒ½ï¼Œä»…æ›´æ–°ç•Œé¢ä¸­éœ€è¦æ›´æ”¹çš„éƒ¨åˆ†ã€‚äº†è§£è§¦å‘é‡ç»„çš„åŸå› ä»¥åŠå¦‚ä½•æœ€å°åŒ–é‡ç»„çš„å½±å“èŒƒå›´å¯¹äºæ€§èƒ½ä¼˜åŒ–è‡³å…³é‡è¦ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">ExpensiveCalculation</span><span class="p">(</span><span class="n">numbers</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// ä¸å¥½ï¼šæ¯æ¬¡é‡ç»„éƒ½ä¼šæ‰§è¡Œæ˜‚è´µçš„æ“ä½œ</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">average</span> <span class="p">=</span> <span class="n">numbers</span><span class="p">.</span><span class="n">takeIf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">isNotEmpty</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>        <span class="o">?.</span><span class="n">average</span><span class="p">()</span>
</span><span class='line'>        <span class="o">?:</span> <span class="m">0.0</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// ä¼˜ç‚¹ï¼šæ˜‚è´µçš„æ“ä½œè¢«ç¼“å­˜ï¼Œå¹¶ä¸”ä»…åœ¨è¾“å…¥å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°è®¡ç®—</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">cachedAverage</span> <span class="p">=</span> <span class="n">remember</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">numbers</span><span class="p">.</span><span class="n">takeIf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">isNotEmpty</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>            <span class="o">?.</span><span class="n">average</span><span class="p">()</span>
</span><span class='line'>            <span class="o">?:</span> <span class="m">0.0</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Column</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// æ¯æ¬¡é‡ç»„æ—¶éƒ½ä¼šé‡æ–°è®¡ç®—</span>
</span><span class='line'>        <span class="n">Text</span><span class="p">(</span><span class="s">&quot;Current Average: ${&quot;</span><span class="p">%.</span><span class="m">2f</span><span class="s">&quot;.format(average)}&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// è¿™å°†ä½¿ç”¨ç¼“å­˜ä½çš„å€¼</span>
</span><span class='line'>        <span class="n">Text</span><span class="p">(</span><span class="s">&quot;Cached Average: ${&quot;</span><span class="p">%.</span><span class="m">2f</span><span class="s">&quot;.format(cachedAverage)}&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ç¨³å®šç±»å‹ï¼ˆStable typesï¼‰å’Œä¸å¯å˜æ€§ï¼ˆImmutabilityï¼‰</h3>

<p>ç¨³å®šçš„ç±»å‹å¯¹äºComposeçš„æ™ºèƒ½é‡ç»„ç³»ç»Ÿè‡³å…³é‡è¦ã€‚å½“Composeèƒ½å¤Ÿä¿è¯å…¶ equals() æ–¹æ³•ä¸å…¶å±æ€§ä¸€è‡´ï¼Œå¹¶ä¸”å±æ€§æœ¬èº«ä¸ä¼šåœ¨ä¸è§¦å‘é‡ç»„çš„æƒ…å†µä¸‹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¯¥ç±»å‹å³è¢«è§†ä¸ºç¨³å®šç±»å‹ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// ä¸å¥½ï¼šç±»å‹ä¸ç¨³å®š - å¯å˜å±æ€§å¯èƒ½ä¼šåœ¨ä¸é€šçŸ¥Composeçš„æƒ…å†µä¸‹å‘ç”Ÿå˜åŒ–</span>
</span><span class='line'><span class="n">data</span> <span class="k">class</span> <span class="nc">UserState</span><span class="p">(</span>
</span><span class='line'>    <span class="k">var</span> <span class="py">name</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="c1">// å¯å˜å±æ€§å¯ä»¥å·å·åœ°æ”¹å˜</span>
</span><span class='line'>    <span class="k">var</span> <span class="py">age</span><span class="p">:</span> <span class="n">Int</span>      <span class="c1">// è€Œä¸”æ›´æ”¹ä¸ä¼šè§¦å‘é‡ç»„</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ä¼˜ç‚¹ï¼šç¨³å®šç±»å‹ - ä¸å¯å˜å±æ€§å’Œæ˜¾å¼ç¨³å®šæ€§</span>
</span><span class='line'><span class="n">@Stable</span>  <span class="c1">// å‘Šè¯‰Composeæ­¤ç±»å‹å…·æœ‰å¯é¢„æµ‹çš„ç›¸ç­‰æ€§</span>
</span><span class='line'><span class="n">data</span> <span class="k">class</span> <span class="nc">UserState</span><span class="p">(</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">name</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>  <span class="c1">// ä¸å¯å˜å±æ€§</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">age</span><span class="p">:</span> <span class="n">Int</span>      <span class="c1">// å¦‚è¦æ›´æ”¹éœ€è¦åˆ›å»ºæ–°å®ä¾‹</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½¿ç”¨ç¨³å®šç±»å‹æœ‰ä»¥ä¸‹å‡ ä¸ªå¥½å¤„ï¼š</p>

<ol>
<li>æ›´é«˜æ•ˆçš„é‡ç»„ - å½“Composeç¡®å®šæ•°æ®æœªå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå¯ä»¥è·³è¿‡é‡ç»„éƒ¨åˆ†UIï¼Œæ¢å¥è¯è¯´å¯ä»¥å‡å°‘å¾ˆå¤šä¸å¿…è¦çš„é‡ç»„ï¼Œè¿›è€Œæé«˜æ€§èƒ½</li>
<li>å¯é¢„æµ‹çš„è¡Œä¸º - æ•°æ®æ›´æ”¹å§‹ç»ˆä¼šè§¦å‘æ­£ç¡®çš„UIæ›´æ–°</li>
<li>çº¿ç¨‹å®‰å…¨ï¼ˆThread safetyï¼‰ - ä¸å¯å˜æ•°æ®å¯ä»¥å®‰å…¨åœ°åœ¨åç¨‹ä¹‹é—´å…±äº«</li>
</ol>


<p><strong>è¯‘æ³¨ï¼š</strong> è¿™é‡Œè¯´çš„åº”è¯¥æ˜¯å¯ä»¥åœ¨çº¿ç¨‹ä¹‹é—´å®‰å…¨åœ°å…±äº«ï¼Œåç¨‹å¦‚æœæ²¡æœ‰çº¿ç¨‹åˆ‡æ¢æ˜¯ä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜çš„ã€‚</p>

<h2>æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ç‚¹</h2>

<h3>1. åˆç†åœ°ä½¿ç”¨ remember å’Œ derivedStateOf è¿›è¡ŒçŠ¶æ€ï¼ˆStateï¼‰ç®¡ç†</h3>

<p>remember å’Œ derivedStateOf å‡½æ•°åœ¨çŠ¶æ€ç®¡ç†ä¸­èµ·åˆ°ä¸åŒçš„ä½œç”¨ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">UserProfile</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">User</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Item</span><span class="p">&gt;)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// ç¼ºç‚¹ï¼šæ¯æ¬¡é‡æ–°ç»„åˆæ—¶éƒ½é‡æ–°è®¡ç®—</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">filteredItems</span> <span class="p">=</span> <span class="n">items</span><span class="p">.</span><span class="n">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">userId</span> <span class="p">==</span> <span class="n">user</span><span class="p">.</span><span class="n">id</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// å¥½ï¼šä½¿ç”¨è®°å¿†ç¼“å­˜è®¡ç®—</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">cachedItems</span> <span class="p">=</span> <span class="n">remember</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">user</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">items</span><span class="p">.</span><span class="n">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">userId</span> <span class="p">==</span> <span class="n">user</span><span class="p">.</span><span class="n">id</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// æ›´å¥½çš„æ–¹å¼ï¼šä½¿ç”¨ derivedStateOf è¿›è¡Œååº”å¼è®¡ç®—</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">reactiveItems</span> <span class="k">by</span> <span class="n">remember</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">derivedStateOf</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">items</span><span class="p">.</span><span class="n">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">userId</span> <span class="p">==</span> <span class="n">user</span><span class="p">.</span><span class="n">id</span> <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// å½“ items å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒreactiveItems ä¼šè‡ªåŠ¨æ›´æ–°</span>
</span><span class='line'>    <span class="c1">// å¹¶ä¸”ä»…åœ¨è¿‡æ»¤ç»“æœå‘ç”Ÿå˜åŒ–æ—¶è§¦å‘é‡ç»„</span>
</span><span class='line'>    <span class="n">LazyColumn</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">itemsIndexed</span><span class="p">(</span>
</span><span class='line'>            <span class="n">items</span> <span class="p">=</span> <span class="n">reactiveItems</span><span class="p">,</span>
</span><span class='line'>            <span class="n">key</span> <span class="p">=</span> <span class="p">{</span> <span class="n">_</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">Item</span> <span class="p">-&gt;</span> <span class="n">item</span><span class="p">.</span><span class="n">id</span> <span class="p">}</span>
</span><span class='line'>        <span class="p">)</span> <span class="p">{</span> <span class="n">_</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">Item</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="n">ItemRow</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>è¯‘æ³¨ï¼š</strong> å¯¹äºçŠ¶æ€çš„ç®¡ç†ï¼Œå¯ä»¥å¤ä¹ ä¸€ä¸‹ä¹‹å‰ä¸“é—¨è®²è§£å‰¯ä½œç”¨(Side effects)çš„æ–‡ç« <a href="https://juejin.cn/post/7405158681078104127">é™Composeåå…«æŒä¹‹ã€é¾™æˆ˜äºé‡ã€| Side Effects</a>ã€‚</p>

<h3>2. åˆç†åœ°ä½¿ç”¨CompositionLocal</h3>

<p><strong>è¯‘æ³¨ï¼š</strong> å…³äºCompositionLocalçš„ä½¿ç”¨å¯ä»¥çœ‹å‰é¢å†™è¿‡çš„æ–‡ç« <a href="https://juejin.cn/post/7434543407636267071">ç”¨Composeä¸­çš„CompositionLocalæ¥æš—æ¸¡é™ˆä»“</a>ï¼Œä¸‹é¢çš„ç¤ºä¾‹æ˜¯æƒ³è¦è¯´æ˜ï¼Œåº”è¯¥åœ¨åˆç†çš„åœ°æ–¹è®¿é—®CompositionLocalé‡Œé¢çš„æ•°æ®ï¼Œå› æ•°å¯¹CompositionLocalçš„è®¿é—®åœ°æ–¹ä¼šè¢«è§¦å‘é‡ç»„ï¼ˆ<a href="https://juejin.cn/post/7401358349877346338">ä¹‹å‰çš„æ–‡ç« æœ‰è®²è¿‡</a>é‡ç»„çš„è§¦å‘æ˜¯çŠ¶æ€ä½¿ç”¨çš„åœ°æ–¹ï¼Œè€Œä¸æ˜¯å®šä¹‰çš„åœ°æ–¹ï¼‰ï¼Œå¦‚æœåœ¨æ‰€æœ‰çš„åœ°æ–¹éƒ½ ç›´æ¥è®¿é—®CompositionLocalï¼Œç‰¹åˆ«æ˜¯åµŒå¥—è¾ƒæ·±çš„åœ°æ–¹ä¹Ÿéƒ½ ç›´æ¥è®¿é—®ï¼Œé‚£éƒ½ä¼šè§¦å‘é‡ç»„ï¼Œä½†å¤§éƒ¨åˆ†å…¶å®æ˜¯ä¸å¿…è¦çš„ã€‚åƒä¸‹æ ·ç¤ºä¾‹å±•ç¤ºçš„é‚£æ ·ï¼Œåœ¨ä¸€å®šçš„çº§åˆ«ä¸­è®¿é—®CompositionLocalï¼Œç„¶åå®ƒçš„å†…éƒ¨åµŒå¥—è°ƒç”¨ç›´æ¥å¤ç”¨æ•°å€¼ï¼Œå¯ä»¥é¿å…è¿‡åº¦é‡ç»„ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// ä¸å¥½ï¼šæ¯ä¸ªå­ç»„ä»¶éƒ½è®¿é—® CompositionLocal</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">DeepNestedContent</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">theme</span> <span class="p">=</span> <span class="n">LocalTheme</span><span class="p">.</span><span class="n">current</span>  <span class="c1">// ç›´æ¥è®¿é—®</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">strings</span> <span class="p">=</span> <span class="n">LocalStrings</span><span class="p">.</span><span class="n">current</span>  <span class="c1">// å¤šä¸ª CompositionLocal è®¿é—®</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">dimensions</span> <span class="p">=</span> <span class="n">LocalDimensions</span><span class="p">.</span><span class="n">current</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Column</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Text</span><span class="p">(</span>
</span><span class='line'>            <span class="n">text</span> <span class="p">=</span> <span class="n">strings</span><span class="p">.</span><span class="n">title</span><span class="p">,</span>
</span><span class='line'>            <span class="n">style</span> <span class="p">=</span> <span class="n">theme</span><span class="p">.</span><span class="n">textStyle</span><span class="p">,</span>
</span><span class='line'>            <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="n">dimensions</span><span class="p">.</span><span class="n">padding</span><span class="p">)</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>        <span class="c1">// å…·æœ‰é‡å¤ CompositionLocal è®¿é—®çš„æ›´å¤šåµŒå¥—å†…å®¹</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// å¥½ï¼šæå‡ CompositionLocalçš„å€¼ä»¥æœ€å°åŒ–æŸ¥æ‰¾</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">ParentContent</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// å•ç‹¬è®¿é—® CompositionLocal å€¼</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">theme</span> <span class="p">=</span> <span class="n">LocalTheme</span><span class="p">.</span><span class="n">current</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">strings</span> <span class="p">=</span> <span class="n">LocalStrings</span><span class="p">.</span><span class="n">current</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">dimensions</span> <span class="p">=</span> <span class="n">LocalDimensions</span><span class="p">.</span><span class="n">current</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">DeepNestedContent</span><span class="p">(</span>
</span><span class='line'>        <span class="n">theme</span> <span class="p">=</span> <span class="n">theme</span><span class="p">,</span>
</span><span class='line'>        <span class="n">strings</span> <span class="p">=</span> <span class="n">strings</span><span class="p">,</span>
</span><span class='line'>        <span class="n">dimensions</span> <span class="p">=</span> <span class="n">dimensions</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">DeepNestedContent</span><span class="p">(</span>
</span><span class='line'>    <span class="n">theme</span><span class="p">:</span> <span class="n">Theme</span><span class="p">,</span>
</span><span class='line'>    <span class="n">strings</span><span class="p">:</span> <span class="n">Strings</span><span class="p">,</span>
</span><span class='line'>    <span class="n">dimensions</span><span class="p">:</span> <span class="n">Dimensions</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// ä½¿ç”¨ä¼ é€’çš„å‚æ•°è€Œä¸æ˜¯æŸ¥æ‰¾ CompositionLocal å€¼</span>
</span><span class='line'>    <span class="n">Column</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Text</span><span class="p">(</span>
</span><span class='line'>            <span class="n">text</span> <span class="p">=</span> <span class="n">strings</span><span class="p">.</span><span class="n">title</span><span class="p">,</span>
</span><span class='line'>            <span class="n">style</span> <span class="p">=</span> <span class="n">theme</span><span class="p">.</span><span class="n">textStyle</span><span class="p">,</span>
</span><span class='line'>            <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="n">dimensions</span><span class="p">.</span><span class="n">padding</span><span class="p">)</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>        <span class="c1">// ä½¿ç”¨ä¼ é€’çš„å‚æ•°è¿›è¡Œæ›´å¤šåµŒå¥—å†…å®¹</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>3. LazyList ä¼˜åŒ–æŠ€å·§</h3>

<p>é«˜æ•ˆçš„åˆ—è¡¨æ¸²æŸ“å¯¹äºæµç•…çš„æ»šåŠ¨æ€§èƒ½è‡³å…³é‡è¦ã€‚ä»¥ä¸‹æ˜¯é’ˆå¯¹ LazyList ç»„ä»¶çš„å…³é”®ä¼˜åŒ–ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="err">&lt;</span><span class="nf">T</span> <span class="p">:</span> <span class="n">Any</span><span class="p">&gt;</span> <span class="n">OptimizedList</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">LazyColumn</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">itemsIndexed</span><span class="p">(</span>
</span><span class='line'>            <span class="n">items</span> <span class="p">=</span> <span class="n">items</span><span class="p">,</span>
</span><span class='line'>            <span class="c1">// ç¨³å®šçš„keyæœ‰åŠ©äºComposeåœ¨æ›´æ–°è¿‡ç¨‹ä¸­è·Ÿè¸ªé¡¹ç›®</span>
</span><span class='line'>            <span class="n">key</span> <span class="p">=</span> <span class="p">{</span> <span class="n">_</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">T</span> <span class="p">-&gt;</span> <span class="n">item</span><span class="p">.</span><span class="n">hashCode</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>        <span class="p">)</span> <span class="p">{</span> <span class="n">_</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">T</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="c1">// æ¯ä¸ªitemçš„å†…å®¹</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>LazyList çš„å…³é”®ä¼˜åŒ–ç‚¹ï¼š</p>

<ol>
<li>æä¾›ç¨³å®šçš„é”®ï¼Œå¸®åŠ©Composeåœ¨æ›´æ–°è¿‡ç¨‹ä¸­è·Ÿè¸ªé¡¹ç›®</li>
<li>å°½å¯èƒ½ä½¿ç”¨å›ºå®šå¤§å°ä»¥é¿å…é‡æ–°æµ‹é‡</li>
<li>ä¿æŒé¡¹ç›®å¯ç»„åˆé¡¹çš„è½»é‡çº§</li>
<li>é¿å…åœ¨é¡¹ç›®å†…å®¹ä¸­è¿›è¡Œä¸å¿…è¦çš„åˆ†é…</li>
<li>è®°ä½è¦ä¸ºæ¯ä¸ªé¡¹ç›®ç¼“å­˜æ˜‚è´µçš„è®¡ç®—</li>
</ol>


<h2>æµ‹é‡å’Œç›‘æ§æ€§èƒ½</h2>

<h3>Layout Inspectorå’ŒComposition Traces</h3>

<p>Android Studio ä¸­çš„å¸ƒå±€æ£€æŸ¥å™¨æ˜¯ä¸€æ¬¾å¼ºå¤§çš„Composeç•Œé¢æ€§èƒ½è°ƒè¯•å·¥å…·ã€‚å®ƒèƒ½å¤Ÿå¸®åŠ©ä½ æ·±å…¥äº†è§£åº”ç”¨çš„è§†å›¾å±‚æ¬¡ç»“æ„ã€é‡ç»„è®¡æ•°ä»¥åŠåº”ç”¨äºæ¯ä¸ªå¯ç»„åˆé¡¹çš„ä¿®é¥°ç¬¦ã€‚</p>

<p>è¦å°†å¸ƒå±€æ£€æŸ¥å™¨ä¸Composeç»“åˆä½¿ç”¨ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>

<ol>
<li>åœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¿è¡Œä½ çš„åº”ç”¨</li>
<li>åœ¨â€œæ­£åœ¨è¿è¡Œçš„è®¾å¤‡â€çª—å£ä¸­ï¼Œä½ å°†çœ‹åˆ°ä¸€ä¸ªç”¨äºåˆ‡æ¢å¸ƒå±€æ£€æŸ¥å™¨çš„æŒ‰é’®</li>
<li>æ£€æŸ¥Composeå±‚æ¬¡ç»“æ„ï¼š

<ul>
<li>æŸ¥çœ‹ç»„ä»¶æ ‘</li>
<li>æ£€æŸ¥é‡ç»„è®¡æ•°</li>
<li>åˆ†æä¿®é¥°ç¬¦é“¾</li>
<li>æ£€æŸ¥å¯ç»„åˆé¡¹å‚æ•°</li>
</ul>
</li>
</ol>


<p><img src="https://carrion.dev/images/kotlin/layout-inspector.png" alt="Layout Inspector" /></p>

<p>å¸ƒå±€æ£€æŸ¥å™¨ä¸­éœ€è¦ç›‘æ§çš„å…³é”®æŒ‡æ ‡ï¼š</p>

<ol>
<li>é‡ç»„è®¡æ•° - æ•°å€¼è¾ƒé«˜è¡¨ç¤ºå­˜åœ¨æ½œåœ¨çš„ä¼˜åŒ–æœºä¼š</li>
<li>è·³è¿‡è®¡æ•° - æ£€æŸ¥å¯ç»„åˆé¡¹æ˜¯å¦åœ¨åº”è¯¥è·³è¿‡é‡ç»„æ—¶è·³è¿‡</li>
<li>ä¿®é¥°ç¬¦é“¾å¤æ‚åº¦ - è¾ƒé•¿çš„ä¿®é¥°ç¬¦é“¾å¯èƒ½ä¼šå½±å“æµ‹é‡/å¸ƒå±€æ€§èƒ½</li>
</ol>


<h3>æ€§èƒ½æµ‹è¯•</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Test</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">performanceTest</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">benchmarkRule</span><span class="p">.</span><span class="n">measureRepeated</span><span class="p">(</span>
</span><span class='line'>        <span class="n">packageName</span> <span class="p">=</span> <span class="s">&quot;com.example.app&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="n">metrics</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span><span class="n">FrameTimingMetric</span><span class="p">()),</span>
</span><span class='line'>        <span class="n">iterations</span> <span class="p">=</span> <span class="m">5</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">composeTestRule</span><span class="p">.</span><span class="n">setContent</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">YourComposable</span><span class="p">()</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>æœ€ä½³å®è·µæ€»ç»“</h2>

<ol>
<li>ä½¿ç”¨ç¨³å®šç±»å‹(Stable types)å’Œä¸å¯å˜æ•°æ®ç»“æ„(Immutable data structures)</li>
<li>ä½¿ç”¨rememberæå‡é«˜å¼€é”€è®¡ç®—</li>
<li>åœ¨æƒ°æ€§åˆ—è¡¨(lazy list)ä¸­å®ç°åˆé€‚çš„é”®(key)</li>
<li>æœ€å°åŒ–é‡ç»„èŒƒå›´</li>
<li>å®šæœŸåˆ†æå’Œæµ‹é‡æ€§èƒ½</li>
</ol>


<p>éµå¾ªè¿™äº›ä¼˜åŒ–æŠ€å·§å°†æœ‰åŠ©äºç¡®ä¿ä½ çš„Compose UIä¿æŒå“åº”è¿…é€Ÿä¸”é«˜æ•ˆï¼Œä»è€Œä¸ºä½ çš„åº”ç”¨æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Compose Multiplatformæ”¯æŒçƒ­é‡è½½(Hot Reload)äº†]]></title>
    <link href="https://alexhilton.github.io/blog/2025/04/12/compose-hot-reload/"/>
    <updated>2025-04-12T17:11:47+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/04/12/compose-hot-reload</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ªCompose Hot Reload is Now Availableï¼ŒåŸæ–‡é“¾æ¥<a href="https://medium.com/@wisemuji/compose-hot-reload-is-now-available-3a9aee58b0fe">Compose Hot Reload is Now Available</a>ï¼Œç”±<a href="https://medium.com/@wisemuji">Suhyeon Kim</a>ï¼Œå‘å¸ƒäº2025å¹´3æœˆ19æ—¥ã€‚</p></blockquote>

<p><a href="https://alexhilton.github.io/blog/2025/04/12/compose-hot-reload/"><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FMBFWn5vJOuaM41zKE6aTg.jpeg" title="auto auto" ></a></p>

<!-- more -->


<p><strong>è¯‘æ³¨ï¼š</strong>  éœ€è¦æ³¨æ„çš„æ˜¯Googleé€šè¿‡Android Studio(after Giraffe)é‡Œé¢çš„<a href="https://developer.android.com/develop/ui/compose/tooling/iterative-development">Live Editç‰¹æ€§</a>æä¾›äº†å¯¹Androidä¸Šé¢çš„Jetpack Composeçš„å®æ—¶æ›´æ–°æ”¯æŒã€‚ä½†å®ƒä»…æ”¯æŒJetpack Compose (for Adnroid)ï¼Œå¹¶ä¸æ”¯æŒCMPï¼Œä¹Ÿå³ä¸æ”¯æŒJetBrainsçš„Composeã€‚ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤JetBrainsæ‰ä¼šå¼€å‘é¢å‘CMPçš„Hot Reloadã€‚</p>

<p>åœ¨Compose UIå¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ æ˜¯å¦ç»å¸¸éœ€è¦æ„å»ºè¿è¡Œï¼ŸCompose çƒ­é‡è½½ç°å·²åœ¨Maven Centralä¸­æ¨å‡ºï¼Œå¯ä¸ºComposeå¤šå¹³å°ï¼ˆæ¡Œé¢ï¼‰åº”ç”¨ä¸­çš„UIä»£ç æä¾›å®æ—¶æ›´æ–°ã€‚æˆ‘ä»¬æ— éœ€é‡å¯åº”ç”¨å³å¯ç«‹å³æŸ¥çœ‹UIä»£ç çš„æ›´æ”¹ã€‚</p>

<p>è®©æˆ‘ä»¬æ¥ä¸€æ¢ç©¶ç«Ÿï¼</p>

<h2>çƒ­é‡è½½(Hot Reload)æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ</h2>

<p>è®¸å¤šå£°æ˜å¼UIæ¡†æ¶éƒ½æä¾›äº†ç±»ä¼¼æ¦‚å¿µï¼Œçƒ­é‡è½½ï¼Œå³å¯ä»¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­æä¾›å¯¹UIæ›´æ”¹çš„è¿‘ä¹å³æ—¶çš„åé¦ˆï¼ˆå°½ç®¡å®ƒä»¬çš„åç§°ä¸åŒï¼ï¼‰ã€‚</p>

<p>ä¾‹å¦‚éš”å£çš„ä¸¤å®¶ï¼š</p>

<ul>
<li>Flutterçƒ­åŠ è½½ï¼š<a href="https://docs.flutter.dev/tools/hot-reload">https://docs.flutter.dev/tools/hot-reload</a></li>
<li>React Nativeå¿«é€Ÿåˆ·æ–°ï¼š<a href="https://reactnative.dev/docs/fast-refresh">https://reactnative.dev/docs/fast-refresh</a></li>
</ul>


<p>çƒ­é‡è½½å…è®¸å¼€å‘è€…å®æ—¶æŸ¥çœ‹ä»£ç æ›´æ”¹ï¼Œæ— éœ€é‡å¯åº”ç”¨æˆ–é‡æ–°ç¼–è¯‘æ•´ä¸ªé¡¹ç›®ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œçƒ­é‡è½½ä¼šä¿ç•™åº”ç”¨çš„çŠ¶æ€ï¼Œå› æ­¤å¼€å‘è€…å¯ä»¥ç»§ç»­ä¸åº”ç”¨äº¤äº’ï¼Œè€Œä¸ä¼šä¸¢å¤±è¿›åº¦æˆ–ä¸Šä¸‹æ–‡ã€‚è¿™å¯ä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ¼”ç¤ºä»£ç æ›´æ”¹å¯¹UIçš„å½±å“ï¼Œä»è€Œæé«˜å·¥ä½œæ•ˆç‡ï¼Œè€Œæ— éœ€ç­‰å¾…æ¼«é•¿çš„æ„å»ºã€‚</p>

<h2>Composeçš„çƒ­é‡è½½</h2>

<p>çœ‹ä¸€ä¸‹å®˜æ–¹çš„ä»‹ç»<a href="https://github.com/JetBrains/compose-hot-reload">https://github.com/JetBrains/compose-hot-reload</a>ï¼š</p>

<blockquote><p>åœ¨Composeå¤šå¹³å°åº”ç”¨ä¸­æ›´æ”¹ä½ çš„UIä»£ç ï¼Œå¹¶å®æ—¶æŸ¥çœ‹ç»“æœã€‚
æ— éœ€é‡å¯åº”ç”¨ã€‚</p></blockquote>

<p>ç›®å‰ï¼ŒCompose Hot Reload é€‚ç”¨äºé’ˆå¯¹æ¡Œé¢ JVM çš„å¤šå¹³å°é¡¹ç›®ï¼ˆæœªæ¥æ˜¯å¦æœ‰å¯èƒ½æ‰©å±•ï¼Ÿæˆ‘ä¸ç¡®å®šã€‚:Dï¼‰ã€‚Compose Hot Reload çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ v1.0.0-alpha02ï¼Œäºæ˜¨å¤©ï¼ˆ2025 å¹´ 3 æœˆ 17 æ—¥ï¼‰å‘å¸ƒã€‚ç°åœ¨ï¼Œå¼€å‘è€…å¯ä»¥åœ¨Composeå¤šå¹³å°åº”ç”¨ä¸­æŸ¥çœ‹å…¶UIä»£ç çš„æ›´æ”¹ï¼Œè€Œæ— éœ€é‡å¯åº”ç”¨ã€‚è¿™æ„å‘³ç€å¼€å‘è€…å¯ä»¥ç«‹å³é¢„è§ˆæ›´æ”¹ï¼Œè€Œæ— éœ€ç¼“æ…¢çš„æ„å»ºå’Œé‡å¯ã€‚</p>

<p><strong>è¯‘æ³¨ï¼š</strong> ç°åœ¨ï¼ˆ2025å¹´4æœˆ9æ—¥ï¼‰æœ€æ–°ç‰ˆæœ¬æ˜¯ v1.0.0-alpha04ï¼Œä¸»è¦æ˜¯Bugfixï¼Œç›®å‰å¼€å‘ä¸­çš„ç‰ˆæœ¬æ˜¯ v1.0.0-alpha05 ã€‚</p>

<h2>å¦‚ä½•ä¸Šæ‰‹</h2>

<p>è¦å¼€å§‹ä½¿ç”¨Compose Hot Reloadï¼Œè¯·æŸ¥çœ‹<a href="https://github.com/JetBrains/compose-hot-reload">Compose Hot Reload</a>çš„ GitHub ä»£ç åº“ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong> ä»¥ä¸‹å†…å®¹åŸºäº v1.0.0-alpha02 ç¼–å†™ã€‚</p>

<h3>ä¾èµ–è¦æ±‚</h3>

<ul>
<li>ä¸€ä¸ªä»¥æ¡Œé¢ä¸ºç›®æ ‡çš„Compose Multiplatform é¡¹ç›®ï¼ˆå‚è§<a href="https://github.com/JetBrains/compose-hot-reload#faq">å…¶FAQ</a>ï¼‰</li>
<li>Kotlin 2.1.20-Beta2 æˆ–æ›´é«˜ç‰ˆæœ¬</li>
</ul>


<p>å¯¹äº Android åº”ç”¨ï¼Œæœ‰ä¸€ä¸ªå°çš„è§£å†³æ–¹æ³•ï¼š
é¦–å…ˆï¼Œä½ éœ€è¦ä»Jetpack Composeæ’ä»¶åˆ‡æ¢åˆ°Compose Multiplatform æ’ä»¶ï¼Œ
ç„¶åæ·»åŠ ä¸€ä¸ªå•ç‹¬çš„ Gradle æ¨¡å—å¹¶é…ç½®æ¡Œé¢ç›®æ ‡ã€‚</p>

<h3>å°† Gradle æ’ä»¶åº”ç”¨åˆ°ä½ çš„é¡¹ç›®ä¸­</h3>

<p>å°† org.jetbrains.compose.hot-reload Gradle æ’ä»¶æ·»åŠ åˆ°ä½ çš„æ„å»ºè„šæœ¬ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">plugins</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">kotlin</span><span class="p">(</span><span class="s">&quot;multiplatform&quot;</span><span class="p">)</span> <span class="n">version</span> <span class="s">&quot;2.1.20-RC&quot;</span> <span class="c1">// &lt;- Use Kotlin 2.1.20-RC or higher!</span>
</span><span class='line'>    <span class="n">kotlin</span><span class="p">(</span><span class="s">&quot;plugin.compose&quot;</span><span class="p">)</span> <span class="n">version</span> <span class="s">&quot;2.1.20-RC&quot;</span> <span class="c1">// &lt;- Use Compose Compiler Plugin 2.1.20-RC or higher!</span>
</span><span class='line'>    <span class="n">id</span><span class="p">(</span><span class="s">&quot;org.jetbrains.compose&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">id</span><span class="p">(</span><span class="s">&quot;org.jetbrains.compose.hot-reload&quot;</span><span class="p">)</span> <span class="n">version</span> <span class="s">&quot;1.0.0-alpha02&quot;</span> <span class="c1">// &lt;- add this additionally</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>å¯ç”¨â€œOptimizeNonSkippingGroupsâ€ï¼š</h3>

<p>å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°ä½ çš„ build.gradle.kts ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">import</span> <span class="nn">org.jetbrains.kotlin.compose.compiler.gradle.ComposeFeatureFlag</span>
</span><span class='line'><span class="c1">// ...</span>
</span><span class='line'><span class="n">composeCompiler</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">featureFlags</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">ComposeFeatureFlag</span><span class="p">.</span><span class="n">OptimizeNonSkippingGroups</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>ä¸ºUIçƒ­é‡è½½æä¾›å…¥å£ç‚¹</h3>

<p>åœ¨é¡¹ç›®çš„æ¡Œé¢æºä»£ç é›†ä¸­ï¼Œä½¿ç”¨ DevelopmentEntryPoint åŒ…è£…çª—å£å†…å®¹ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">import</span> <span class="nn">org.jetbrains.compose.reload.DevelopmentEntryPoint</span>
</span><span class='line'><span class="c1">// ...</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">singleWindowApplication</span><span class="p">(...)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">DevelopmentEntryPoint</span> <span class="p">{</span> <span class="c1">// add this line</span>
</span><span class='line'>            <span class="n">App</span><span class="p">()</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦æŠ˜è…¾çš„å…¨éƒ¨å†…å®¹ã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>

<h2>Demoæ¼”ç¤º</h2>

<p>è¦äº†è§£Compose çƒ­é‡è½½çš„å®é™…æ•ˆæœï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘çš„ç¤ºä¾‹é¡¹ç›®<a href="https://github.com/wisemuji/compose-would-you-rather-game">â€œWould You Rather Gameâ€</a>ã€‚è¿™ä¸ªé¡¹ç›®æ˜¯ä¸€ä¸ªç®€å•çš„ Compose å¤šå¹³å°æ¡Œé¢åº”ç”¨ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­å›ç­”æœ‰è¶£çš„â€œWould You Ratherâ€é—®é¢˜ã€‚Compose çƒ­é‡è½½æ’ä»¶æœ€è¿‘å·²å®ç°ã€‚</p>

<p>ä½ å¯ä»¥å‚è€ƒ Compose çƒ­é‡è½½çš„setupæäº¤ï¼š<a href="https://github.com/wisemuji/compose-would-you-rather-game/commit/937375cea9010733ee751dc2d464a0df21318cee">setupæäº¤</a>ã€‚</p>

<p>å¦‚æœä½ åœ¨é¡¹ç›®ä¸Šè¿è¡ŒdesktopRunï¼Œä½ ä¼šæ³¨æ„åˆ°æ¡Œé¢åº”ç”¨ç¨‹åºæ—è¾¹ä¼šå‡ºç°ä¸€ä¸ªå°çš„Composeå›¾æ ‡ã€‚</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*TXn4jUzxwcSh5IfqRqFNkA.png" alt="HotReload Icon" /></p>

<p>è¿™å°†è§¦å‘ Compose Hot Reload Tooling æ¨¡å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*37gLudPijGvh3A-rKdK_kw.png" alt="HotReload Demo" /></p>

<h3>UIæ›´æ”¹ç¤ºä¾‹</h3>

<p>å‡è®¾æˆ‘ä»¬æƒ³è¦æ›´æ”¹<a href="https://github.com/wisemuji/compose-would-you-rather-game/blob/4e9bfc7172c7145f95190fd383169bbcdc25856f/composeApp/src/commonMain/kotlin/ui/game/GameScreen.kt#L226">GameScreen.kt</a>ä¸­çš„åŠ¨ç”»ã€‚</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b4xJXpWH9oA5YohC1zsWng.gif" alt="Full Demo" /></p>

<p>çœ‹åˆ°æ²¡æœ‰ï¼ä¸€æ—¦æˆ‘ä»¬ä¿å­˜æ–‡ä»¶ï¼Œæ›´æ”¹å°±ä¼šç«‹å³æ˜¾ç¤ºåœ¨æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºä¸­ã€‚æ— éœ€é‡å¯åº”ç”¨ï¼</p>

<h2>çƒ­é‡è½½å½“å‰æ”¯æŒçš„åœºæ™¯</h2>

<p>ç›®å‰ï¼Œå‡ ä¹æ‰€æœ‰ä»£ç æ›´æ”¹éƒ½æ”¯æŒçƒ­é‡è½½ï¼ˆé™¤äº†ä»ç±»ä¸­åˆ é™¤è¶…ç±»å‹ï¼‰ã€‚</p>

<p><a href="https://hashnode.com/@sellmair">Sebastian Sellmair çš„è§†é¢‘å’Œåšå®¢æ–‡ç« </a>é€šè¿‡å¤šä¸ªæ¼”ç¤ºå±•ç¤ºäº†è¿™äº›åŠŸèƒ½ï¼Œå¹¶è¯¦ç»†è§£é‡Šäº†é‡è½½çš„åº•å±‚å·¥ä½œåŸç†ã€‚</p>

<h2>å±€é™æ€§</h2>

<p>ç”±äºå®ƒä»…æ”¯æŒåŸºäº JVM çš„æ¡Œé¢åº”ç”¨ï¼Œå› æ­¤ç›®å‰å°šä¸æ”¯æŒ Android å’Œå…¶ä»–å¹³å°ã€‚
æ­¤å¤–ï¼Œæ„å»ºæ€§èƒ½æ–¹é¢å¯èƒ½å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚åœ¨æˆ‘çš„æœ¬åœ°ç¯å¢ƒä¸­ï¼Œæ›´æ”¹å¤§çº¦éœ€è¦ 3 åˆ° 5 ç§’ï¼Œæ„Ÿè§‰æ¯”å…¶ä»–å£°æ˜å¼UIæ¡†æ¶ä¸­çš„çƒ­é‡è½½æ…¢ä¸å°‘ã€‚ä¼°è®¡å®ƒä¼šåœ¨åé¢å¾—åˆ°æ”¹å–„ã€‚</p>

<p>ç”±äºè¿™æ˜¯ä¸€ä¸ª Alpha ç‰ˆæœ¬ï¼Œå› æ­¤æ— æ³•ä¿è¯ç¨³å®šæ€§ã€‚å¼€å‘è€…åº”è¯¥é¢„æ–™åˆ°å¯èƒ½ä¼šå‡ºç°ä¸€äº›æ½œåœ¨çš„é”™è¯¯å’Œè¿ç§»æŒ‘æˆ˜ï¼Œæ­£å¦‚ JetBrains å›¢é˜Ÿæ‰€æŒ‡å‡ºçš„ï¼šâ€œAlpha ç‰ˆæœ¬æ„å‘³ç€ä½¿ç”¨é£é™©è‡ªè´Ÿï¼Œè¿ç§»é—®é¢˜ä¹Ÿéœ€è°¨æ…ã€‚æˆ‘ä»¬æ‰“ç®—å°†è¿™ä¸ªæƒ³æ³•äº§å“åŒ–ï¼Œä½†å°šæœªæœ€ç»ˆæˆå‹ã€‚â€ ç”±äºè¯¥åŠŸèƒ½ä»åœ¨ç§¯æå¼€å‘ä¸­ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­æŒç»­å…³æ³¨æ›´æ–°ã€‚</p>

<h2>æä¾›åé¦ˆ</h2>

<p>å¦‚æœä½ é‡åˆ°ä»»ä½•é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œä½ å¯ä»¥é€šè¿‡<a href="https://slack-chats.kotlinlang.org/t/27038699/with-compose-hot-reload-now-being-available-on-maven-central"> Kotlinlang Slack - Compose Hot Reload </a>åˆ†äº«ä½ çš„æƒ³æ³•ã€‚</p>

<blockquote><p>å°¤å…¶æ¬¢è¿æï¼š</p>

<ul>
<li>è®¾ç½®æ—¶é‡åˆ°çš„é—®é¢˜</li>
<li>é‡æ–°åŠ è½½ç‰¹å®šä»£ç æ®µæ—¶é‡åˆ°çš„é—®é¢˜</li>
<li>å…³äºå¦‚ä½•æ”¹è¿›/åŠŸèƒ½è¯·æ±‚çš„æƒ³æ³•</li>
</ul>


<p>ç›®å‰ä¸å¤ªæ„Ÿå…´è¶£çš„å†…å®¹ï¼š</p>

<ul>
<li>æ„å»ºæ€§èƒ½ï¼šç›®å‰ï¼Œâ€œGradle é‡ç¼–è¯‘å™¨â€çš„é€Ÿåº¦å°†ä¸ä½ çš„é¡¹ç›®é€Ÿåº¦ä¸€æ ·å¿«ã€‚å¼ºçƒˆå»ºè®®
å¯ç”¨ Gradles é…ç½®ç¼“å­˜ï¼Œå¹¶ä¿æŒé¡¹ç›®éå¸¸å¹²å‡€ã€‚å…¶ä»–â€œé‡ç¼–è¯‘å™¨â€ä¹Ÿä¼šæœ‰æ‰€å¸®åŠ©ï¼ï¼ˆIntelliJã€Amper ç­‰ï¼‰</li>
</ul>
</blockquote>

<h2>æ€»ç»“</h2>

<p>æˆ‘ç›¸ä¿¡ Compose ä¸­çš„ Hot Reload æ˜¯å¼€å‘ Compose UIçš„ä¸€å¤§å˜é©ã€‚
å®ƒå¯ä»¥è®©å¼€å‘äººå‘˜åœ¨æ— éœ€é‡å¯åº”ç”¨çš„æƒ…å†µä¸‹çœ‹åˆ°æ›´æ”¹ï¼Œä»è€ŒåŠ å¿«UIå¼€å‘é€Ÿåº¦ï¼Œä½†å®ƒä»å¤„äºå®éªŒé˜¶æ®µã€‚ç›®å‰ï¼Œå®ƒæœ€é€‚åˆä¸ªäººæˆ–æ—©æœŸé¡¹ç›®ï¼Œä½ å¯ä»¥ä½¿ç”¨ alpha ç‰ˆæœ¬è¿›è¡Œå¼€å‘ã€‚åœ¨ä½ è‡ªå·±çš„ Compose Multiplatform é¡¹ç›®ä¸­è¯•ç”¨å®ƒï¼Œä½“éªŒå³æ—¶UIåé¦ˆçš„å¥½å¤„ï¼</p>

<p>æˆ‘è¿«ä¸åŠå¾…åœ°æƒ³çœ‹åˆ°å³å°†åˆ°æ¥çš„æ›´æ–°ï¼XD</p>

<h2>å‚è€ƒèµ„æ–™</h2>

<ul>
<li><a href="https://github.com/JetBrains/compose-hot-reload">https://github.com/JetBrains/compose-hot-reload</a></li>
<li><a href="https://blog.sellmair.io/say-hello-to-compose-hot-reload-firework">https://blog.sellmair.io/say-hello-to-compose-hot-reload-firework</a></li>
<li><a href="https://www.youtube.com/watch?v=8Z-Vuo3wTd0">Firework: Introducing Compose Hot Reload</a></li>
<li><a href="https://www.youtube.com/watch?v=I_FMnPaEBEA">How â€˜Hot Reloadâ€™ is implemented for Compose</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å®æˆ˜ï¼šæ¢ç´¢Jetpack Composeä¸­çš„SearchBar]]></title>
    <link href="https://alexhilton.github.io/blog/2025/04/09/searchbar-in-jetpack-compose/"/>
    <updated>2025-04-09T22:40:46+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/04/09/searchbar-in-jetpack-compose</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ªExploring Jetpack Compose: SearchBarï¼ŒåŸæ–‡é“¾æ¥ï¼š<a href="https://joebirch.co/android/exploring-the-searchbar-composable/">https://joebirch.co/android/exploring-the-searchbar-composable/</a>ï¼Œä½œè€…æ˜¯Joe Birchã€‚</p></blockquote>

<p>åœ¨åº”ç”¨å†…æœç´¢å†…å®¹æ˜¯ä¸€é¡¹å¸¸è§åŠŸèƒ½ï¼Œäº‹å®ä¸Šï¼Œä½ å¯ä»¥åœ¨è®¾å¤‡ä¸Šçš„å¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸­å‘ç°æ­¤åŠŸèƒ½ã€‚åœ¨ Android ä¸Šï¼Œæˆ‘ä»¬çœ‹åˆ°çš„æ­¤åŠŸèƒ½çš„å¸¸è§ UI ç»„ä»¶æ˜¯æµ®åŠ¨æœç´¢æ ï¼Œæ”¾ç½®åœ¨å±å¹•çš„æ˜¾çœ¼ä½ç½®ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™è¿˜ä¼šå‘ç”¨æˆ·æä¾›æœç´¢å»ºè®®ï¼Œä»¥ç®€åŒ–æœç´¢è¿‡ç¨‹ã€‚Jetpack Compose Material3 è½¯ä»¶åŒ…æä¾›äº†å¯¹æä¾›æ­¤åŠŸèƒ½çš„ SearchBar å¯ç»„åˆé¡¹çš„è®¿é—®ï¼Œåœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åœ¨æˆ‘ä»¬è‡ªå·±çš„åº”ç”¨ä¸­ä½¿ç”¨å®ƒã€‚</p>

<p><a href="https://alexhilton.github.io/blog/2025/04/09/searchbar-in-jetpack-compose/"><img src="https://joebirch.co/wp-content/uploads/2025/03/Group.png" title="auto auto" ></a></p>

<!-- more -->


<p>SearchBar å¯ç»„åˆé¡¹å…è®¸æˆ‘ä»¬æ˜¾ç¤ºä¸€ä¸ªæµ®åŠ¨çš„æœç´¢ç»„ä»¶ï¼Œè¯¥ç»„ä»¶å±•å¼€åä¼šæ˜¾ç¤ºå¯é€‰çš„æ¨èã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨è®¸å¤šåº”ç”¨ä¸­çœ‹åˆ°çš„å¸¸è§æ¨¡å¼ï¼Œæ­¤å¯ç»„åˆé¡¹æä¾›äº†å¼€ç®±å³ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚SearchBar å¯ç»„åˆé¡¹æä¾›äº†è¶³å¤Ÿçš„è‡ªå®šä¹‰åŠŸèƒ½æ¥æ§åˆ¶ç»„ä»¶çš„å¤–è§‚å’Œæ„Ÿè§‰ï¼ŒåŒæ—¶ä½¿ç”¨åŸºäºæ’æ§½(slot)çš„æ–¹æ³•è®©æˆ‘ä»¬æä¾›è¾“å…¥å­—æ®µä»¥ä¾›ä½¿ç”¨ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">SearchBar</span><span class="p">(</span>
</span><span class='line'>    <span class="n">inputField</span><span class="p">:</span> <span class="n">@Composable</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">,</span>
</span><span class='line'>    <span class="n">expanded</span><span class="p">:</span> <span class="n">Boolean</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onExpandedChange</span><span class="p">:</span> <span class="p">(</span><span class="n">Boolean</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">,</span>
</span><span class='line'>    <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>    <span class="n">shape</span><span class="p">:</span> <span class="n">Shape</span> <span class="p">=</span> <span class="n">SearchBarDefaults</span><span class="p">.</span><span class="n">inputFieldShape</span><span class="p">,</span>
</span><span class='line'>    <span class="n">colors</span><span class="p">:</span> <span class="n">SearchBarColors</span> <span class="p">=</span> <span class="n">SearchBarDefaults</span><span class="p">.</span><span class="n">colors</span><span class="p">(),</span>
</span><span class='line'>    <span class="n">tonalElevation</span><span class="p">:</span> <span class="n">Dp</span> <span class="p">=</span> <span class="n">SearchBarDefaults</span><span class="p">.</span><span class="n">TonalElevation</span><span class="p">,</span>
</span><span class='line'>    <span class="n">shadowElevation</span><span class="p">:</span> <span class="n">Dp</span> <span class="p">=</span> <span class="n">SearchBarDefaults</span><span class="p">.</span><span class="n">ShadowElevation</span><span class="p">,</span>
</span><span class='line'>    <span class="n">windowInsets</span><span class="p">:</span> <span class="n">WindowInsets</span> <span class="p">=</span> <span class="n">SearchBarDefaults</span><span class="p">.</span><span class="n">windowInsets</span><span class="p">,</span>
</span><span class='line'>    <span class="n">content</span><span class="p">:</span> <span class="n">@Composable</span> <span class="n">ColumnScope</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¯¥ç»„ä»¶ä¸ºæˆ‘ä»¬å¤„ç†äº†å¤§éƒ¨åˆ†å†…éƒ¨å·¥ä½œâ€”â€”å…¶ä¸­ä¸¤ä¸ªå…³é”®éƒ¨åˆ†éœ€è¦æˆ‘ä»¬è‡ªå·±æä¾›ã€‚</p>

<ul>
<li>inputField â€“ è¿™æ˜¯è¡¨ç¤ºå†…å®¹è¾“å…¥çš„æœç´¢å­—æ®µçš„è¾“å…¥å¯ç»„åˆé¡¹</li>
<li>content â€“ è¿™æ˜¯æœç´¢æ å±•å¼€æ—¶ç”¨äºæ˜¾ç¤ºæ¨èçš„å†…å®¹åŒºåŸŸ</li>
</ul>


<p>é™¤äº†è¿™äº›å­—æ®µä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç»„å…¶ä»–å±æ€§ç”¨äºç¡®å®š SearchBar çš„å½“å‰çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå½“æœç´¢æ å¤„äºå±•å¼€çŠ¶æ€æ—¶ï¼Œå¯ç»„åˆé¡¹çš„å†…å®¹å°†æ˜¾ç¤ºåœ¨è¾“å…¥å­—æ®µä¸‹æ–¹ã€‚ä¸ºäº†èƒ½å¤Ÿç®¡ç†è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå¯ç»„åˆé¡¹æä¾›ä¸€äº›å‚æ•°ï¼Œç”¨äºç®¡ç†æ­¤çŠ¶æ€ã€‚é¦–å…ˆï¼Œexpanded å‚æ•°ç”¨äºæè¿° SearchBar æ˜¯å¦å¤„äºå±•å¼€çŠ¶æ€ï¼ˆè¿™å°†å†³å®šæ˜¯å¦æ˜¾ç¤ºå†…å®¹åŒºåŸŸï¼‰ï¼Œä»¥åŠ onExpandedChange å‚æ•°ï¼Œç”¨äºä¸ºå®ç°æä¾›å±•å¼€çŠ¶æ€çš„æ›´æ–°å€¼ï¼ˆç„¶åå¯ç”¨äºåæ˜ æˆ‘ä»¬è‡ªå·±çš„çŠ¶æ€å®ç°ï¼‰ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">var</span> <span class="py">expanded</span> <span class="k">by</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">mutableStateOf</span><span class="p">(</span><span class="k">false</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">SearchBar</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">fillMaxWidth</span><span class="p">(),</span>
</span><span class='line'>    <span class="n">expanded</span> <span class="p">=</span> <span class="n">expanded</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onExpandedChange</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">expanded</span> <span class="p">=</span> <span class="n">it</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>é™¤äº†ç®¡ç†è¿™ç§å±•å¼€çŠ¶æ€å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æä¾›ç”¨äº SearchBar è¾“å…¥åŒºåŸŸçš„ inputFieldã€‚é™¤äº†éµå¾ªå¯ç»„åˆé¡¹çš„åŸºäºæ’æ§½çš„æ–¹æ³•ä¹‹å¤–ï¼Œè¿™è¿˜å…è®¸å¯ç»„åˆé¡¹éµå¾ªçŠ¶æ€æå‡çš„æ¦‚å¿µï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå®Œå…¨ç®¡ç† SearchBar è¾“å…¥å­—æ®µçš„çŠ¶æ€æ¦‚å¿µã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">var</span> <span class="py">expanded</span> <span class="k">by</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">mutableStateOf</span><span class="p">(</span><span class="k">false</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="k">var</span> <span class="py">query</span> <span class="k">by</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">mutableStateOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">?&gt;(</span><span class="k">null</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">SearchBar</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">fillMaxWidth</span><span class="p">(),</span>
</span><span class='line'>    <span class="n">expanded</span> <span class="p">=</span> <span class="n">expanded</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onExpandedChange</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">expanded</span> <span class="p">=</span> <span class="n">it</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="n">inputField</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// ...</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸ºäº†ç®€åŒ–æ­¤æ“ä½œï¼ŒSearchBarDefaults ç±»ä¸ºæˆ‘ä»¬æä¾›äº†å¯¹ InputField å¯ç»„åˆé¡¹çš„è®¿é—® - è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿè®¿é—®ä¸“é—¨ä¸º SearchBar å®ç°çš„å¯ç»„åˆé¡¹ã€‚ä¸éœ€è¦ä½¿ç”¨æ­¤ç‰¹å®šå¯ç»„åˆé¡¹ï¼Œä½†å®ƒæ˜¯ä¸“é—¨ä¸ºåŸºäºæœç´¢çš„è¾“å…¥å­—æ®µæä¾›çš„ä¾¿åˆ©å¯ç»„åˆé¡¹ã€‚æ­¤å¯ç»„åˆé¡¹é‡‡ç”¨ä¸€äº›å…³é”®å‚æ•°ï¼Œç”¨äºå°†å…¶é…ç½®ä¸ºåœ¨ SearchBar ä¸­ä½¿ç”¨ï¼š</p>

<ul>
<li>expanded å’Œ onExpandedChange - ç”¨äºç®¡ç†å­—æ®µçš„å±•å¼€çŠ¶æ€</li>
<li>query å’Œ onQueryChange - ç”¨äºç®¡ç†å­—æ®µä¸­æ˜¾ç¤ºçš„æŸ¥è¯¢çš„çŠ¶æ€</li>
</ul>


<p>é™¤äº†è¿™äº›æ ¸å¿ƒå±æ€§å¤–ï¼Œä½ è¿˜ä¼šæ³¨æ„åˆ°å¯¹æ ‡å‡†å­—æ®µå‚æ•°ï¼ˆå¦‚å ä½ç¬¦ã€leadingIcon å’Œ trailingIconï¼‰çš„æ”¯æŒã€‚é™¤äº†ç”¨äºæä¾›ä¿¡æ¯ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­çœ‹åˆ°æˆ‘å¦‚ä½•ä½¿ç”¨ trailingIcon å…è®¸ SearchBar åœ¨å•å‡»å–æ¶ˆæŒ‰é’®æ—¶æ¢å¤åˆ°æŠ˜å çŠ¶æ€ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">SearchBarDefaults</span><span class="p">.</span><span class="n">InputField</span><span class="p">(</span>
</span><span class='line'>    <span class="n">onSearch</span> <span class="p">=</span> <span class="p">{</span> <span class="n">expanded</span> <span class="p">=</span> <span class="k">false</span> <span class="p">},</span>
</span><span class='line'>    <span class="n">expanded</span> <span class="p">=</span> <span class="n">expanded</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onExpandedChange</span> <span class="p">=</span> <span class="p">{</span> <span class="n">expanded</span> <span class="p">=</span> <span class="n">it</span> <span class="p">},</span>
</span><span class='line'>    <span class="n">placeholder</span> <span class="p">=</span> <span class="p">{</span> <span class="n">Text</span><span class="p">(</span><span class="s">&quot;What are you looking for?&quot;</span><span class="p">)</span> <span class="p">},</span>
</span><span class='line'>    <span class="n">leadingIcon</span> <span class="p">=</span> <span class="p">{</span> <span class="n">Icon</span><span class="p">(</span><span class="n">Icons</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">Search</span><span class="p">,</span> <span class="n">contentDescription</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">},</span>
</span><span class='line'>    <span class="n">trailingIcon</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">expanded</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">IconButton</span><span class="p">(</span><span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">expanded</span> <span class="p">=</span> <span class="k">false</span>
</span><span class='line'>            <span class="p">})</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">Icon</span><span class="p">(</span><span class="n">Icons</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">Close</span><span class="p">,</span> <span class="n">contentDescription</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="n">query</span> <span class="p">=</span> <span class="n">query</span> <span class="o">?:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onQueryChange</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">query</span> <span class="p">=</span> <span class="n">it</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç„¶åå¯ä»¥å°†æ­¤ InputField å¯ç»„åˆé¡¹çš„å®ç°æ’å…¥åˆ° SearchBar å¯ç»„åˆé¡¹çš„ inputField å‚æ•°ä¸­ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">var</span> <span class="py">expanded</span> <span class="k">by</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">mutableStateOf</span><span class="p">(</span><span class="k">false</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="k">var</span> <span class="py">query</span> <span class="k">by</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">mutableStateOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">?&gt;(</span><span class="k">null</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">SearchBar</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">fillMaxWidth</span><span class="p">(),</span>
</span><span class='line'>    <span class="n">expanded</span> <span class="p">=</span> <span class="n">expanded</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onExpandedChange</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">expanded</span> <span class="p">=</span> <span class="n">it</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="n">inputField</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">SearchBarDefaults</span><span class="p">.</span><span class="n">InputField</span><span class="p">(</span>
</span><span class='line'>            <span class="n">onSearch</span> <span class="p">=</span> <span class="p">{</span> <span class="n">expanded</span> <span class="p">=</span> <span class="k">false</span> <span class="p">},</span>
</span><span class='line'>            <span class="n">expanded</span> <span class="p">=</span> <span class="n">expanded</span><span class="p">,</span>
</span><span class='line'>            <span class="n">onExpandedChange</span> <span class="p">=</span> <span class="p">{</span> <span class="n">expanded</span> <span class="p">=</span> <span class="n">it</span> <span class="p">},</span>
</span><span class='line'>            <span class="n">placeholder</span> <span class="p">=</span> <span class="p">{</span> <span class="n">Text</span><span class="p">(</span><span class="s">&quot;What are you looking for?&quot;</span><span class="p">)</span> <span class="p">},</span>
</span><span class='line'>            <span class="n">leadingIcon</span> <span class="p">=</span> <span class="p">{</span> <span class="n">Icon</span><span class="p">(</span><span class="n">Icons</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">Search</span><span class="p">,</span> <span class="n">contentDescription</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">},</span>
</span><span class='line'>            <span class="n">trailingIcon</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="n">expanded</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="n">IconButton</span><span class="p">(</span><span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>                        <span class="n">expanded</span> <span class="p">=</span> <span class="k">false</span>
</span><span class='line'>                    <span class="p">})</span> <span class="p">{</span>
</span><span class='line'>                        <span class="n">Icon</span><span class="p">(</span><span class="n">Icons</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">Close</span><span class="p">,</span> <span class="n">contentDescription</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">},</span>
</span><span class='line'>            <span class="n">query</span> <span class="p">=</span> <span class="n">query</span> <span class="o">?:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="n">onQueryChange</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">query</span> <span class="p">=</span> <span class="n">it</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿç»„åˆ SearchBar å¹¶çœ‹åˆ°åœ¨æˆ‘ä»¬çš„ UI ä¸­æ˜¾ç¤ºçš„æµ®åŠ¨ç»„ä»¶ã€‚</p>

<p><img src="https://joebirch.co/wp-content/uploads/2025/03/sea.png" alt="SearchBar" /></p>

<p>æ­¤æ—¶æˆ‘ä»¬å‰©ä¸‹è¦å®ç°çš„å°±æ˜¯ SearchBar çš„å†…å®¹ï¼Œè¿™æ˜¯ SearchBar å¤„äºå±•å¼€çŠ¶æ€æ—¶æ˜¾ç¤ºçš„å†…å®¹ã€‚æ­¤å‚æ•°åˆ©ç”¨äº† ColumnScopeï¼Œå› æ­¤æ­¤å¤„æä¾›çš„ä»»ä½•å¯ç»„åˆé¡¹éƒ½å°†å‚ç›´å †å ã€‚æ­¤å†…å®¹åŒºåŸŸçš„é¢„æœŸå½¢å¼æ˜¯ç”¨æˆ·å¯ä»¥é€‰æ‹©çš„æ¨èåˆ—è¡¨ï¼Œå› æ­¤æˆ‘ä»¬å°†ç»§ç»­ç¼–å†™å‡ ä¸ª ListItem å¯ç»„åˆé¡¹ï¼Œæ¯ä¸ªå¯ç»„åˆé¡¹éƒ½ç”¨äºå‘ç”¨æˆ·æ˜¾ç¤ºæœç´¢æ¨èã€‚å½“ç‚¹å‡»å…¶ä¸­ä»»ä½•ä¸€é¡¹æ—¶ï¼ŒæŸ¥è¯¢å°†æ›´æ–°ä¸ºé€‰å®šå€¼ï¼Œå¹¶ä¸” SearchBar çš„å±•å¼€çŠ¶æ€å°†é‡ç½®ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">var</span> <span class="py">expanded</span> <span class="k">by</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">mutableStateOf</span><span class="p">(</span><span class="k">false</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="k">var</span> <span class="py">query</span> <span class="k">by</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">mutableStateOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">?&gt;(</span><span class="k">null</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">SearchBar</span><span class="p">(</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">listOf</span><span class="p">(</span><span class="s">&quot;Result 1&quot;</span><span class="p">,</span> <span class="s">&quot;Result 2&quot;</span><span class="p">,</span> <span class="s">&quot;Result 3&quot;</span><span class="p">,</span> <span class="s">&quot;Result 4&quot;</span><span class="p">).</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">text</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="n">ListItem</span><span class="p">(</span>
</span><span class='line'>            <span class="n">headlineContent</span> <span class="p">=</span> <span class="p">{</span> <span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="p">},</span>
</span><span class='line'>            <span class="n">colors</span> <span class="p">=</span> <span class="n">ListItemDefaults</span><span class="p">.</span><span class="n">colors</span><span class="p">(</span><span class="n">containerColor</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">Transparent</span><span class="p">),</span>
</span><span class='line'>            <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">clickable</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">query</span> <span class="p">=</span> <span class="n">text</span>
</span><span class='line'>                <span class="n">expanded</span> <span class="p">=</span> <span class="k">false</span>
</span><span class='line'>            <span class="p">}.</span><span class="n">fillMaxWidth</span><span class="p">().</span><span class="n">padding</span><span class="p">(</span><span class="n">horizontal</span> <span class="p">=</span> <span class="m">16.</span><span class="n">dp</span><span class="p">,</span> <span class="n">vertical</span> <span class="p">=</span> <span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æœ‰äº†æ­¤åŠŸèƒ½ï¼Œæˆ‘ä»¬ç°åœ¨å°±èƒ½å¤Ÿçœ‹åˆ°åœ¨æµ®åŠ¨æœç´¢æ ä¸‹æ–¹æ˜¾ç¤ºçš„æ¨èã€‚</p>

<p><img src="https://joebirch.co/wp-content/uploads/2025/03/recs.png" alt="Recommendations" /></p>

<p>æœ‰äº†ä¸Šè¿°å†…å®¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°ä¸€ä¸ªæµ®åŠ¨æœç´¢æ ï¼Œå‘ç”¨æˆ·æ˜¾ç¤ºæœç´¢å»ºè®®ã€‚ä½¿ç”¨ Material3 SearchBar å¯ç»„åˆé¡¹ï¼Œå®ç°åœ¨è¿™ä¸¤ç§ä¸åŒçŠ¶æ€ä¹‹é—´è½¬æ¢çš„å¯ç»„åˆé¡¹éå¸¸å®¹æ˜“ã€‚ä¹Ÿè®¸ä½ å·²ç»åœ¨åº”ç”¨ä¸­ä½¿ç”¨äº† SearchBarï¼Œæˆ–è€…ä¸€ç›´åœ¨å¯»æ‰¾ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†æ— è®ºå¦‚ä½•ï¼Œæˆ‘æœŸå¾…çœ‹åˆ°æ›´å¤šåº”ç”¨é€šè¿‡ Jetpack Compose ä¸­æ›´å¹¿æ³›çš„ç»„ä»¶æ”¯æŒæ¥èŠ‚çœæ—¶é—´ï¼</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å®æˆ˜ï¼šåœ¨Composeä¸­ä¼˜é›…åœ°å®ç°æç¤º]]></title>
    <link href="https://alexhilton.github.io/blog/2025/03/28/hints-in-compose/"/>
    <updated>2025-03-28T22:05:00+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/03/28/hints-in-compose</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ª<a href="https://proandroiddev.com/hints-in-compose-10b6470acc58">Hints in Compose</a>ï¼ŒåŸæ–‡ç”±<a href="https://medium.com/@vitoksmile">Viktor Mykhailiv</a>å‘å¸ƒäº2025å¹´2æœˆ13æ—¥ï¼Œæ–‡ç« å†…å®¹å·¨è¯¦ç»†ï¼ŒTL;DR;ã€‚</p></blockquote>

<p><a href="https://alexhilton.github.io/blog/2025/03/28/hints-in-compose/"><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0jBirMqQV-aXKXw5gekEkQ.jpeg" title="auto auto" ></a></p>

<!-- more -->


<p>æœ‰æ—¶æˆ‘ä»¬çš„åº”ç”¨éœ€è¦çªå‡ºæ˜¾ç¤ºæŸäº› UI ç»„ä»¶ï¼Œä¾‹å¦‚åœ¨é¦–æ¬¡ç™»å½•ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰æ—¶ï¼Œæˆ–è€…å½“æˆ‘ä»¬æ·»åŠ æ–°å†…å®¹ï¼ˆâ€œæ–°åŠŸèƒ½â€ï¼‰æ—¶ã€‚</p>

<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†æŒ‡å¯¼å¦‚ä½•æ„å»ºè‡ªå®šä¹‰è§£å†³æ–¹æ¡ˆæ¥æ˜¾ç¤ºæç¤º/å·¥å…·æç¤ºï¼ŒæŒ‡å‘ Composeï¼ˆCompose Multiplatform å’Œ Jetpack Composeï¼‰ä¸­çš„ç‰¹å®š UI å…ƒç´ ã€‚</p>

<h2>å¸ƒå±€å±‚æ¬¡</h2>

<p>è¦çªå‡ºæ˜¾ç¤º UI å…ƒç´ ï¼Œé¦–å…ˆæˆ‘ä»¬åº”è¯¥äº†è§£â€œæç¤ºâ€(Hints)çš„ä¸»è¦æ¦‚å¿µã€‚
å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¸¦æœ‰ TopBarã€BottomNavigation å’Œä¸»è¦æ“ä½œæŒ‰é’®çš„åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬æƒ³è¦çªå‡ºæ˜¾ç¤º TopBar çš„æ“ä½œã€ä¸»è¦æŒ‰é’®å’Œ BottomNavigation ä¸­çš„ä¸€ä¸ªé¡¹ç›®ã€‚</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7K0zoXqZM0ajYYZARn6I5w.png" alt="Layout hierarchy" /></p>

<p>å¯¹äºæˆ‘ä»¬çš„â€œæç¤ºâ€ï¼Œæˆ‘ä»¬éœ€è¦ç»˜åˆ¶ä¸€ä¸ªæš—æ·¡çš„èƒŒæ™¯ï¼ˆä¹Ÿæ˜¯ä¸ºäº†æ‹¦æˆªè§¦æ‘¸äº‹ä»¶ï¼‰ï¼Œè®¡ç®—çªå‡ºæ˜¾ç¤ºçš„ UI å…ƒç´ çš„ä½ç½®ï¼Œå‰ªæ‰ï¼ˆå±è”½ï¼‰æˆ‘ä»¬çš„å…ƒç´ å½¢çŠ¶ä»¥å…å˜æš—ï¼Œæœ€åç»˜åˆ¶ä¸€ä¸ªæç¤ºï¼ˆä¾‹å¦‚å¸¦æœ‰èƒŒæ™¯çš„æ–‡æœ¬ï¼‰ã€‚</p>

<h2>1. æš—æ·¡çš„èƒŒæ™¯</h2>

<p>è¦åœ¨æ‰€æœ‰å†…å®¹ä¹‹ä¸Šç»˜åˆ¶ä¸€ä¸ªæš—æ·¡çš„èƒŒæ™¯ä½œä¸ºè¦†ç›–æˆ–å¼¹å‡ºçª—å£ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p>

<h3>a. ä½¿ç”¨è‡ªå®šä¹‰å¯ç»„åˆé¡¹åŒ…è£…æˆ‘ä»¬åº”ç”¨ï¼ˆæ ¹ç»„ä»¶ï¼‰çš„æ‰€æœ‰å†…å®¹ï¼ˆä¾‹å¦‚å¸¦æœ‰ Modifier.background çš„ Boxï¼‰</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">AppContent</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>   <span class="n">HintOverlay</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">MaterialTheme</span> <span class="p">{</span>
</span><span class='line'>         <span class="n">Scaffold</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// æˆ‘çš„åº”ç”¨å†…å®¹</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>b. ä½¿ç”¨å¯¹è¯æ¡†</h3>

<p>é€šè¿‡ä½¿ç”¨å¯¹è¯æ¡†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ‰€æœ‰å†…å®¹ä¹‹ä¸Šæ˜¾ç¤ºä¸€ä¸ªè¦†ç›–å±‚ï¼ˆä¾‹å¦‚ï¼Œåœ¨ Android ä¸Šï¼Œå¯¹è¯æ¡†æ˜¾ç¤ºåœ¨è‡ªå·±çš„çª—å£ä¸­ï¼‰ã€‚
ä½¿ç”¨å¯¹è¯æ¡†æ—¶ï¼ŒCompose Multiplatform ä¸­çš„ scrimColor ä¼šå‡ºç°é—®é¢˜ã€‚æˆ‘ä»¬æ— æ³•ä» Compose é€šç”¨ç›®æ ‡é…ç½® scrimColor ï¼Œä½†æ¯ä¸ªç›®æ ‡ï¼ˆAndroid é™¤å¤–ï¼‰éƒ½ä¸º scrimColor æä¾›äº†ä¸€ä¸ªå®é™…å€¼ã€‚ä½œä¸ºä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªä¾‹å¤–ç±»æ¥æä¾›å¯¹è¯æ¡†å±æ€§å¹¶ä¸ºæ¯ä¸ªç›®æ ‡æä¾›å®é™…å®ç°ã€‚</p>

<h3>c. ä½¿ç”¨ Popup</h3>

<p>Popup åœ¨è¿™é‡Œçœ‹èµ·æ¥æ›´å¥½ï¼Œå› ä¸ºå®ƒé»˜è®¤ä¸ç»˜åˆ¶ scrimColorï¼Œå¹¶ä¸”è¦†ç›–å±‚æ˜¾ç¤ºåœ¨æ‰€æœ‰å†…å®¹ä¹‹ä¸Šã€‚</p>

<p>æˆ‘ä¼šé‡‡ç”¨ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œä¸å¼ºåˆ¶æ‰‹åŠ¨ä½¿ç”¨ HintOverlayã€‚</p>

<p>æˆ‘è¿˜æƒ³ä¸ºè¦†ç›–å±‚èƒŒæ™¯æ·»åŠ  Brush æ”¯æŒï¼Œè€Œä¸ä»…ä»…æ˜¯ Color ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">val</span> <span class="py">LocalHintOverlayColor</span> <span class="p">=</span> <span class="n">staticCompositionLocalOf</span><span class="p">&lt;</span><span class="n">Color</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">Color</span><span class="p">(</span><span class="m">0</span><span class="n">x44000000</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">val</span> <span class="py">LocalHintOverlayBrush</span> <span class="p">=</span> <span class="n">staticCompositionLocalOf</span><span class="p">&lt;</span><span class="n">Brush</span><span class="p">?&gt;</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">HintOverlay</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Popup</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Box</span><span class="p">(</span>
</span><span class='line'>            <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span><span class='line'>                <span class="p">.</span><span class="n">fillMaxSize</span><span class="p">()</span>
</span><span class='line'>                <span class="p">.</span><span class="n">overlayBackground</span><span class="p">()</span>
</span><span class='line'>        <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">Text</span><span class="p">(</span>
</span><span class='line'>                <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">align</span><span class="p">(</span><span class="n">Alignment</span><span class="p">.</span><span class="n">Center</span><span class="p">),</span>
</span><span class='line'>                <span class="n">text</span> <span class="p">=</span> <span class="s">&quot;Draw hints here&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">White</span><span class="p">,</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * ä» [LocalHintOverlayBrush] æˆ– [LocalHintOverlayColor] è®¾ç½® `background`ã€‚</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="k">private</span> <span class="k">fun</span> <span class="nf">Modifier</span><span class="p">.</span><span class="n">overlayBackground</span><span class="p">():</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">composed</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">LocalHintOverlayBrush</span><span class="p">.</span><span class="n">current</span><span class="o">?.</span><span class="n">let</span> <span class="p">{</span> <span class="n">background</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>        <span class="o">?:</span> <span class="n">background</span><span class="p">(</span><span class="n">LocalHintOverlayColor</span><span class="p">.</span><span class="n">current</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘å¯ä»¥ä½¿ç”¨CompositionLocalProvider è®¾ç½® Brush æ¥è¦†ç›–è¦†ç›–çš„èƒŒæ™¯ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">CompositionLocalProvider</span><span class="p">(</span>
</span><span class='line'>    <span class="n">LocalHintOverlayBrush</span> <span class="n">provides</span> <span class="n">Brush</span><span class="p">.</span><span class="n">linearGradient</span><span class="p">(</span>
</span><span class='line'>        <span class="n">listOf</span><span class="p">(</span>
</span><span class='line'>            <span class="n">Color</span><span class="p">.</span><span class="n">Red</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">alpha</span> <span class="p">=</span> <span class="m">0.5f</span><span class="p">),</span>
</span><span class='line'>            <span class="n">Color</span><span class="p">.</span><span class="n">Blue</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">alpha</span> <span class="p">=</span> <span class="m">0.5f</span><span class="p">),</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>    <span class="p">),</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">HintOverlay</span><span class="p">()</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KrHuSNZT0zE-Eddz1GBA2A.png" alt="Dimmed background" /></p>

<h2>2. è®¡ç®—é”šç‚¹åæ ‡</h2>

<p>è¦è·å– Compose ä¸­ UI å…ƒç´ çš„åæ ‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨OnGloballyPositionedModifier ï¼Œå½“å†…å®¹çš„å…¨å±€ä½ç½®å¯èƒ½å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šä½¿ç”¨å¸ƒå±€çš„æœ€ç»ˆâ€‹â€‹ LayoutCoordinates è°ƒç”¨è¯¥æ–¹æ³•ã€‚</p>

<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">Column</span><span class="p">(</span>
</span><span class='line'>    <span class="n">Modifier</span><span class="p">.</span><span class="n">onGloballyPositioned</span> <span class="p">{</span> <span class="n">coordinates</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="c1">// è¿™å°†æ˜¯Columnçš„å¤§å°ã€‚</span>
</span><span class='line'>        <span class="n">coordinates</span><span class="p">.</span><span class="n">size</span>
</span><span class='line'>        <span class="c1">// Columnç›¸å¯¹äºåº”ç”¨ç¨‹åºçª—å£çš„ä½ç½®ã€‚</span>
</span><span class='line'>        <span class="n">coordinates</span><span class="p">.</span><span class="n">positionInWindow</span><span class="p">()</span>
</span><span class='line'>        <span class="c1">// Columnç›¸å¯¹äº Compose æ ¹çš„ä½ç½®ã€‚</span>
</span><span class='line'>        <span class="n">coordinates</span><span class="p">.</span><span class="n">positionInRoot</span><span class="p">()</span>
</span><span class='line'>        <span class="c1">// è¿™äº›å°†æ˜¯æä¾›ç»™å¸ƒå±€çš„å¯¹é½çº¿ï¼ˆæ­¤å¤„çš„Columnä¸ºç©ºï¼‰ã€‚</span>
</span><span class='line'>        <span class="n">coordinates</span><span class="p">.</span><span class="n">providedAlignmentLines</span>
</span><span class='line'>        <span class="c1">// è¿™å°†æ˜¯ä¸ Column çš„çˆ¶çº§ç›¸å¯¹åº”çš„ LayoutCoordinates å®ä¾‹ã€‚</span>
</span><span class='line'>        <span class="n">coordinates</span><span class="p">.</span><span class="n">parentLayoutCoordinates</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Box</span><span class="p">(</span><span class="n">Modifier</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="m">20.</span><span class="n">dp</span><span class="p">).</span><span class="n">background</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Green</span><span class="p">))</span>
</span><span class='line'>    <span class="n">Box</span><span class="p">(</span><span class="n">Modifier</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="m">20.</span><span class="n">dp</span><span class="p">).</span><span class="n">background</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Blue</span><span class="p">))</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¯¹äºæˆ‘ä»¬çš„æç¤ºï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªçŠ¶æ€æ¥ä¿å­˜é”šç‚¹çš„åæ ‡å’Œå¤§å°ï¼Œå¹¶å¼•å…¥ä¸€ä¸ªä¿®æ”¹å™¨æ¥æ›´æ–°çŠ¶æ€ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Stable</span>
</span><span class='line'><span class="k">class</span> <span class="nc">HintAnchorState</span> <span class="k">internal</span> <span class="n">constructor</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">internal</span> <span class="k">var</span> <span class="py">size</span><span class="p">:</span> <span class="n">IntSize</span> <span class="k">by</span> <span class="n">mutableStateOf</span><span class="p">(</span><span class="n">IntSize</span><span class="p">.</span><span class="n">Zero</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">internal</span> <span class="k">var</span> <span class="py">offset</span><span class="p">:</span> <span class="n">Offset</span> <span class="k">by</span> <span class="n">mutableStateOf</span><span class="p">(</span><span class="n">Offset</span><span class="p">.</span><span class="n">Zero</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">rememberHintAnchorState</span><span class="p">():</span> <span class="n">HintAnchorState</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">HintAnchorState</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">fun</span> <span class="nf">Modifier</span><span class="p">.</span><span class="n">hintAnchor</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">HintAnchorState</span><span class="p">):</span> <span class="n">Modifier</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">onGloballyPositioned</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">state</span><span class="p">.</span><span class="n">size</span> <span class="p">=</span> <span class="n">it</span><span class="p">.</span><span class="n">size</span>
</span><span class='line'>        <span class="n">state</span><span class="p">.</span><span class="n">offset</span> <span class="p">=</span> <span class="n">it</span><span class="p">.</span><span class="n">positionInWindow</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è®¢é˜…æ‰€éœ€ UI å…ƒç´ çš„å¤§å°å’Œåæ ‡å˜åŒ–å³å¯æ›´æ–°é”šç‚¹çš„çŠ¶æ€ã€‚
ç°åœ¨æˆ‘ä»¬éœ€è¦å°†æ­¤ hintAnchor ä¿®é¥°ç¬¦åº”ç”¨äºæˆ‘ä»¬çš„å†…å®¹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">val</span> <span class="py">topAppBarActionHintAnchor</span> <span class="p">=</span> <span class="n">rememberHintAnchorState</span><span class="p">()</span>
</span><span class='line'><span class="k">val</span> <span class="py">actionHintAnchor</span> <span class="p">=</span> <span class="n">rememberHintAnchorState</span><span class="p">()</span>
</span><span class='line'><span class="k">val</span> <span class="py">bottomNavigationHintAnchor</span> <span class="p">=</span> <span class="n">rememberHintAnchorState</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">IconButton</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span><span class='line'>        <span class="p">.</span><span class="n">hintAnchor</span><span class="p">(</span><span class="n">topAppBarActionHintAnchor</span><span class="p">),</span>
</span><span class='line'>    <span class="n">onClick</span> <span class="p">=</span> <span class="p">{},</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">Button</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span><span class='line'>        <span class="p">.</span><span class="n">hintAnchor</span><span class="p">(</span><span class="n">actionHintAnchor</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="m">4.</span><span class="n">dp</span><span class="p">),</span>
</span><span class='line'>    <span class="n">onClick</span> <span class="p">=</span> <span class="p">{},</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Text</span><span class="p">(</span><span class="s">&quot;Action&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">BottomNavigationItem</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span><span class='line'>        <span class="p">.</span><span class="n">hintAnchor</span><span class="p">(</span><span class="n">topAppBarActionHintAnchor</span><span class="p">),</span>
</span><span class='line'>    <span class="c1">//... ä¼ å…¥å…¶ä»–éœ€è¦çš„å‚æ•°</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p><strong>æ³¨æ„ï¼š</strong> ä¿®é¥°ç¬¦é¡ºåºåœ¨ Compose ä¸­å§‹ç»ˆå¾ˆé‡è¦ï¼Œæˆ‘ä»¬åœ¨ hintAnchor åè®¾ç½® 4.dpï¼Œä»¥ä¾¿åœ¨æ­¤æŒ‰é’®å‘¨å›´ç•™å‡ºé¢å¤–ç©ºé—´ï¼ˆé”šç‚¹çš„å°ºå¯¸å°†æ¯”å®é™…æŒ‰é’®çš„å°ºå¯¸å¤§ 4.dpï¼‰ã€‚</p></blockquote>

<p>HintOverlay å¯ç»„åˆé¡¹éœ€è¦è¿›è¡Œä¸€äº›æ›´æ”¹æ‰èƒ½ä½¿ç”¨ HintAnchorStateä¸ºæ­¤é”šç‚¹ç»˜åˆ¶æç¤ºã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">HintOverlay</span><span class="p">(</span>
</span><span class='line'>    <span class="n">anchors</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">HintAnchorState</span><span class="p">&gt;,</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Box</span><span class="p">(</span>
</span><span class='line'>        <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span><span class='line'>            <span class="p">.</span><span class="n">fillMaxSize</span><span class="p">()</span>
</span><span class='line'>            <span class="p">.</span><span class="n">overlayBackground</span><span class="p">(</span><span class="n">anchors</span><span class="p">)</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * ä» [LocalHintOverlayBrush] æˆ– [LocalHintOverlayColor] è®¾ç½®â€œbackgroundâ€ã€‚</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="k">private</span> <span class="k">fun</span> <span class="nf">Modifier</span><span class="p">.</span><span class="n">overlayBackground</span><span class="p">(</span>
</span><span class='line'>    <span class="n">anchors</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">HintAnchorState</span><span class="p">&gt;,</span>
</span><span class='line'><span class="p">):</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">composed</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">backgroundBrush</span> <span class="p">=</span> <span class="n">LocalHintOverlayBrush</span><span class="p">.</span><span class="n">current</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">backgroundColor</span> <span class="p">=</span> <span class="n">LocalHintOverlayColor</span><span class="p">.</span><span class="n">current</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">drawWithCache</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">onDrawWithContent</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">backgroundBrush</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">drawRect</span><span class="p">(</span><span class="n">backgroundBrush</span><span class="p">)</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">drawRect</span><span class="p">(</span><span class="n">backgroundColor</span><span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">anchors</span><span class="p">().</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">anchor</span> <span class="p">-&gt;</span>
</span><span class='line'>                <span class="n">drawRect</span><span class="p">(</span>
</span><span class='line'>                    <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">Red</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">topLeft</span> <span class="p">=</span> <span class="n">anchor</span><span class="p">.</span><span class="n">offset</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">size</span> <span class="p">=</span> <span class="n">anchor</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">toSize</span><span class="p">(),</span>
</span><span class='line'>                    <span class="n">style</span> <span class="p">=</span> <span class="n">Stroke</span><span class="p">(</span><span class="n">width</span> <span class="p">=</span> <span class="m">5f</span><span class="p">),</span>
</span><span class='line'>                <span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">drawContent</span><span class="p">()</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç°åœ¨æˆ‘ä»¬åªéœ€åœ¨é”šç‚¹å‘¨å›´ç”»ä¸€ä¸ªçº¢è‰²çŸ©å½¢ï¼š</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EqvV4AHsimwvwZxajIgtXg.png" alt="Anchors" /></p>

<p>ä½†å¦‚æœæˆ‘ä»¬åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šè¿è¡Œï¼Œæˆ‘ä»¬ä¼šåœ¨ Android ä¸Šå¾—åˆ°é”™è¯¯çš„æ•°å­—ï¼š</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2wennrPOIcKArOK4MuayAQ.png" alt="With Window Insets" /></p>

<p>è¯¥é—®é¢˜ä¸ WindowInsets æœ‰å…³ã€‚è®©æˆ‘ä»¬å‡å»è¿™äº› insets æ¥ä¿®å¤å®ƒï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">fun</span> <span class="nf">Modifier</span><span class="p">.</span><span class="n">hintAnchor</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">HintAnchorState</span><span class="p">):</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">composed</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">statusBarInsets</span> <span class="p">=</span> <span class="n">WindowInsets</span><span class="p">.</span><span class="n">statusBars</span><span class="p">.</span><span class="n">getTop</span><span class="p">(</span><span class="n">LocalDensity</span><span class="p">.</span><span class="n">current</span><span class="p">).</span><span class="n">toFloat</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">onGloballyPositioned</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">state</span><span class="p">.</span><span class="n">size</span> <span class="p">=</span> <span class="n">it</span><span class="p">.</span><span class="n">size</span>
</span><span class='line'>        <span class="n">state</span><span class="p">.</span><span class="n">offset</span> <span class="p">=</span> <span class="n">it</span><span class="p">.</span><span class="n">positionInWindow</span><span class="p">()</span>
</span><span class='line'>            <span class="c1">// ä¿®å¤ Android ä¸Šçš„ WindowInsets</span>
</span><span class='line'>            <span class="p">.</span><span class="n">minus</span><span class="p">(</span><span class="n">Offset</span><span class="p">(</span><span class="n">x</span> <span class="p">=</span> <span class="m">0f</span><span class="p">,</span> <span class="n">y</span> <span class="p">=</span> <span class="n">statusBarInsets</span><span class="p">))</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LlrCLPAEgpk7q--X7i3UsA.png" alt="Fixed window insets" /></p>

<h2>3. å‰ªè¾‘å‡ºé”šç‚¹çš„å½¢çŠ¶</h2>

<p>è¦å‰ªè¾‘å½¢çŠ¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Path å’Œ PathOperation ã€‚ä¿®æ”¹ hintAnchor Modifier ä»¥æ¥å— Shape ï¼Œå®ƒå°†ç”¨äºåœ¨é”šç‚¹å‘¨å›´è®¾ç½®æ‰€éœ€çš„å½¢çŠ¶ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">fun</span> <span class="nf">Modifier</span><span class="p">.</span><span class="n">hintAnchor</span><span class="p">(</span>
</span><span class='line'>    <span class="n">state</span><span class="p">:</span> <span class="n">HintAnchorState</span><span class="p">,</span>
</span><span class='line'>    <span class="n">shape</span><span class="p">:</span> <span class="n">Shape</span> <span class="p">=</span> <span class="n">RectangleShape</span><span class="p">,</span>
</span><span class='line'><span class="p">):</span> <span class="n">Modifier</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">state</span><span class="p">.</span><span class="n">shape</span> <span class="p">=</span> <span class="n">shape</span>
</span><span class='line'>    <span class="c1">//..onGloballyPositioned</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Stable</span>
</span><span class='line'><span class="k">class</span> <span class="nc">HintAnchorState</span> <span class="k">internal</span> <span class="n">constructor</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//...å…¶ä»–çš„çŠ¶æ€æ”¾è¿™é‡Œ</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">internal</span> <span class="k">var</span> <span class="py">shape</span><span class="p">:</span> <span class="n">Shape</span> <span class="k">by</span> <span class="n">mutableStateOf</span><span class="p">(</span><span class="n">RectangleShape</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ ¹æ®æä¾›çš„å½¢çŠ¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè½®å»“ï¼Œç”¨äºå°†é”šç‚¹çš„å½¢çŠ¶ä»èƒŒæ™¯ä¸­å‰ªæ‰ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">internal</span> <span class="k">fun</span> <span class="nf">Modifier</span><span class="p">.</span><span class="n">overlayBackground</span><span class="p">(</span>
</span><span class='line'>    <span class="n">anchors</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">HintAnchorState</span><span class="p">&gt;,</span>
</span><span class='line'><span class="p">):</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">composed</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">backgroundBrush</span> <span class="p">=</span> <span class="n">LocalHintOverlayBrush</span><span class="p">.</span><span class="n">current</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">backgroundColor</span> <span class="p">=</span> <span class="n">LocalHintOverlayColor</span><span class="p">.</span><span class="n">current</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">layoutDirection</span> <span class="p">=</span> <span class="n">LocalLayoutDirection</span><span class="p">.</span><span class="n">current</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">density</span> <span class="p">=</span> <span class="n">LocalDensity</span><span class="p">.</span><span class="n">current</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">drawWithCache</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// å‡†å¤‡èƒŒæ™¯è·¯å¾„</span>
</span><span class='line'>        <span class="k">val</span> <span class="py">path</span> <span class="p">=</span> <span class="n">Path</span><span class="p">().</span><span class="n">apply</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">lineTo</span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="m">0f</span><span class="p">)</span>
</span><span class='line'>            <span class="n">lineTo</span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">)</span>
</span><span class='line'>            <span class="n">lineTo</span><span class="p">(</span><span class="m">0f</span><span class="p">,</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">)</span>
</span><span class='line'>            <span class="n">lineTo</span><span class="p">(</span><span class="m">0f</span><span class="p">,</span> <span class="m">0f</span><span class="p">)</span>
</span><span class='line'>            <span class="n">close</span><span class="p">()</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">anchors</span><span class="p">().</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">anchor</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="c1">// ä¸ºé”šç‚¹å‡†å¤‡è·¯å¾„</span>
</span><span class='line'>            <span class="k">val</span> <span class="py">anchorPath</span> <span class="p">=</span> <span class="n">Path</span><span class="p">()</span>
</span><span class='line'>            <span class="n">anchorPath</span><span class="p">.</span><span class="n">addOutline</span><span class="p">(</span>
</span><span class='line'>                <span class="n">anchor</span><span class="p">.</span><span class="n">shape</span><span class="p">.</span><span class="n">createOutline</span><span class="p">(</span>
</span><span class='line'>                    <span class="n">size</span> <span class="p">=</span> <span class="n">anchor</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">toSize</span><span class="p">(),</span>
</span><span class='line'>                    <span class="n">layoutDirection</span> <span class="p">=</span> <span class="n">layoutDirection</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">density</span> <span class="p">=</span> <span class="n">density</span><span class="p">,</span>
</span><span class='line'>                <span class="p">)</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>            <span class="n">anchorPath</span><span class="p">.</span><span class="n">translate</span><span class="p">(</span><span class="n">anchor</span><span class="p">.</span><span class="n">offset</span><span class="p">)</span>
</span><span class='line'>            <span class="n">anchorPath</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// è£å‰ªæ‰é”šç‚¹</span>
</span><span class='line'>            <span class="n">path</span><span class="p">.</span><span class="n">op</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">anchorPath</span><span class="p">,</span> <span class="n">PathOperation</span><span class="p">.</span><span class="n">Xor</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">onDrawWithContent</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// æˆ‘ä»¬ä¸ä»…ä»…ç»˜åˆ¶è·¯å¾„ï¼Œè€Œä¸æ˜¯åƒä»¥å‰ä¸€æ ·ç»˜åˆ¶çŸ©å½¢</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">backgroundBrush</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">drawPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">backgroundBrush</span><span class="p">)</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">drawPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">backgroundColor</span><span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">drawContent</span><span class="p">()</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è®©æˆ‘ä»¬ä¼ é€’ CircleShape å’Œ RoundedCornerShape æ¥çœ‹çœ‹æç¤ºç°åœ¨æ˜¯ä»€ä¹ˆæ ·å­ï¼š</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i2dWMv3Wa9at-fzGiKm8KQ.png" alt="Clip" /></p>

<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬çŸ¥é“å¦‚ä½•ç»˜åˆ¶èƒŒæ™¯è¦†ç›–å±‚ã€è®¡ç®—é”šç‚¹çš„ä½ç½®ä»¥åŠå¦‚ä½•å‰ªè£èƒŒæ™¯ã€‚</p>

<h2>4. ç»˜åˆ¶æç¤º</h2>

<p>åœ¨å®é™…ç»˜åˆ¶ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥å®šä¹‰æç¤ºéœ€è¦å‘ˆç°å“ªäº›ä¿¡æ¯ã€‚</p>

<p>ä¸ºäº†ä¸å¼ºåˆ¶åªæä¾›æ–‡æœ¬ï¼Œæˆ‘ä»¬é‡‡ç”¨slotæ–¹æ³•ã€‚é€šè¿‡å®šä¹‰slotï¼Œæˆ‘ä»¬å…è®¸ä½¿ç”¨ä»»ä½•æ‰€éœ€çš„composablesã€‚</p>

<p>æˆ‘å°†ä»‹ç»ä¸€ä¸ªæ–°çš„ç±» Hint æ¥ä¿å­˜æˆ‘ä»¬çš„Composableå†…å®¹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Stable</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Hint</span> <span class="k">internal</span> <span class="n">constructor</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">internal</span> <span class="k">var</span> <span class="py">content</span><span class="p">:</span> <span class="n">@Composable</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span> <span class="k">by</span> <span class="n">mutableStateOf</span><span class="p">({})</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">rememberHint</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="n">@Composable</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">):</span> <span class="n">Hint</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">remember</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Hint</span><span class="p">().</span><span class="n">also</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">content</span> <span class="p">=</span> <span class="n">content</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¹¶å°†æ­¤ Hint æ·»åŠ ä¸º HintAnchorState çš„ä¸€éƒ¨åˆ†ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Stable</span>
</span><span class='line'><span class="k">class</span> <span class="nc">HintAnchorState</span> <span class="k">internal</span> <span class="n">constructor</span><span class="p">(</span>
</span><span class='line'>    <span class="k">internal</span> <span class="k">val</span> <span class="py">hint</span><span class="p">:</span> <span class="n">Hint</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//...å…¶ä»–çš„çŠ¶æ€æ”¾è¿™é‡Œ</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">rememberHintAnchorState</span><span class="p">(</span><span class="n">hint</span><span class="p">:</span> <span class="n">Hint</span><span class="p">):</span> <span class="n">HintAnchorState</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">remember</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">HintAnchorState</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨ HintOverlay å†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆ â€” BoxWithConstraints ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">HintOverlay</span><span class="p">(</span>
</span><span class='line'>    <span class="n">anchors</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">HintAnchorState</span><span class="p">&gt;,</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//...</span>
</span><span class='line'>    <span class="n">BoxWithConstraints</span><span class="p">(</span>
</span><span class='line'>        <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span><span class='line'>            <span class="p">.</span><span class="n">fillMaxSize</span><span class="p">()</span>
</span><span class='line'>            <span class="p">.</span><span class="n">overlayBackground</span><span class="p">(</span><span class="n">anchors</span><span class="p">)</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">anchors</span><span class="p">().</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">anchor</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="n">Box</span><span class="p">(</span>
</span><span class='line'>                <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span><span class='line'>                    <span class="p">.</span><span class="n">graphicsLayer</span> <span class="p">{</span>
</span><span class='line'>                        <span class="n">translationX</span> <span class="p">=</span> <span class="n">anchor</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">x</span>
</span><span class='line'>                        <span class="n">translationY</span> <span class="p">=</span> <span class="n">anchor</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">y</span> <span class="p">+</span> <span class="n">anchor</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span>
</span><span class='line'>                    <span class="p">},</span>
</span><span class='line'>            <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">anchor</span><span class="p">.</span><span class="n">hint</span><span class="p">.</span><span class="n">content</span><span class="p">()</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¿®æ”¹åº”ç”¨ç¨‹åºå†…å®¹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">val</span> <span class="py">topAppBarHint</span> <span class="p">=</span> <span class="n">rememberHint</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">OutlinedButton</span><span class="p">(</span><span class="n">onClick</span> <span class="p">=</span> <span class="p">{})</span> <span class="p">{</span> <span class="n">Text</span><span class="p">(</span><span class="s">&quot;Hint for TopAppBar&quot;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">val</span> <span class="py">topAppBarActionHintAnchor</span> <span class="p">=</span> <span class="n">rememberHintAnchorState</span><span class="p">(</span><span class="n">topAppBarHint</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">val</span> <span class="py">actionHint</span> <span class="p">=</span> <span class="n">rememberHint</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Text</span><span class="p">(</span><span class="s">&quot;Hint for Action&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">val</span> <span class="py">actionHintAnchor</span> <span class="p">=</span> <span class="n">rememberHintAnchorState</span><span class="p">(</span><span class="n">actionHint</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">val</span> <span class="py">bottomNavigationHint</span> <span class="p">=</span> <span class="n">rememberHint</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Row</span><span class="p">(</span>
</span><span class='line'>        <span class="n">verticalAlignment</span> <span class="p">=</span> <span class="n">Alignment</span><span class="p">.</span><span class="n">CenterVertically</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Spacer</span><span class="p">(</span><span class="n">Modifier</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="m">32.</span><span class="n">dp</span><span class="p">).</span><span class="n">background</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Magenta</span><span class="p">,</span> <span class="n">CircleShape</span><span class="p">))</span>
</span><span class='line'>        <span class="n">Spacer</span><span class="p">(</span><span class="n">Modifier</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">))</span>
</span><span class='line'>        <span class="n">Text</span><span class="p">(</span><span class="s">&quot;Hint for BottomNavigation&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">val</span> <span class="py">bottomNavigationHintAnchor</span> <span class="p">=</span> <span class="n">rememberHintAnchorState</span><span class="p">(</span><span class="n">bottomNavigationHint</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç»“æœå¦‚ä¸‹ï¼š</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mMenE2fp2jph6YUBlxX4pA.png" alt="Hint for action" /></p>

<p>è®©æˆ‘ä»¬å¼•å…¥ä¸€ä¸ªåº”ç”¨ç¨‹åºç‰¹å®šçš„ä»£ç æ¥ç»˜åˆ¶æç¤ºèƒŒæ™¯ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">rememberHintContainer</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="n">@Composable</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">):</span> <span class="n">Hint</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">rememberHint</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Box</span><span class="p">(</span>
</span><span class='line'>            <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span><span class='line'>                <span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="n">top</span> <span class="p">=</span> <span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
</span><span class='line'>                <span class="p">.</span><span class="n">background</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Yellow</span><span class="p">,</span> <span class="n">shape</span> <span class="p">=</span> <span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">16.</span><span class="n">dp</span><span class="p">))</span>
</span><span class='line'>                <span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="m">16.</span><span class="n">dp</span><span class="p">),</span>
</span><span class='line'>        <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">CompositionLocalProvider</span><span class="p">(</span>
</span><span class='line'>                <span class="n">LocalTextStyle</span> <span class="n">provides</span> <span class="n">TextStyle</span><span class="p">(</span>
</span><span class='line'>                    <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">Black</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">fontSize</span> <span class="p">=</span> <span class="m">12.</span><span class="n">sp</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">fontWeight</span> <span class="p">=</span> <span class="n">FontWeight</span><span class="p">.</span><span class="n">Light</span><span class="p">,</span>
</span><span class='line'>                <span class="p">),</span>
</span><span class='line'>            <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">content</span><span class="p">()</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xn8pxlU_nUQvywbtqVwUtw.png" alt="Hint2" /></p>

<p>æˆ‘ä»¬é‡åˆ°äº† 2 ä¸ªé—®é¢˜ï¼š</p>

<ol>
<li>æ°´å¹³å¯¹é½ï¼Œæç¤ºåº”ä¸å…¶é”šç‚¹å±…ä¸­å¯¹é½ã€‚</li>
<li>BottomNavigation çš„æç¤ºè¶…å‡ºäº†å±å¹•èŒƒå›´ã€‚</li>
</ol>


<p>è®©æˆ‘ä»¬æ”¹ç”¨è‡ªå®šä¹‰å¸ƒå±€å¹¶ä¿®å¤è¿™äº›é—®é¢˜ã€‚</p>

<p>è¦æµ‹é‡å’Œå¸ƒå±€å¤šä¸ªå¯ç»„åˆé¡¹ï¼Œè¯·ä½¿ç”¨ Layoutã€‚æ­¤composableå…è®¸æˆ‘ä»¬æ‰‹åŠ¨æµ‹é‡å’Œå¸ƒå±€å­é¡¹ã€‚æ‰€æœ‰æ›´é«˜çº§åˆ«çš„å¸ƒå±€ï¼ˆå¦‚ Column å’Œ Rowï¼‰éƒ½æ˜¯ä½¿ç”¨ Layout å®ç°çš„ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">internal</span> <span class="k">fun</span> <span class="nf">HintsContainer</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>    <span class="n">anchors</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">HintAnchorState</span><span class="p">&gt;,</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">anchors</span> <span class="p">=</span> <span class="n">anchors</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Layout</span><span class="p">(</span>
</span><span class='line'>        <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span>
</span><span class='line'>            <span class="p">.</span><span class="n">overlayBackground</span><span class="p">(</span><span class="n">anchors</span><span class="p">),</span>
</span><span class='line'>        <span class="n">content</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">anchors</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">hint</span><span class="p">.</span><span class="n">content</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span> <span class="n">measurables</span><span class="p">,</span> <span class="n">constraints</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="c1">// æµ‹é‡æ¯ä¸€ä¸ªæç¤º</span>
</span><span class='line'>        <span class="k">val</span> <span class="py">placeables</span> <span class="p">=</span> <span class="n">measurables</span><span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">measurable</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="n">measurable</span><span class="p">.</span><span class="n">measure</span><span class="p">(</span>
</span><span class='line'>                <span class="n">constraints</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">minWidth</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">minHeight</span> <span class="p">=</span> <span class="m">0</span><span class="p">)</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// å°†å¸ƒå±€å°ºå¯¸è®¾ç½®å¾—å°½å¯èƒ½å¤§</span>
</span><span class='line'>        <span class="n">layout</span><span class="p">(</span><span class="n">constraints</span><span class="p">.</span><span class="n">maxWidth</span><span class="p">,</span> <span class="n">constraints</span><span class="p">.</span><span class="n">maxHeight</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// å°†æ¯ä¸ªæç¤ºç›¸å¯¹äºå…¶é”šç‚¹æ”¾ç½®</span>
</span><span class='line'>            <span class="n">placeables</span><span class="p">.</span><span class="n">forEachIndexed</span> <span class="p">{</span> <span class="n">index</span><span class="p">,</span> <span class="n">placeable</span> <span class="p">-&gt;</span>
</span><span class='line'>                <span class="k">val</span> <span class="py">anchor</span> <span class="p">=</span> <span class="n">anchors</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>                <span class="c1">// å°†æ­¤æç¤ºå±…ä¸­å¯¹é½</span>
</span><span class='line'>                <span class="k">val</span> <span class="py">x</span> <span class="p">=</span> <span class="p">(</span><span class="n">anchor</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">x</span><span class="p">.</span><span class="n">toInt</span><span class="p">()</span> <span class="p">-</span> <span class="p">(</span><span class="n">placeable</span><span class="p">.</span><span class="n">width</span> <span class="p">-</span> <span class="n">anchor</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">)</span> <span class="p">/</span> <span class="m">2</span><span class="p">)</span>
</span><span class='line'>                    <span class="c1">// ä¿®å¤è¶…å‡ºå±å¹•çš„åæ ‡</span>
</span><span class='line'>                    <span class="p">.</span><span class="n">coerceAtLeast</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
</span><span class='line'>                    <span class="p">.</span><span class="n">coerceAtMost</span><span class="p">(</span><span class="n">constraints</span><span class="p">.</span><span class="n">maxWidth</span> <span class="p">-</span> <span class="n">placeable</span><span class="p">.</span><span class="n">width</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>                <span class="c1">// æŠŠè¿™ä¸ªæç¤ºæ”¾åœ¨å®ƒçš„é”šç‚¹ä¸‹é¢</span>
</span><span class='line'>                <span class="k">var</span> <span class="py">y</span> <span class="p">=</span> <span class="p">(</span><span class="n">anchor</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">.</span><span class="n">toInt</span><span class="p">()</span> <span class="p">+</span> <span class="n">anchor</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">)</span>
</span><span class='line'>                    <span class="c1">// å¦‚æœè¶…å‡ºå±å¹•ï¼Œåˆ™ä¿®å¤ y åæ ‡</span>
</span><span class='line'>                    <span class="p">.</span><span class="n">coerceAtMost</span><span class="p">(</span><span class="n">constraints</span><span class="p">.</span><span class="n">maxHeight</span> <span class="p">-</span> <span class="n">placeable</span><span class="p">.</span><span class="n">height</span><span class="p">)</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="n">y</span> <span class="p">&lt;</span> <span class="n">anchor</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">y</span> <span class="p">+</span> <span class="n">anchor</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="c1">// æç¤ºä¸é”šç‚¹é‡å ï¼Œè¯·å°†æ­¤æç¤ºæ”¾åœ¨å…¶é”šç‚¹ä¸Šæ–¹</span>
</span><span class='line'>                    <span class="n">y</span> <span class="p">=</span> <span class="n">anchor</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">y</span><span class="p">.</span><span class="n">toInt</span><span class="p">()</span> <span class="p">-</span> <span class="n">placeable</span><span class="p">.</span><span class="n">height</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">placeable</span><span class="p">.</span><span class="n">placeRelative</span><span class="p">(</span><span class="n">x</span> <span class="p">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">=</span> <span class="n">y</span><span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*syuJkuAd-_BgiYfFP8bKgQ.png" alt="Hint3" /></p>

<p>å› ä¸ºæˆ‘ä»¬å…è®¸ä¼ é€’ä»»ä½•å¯ç»„åˆé¡¹ä½œä¸ºæç¤ºï¼Œæ‰€ä»¥è°ƒç”¨è€…å¯ä»¥å®Œå…¨æ§åˆ¶æç¤ºçš„å¤–è§‚ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åªä½¿ç”¨ Text ï¼Œæˆ–è€…ä½¿ç”¨åŒ…å«è®¸å¤šå­é¡¹çš„å¤æ‚ Row ã€‚</p>

<h2>5. å¦‚ä½•æ§åˆ¶æç¤ºï¼Ÿ</h2>

<p>æˆ‘ä»¬é™æ€åœ°æ·»åŠ äº†æç¤ºä»¥å°†å…¶æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ä½†çœŸæ­£äº§å“åº”ç”¨ç¨‹åºå¹¶éå¦‚æ­¤ã€‚è®©æˆ‘ä»¬å¼•å…¥ HintController æ¥æ§åˆ¶ä½•æ—¶æ˜¾ç¤ºæç¤ºã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Stable</span>
</span><span class='line'><span class="k">class</span> <span class="nc">HintController</span> <span class="k">internal</span> <span class="n">constructor</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">internal</span> <span class="k">var</span> <span class="py">hint</span> <span class="k">by</span> <span class="n">mutableStateOf</span><span class="p">&lt;</span><span class="n">HintAnchorState</span><span class="p">?&gt;(</span><span class="k">null</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">show</span><span class="p">(</span><span class="n">hint</span><span class="p">:</span> <span class="n">HintAnchorState</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="n">hint</span> <span class="p">=</span> <span class="n">hint</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">rememberHintController</span><span class="p">():</span> <span class="n">HintController</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">controller</span> <span class="p">=</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">HintController</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">controller</span><span class="p">.</span><span class="n">hint</span><span class="o">?.</span><span class="n">let</span> <span class="p">{</span> <span class="n">hint</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="n">HintOverlay</span><span class="p">(</span><span class="n">anchor</span> <span class="p">=</span> <span class="n">hint</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">controller</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¿®æ”¹åº”ç”¨ç¨‹åºå†…å®¹ï¼Œä»¥ä¾¿åœ¨æˆ‘ä»¬ç‚¹å‡»é”šç‚¹æ—¶æ˜¾ç¤ºæç¤ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">val</span> <span class="py">hintController</span> <span class="p">=</span> <span class="n">rememberHintController</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">IconButton</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span><span class='line'>        <span class="p">.</span><span class="n">hintAnchor</span><span class="p">(</span><span class="n">topAppBarActionHintAnchor</span><span class="p">,</span> <span class="n">CircleShape</span><span class="p">),</span>
</span><span class='line'>    <span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">hintController</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="n">topAppBarActionHintAnchor</span><span class="p">)</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">BottomNavigationItem</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span><span class='line'>        <span class="p">.</span><span class="n">hintAnchor</span><span class="p">(</span>
</span><span class='line'>            <span class="n">bottomNavigationHintAnchor</span><span class="p">,</span>
</span><span class='line'>            <span class="n">shape</span> <span class="p">=</span> <span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">50f</span><span class="p">),</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>    <span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">hintController</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="n">bottomNavigationHintAnchor</span><span class="p">)</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">Button</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span><span class='line'>        <span class="p">.</span><span class="n">hintAnchor</span><span class="p">(</span><span class="n">actionHintAnchor</span><span class="p">,</span> <span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">16.</span><span class="n">dp</span><span class="p">))</span>
</span><span class='line'>        <span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="m">4.</span><span class="n">dp</span><span class="p">),</span>
</span><span class='line'>    <span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">hintController</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="n">actionHintAnchor</span><span class="p">)</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>æ³¨æ„ï¼šæˆ‘ä»¬ä¸å†éœ€è¦æ˜¾ç¤ºçš„ HintOverlay ï¼Œå®ƒç°åœ¨å˜å¾—å†…ç½®äº†ã€‚</p></blockquote>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jIOTXOSnHVeL_jjyEx1gdg.png" alt="Control" /></p>

<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥é€ä¸€æ˜¾ç¤ºæç¤ºï¼Œä½†è¿˜æœ‰ä¸¤ä¸ªéƒ¨åˆ†ç¼ºå¤±ï¼šå¦‚ä½•å…³é—­æç¤ºï¼Œä»¥åŠå¦‚ä½•è¦†ç›–è¦†ç›–é¢œè‰²ã€‚</p>

<p>å¯¹æç¤ºæ§åˆ¶å™¨è¿›è¡Œæ›´æ”¹ä»¥å…è®¸ä¼ é€’è¦†ç›–é¢œè‰²ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">rememberHintController</span><span class="p">(</span><span class="n">overlay</span><span class="p">:</span> <span class="n">Brush</span><span class="p">):</span> <span class="n">HintController</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">rememberHintController</span><span class="p">(</span><span class="n">overlay</span> <span class="p">=</span> <span class="n">LocalHintOverlayBrush</span> <span class="n">provides</span> <span class="n">overlay</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">rememberHintController</span><span class="p">(</span><span class="n">overlay</span><span class="p">:</span> <span class="n">Color</span> <span class="p">=</span> <span class="n">HintOverlayColorDefault</span><span class="p">):</span> <span class="n">HintController</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">rememberHintController</span><span class="p">(</span><span class="n">overlay</span> <span class="p">=</span> <span class="n">LocalHintOverlayColor</span> <span class="n">provides</span> <span class="n">overlay</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">private</span> <span class="k">fun</span> <span class="nf">rememberHintController</span><span class="p">(</span><span class="n">overlay</span><span class="p">:</span> <span class="n">ProvidedValue</span><span class="p">&lt;*&gt;):</span> <span class="n">HintController</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">controller</span> <span class="p">=</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">HintController</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">controller</span><span class="p">.</span><span class="n">hint</span><span class="o">?.</span><span class="n">let</span> <span class="p">{</span> <span class="n">hint</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="n">CompositionLocalProvider</span><span class="p">(</span><span class="n">overlay</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">HintOverlay</span><span class="p">(</span><span class="n">anchor</span> <span class="p">=</span> <span class="n">hint</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">controller</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸ºäº†æ¶ˆé™¤æˆ‘ä»¬çš„æç¤ºï¼Œè®©æˆ‘ä»¬å¼•å…¥ä»¥ä¸‹å˜åŒ–ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Stable</span>
</span><span class='line'><span class="k">class</span> <span class="nc">HintController</span> <span class="k">internal</span> <span class="n">constructor</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">internal</span> <span class="k">var</span> <span class="py">hint</span> <span class="k">by</span> <span class="n">mutableStateOf</span><span class="p">&lt;</span><span class="n">HintAnchorState</span><span class="p">?&gt;(</span><span class="k">null</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">show</span><span class="p">(</span><span class="n">hint</span><span class="p">:</span> <span class="n">HintAnchorState</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="n">hint</span> <span class="p">=</span> <span class="n">hint</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">dismiss</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">hint</span> <span class="p">=</span> <span class="k">null</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬ä½¿ç”¨ Popup ä½œä¸ºè¦†ç›–å±‚çš„å®¹å™¨ï¼Œå¦‚æœç”¨æˆ·ç‚¹å‡» Android ä¸Šçš„è¿”å›æŒ‰é’®(BACK)ï¼ŒPopup å°±ä¼šè¢«å…³é—­ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">internal</span> <span class="k">fun</span> <span class="nf">HintOverlay</span><span class="p">(</span>
</span><span class='line'>    <span class="n">anchor</span><span class="p">:</span> <span class="n">HintAnchorState</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onDismiss</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Popup</span><span class="p">(</span>
</span><span class='line'>        <span class="n">onDismissRequest</span> <span class="p">=</span> <span class="n">onDismiss</span><span class="p">,</span>
</span><span class='line'>        <span class="c1">// è®¾ç½®å¯èšç„¦ä»¥å¤„ç†æŒ‰å‹backäº‹ä»¶</span>
</span><span class='line'>        <span class="n">properties</span> <span class="p">=</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">PopupProperties</span><span class="p">(</span><span class="n">focusable</span> <span class="p">=</span> <span class="k">true</span><span class="p">)</span> <span class="p">},</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//...åœ¨è¿™é‡Œç”»å‡ºæˆ‘ä»¬çš„æç¤º</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">internal</span> <span class="k">fun</span> <span class="nf">HintsContainer</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>    <span class="n">anchor</span><span class="p">:</span> <span class="n">HintAnchorState</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onDismiss</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Layout</span><span class="p">(</span>
</span><span class='line'>        <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span>
</span><span class='line'>            <span class="p">.</span><span class="n">overlayBackground</span><span class="p">(</span><span class="n">anchor</span><span class="p">)</span>
</span><span class='line'>            <span class="p">.</span><span class="n">clickable</span><span class="p">(</span>
</span><span class='line'>                <span class="n">interactionSource</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
</span><span class='line'>                <span class="c1">// ç¦ç”¨ripple</span>
</span><span class='line'>                <span class="n">indication</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
</span><span class='line'>                <span class="n">onClick</span> <span class="p">=</span> <span class="n">onDismiss</span><span class="p">,</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç»“æœæ¼”ç¤ºè§†é¢‘ <a href="https://youtu.be/eo49PKlhO5Y">https://youtu.be/eo49PKlhO5Y</a></p>

<p>ç°åœ¨ï¼ŒHintController å…è®¸æˆ‘ä»¬æŒ‰æ—¶é—´æ˜¾ç¤ºä¸€ä¸ªæç¤ºï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³æŒ‰é¡ºåºæ˜¾ç¤ºå¤šä¸ªæç¤ºï¼Œåˆ™æ²¡æœ‰å®é™…çš„é˜Ÿåˆ—ã€‚</p>

<p>å¯ä»¥æ‰©å±• HintController å¹¶æ·»åŠ æš‚åœä¿®é¥°ç¬¦ä»¥çŸ¥é“æç¤ºçš„æ˜¾ç¤ºæ—¶é—´ï¼ˆä¾‹å¦‚ï¼Œåœ¨æ˜¾ç¤ºæç¤ºåç«‹å³æ‰§è¡ŒæŸé¡¹æ“ä½œï¼‰ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Stable</span>
</span><span class='line'><span class="k">class</span> <span class="nc">HintController</span> <span class="k">internal</span> <span class="n">constructor</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="k">var</span> <span class="py">queue</span> <span class="p">=</span> <span class="n">mutableStateListOf</span><span class="p">&lt;</span><span class="n">HintAnchorState</span><span class="p">&gt;()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">internal</span> <span class="k">val</span> <span class="py">hint</span><span class="p">:</span> <span class="n">HintAnchorState</span><span class="p">?</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">queue</span><span class="p">.</span><span class="n">firstOrNull</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="k">val</span> <span class="py">pendingRequests</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="n">HintAnchorState</span><span class="p">,</span> <span class="n">Continuation</span><span class="p">&lt;</span><span class="n">Unit</span><span class="p">&gt;&gt;()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">suspend</span> <span class="k">fun</span> <span class="nf">show</span><span class="p">(</span><span class="n">hint</span><span class="p">:</span> <span class="n">HintAnchorState</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">suspendCoroutine</span> <span class="p">{</span> <span class="n">continuation</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="n">pendingRequests</span><span class="p">[</span><span class="n">hint</span><span class="p">]</span> <span class="p">=</span> <span class="n">continuation</span>
</span><span class='line'>            <span class="n">queue</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">suspend</span> <span class="k">fun</span> <span class="nf">show</span><span class="p">(</span><span class="k">vararg</span> <span class="n">hint</span><span class="p">:</span> <span class="n">HintAnchorState</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">show</span><span class="p">(</span><span class="n">hint</span><span class="p">.</span><span class="n">toList</span><span class="p">())</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">suspend</span> <span class="k">fun</span> <span class="nf">show</span><span class="p">(</span><span class="n">hints</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">HintAnchorState</span><span class="p">&gt;)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">suspendCoroutine</span> <span class="p">{</span> <span class="n">continuation</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="n">pendingRequests</span><span class="p">[</span><span class="n">hints</span><span class="p">.</span><span class="n">last</span><span class="p">()]</span> <span class="p">=</span> <span class="n">continuation</span>
</span><span class='line'>            <span class="n">queue</span><span class="p">.</span><span class="n">addAll</span><span class="p">(</span><span class="n">hints</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">internal</span> <span class="k">fun</span> <span class="nf">onDismissed</span><span class="p">(</span><span class="n">hint</span><span class="p">:</span> <span class="n">HintAnchorState</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">pendingRequests</span><span class="p">[</span><span class="n">hint</span><span class="p">]</span><span class="o">?.</span><span class="n">let</span> <span class="p">{</span> <span class="n">continuation</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="n">continuation</span><span class="p">.</span><span class="n">resume</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span>
</span><span class='line'>            <span class="n">pendingRequests</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">queue</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">dismiss</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">pendingRequests</span><span class="p">.</span><span class="n">values</span>
</span><span class='line'>            <span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">continuation</span> <span class="p">-&gt;</span>
</span><span class='line'>                <span class="n">continuation</span><span class="p">.</span><span class="n">resumeWithException</span><span class="p">(</span><span class="n">CancellationException</span><span class="p">(</span><span class="s">&quot;Hint was dismissed&quot;</span><span class="p">))</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="n">pendingRequests</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
</span><span class='line'>        <span class="n">queue</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç°åœ¨ä¸ºäº†åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨æ˜¾ç¤ºæç¤ºï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª CoroutineScope ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">val</span> <span class="py">coroutineScope</span> <span class="p">=</span> <span class="n">rememberCoroutineScope</span><span class="p">()</span>
</span><span class='line'><span class="k">val</span> <span class="py">hintController</span> <span class="p">=</span> <span class="n">rememberHintController</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ç°åœ¨æˆ‘ä»¬å¯ä»¥ä»æç¤ºæœ¬èº«ä¸­å¿½ç•¥æ‰€æœ‰å¾…å¤„ç†çš„æç¤º</span>
</span><span class='line'><span class="k">val</span> <span class="py">topAppBarHint</span> <span class="p">=</span> <span class="n">rememberHintContainer</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">OutlinedButton</span><span class="p">(</span>
</span><span class='line'>        <span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">hintController</span><span class="p">.</span><span class="n">dismiss</span><span class="p">()</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span> <span class="n">Text</span><span class="p">(</span><span class="s">&quot;Hint for TopAppBar&quot;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// æ˜¾ç¤º 1 æ¡æç¤º</span>
</span><span class='line'><span class="n">BottomNavigationItem</span><span class="p">(</span>
</span><span class='line'>    <span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">coroutineScope</span><span class="p">.</span><span class="n">launch</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">hintController</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="n">bottomNavigationHintAnchor</span><span class="p">)</span>
</span><span class='line'>            <span class="n">scaffoldState</span><span class="p">.</span><span class="n">snackbarHostState</span><span class="p">.</span><span class="n">showSnackbar</span><span class="p">(</span><span class="s">&quot;One hint was shown&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// è¿ç»­æ˜¾ç¤ºå¤šä¸ªæç¤º</span>
</span><span class='line'><span class="n">Button</span><span class="p">(</span>
</span><span class='line'>    <span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">coroutineScope</span><span class="p">.</span><span class="n">launch</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">hintController</span><span class="p">.</span><span class="n">show</span><span class="p">(</span>
</span><span class='line'>                <span class="n">topAppBarActionHintAnchor</span><span class="p">,</span>
</span><span class='line'>                <span class="n">actionHintAnchor</span><span class="p">,</span>
</span><span class='line'>                <span class="n">bottomNavigationHintAnchor</span><span class="p">,</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>            <span class="n">scaffoldState</span><span class="p">.</span><span class="n">snackbarHostState</span><span class="p">.</span><span class="n">showSnackbar</span><span class="p">(</span><span class="s">&quot;Many hints were shown&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p><strong>æ³¨æ„ï¼š</strong> å¦‚æœæˆ‘ä»¬é€šè¿‡è°ƒç”¨ hintController.dismiss() æ¥å…³é—­æç¤ºï¼Œåˆ™ hintController.show ä¹‹åçš„ä»£ç å°†ä¸ä¼šè¢«è°ƒç”¨ã€‚</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">coroutineScope</span><span class="p">.</span><span class="n">launch</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">hintController</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="n">topAppBarActionHintAnchor</span><span class="p">)</span>
</span><span class='line'>    <span class="c1">// å¦‚æœé€šè¿‡è°ƒç”¨ hintController.dismiss å…³é—­äº†ä¹‹å‰çš„æç¤ºï¼Œåˆ™ä¸ä¼šæ˜¾ç¤º Snackbar</span>
</span><span class='line'>    <span class="n">scaffoldState</span><span class="p">.</span><span class="n">snackbarHostState</span><span class="p">.</span><span class="n">showSnackbar</span><span class="p">(</span><span class="s">&quot;One hint was shown&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æœ€ç»ˆç»“æœå¦‚è¿™ä¸ªè§†é¢‘æ¼”ç¤º <a href="https://youtu.be/tyZUNJLEVxQ">https://youtu.be/tyZUNJLEVxQ</a>ï¼šæˆ‘ä»¬å¯ä»¥æ˜¾ç¤ºå•ä¸ªæç¤ºï¼Œä¹Ÿå¯ä»¥æ˜¾ç¤ºæç¤ºåˆ—è¡¨ã€‚</p>

<p>ç”±äºè¯¥é¡¹ç›®ä½¿ç”¨ Compose Multiplatformï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹ä¸åŒçš„ç›®æ ‡è¿è¡Œè¯¥åº”ç”¨ç¨‹åºï¼š</p>

<ul>
<li>Androidç»“æœæ¼”ç¤º <a href="https://youtu.be/BVBCipnbIUc">https://youtu.be/BVBCipnbIUc</a></li>
<li>iOSç»“æœæ¼”ç¤º <a href="https://youtu.be/Z1uasddgqwo">https://youtu.be/Z1uasddgqwo</a></li>
</ul>


<h2>æ€»ç»“</h2>

<p>Compose å’Œ Kotlin Multiplatform æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç»„åˆï¼Œå®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨ Kotlin æ¥å®ç° UI å’Œä¸šåŠ¡é€»è¾‘ã€‚CMP åº“ä»…ä¸Jetpack Compose Android é¡¹ç›®å®Œå…¨å…¼å®¹ã€‚</p>

<p>å¯ä»¥åœ¨ GitHub ä¸ŠæŸ¥çœ‹æˆ‘çš„repoï¼š<a href="https://github.com/vitoksmile/ComposeHints">https://github.com/vitoksmile/ComposeHints</a>ã€‚</p>

<p>æ„Ÿè°¢ä½ çš„é˜…è¯»ï¼ŒæœŸå¾…åœ¨ GitHub ä¸Šè·å¾—ä½ çš„Star :)ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å®æˆ˜ï¼šåœ¨Composeä¸­ç»˜åˆ¶ç¡çœ æ—¶é—´çº¿]]></title>
    <link href="https://alexhilton.github.io/blog/2025/03/26/draw-sleep-timeline-graph-in-compose/"/>
    <updated>2025-03-26T21:41:40+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/03/26/draw-sleep-timeline-graph-in-compose</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ª<a href="https://proandroiddev.com/sleep-timeline-graph-in-compose-15c99f9a4af0">Draw sleep timeline graph in Compose</a>ï¼ŒåŸæ–‡ç”±<a href="https://medium.com/@vitoksmile">Viktor Mykhailiv</a>å‘å¸ƒäº2025å¹´1æœˆ31æ—¥ã€‚</p></blockquote>

<p><strong>è¯‘è€…æŒ‰ï¼š</strong> æˆ‘ä»¬åœ¨å‰é¢çš„<a href="https://juejin.cn/column/7367555191338467337">é™Composeåå…«æŒ</a>ç³»åˆ—ä¸­è®²è§£è¿‡åœ¨Composeè‡ªå®šä¹‰ç»˜åˆ¶çš„æ–¹æ³•ï¼Œå¯ä»¥å…ˆæ¸©ä¹ ä¸€ä¸‹<a href="https://juejin.cn/post/7381826917086920742">ä¸Šä¸€ç¯‡æ–‡ç« </a>ã€‚è¿™ç¯‡æ–‡ç« æ˜¯æå‡è‡ªå®šä¹‰ç»˜åˆ¶æŠ€å·§çš„ä¸€ä¸ªéå¸¸å¥½çš„å®æˆ˜ä¾‹å­ã€‚</p>

<p><a href="https://alexhilton.github.io/blog/2025/03/26/draw-sleep-timeline-graph-in-compose/"><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OUAsgvNoNx9VpSk9Eyqgzg.jpeg" title="auto auto" ></a></p>

<!-- more -->


<p>å½“å†…ç½®ç»„ä»¶ä¸èƒ½å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„åº”ç”¨éœ€æ±‚æ—¶ï¼Œè‡ªå®šä¹‰ç»˜å›¾éå¸¸æœ‰ç”¨ã€‚æœ¬æ–‡æä¾›äº†åˆ›å»ºè‡ªå®šä¹‰ç¡çœ æ—¶é—´çº¿å›¾è¡¨çš„æŒ‡å—ï¼Œç±»ä¼¼äºä½ åœ¨<a href="https://play.google.com/store/apps/details?id=com.fitbit.FitbitMobile">Fitbit åº”ç”¨</a>ä¸­æ‰¾åˆ°çš„å›¾è¡¨ã€‚</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cA9uPgAG29Gu2AhajArq9w.jpeg" alt="Screenshots from Fitbit Android app" /></p>

<h2>åœ¨ Compose ä¸­å¦‚ä½•ç»˜å›¾ï¼Ÿ</h2>

<p>è¦å¼€å§‹åœ¨ Compose ä¸­ç»˜å›¾ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç»˜å›¾Modifieræˆ– Canvaså¯ç»„åˆå‡½æ•°ï¼Œè¿™ä¸ºæˆ‘ä»¬æä¾›äº† DrawScope â€” ä¸€ç§å£°æ˜å¼ã€æ— çŠ¶æ€çš„APIï¼Œç”¨äºç»˜åˆ¶å½¢çŠ¶å’Œè·¯å¾„ï¼Œè€Œæ— éœ€æ¶ˆè´¹è€…ç»´æŠ¤åº•å±‚çŠ¶æ€ã€‚DrawScopeå®ç°è¿˜æä¾›äº†å°ºå¯¸ä¿¡æ¯ï¼Œå¹¶ä¸”å˜å¹»æ˜¯ç›¸å¯¹äºæœ¬åœ°å¹³ç§»å®Œæˆçš„ã€‚</p>

<blockquote><p><strong>æ³¨æ„ï¼š</strong> Jetpack Composeï¼ˆä»…é™ Androidï¼‰å’Œ Compose Multiplatformï¼ˆæ¡Œé¢ã€Androidã€iOSã€Webï¼‰å…·æœ‰ç±»ä¼¼çš„ç»˜å›¾ APIã€‚ä¸‹é¢çš„å±å¹•æˆªå›¾æ˜¯åœ¨æ¡Œé¢ï¼ˆmacOSï¼‰ä¸Šåˆ¶ä½œçš„ï¼Œä½†æ‰€æœ‰å¹³å°ä¸Šçš„ç»“æœéƒ½æ˜¯ç›¸åŒçš„ï¼ˆæŸ¥çœ‹æœ€åä¸€å¼ å±å¹•æˆªå›¾ï¼‰ã€‚</p></blockquote>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">Canvas</span><span class="p">(</span><span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">fillMaxSize</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">rotate</span><span class="p">(</span><span class="n">degrees</span> <span class="p">=</span> <span class="m">45F</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">drawRect</span><span class="p">(</span>
</span><span class='line'>            <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">Gray</span><span class="p">,</span>
</span><span class='line'>            <span class="n">topLeft</span> <span class="p">=</span> <span class="n">Offset</span><span class="p">(</span><span class="n">x</span> <span class="p">=</span> <span class="n">size</span><span class="p">.</span><span class="n">width</span> <span class="p">/</span> <span class="m">3F</span><span class="p">,</span> <span class="n">y</span> <span class="p">=</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="p">/</span> <span class="m">3F</span><span class="p">),</span>
</span><span class='line'>            <span class="n">size</span> <span class="p">=</span> <span class="n">size</span> <span class="p">/</span> <span class="m">3F</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_qkChFEn25kC_cfgiRXgKg.png" alt="Composeä¸­çš„è‡ªå®šä¹‰ç»˜åˆ¶" /></p>

<h2>å•¥æ˜¯ç¡çœ æ—¶é—´è¡¨ï¼Ÿ</h2>

<p>æˆ‘ä»¬å¯ä»¥åœ¨ Health Connect ä¸­è¯»å–æˆ–å†™å…¥ç¡çœ æ•°æ®ã€‚ç¡çœ æ•°æ®æ˜¾ç¤ºä¸ºä¼šè¯ï¼Œå¯åˆ†ä¸ºä»¥ä¸‹ç¡çœ é˜¶æ®µï¼š</p>

<ul>
<li>æ¸…é†’ï¼šç”¨æˆ·åœ¨ç¡çœ å‘¨æœŸå†…æ¸…é†’ã€‚</li>
<li>æµ…ç¡çœ ï¼šç”¨æˆ·å¤„äºæµ…ç¡çœ å‘¨æœŸã€‚</li>
<li>æ·±ç¡çœ ï¼šç”¨æˆ·å¤„äºæ·±ç¡çœ å‘¨æœŸã€‚</li>
<li>REMï¼šç”¨æˆ·å¤„äº REM ç¡çœ å‘¨æœŸã€‚</li>
</ul>


<p>è¿™äº›å€¼è¡¨ç¤ºç”¨æˆ·åœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…ç»å†çš„ç¡çœ ç±»å‹ã€‚SleepSessionRecord æ•°æ®ç±»å‹åŒ…å«ä¸¤éƒ¨åˆ†ï¼š</p>

<ol>
<li>æ•´ä¸ªç¡çœ è¿‡ç¨‹ï¼Œæ¶µç›–æ•´ä¸ªç¡çœ æ—¶é—´ã€‚</li>
<li>ç¡çœ è¿‡ç¨‹ä¸­çš„å„ä¸ªé˜¶æ®µï¼Œä¾‹å¦‚æµ…ç¡çœ æˆ–æ·±ç¡çœ ã€‚</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">val</span> <span class="py">record</span> <span class="p">=</span> <span class="n">remember</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">SleepSessionRecord</span><span class="p">(</span>
</span><span class='line'>        <span class="n">startTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-28T21:10:10Z&quot;</span><span class="p">),</span>
</span><span class='line'>        <span class="n">endTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-29T07:32:13Z&quot;</span><span class="p">),</span>
</span><span class='line'>        <span class="n">startZoneOffset</span> <span class="p">=</span> <span class="n">UtcOffset</span><span class="p">(</span><span class="n">hours</span> <span class="p">=</span> <span class="m">2</span><span class="p">),</span>
</span><span class='line'>        <span class="n">endZoneOffset</span> <span class="p">=</span> <span class="n">UtcOffset</span><span class="p">(</span><span class="n">hours</span> <span class="p">=</span> <span class="m">2</span><span class="p">),</span>
</span><span class='line'>        <span class="n">stages</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span>
</span><span class='line'>            <span class="n">SleepSessionRecord</span><span class="p">.</span><span class="n">Stage</span><span class="p">(</span>
</span><span class='line'>                <span class="n">startTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-28T21:10:10Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="n">endTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-28T23:15:13Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="k">type</span> <span class="p">=</span> <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">Light</span><span class="p">,</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>            <span class="n">SleepSessionRecord</span><span class="p">.</span><span class="n">Stage</span><span class="p">(</span>
</span><span class='line'>                <span class="n">startTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-28T23:15:13Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="n">endTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-29T01:56:32Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="k">type</span> <span class="p">=</span> <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">Deep</span><span class="p">,</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>            <span class="n">SleepSessionRecord</span><span class="p">.</span><span class="n">Stage</span><span class="p">(</span>
</span><span class='line'>                <span class="n">startTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-29T01:56:13Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="n">endTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-29T03:16:22Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="k">type</span> <span class="p">=</span> <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">Light</span><span class="p">,</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>            <span class="n">SleepSessionRecord</span><span class="p">.</span><span class="n">Stage</span><span class="p">(</span>
</span><span class='line'>                <span class="n">startTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-29T03:16:22Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="n">endTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-29T04:32:13Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="k">type</span> <span class="p">=</span> <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">REM</span><span class="p">,</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>            <span class="n">SleepSessionRecord</span><span class="p">.</span><span class="n">Stage</span><span class="p">(</span>
</span><span class='line'>                <span class="n">startTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-29T04:32:13Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="n">endTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-29T05:12:56Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="k">type</span> <span class="p">=</span> <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">Deep</span><span class="p">,</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>            <span class="n">SleepSessionRecord</span><span class="p">.</span><span class="n">Stage</span><span class="p">(</span>
</span><span class='line'>                <span class="n">startTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-29T05:12:56Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="n">endTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-29T07:32:13Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="k">type</span> <span class="p">=</span> <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">Light</span><span class="p">,</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>            <span class="n">SleepSessionRecord</span><span class="p">.</span><span class="n">Stage</span><span class="p">(</span>
</span><span class='line'>                <span class="n">startTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-28T22:11:56Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="n">endTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-28T22:17:13Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="k">type</span> <span class="p">=</span> <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">Awake</span><span class="p">,</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>            <span class="n">SleepSessionRecord</span><span class="p">.</span><span class="n">Stage</span><span class="p">(</span>
</span><span class='line'>                <span class="n">startTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-28T22:39:56Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="n">endTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-28T22:51:13Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="k">type</span> <span class="p">=</span> <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">Awake</span><span class="p">,</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>            <span class="n">SleepSessionRecord</span><span class="p">.</span><span class="n">Stage</span><span class="p">(</span>
</span><span class='line'>                <span class="n">startTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-29T04:47:56Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="n">endTime</span> <span class="p">=</span> <span class="n">Instant</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;2025-01-29T04:54:13Z&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="k">type</span> <span class="p">=</span> <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">Awake</span><span class="p">,</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>        <span class="p">),</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>éœ€è¦ä¸€ç‚¹æ•°å­¦è®¡ç®—</h2>

<p>åœ¨ç¡çœ æœŸé—´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸åŒæ—¶åˆ»å¤šæ¬¡å¤„äºåŒä¸€é˜¶æ®µã€‚æˆ‘ä»¬éœ€è¦è®¡ç®—ç›¸å¯¹äºç¡çœ çš„èµ·ç‚¹å’Œç»ˆç‚¹ã€‚</p>

<p>è¦åœ¨ Compose ä¸­ç»˜åˆ¶çŸ©å½¢ï¼Œæˆ‘ä»¬éœ€è¦ topOffset å’Œ sizeã€‚</p>

<p><img src="" alt="Math" /></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">private</span> <span class="k">fun</span> <span class="nf">calculate</span><span class="p">(</span>
</span><span class='line'>    <span class="n">canvasSize</span><span class="p">:</span> <span class="n">Size</span><span class="p">,</span>
</span><span class='line'>    <span class="n">recordStartTime</span><span class="p">:</span> <span class="n">Instant</span><span class="p">,</span>
</span><span class='line'>    <span class="n">recordEndTime</span><span class="p">:</span> <span class="n">Instant</span><span class="p">,</span>
</span><span class='line'>    <span class="n">stages</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">SleepSessionRecord</span><span class="p">.</span><span class="n">Stage</span><span class="p">&gt;,</span>
</span><span class='line'><span class="p">):</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">SleepStageDrawPoint</span><span class="p">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">totalDuration</span> <span class="p">=</span> <span class="p">(</span><span class="n">recordEndTime</span> <span class="p">-</span> <span class="n">recordStartTime</span><span class="p">).</span><span class="n">inWholeSeconds</span><span class="p">.</span><span class="n">toFloat</span><span class="p">()</span>
</span><span class='line'>        <span class="p">.</span><span class="n">coerceAtLeast</span><span class="p">(</span><span class="m">1f</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">stages</span><span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">stage</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="k">val</span> <span class="py">stageOffset</span> <span class="p">=</span>
</span><span class='line'>            <span class="p">(</span><span class="n">stage</span><span class="p">.</span><span class="n">startTime</span> <span class="p">-</span> <span class="n">recordStartTime</span><span class="p">).</span><span class="n">inWholeSeconds</span> <span class="p">/</span> <span class="n">totalDuration</span>
</span><span class='line'>        <span class="k">val</span> <span class="py">stageDuration</span> <span class="p">=</span>
</span><span class='line'>            <span class="p">(</span><span class="n">stage</span><span class="p">.</span><span class="n">endTime</span> <span class="p">-</span> <span class="n">stage</span><span class="p">.</span><span class="n">startTime</span><span class="p">).</span><span class="n">inWholeSeconds</span><span class="p">.</span><span class="n">toFloat</span><span class="p">()</span> <span class="p">/</span> <span class="n">totalDuration</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">SleepStageDrawPoint</span><span class="p">(</span>
</span><span class='line'>            <span class="n">topLeft</span> <span class="p">=</span> <span class="n">Offset</span><span class="p">(</span><span class="n">x</span> <span class="p">=</span> <span class="n">canvasSize</span><span class="p">.</span><span class="n">width</span> <span class="p">*</span> <span class="n">stageOffset</span><span class="p">,</span> <span class="n">y</span> <span class="p">=</span> <span class="m">0f</span><span class="p">),</span>
</span><span class='line'>            <span class="n">size</span> <span class="p">=</span> <span class="n">canvasSize</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">width</span> <span class="p">=</span> <span class="n">canvasSize</span><span class="p">.</span><span class="n">width</span> <span class="p">*</span> <span class="n">stageDuration</span><span class="p">),</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ç»˜åˆ¶</h2>

<p>è®©æˆ‘ä»¬æ„å»ºè‡ªå®šä¹‰ Canvas æ¥ç»˜åˆ¶ç¡çœ è¿‡ç¨‹çš„ä¸€ä¸ªé˜¶æ®µï¼Œä¾‹å¦‚æ·±åº¦ç¡çœ ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">SleepSessionCanvas</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>    <span class="n">record</span><span class="p">:</span> <span class="n">SleepSessionRecord</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Spacer</span><span class="p">(</span>
</span><span class='line'>        <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">.</span><span class="n">drawWithCache</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">val</span> <span class="py">points</span> <span class="p">=</span> <span class="n">calculate</span><span class="p">(</span>
</span><span class='line'>                <span class="n">canvasSize</span> <span class="p">=</span> <span class="n">size</span><span class="p">,</span>
</span><span class='line'>                <span class="n">recordStartTime</span> <span class="p">=</span> <span class="n">record</span><span class="p">.</span><span class="n">startTime</span><span class="p">,</span>
</span><span class='line'>                <span class="n">recordEndTime</span> <span class="p">=</span> <span class="n">record</span><span class="p">.</span><span class="n">endTime</span><span class="p">,</span>
</span><span class='line'>                <span class="n">stages</span> <span class="p">=</span> <span class="n">record</span><span class="p">.</span><span class="n">stages</span><span class="p">.</span><span class="n">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="k">type</span> <span class="p">==</span> <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">Deep</span> <span class="p">},</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">onDrawWithContent</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1">// ç”»èƒŒæ™¯</span>
</span><span class='line'>                <span class="n">drawRoundRect</span><span class="p">(</span>
</span><span class='line'>                    <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">LightGray</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">topLeft</span> <span class="p">=</span> <span class="n">Offset</span><span class="p">(</span><span class="n">x</span> <span class="p">=</span> <span class="m">0f</span><span class="p">,</span> <span class="n">y</span> <span class="p">=</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="p">/</span> <span class="m">4f</span><span class="p">),</span>
</span><span class='line'>                    <span class="n">size</span> <span class="p">=</span> <span class="n">size</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">height</span> <span class="p">=</span> <span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="p">/</span> <span class="m">2f</span><span class="p">),</span>
</span><span class='line'>                    <span class="n">cornerRadius</span> <span class="p">=</span> <span class="n">CornerRadius</span><span class="p">(</span><span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="p">/</span> <span class="m">2f</span><span class="p">),</span>
</span><span class='line'>                <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>                <span class="c1">// ç»˜åˆ¶é˜¶æ®µç‚¹</span>
</span><span class='line'>                <span class="n">points</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">point</span> <span class="p">-&gt;</span>
</span><span class='line'>                    <span class="n">drawRect</span><span class="p">(</span>
</span><span class='line'>                        <span class="n">topLeft</span> <span class="p">=</span> <span class="n">point</span><span class="p">.</span><span class="n">topLeft</span><span class="p">,</span>
</span><span class='line'>                        <span class="n">size</span> <span class="p">=</span> <span class="n">point</span><span class="p">.</span><span class="n">size</span><span class="p">,</span>
</span><span class='line'>                        <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">(</span><span class="m">0</span><span class="n">xFF673AB7</span><span class="p">),</span>
</span><span class='line'>                    <span class="p">)</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¹‹å‰å®šä¹‰çš„ç¡çœ ä¼šè¯è¿è¡Œé¡¹ç›®ï¼Œæˆ‘ä»¬å°†çœ‹åˆ° 3 ä¸ªçŸ©å½¢ï¼š1 ä¸ªç°è‰²çŸ©å½¢è¡¨ç¤ºèƒŒæ™¯ï¼Œ2 ä¸ªç´«è‰²çŸ©å½¢è¡¨ç¤ºæ·±åº¦ç¡çœ é˜¶æ®µã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">SleepSessionCanvas</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span><span class='line'>        <span class="p">.</span><span class="n">fillMaxWidth</span><span class="p">()</span>
</span><span class='line'>        <span class="p">.</span><span class="n">height</span><span class="p">(</span><span class="m">320.</span><span class="n">dp</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="m">16.</span><span class="n">dp</span><span class="p">),</span>
</span><span class='line'>    <span class="n">record</span> <span class="p">=</span> <span class="n">record</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ANITvvaUEuuwwcACzY21qA.png" alt="æ·±åº¦ç¡çœ é˜¶æ®µ" /></p>

<p>ä¸ºäº†ç»˜åˆ¶ç¡çœ è¿‡ç¨‹çš„æ‰€æœ‰é˜¶æ®µï¼ˆæ¸…é†’ã€å¿«é€Ÿçœ¼åŠ¨ã€æµ…ç¡çœ å’Œæ·±ç¡çœ ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€äº›è°ƒæ•´ï¼Œå°†æ¯ä¸ªé˜¶æ®µç±»å‹å‚ç›´ç»˜åˆ¶ä¸ºåˆ—ç»„ä»¶ï¼ŒåŠæ³•æ˜¯é€è¡Œç»˜åˆ¶å¹¶å¯¹ä¸‹ä¸€è¡Œåº”ç”¨ä¸€äº›åç§»é‡ï¼ˆoffsetï¼‰ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">SleepSessionCanvas</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>    <span class="n">record</span><span class="p">:</span> <span class="n">SleepSessionRecord</span><span class="p">,</span>
</span><span class='line'>    <span class="n">stageHeight</span><span class="p">:</span> <span class="n">Dp</span> <span class="p">=</span> <span class="m">48.</span><span class="n">dp</span><span class="p">,</span>
</span><span class='line'>    <span class="n">stagesSpacing</span><span class="p">:</span> <span class="n">Dp</span> <span class="p">=</span> <span class="m">16.</span><span class="n">dp</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">colors</span> <span class="p">=</span> <span class="n">remember</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">mapOf</span><span class="p">(</span>
</span><span class='line'>            <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">Awake</span> <span class="n">to</span> <span class="n">Color</span><span class="p">(</span><span class="m">0</span><span class="n">xFFFF9800</span><span class="p">),</span>
</span><span class='line'>            <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">Light</span> <span class="n">to</span> <span class="n">Color</span><span class="p">(</span><span class="m">0</span><span class="n">xFF2196F3</span><span class="p">),</span>
</span><span class='line'>            <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">Deep</span> <span class="n">to</span> <span class="n">Color</span><span class="p">(</span><span class="m">0</span><span class="n">xFF673AB7</span><span class="p">),</span>
</span><span class='line'>            <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">REM</span> <span class="n">to</span> <span class="n">Color</span><span class="p">(</span><span class="m">0</span><span class="n">xFF795548</span><span class="p">),</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="py">stageHeightPx</span> <span class="p">=</span> <span class="n">with</span><span class="p">(</span><span class="n">LocalDensity</span><span class="p">.</span><span class="n">current</span><span class="p">)</span> <span class="p">{</span> <span class="n">stageHeight</span><span class="p">.</span><span class="n">toPx</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">stagesSpacingPx</span> <span class="p">=</span> <span class="n">with</span><span class="p">(</span><span class="n">LocalDensity</span><span class="p">.</span><span class="n">current</span><span class="p">)</span> <span class="p">{</span> <span class="n">stagesSpacing</span><span class="p">.</span><span class="n">toPx</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Spacer</span><span class="p">(</span>
</span><span class='line'>        <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span>
</span><span class='line'>            <span class="p">.</span><span class="n">requiredHeight</span><span class="p">(</span><span class="n">stageHeight</span> <span class="p">*</span> <span class="n">colors</span><span class="p">.</span><span class="n">size</span> <span class="p">+</span> <span class="n">stagesSpacing</span> <span class="p">*</span> <span class="p">(</span><span class="n">colors</span><span class="p">.</span><span class="n">size</span> <span class="p">-</span> <span class="m">1</span><span class="p">))</span>
</span><span class='line'>            <span class="p">.</span><span class="n">drawWithCache</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">val</span> <span class="py">stages</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span>
</span><span class='line'>                    <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">Awake</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">REM</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">Light</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">SleepSessionStageType</span><span class="p">.</span><span class="n">Deep</span><span class="p">,</span>
</span><span class='line'>                <span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="k">type</span> <span class="p">-&gt;</span>
</span><span class='line'>                    <span class="k">type</span> <span class="n">to</span> <span class="n">calculate</span><span class="p">(</span>
</span><span class='line'>                        <span class="n">canvasSize</span> <span class="p">=</span> <span class="n">size</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">height</span> <span class="p">=</span> <span class="n">stageHeightPx</span><span class="p">),</span>
</span><span class='line'>                        <span class="n">recordStartTime</span> <span class="p">=</span> <span class="n">record</span><span class="p">.</span><span class="n">startTime</span><span class="p">,</span>
</span><span class='line'>                        <span class="n">recordEndTime</span> <span class="p">=</span> <span class="n">record</span><span class="p">.</span><span class="n">endTime</span><span class="p">,</span>
</span><span class='line'>                        <span class="n">stages</span> <span class="p">=</span> <span class="n">record</span><span class="p">.</span><span class="n">stages</span><span class="p">.</span><span class="n">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="k">type</span> <span class="p">==</span> <span class="k">type</span> <span class="p">},</span>
</span><span class='line'>                    <span class="p">)</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">onDrawWithContent</span> <span class="p">{</span>
</span><span class='line'>                    <span class="k">var</span> <span class="py">offset</span> <span class="p">=</span> <span class="m">0f</span>
</span><span class='line'>                    <span class="n">stages</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="p">(</span><span class="k">type</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span> <span class="p">-&gt;</span>
</span><span class='line'>                        <span class="n">translate</span><span class="p">(</span><span class="n">top</span> <span class="p">=</span> <span class="n">offset</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                            <span class="c1">// ç”»èƒŒæ™¯</span>
</span><span class='line'>                            <span class="n">drawRoundRect</span><span class="p">(</span>
</span><span class='line'>                                <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">LightGray</span><span class="p">,</span>
</span><span class='line'>                                <span class="n">topLeft</span> <span class="p">=</span> <span class="n">Offset</span><span class="p">(</span><span class="n">x</span> <span class="p">=</span> <span class="m">0f</span><span class="p">,</span> <span class="n">y</span> <span class="p">=</span> <span class="n">stageHeightPx</span> <span class="p">/</span> <span class="m">4</span><span class="p">),</span>
</span><span class='line'>                                <span class="n">size</span> <span class="p">=</span> <span class="n">size</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">height</span> <span class="p">=</span> <span class="n">stageHeightPx</span> <span class="p">/</span> <span class="m">2</span><span class="p">),</span>
</span><span class='line'>                                <span class="n">cornerRadius</span> <span class="p">=</span> <span class="n">CornerRadius</span><span class="p">(</span><span class="n">stageHeightPx</span> <span class="p">/</span> <span class="m">2</span><span class="p">),</span>
</span><span class='line'>                            <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>                            <span class="c1">// ç»˜åˆ¶é˜¶æ®µç‚¹</span>
</span><span class='line'>                            <span class="n">points</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">point</span> <span class="p">-&gt;</span>
</span><span class='line'>                                <span class="n">drawRect</span><span class="p">(</span>
</span><span class='line'>                                    <span class="n">topLeft</span> <span class="p">=</span> <span class="n">point</span><span class="p">.</span><span class="n">topLeft</span><span class="p">,</span>
</span><span class='line'>                                    <span class="n">size</span> <span class="p">=</span> <span class="n">point</span><span class="p">.</span><span class="n">size</span><span class="p">,</span>
</span><span class='line'>                                    <span class="n">color</span> <span class="p">=</span> <span class="n">colors</span><span class="p">.</span><span class="n">getValue</span><span class="p">(</span><span class="k">type</span><span class="p">),</span>
</span><span class='line'>                                <span class="p">)</span>
</span><span class='line'>                            <span class="p">}</span>
</span><span class='line'>                        <span class="p">}</span>
</span><span class='line'>                        <span class="n">offset</span> <span class="p">+=</span> <span class="n">stageHeightPx</span> <span class="p">+</span> <span class="n">stagesSpacingPx</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iXIS4tbsvx5AhTtRqlWi7A.png" alt="æœ€ç»ˆçš„å›¾å½¢" /></p>

<h3>æ·»åŠ æ–‡æœ¬</h3>

<p>è¦åœ¨ Compose ä¸­ç»˜åˆ¶æ–‡æœ¬ï¼Œæˆ‘ä»¬é€šå¸¸å¯ä»¥ä½¿ç”¨ Text å¯ç»„åˆé¡¹ã€‚ä½†æ˜¯ï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¤„äº DrawScope ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ DrawScope.drawText()æ–¹æ³•ã€‚</p>

<p>ç»˜åˆ¶æ–‡æœ¬ä¸å…¶ä»–ç»˜åˆ¶å‘½ä»¤ç•¥æœ‰ä¸åŒã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ä¸ºç»˜åˆ¶å‘½ä»¤æä¾›ç»˜åˆ¶å½¢çŠ¶/å›¾åƒçš„å¤§å°ï¼ˆå®½åº¦å’Œé«˜åº¦ï¼‰ã€‚å¯¹äºæ–‡æœ¬ï¼Œæœ‰å‡ ä¸ªå‚æ•°å¯ä»¥æ§åˆ¶æ¸²æŸ“æ–‡æœ¬çš„å¤§å°ï¼Œä¾‹å¦‚å­—ä½“å¤§å°ã€å­—ä½“ã€è¿å­—ç¬¦å’Œå­—æ¯é—´è·ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨ TextMeasurer æ¥è·å–æ–‡æœ¬çš„æµ‹é‡å¤§å°ï¼Œå…·ä½“å–å†³äºä¸Šè¿°å› ç´ ã€‚</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QB1QvINWUWMlpRoPSzrcUQ.png" alt="Desktopæ•ˆæœ" /></p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*U_LBREiTciw2F3ghYiHqCw.jpeg" alt="Androidå’ŒiOSæ•ˆæœ" /></p>

<p>è¯·åˆ°æˆ‘çš„Github repoä¸­æŸ¥æ‰¾å®Œæ•´ç¤ºä¾‹ä»£ç ï¼š<a href="https://github.com/vitoksmile/Sleep-timeline-graph">https://github.com/vitoksmile/Sleep-timeline-graph</a>ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[é«˜æ•ˆåœ°åœ¨Jetpack Composeä¸­è®¾è®¡UIç»„ä»¶]]></title>
    <link href="https://alexhilton.github.io/blog/2025/03/16/effective-compose-components/"/>
    <updated>2025-03-16T20:37:18+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/03/16/effective-compose-components</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ª<a href="https://proandroiddev.com/designing-effective-ui-components-in-jetpack-compose-cb8d18f7f888">Designing Effective UI Components in Jetpack Compose</a>ï¼ŒåŸæ–‡ä½œè€…æ˜¯Jaewoong Eumï¼ŒåŸæ–‡å‘å¸ƒäº2025å¹´2æœˆ7æ—¥ã€‚</p></blockquote>

<p><strong>è¯‘è€…æŒ‰ï¼š</strong> æœ¬æ–‡é€‚åˆæœ‰ä¸€å®šJetpack Composeç»éªŒçš„å¼€å‘è€…é˜…è¯»ï¼Œå‡å®šè¯»è€…ç†Ÿæ‚‰Jetpack Composeçš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼Œä»¥åŠç†Ÿæ‚‰å¸¸è§ çš„Slotè®¾è®¡æ¨¡å¼ã€‚å¦åˆ™ç†è§£ä¸Šå¯èƒ½ä¼šæœ‰ä¸€äº›å›°éš¾ã€‚</p>

<p><a href="https://alexhilton.github.io/blog/2025/03/16/effective-compose-components/"><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PwVzAjyhIPGIgrT0" title="auto auto" ></a></p>

<!-- more -->


<p>è‡ª<a href="https://android-developers.googleblog.com/2021/07/jetpack-compose-announcement.html"> Google å®£å¸ƒ Jetpack Compose 1.0 ç¨³å®šç‰ˆ</a>ä»¥æ¥ï¼Œè®¸å¤šå…¬å¸éƒ½å·²é‡‡ç”¨ Jetpack Compose æ¥åˆ©ç”¨å…¶ä¼—å¤šä¼˜åŠ¿ã€‚éšç€ Compose åœ¨ Android ç”Ÿæ€ç³»ç»Ÿä¸­çš„å¹¿æ³›é‡‡ç”¨ï¼Œåº“å’Œ SDK ä¹Ÿå¼€å§‹é›†æˆå¯¹ Compose çš„æ”¯æŒã€‚</p>

<p>ä¼ ç»Ÿä¸Šï¼Œåœ¨åŸºäº XML çš„é¡¹ç›®ä¸­ï¼ŒUI ç»„ä»¶ä»¥è‡ªå®šä¹‰è§†å›¾çš„å½¢å¼æä¾›ï¼Œå¹¶é€šè¿‡å±æ€§ï¼ˆattributesï¼‰æä¾›å¯è‡ªå®šä¹‰çš„é€‰é¡¹ã€‚è™½ç„¶è¿™ç§æ–¹æ³•å¯ä»¥è½»æ¾åœ°å°†ç»„ä»¶é›†æˆåˆ° XML å¸ƒå±€ä¸­ï¼Œä½†å®ƒå¸¦æ¥äº†ä¸€äº›æŒ‘æˆ˜ï¼Œä¾‹å¦‚åœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´åº”ç”¨ä¸»é¢˜æ ·å¼æ—¶ä¸ä¸€è‡´ï¼Œä»¥åŠç”±äºåº•å±‚ View ç±»å…¬å¼€çš„æ–¹æ³•è€Œå¯¼è‡´çš„ API æ»¥ç”¨ã€‚</p>

<p>ä¸ä¼ ç»Ÿçš„è‡ªå®šä¹‰è§†å›¾ç›¸æ¯”ï¼ŒJetpack Compose æä¾›äº†ä¸€ç§å®Œå…¨ä¸åŒçš„ç»„ä»¶è®¾è®¡ç­–ç•¥ã€‚å…¶å£°æ˜å¼ç»“æ„å…è®¸æ›´ç›´è§‚ã€æ›´çµæ´»çš„ API è®¾è®¡ã€‚è¿™ç§è½¬å˜ä¸ä»…æœ‰åˆ©äºåº“å’Œ SDK å¼€å‘äººå‘˜ï¼Œä¹Ÿæœ‰åˆ©äºæ„å»ºå…±äº« UI ç»„ä»¶çš„å¤§å‹å›¢é˜Ÿï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿå®æ–½æ›´å¥½çš„åšæ³•ã€å‡å°‘è¯¯ç”¨å¹¶å¢å¼ºæ•´ä½“å¼€å‘äººå‘˜ä½“éªŒã€‚</p>

<p>åœ¨æœ¬æ–‡ä¸­ï¼Œä½ å°†å‘ç°åœ¨ Jetpack Compose ä¸­è®¾è®¡ UI ç»„ä»¶çš„æœ‰æ•ˆç­–ç•¥ï¼Œå€Ÿé‰´<a href="https://getstream.io/video/sdk/android/"> Stream Video SDK </a>çš„æœ€ä½³å®è·µã€‚</p>

<h2>Modifierçš„æœ€ä½³å®è·µ</h2>

<p><a href="https://developer.android.com/develop/ui/compose/modifiers">Modifier </a>æ˜¯ Jetpack Compose ä¸­ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ APIï¼Œå¯è®©ä½ ä»¥é“¾å¼å’Œå¯ç»„åˆçš„æ–¹å¼è£…é¥°å’Œå¢å¼º UI å…ƒç´ ã€‚ä½†æ˜¯ï¼Œåº”è°¨æ…ä½¿ç”¨å®ƒï¼Œå› ä¸ºå®ƒçš„å±æ€§å¯ä»¥ä¼ æ’­åˆ°å…¶ä»–å¯ç»„åˆå‡½æ•°ï¼Œå¦‚æœç®¡ç†ä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„æ•ˆæœã€‚</p>

<p>Modifierå‡½æ•°çš„é¡ºåºå°¤å…¶é‡è¦ï¼Œå› ä¸ºæ¯ä¸ªå‡½æ•°éƒ½ä¼šä¿®æ”¹å‰ä¸€ä¸ªå‡½æ•°è¿”å›çš„Modifieræˆ–ä»å¯ç»„åˆé¡¹å¤–éƒ¨ä¼ é€’çš„Modifierã€‚æ­¤é¡ºåºç›´æ¥å½±å“æœ€ç»ˆè¾“å‡ºã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ä¸‰ä¸ªå…³é”®åŸåˆ™å’Œæœ€ä½³å®è·µï¼Œå®ƒä»¬å¯ä»¥æŒ‡å¯¼ä½ åœ¨ Jetpack Compose ä¸­è®¾è®¡æœ‰æ•ˆä¸”å¯é¢„æµ‹çš„ UI ç»„ä»¶ APIã€‚</p>

<h3>1. å°†Modifieråº”ç”¨åˆ°ç»„ä»¶æœ€é¡¶å±‚çš„å¸ƒå±€</h3>

<p>Jetpack Compose ä¸­çš„Modifierä¼šé€šè¿‡å¸ƒå±€å±‚æ¬¡ç»“æ„å‘ä¸‹ä¼ é€’ï¼Œä½†ç†æƒ³æƒ…å†µä¸‹ï¼Œå®ƒä»¬åº”ä»…åº”ç”¨äºå¯ç»„åˆå‡½æ•°ä¸­æœ€é¡¶å±‚çš„å¸ƒå±€èŠ‚ç‚¹ã€‚åœ¨å±‚æ¬¡ç»“æ„ä¸­çš„ä»»æ„çº§åˆ«åº”ç”¨Modifierå¯èƒ½ä¼šå¯¼è‡´æ„å¤–è¡Œä¸ºï¼Œå¹¶å¢åŠ ç”¨æˆ·è¯¯ç”¨çš„å¯èƒ½æ€§ï¼Œä»è€Œä½¿ç»„ä»¶æ›´éš¾ä»¥é¢„æµ‹ä¸”æ›´éš¾ä»¥æœ‰æ•ˆä½¿ç”¨ã€‚</p>

<p>ä¾‹å¦‚ï¼Œå‡è®¾ä½ æƒ³è¦åˆ›å»ºä¸€ä¸ªä»£è¡¨åœ†å½¢æŒ‰é’®çš„ç»„ä»¶ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">RoundedButton</span><span class="p">(</span>
</span><span class='line'>  <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>  <span class="n">onClick</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">Button</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">32.</span><span class="n">dp</span><span class="p">)),</span>
</span><span class='line'>    <span class="n">onClick</span> <span class="p">=</span> <span class="n">onClick</span>
</span><span class='line'>  <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Text</span><span class="p">(</span>
</span><span class='line'>      <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="m">10.</span><span class="n">dp</span><span class="p">),</span>
</span><span class='line'>      <span class="n">text</span> <span class="p">=</span> <span class="s">&quot;Rounded&quot;</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½†æ˜¯ï¼Œä½ ä¸åº”å°† Modifier åº”ç”¨äº Text ï¼Œè€Œåº”åº”ç”¨äº Button ï¼Œåè€…æ˜¯å¸ƒå±€å±‚æ¬¡ç»“æ„ä¸­æœ€é¡¶å±‚çš„å¯ç»„åˆå‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">RoundedButton</span><span class="p">(</span>
</span><span class='line'>  <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>  <span class="n">onClick</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">Button</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">32.</span><span class="n">dp</span><span class="p">)),</span>
</span><span class='line'>    <span class="n">onClick</span> <span class="p">=</span> <span class="n">onClick</span>
</span><span class='line'>  <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Text</span><span class="p">(</span>
</span><span class='line'>      <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="m">10.</span><span class="n">dp</span><span class="p">),</span> <span class="c1">// åˆ«è¿™ä¹ˆå¹²</span>
</span><span class='line'>      <span class="n">text</span> <span class="p">=</span> <span class="s">&quot;Rounded&quot;</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è‡ªå®šä¹‰å¯ç»„åˆå‡½æ•° RoundedButton çš„ä¸»è¦ç”¨é€”æ˜¯è¡¨ç¤º Button ï¼Œè€Œä¸æ˜¯ Text ã€‚å› æ­¤ï¼Œä½ åº”é¿å…è½¬ç§»æ‰€åˆ›å»ºä¸»è¦ç»„ä»¶çš„ç„¦ç‚¹æˆ–ç”¨é€”ã€‚</p>

<p>æ­¤å¤–ï¼Œå¦‚æœå¸ƒå±€å±‚æ¬¡ç»“æ„å˜å¾—å¤æ‚ï¼Œå¹¶ä¸”ä½ åœ¨å¯ç»„åˆå‡½æ•°çš„ä¸­é—´çº§åˆ«åº”ç”¨Modifierï¼Œåˆ™ç”¨æˆ·å¯èƒ½å¾ˆéš¾é¢„æµ‹æä¾›çš„Modifierå‚æ•°æœ€ç»ˆä¼šå½±å“å“ªä¸ªç»„ä»¶ã€‚è¿™ç§ä¸æ˜ç¡®æ€§å¯èƒ½ä¼šå¯¼è‡´æ··æ·†å’Œè¯¯ç”¨ã€‚</p>

<p>å¦‚æœä½ æƒ³è®©ç”¨æˆ·çµæ´»åœ°ä¿®æ”¹æŒ‰é’®çš„å†…éƒ¨å†…å®¹ï¼Œä½ å¯ä»¥ä½¿ç”¨æ’æ§½æ¥å®ç°ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">RoundedButton</span><span class="p">(</span>
</span><span class='line'>  <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>  <span class="n">onClick</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">,</span>
</span><span class='line'>  <span class="n">content</span><span class="p">:</span> <span class="n">@Composable</span> <span class="n">RowScope</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="n">Unit</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">Button</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">32.</span><span class="n">dp</span><span class="p">)),</span>
</span><span class='line'>    <span class="n">onClick</span> <span class="p">=</span> <span class="n">onClick</span>
</span><span class='line'>  <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">content</span><span class="p">()</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>2. å¯¹Modifierä½¿ç”¨å•ä¸ªå‚æ•°</h3>

<p>ä½ å¯èƒ½æƒ³çŸ¥é“æ˜¯å¦å¯ä»¥æ¥å—å¤šä¸ª Modifier å‚æ•°ä»¥åº”ç”¨äºå¸ƒå±€å±‚æ¬¡ç»“æ„ä¸­çš„ç‰¹å®šç»„ä»¶ï¼ŒåŒæ—¶é™åˆ¶ç»„ä»¶çš„ç»“æ„ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">RoundedButton</span><span class="p">(</span>
</span><span class='line'>  <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>  <span class="n">textModifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>  <span class="n">onClick</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">Button</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">32.</span><span class="n">dp</span><span class="p">)),</span>
</span><span class='line'>    <span class="n">onClick</span> <span class="p">=</span> <span class="n">onClick</span>
</span><span class='line'>  <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Text</span><span class="p">(</span>
</span><span class='line'>      <span class="n">modifier</span> <span class="p">=</span> <span class="n">textModifier</span><span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="m">10.</span><span class="n">dp</span><span class="p">),</span>
</span><span class='line'>      <span class="n">text</span> <span class="p">=</span> <span class="s">&quot;Rounded&quot;</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½†æ˜¯ï¼ŒModifier æœ¬è´¨ä¸Šè¢«è®¾è®¡ä¸ºä¸€ä¸ªå•ä¸€çš„ã€å¯é“¾æ¥çš„å‚æ•°ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿå®šä¹‰ Composable å‡½æ•°çš„å¤–éƒ¨è¡Œä¸ºå’Œå¤–è§‚ã€‚åœ¨ Composable ä¸­å¼•å…¥å¤šä¸ª Modifier å‚æ•°ä¼šå¢åŠ ä¸å¿…è¦çš„å¤æ‚æ€§ï¼Œå¢åŠ è¯¯ç”¨çš„é£é™©ï¼Œå¹¶ä¸”åç¦»äº† Jetpack Compose ä¿æŒ API ç›´è§‚å’Œå¯é¢„æµ‹çš„åŸåˆ™ã€‚</p>

<p>æœ€å¥½ä½¿ç”¨åŸºäºæ’æ§½çš„æ–¹æ³•ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿçµæ´»åœ°è‡ªå®šä¹‰å†…éƒ¨å†…å®¹ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªæ’æ§½ï¼ˆslotï¼‰ï¼Œè®©ç”¨æˆ·æä¾›è‡ªå®šä¹‰å†…å®¹ï¼ŒåŒæ—¶ä»ä¿ç•™å•ä¸ªModifierä»¥è¿›è¡Œå¤–éƒ¨è‡ªå®šä¹‰ï¼Œè€Œä¸æ˜¯æ·»åŠ å¤šä¸ªModifierå‚æ•°ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">RoundedButton</span><span class="p">(</span>
</span><span class='line'>  <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>  <span class="n">onClick</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">,</span>
</span><span class='line'>  <span class="n">content</span><span class="p">:</span> <span class="n">@Composable</span> <span class="n">RowScope</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="n">Unit</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">Button</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">32.</span><span class="n">dp</span><span class="p">)),</span>
</span><span class='line'>    <span class="n">onClick</span> <span class="p">=</span> <span class="n">onClick</span>
</span><span class='line'>  <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">content</span><span class="p">()</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>3. é¿å…è·¨ç»„ä»¶é‡å¤ä½¿ç”¨Modifier</h3>

<p>è®¾è®¡ç»„ä»¶æ—¶çš„å¦ä¸€ä¸ªé‡è¦è€ƒè™‘å› ç´ æ˜¯é¿å…é‡å¤ä½¿ç”¨æä¾›çš„ Modifier å®ä¾‹ã€‚ä¸€äº›å¼€å‘äººå‘˜å¯èƒ½ä¼šæ‹…å¿ƒä¸ºæ¯ä¸ªç»„ä»¶åˆ›å»ºæ–°çš„ Modifier å®ä¾‹å¯èƒ½ä¼šå¯¼è‡´å†…å­˜ä½¿ç”¨é‡å¢åŠ æˆ–å¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ï¼Œå°¤å…¶æ˜¯åœ¨å…·æœ‰å¤§é‡Modifierçš„å¤æ‚å¸ƒå±€å±‚æ¬¡ç»“æ„ä¸­ã€‚</p>

<p>ç„¶è€Œï¼Œç”±äº Jetpack Compose ä¸­Modifierå®ç°çš„ä¼˜åŒ–æ€§è´¨ï¼Œè¿™ç§æ‹…å¿§é€šå¸¸æ˜¯æ²¡æœ‰æ ¹æ®çš„ã€‚Modifieræ—¨åœ¨åº”ç”¨äºå¯ç»„åˆå‡½æ•°ä¸­çš„å•ä¸ªå¸ƒå±€èŠ‚ç‚¹ï¼Œä»¥ç¡®ä¿è¡Œä¸ºæ¸…æ™°ä¸”å¯é¢„æµ‹ã€‚å¦‚æœåœ¨å¸ƒå±€å±‚æ¬¡ç»“æ„ä¸­ä¸åŒçº§åˆ«çš„å¤šä¸ªå¯ç»„åˆé¡¹ä¸­ä½¿ç”¨ç›¸åŒçš„Modifierï¼Œåˆ™å¯èƒ½å¯¼è‡´æ„å¤–çš„å‰¯ä½œç”¨å’Œä¸å¯é¢„æµ‹çš„è¡Œä¸ºï¼Œä»è€ŒæŸå®³ç»„ä»¶çš„ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ã€‚</p>

<p>ä¾‹å¦‚ï¼Œè€ƒè™‘è¿™æ ·ä¸€ç§æƒ…å†µï¼Œå…¶ä¸­ç›¸åŒçš„ Modifier å‚æ•°åœ¨æ•´ä¸ªå¸ƒå±€å±‚æ¬¡ç»“æ„ä¸­é‡å¤ä½¿ç”¨ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">MyButtons</span><span class="p">(</span>
</span><span class='line'>  <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>  <span class="n">onClick</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">Column</span><span class="p">(</span><span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Button</span><span class="p">(</span>
</span><span class='line'>      <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">,</span>
</span><span class='line'>      <span class="n">onClick</span> <span class="p">=</span> <span class="n">onClick</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">Text</span><span class="p">(</span>
</span><span class='line'>        <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="m">10.</span><span class="n">dp</span><span class="p">),</span>
</span><span class='line'>        <span class="n">text</span> <span class="p">=</span> <span class="s">&quot;Rounded&quot;</span>
</span><span class='line'>      <span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Button</span><span class="p">(</span>
</span><span class='line'>      <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">,</span>
</span><span class='line'>      <span class="n">onClick</span> <span class="p">=</span> <span class="n">onClick</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">Text</span><span class="p">(</span>
</span><span class='line'>        <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="m">10.</span><span class="n">dp</span><span class="p">),</span>
</span><span class='line'>        <span class="n">text</span> <span class="p">=</span> <span class="s">&quot;Not Rounded&quot;</span>
</span><span class='line'>      <span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¹ä¸€çœ‹ï¼Œä»£ç ä¼¼ä¹è¿è¡Œæ­£å¸¸ã€‚ä½†æ˜¯ï¼Œå½“ä½ åœ¨è°ƒç”¨ç‚¹ä¿®æ”¹Modifieræ—¶ï¼Œä½ ä¼šæ³¨æ„åˆ°æ„å¤–çš„è¡Œä¸ºï¼Œå¯èƒ½ä¼šä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼æ”¹å˜æ•´ä¸ªå¸ƒå±€ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">MyButtons</span><span class="p">(</span>
</span><span class='line'>  <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span><span class='line'>    <span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">32.</span><span class="n">dp</span><span class="p">))</span>
</span><span class='line'>    <span class="p">.</span><span class="n">background</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Blue</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span> <span class="p">{}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸ºäº†ç¡®ä¿è¡Œä¸ºæ­£ç¡®å¹¶é¿å…æ„å¤–é—®é¢˜ï¼Œä½ åº”é¿å…åœ¨å¤šä¸ªç»„ä»¶ä¸­é‡å¤ä½¿ç”¨Modifierã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œä½ äº†è§£äº†åœ¨è®¾è®¡ Compose ç»„ä»¶æ—¶ç®¡ç†Modifierçš„æœ€ä½³å®è·µã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬é€šè¿‡å®ç°ä¸»é¢˜æ¥æ·±å…¥äº†è§£å¦‚ä½•æä¾›ä¸€è‡´çš„ UI æ ·å¼ã€‚</p>

<h2>ä¸»é¢˜ç¡®ä¿ UI ä¸€è‡´æ€§</h2>

<p>ç°åœ¨ï¼Œå‡è®¾ä½ éœ€è¦æä¾›å¤šç§ Compose ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶åº”å…±äº«ä¸€è‡´çš„æ ·å¼ã€‚å¦‚æœè¿™äº›ç»„ä»¶æ˜¯ç‹¬ç«‹æä¾›çš„ï¼Œé‚£ä¹ˆç»´æŠ¤è¿™äº›ç»„ä»¶ä¹‹é—´ä¸€è‡´æ ·å¼çš„è´£ä»»å°±å®Œå…¨è½åœ¨ç”¨æˆ·èº«ä¸Šã€‚è¿™å¯èƒ½éå¸¸å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œå› ä¸ºæ¯ä¸ªç»„ä»¶å¯èƒ½ä¼šå…¬å¼€ä¸åŒçš„ API æ¥è‡ªå®šä¹‰å…¶æ ·å¼ï¼Œä»è€Œä½¿åŒæ­¥å˜å¾—ç¹çä¸”å®¹æ˜“å‡ºé”™ã€‚</p>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä» Compose Material åº“æä¾›çš„<a href="https://developer.android.com/develop/ui/compose/designsystems/material3#material-theming"> MaterialTheme API </a>ä¸­æ±²å–çµæ„Ÿã€‚å…³é”®åœ¨äºç¡®ä¿ç»„ä»¶æ ·å¼ä¸€è‡´ï¼ŒåŒæ—¶å…è®¸ç”¨æˆ·æ— ç¼è‡ªå®šä¹‰å¹¶åœ¨å„ä¸ªç»„ä»¶ä¹‹é—´ä¿æŒä¸€è‡´çš„æ ·å¼ã€‚</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/0*AyJL0G8NsCGWX9_Q" alt="Theming Consistency" /></p>

<p>Compose çš„<a href="https://getstream.io/video/sdk/"> Stream Video SDK </a>é€šè¿‡æä¾›åä¸º<a href="https://getstream.io/video/docs/android/ui-components/video-theme/"> VideoTheme </a>çš„ä¸“ç”¨ä¸»é¢˜ API å±•ç¤ºäº†æœ€ä½³å®è·µã€‚æ­¤ VideoTheme API å¯ç¡®ä¿ SDK æä¾›çš„æ‰€æœ‰ Compose ç»„ä»¶çš„æ ·å¼ä¸€è‡´ï¼ŒåŒ…æ‹¬é¢œè‰²ã€å°ºå¯¸ã€æ’ç‰ˆã€å½¢çŠ¶ã€æ¶Ÿæ¼ªæ•ˆæœç­‰ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">setContent</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">VideoTheme</span><span class="p">(</span>
</span><span class='line'>        <span class="n">colors</span> <span class="p">=</span> <span class="n">StreamColors</span><span class="p">.</span><span class="n">defaultColors</span><span class="p">().</span><span class="n">copy</span><span class="p">(</span><span class="n">appBackground</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">Black</span><span class="p">),</span>
</span><span class='line'>        <span class="n">dimens</span> <span class="p">=</span> <span class="n">StreamDimens</span><span class="p">.</span><span class="n">defaultDimens</span><span class="p">().</span><span class="n">copy</span><span class="p">(</span><span class="n">callAvatarSize</span> <span class="p">=</span> <span class="m">72.</span><span class="n">dp</span><span class="p">),</span>
</span><span class='line'>        <span class="n">shapes</span> <span class="p">=</span> <span class="n">StreamShapes</span><span class="p">.</span><span class="n">defaultShapes</span><span class="p">().</span><span class="n">copy</span><span class="p">(</span>
</span><span class='line'>            <span class="n">avatar</span> <span class="p">=</span> <span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">),</span>
</span><span class='line'>            <span class="n">callButton</span> <span class="p">=</span> <span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">16.</span><span class="n">dp</span><span class="p">),</span>
</span><span class='line'>            <span class="n">callControls</span> <span class="p">=</span> <span class="n">RectangleShape</span><span class="p">,</span>
</span><span class='line'>            <span class="n">callControlsButton</span> <span class="p">=</span> <span class="n">RoundedCornerShape</span><span class="p">(</span><span class="m">8.</span><span class="n">dp</span><span class="p">)</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">CallContent</span><span class="p">(</span>
</span><span class='line'>            <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">fillMaxSize</span><span class="p">(),</span>
</span><span class='line'>            <span class="n">call</span> <span class="p">=</span> <span class="n">call</span><span class="p">,</span>
</span><span class='line'>            <span class="n">onBackPressed</span> <span class="p">=</span> <span class="p">{</span> <span class="n">finish</span><span class="p">()</span> <span class="p">},</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>é€šè¿‡å°† Stream SDK æä¾›çš„ç»„ä»¶ä¸ VideoTheme åŒ…è£…åœ¨ä¸€èµ·ï¼ˆå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼‰ï¼Œè‡ªå®šä¹‰æ ·å¼å°†è‡ªåŠ¨ä¸€è‡´åœ°åº”ç”¨äºæ‰€æœ‰ç»„ä»¶ã€‚è¿™ç§æ–¹æ³•ä½¿ç”¨æˆ·èƒ½å¤Ÿè½»æ¾ä¿æŒå…¶ UI çš„ä¸€è‡´æ€§ï¼ŒåŒæ—¶è°ƒæ•´ä¸»é¢˜ä»¥æ»¡è¶³å…¶åº”ç”¨ç¨‹åºçš„è®¾è®¡è¦æ±‚ã€‚</p>

<h3>å®ç°è‡ªå®šä¹‰ä¸»é¢˜</h3>

<p>è®©æˆ‘ä»¬æ·±å…¥ç ”ç©¶å¦‚ä½•å®ç°è‡ªå®šä¹‰ä¸»é¢˜ã€‚ç¬¬ä¸€æ­¥æ˜¯å®šä¹‰è®¾è®¡è§„èŒƒï¼Œè¿™äº›è§„èŒƒå°†åœ¨ä½ çš„ç»„ä»¶ä¹‹é—´å…±äº«æˆ–ä¸ºç”¨æˆ·æä¾›è‡ªå®šä¹‰åŠŸèƒ½ã€‚è€ƒè™‘åŒ…æ‹¬é¢œè‰²ã€å½¢çŠ¶å’Œå°ºå¯¸ç­‰æ–¹é¢ï¼Œå› ä¸ºè¿™äº›é€šå¸¸æ˜¯ç¡®ä¿è®¾è®¡ç³»ç»Ÿä¸€è‡´æ€§çš„æœ€é‡è¦å› ç´ ã€‚</p>

<p>ä¾‹å¦‚ï¼Œåœ¨ Stream SDK ä¸­ï¼Œç»„ä»¶æ‰€éœ€çš„æ‰€æœ‰é¢œè‰²é›†å‡åœ¨<a href="https://github.com/GetStream/stream-video-android/blob/c12db8cb6367e10682be3ab323d50dfcc59032f3/stream-video-android-ui-compose/src/main/kotlin/io/getstream/video/android/compose/theme/StreamColors.kt#L24"> StreamColors </a>ç±»ä¸­é¢„å®šä¹‰ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¸€ç§æ— ç¼çš„æ–¹å¼æ¥ä¿æŒå…¶æ•´ä¸ª UI çš„ä¸€è‡´æ€§ã€‚ä»¥ä¸‹æ˜¯ Stream SDK å¦‚ä½•é€šè¿‡ç»“æ„è‰¯å¥½çš„é¢œè‰²é›†ç¡®ä¿ä¸€è‡´æ€§çš„ç¤ºä¾‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">public</span> <span class="n">data</span> <span class="k">class</span> <span class="nc">StreamColors</span><span class="p">(</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">brandPrimary</span><span class="p">:</span> <span class="n">Color</span><span class="p">,</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">brandPrimaryLt</span><span class="p">:</span> <span class="n">Color</span><span class="p">,</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">brandPrimaryDk</span><span class="p">:</span> <span class="n">Color</span><span class="p">,</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">brandSecondary</span><span class="p">:</span> <span class="n">Color</span><span class="p">,</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">brandSecondaryTransparent</span><span class="p">:</span> <span class="n">Color</span><span class="p">,</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">brandCyan</span><span class="p">:</span> <span class="n">Color</span><span class="p">,</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">brandGreen</span><span class="p">:</span> <span class="n">Color</span><span class="p">,</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">brandYellow</span><span class="p">:</span> <span class="n">Color</span><span class="p">,</span>
</span><span class='line'>    <span class="p">..</span>
</span><span class='line'>  <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¥ä¸‹æ¥ï¼Œä½ åº”è¯¥åˆ›å»ºä¸€ä¸ª<a href="https://developer.android.com/develop/ui/compose/compositionlocal"> CompositionLocal </a>æ¥ä¿å­˜è®¾è®¡è§„èŒƒã€‚è¿™å°†å…è®¸ä½ çš„ç»„ä»¶å’Œç”¨æˆ·é€šè¿‡ä½¿ç”¨ StreamTheme.colors è°ƒç”¨åœ¨è‡ªå®šä¹‰ä¸»é¢˜çš„ä¸Šä¸‹æ–‡ä¸­æ— ç¼è®¿é—®è¿™äº›è§„èŒƒã€‚</p>

<p><strong>è¯‘æ³¨ï¼š</strong> CompositionLocalæ˜¯Composeä¸­ç”¨äºåœ¨ä¸Šä¸‹æ–‡å‡½æ•°è°ƒç”¨ä¸­ï¼Œéšå¼çš„ä¼ é€’å¸¸é‡æ€§è´¨å‚æ•°çš„æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« <a href="https://juejin.cn/post/7434543407636267071">ç”¨Composeä¸­çš„CompositionLocalæ¥æš—æ¸¡é™ˆä»“</a>ï¼Œä»¥äº†è§£CompositionLocalçš„è¯¦ç»†ç”¨æ³•ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Local providers for various properties we connect to our components, for styling.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="k">private</span> <span class="k">val</span> <span class="py">LocalColors</span> <span class="p">=</span> <span class="n">compositionLocalOf</span><span class="p">&lt;</span><span class="n">StreamColors</span><span class="p">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">error</span><span class="p">(</span><span class="s">&quot;No colors provided! Make sure to wrap all usages of Stream components in a VideoTheme.&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="n">interface</span> <span class="n">StreamTheme</span> <span class="p">{</span>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Retrieves the current [StreamColors] at the call site&#39;s position in the hierarchy.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">val</span> <span class="py">colors</span><span class="p">:</span> <span class="n">StreamColors</span>
</span><span class='line'>        <span class="n">@Composable</span> <span class="n">@ReadOnlyComposable</span>
</span><span class='line'>        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">LocalColors</span><span class="p">.</span><span class="n">current</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç„¶åï¼Œä½ éœ€è¦åˆ©ç”¨<a href="https://developer.android.com/develop/ui/compose/compositionlocal"> CompositionLocal </a>å°†è¿™äº›è®¾è®¡è§„èŒƒå°è£…åœ¨è‡ªå®šä¹‰ä¸»é¢˜ä¸­ã€‚è¿™ç§æ–¹æ³•å…è®¸ä½ åœ¨æ•´ä¸ªå¯ç»„åˆå±‚æ¬¡ç»“æ„ä¸­é«˜æ•ˆåœ°æä¾›å’Œä¼ æ’­ä½ çš„è®¾è®¡è§„èŒƒã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">public</span> <span class="k">fun</span> <span class="nf">VideoTheme</span><span class="p">(</span>
</span><span class='line'>    <span class="n">isInDarkMode</span><span class="p">:</span> <span class="n">Boolean</span> <span class="p">=</span> <span class="n">isSystemInDarkTheme</span><span class="p">(),</span>
</span><span class='line'>    <span class="n">colors</span><span class="p">:</span> <span class="n">StreamColors</span> <span class="p">=</span> <span class="n">StreamColors</span><span class="p">.</span><span class="n">defaultColors</span><span class="p">(),</span>
</span><span class='line'>    <span class="n">content</span><span class="p">:</span> <span class="n">@Composable</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">CompositionLocalProvider</span><span class="p">(</span>
</span><span class='line'>        <span class="n">LocalColors</span> <span class="n">provides</span> <span class="n">colors</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">content</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç°åœ¨ï¼Œä½ çš„æ‰€æœ‰ç»„ä»¶éƒ½åº”å‡è®¾å®ƒä»¬éƒ½åŒ…å«åœ¨è‡ªå®šä¹‰ä¸»é¢˜ï¼ˆä¾‹å¦‚æœ¬ä¾‹ä¸­çš„ VideoThemeï¼‰ä¸­ï¼Œå¹¶ä½¿ç”¨æä¾›çš„è®¾è®¡è§„èŒƒæ¥ç¡®ä¿æ•´ä¸ªç»„ä»¶é›†çš„æ ·å¼ä¸€è‡´ã€‚è¿™ç§æ–¹æ³•ä¸ä»…ä½¿ä½ çš„ç»„ä»¶ API èƒ½å¤Ÿé‡‡ç”¨ç»Ÿä¸€çš„æ ·å¼ï¼Œè¿˜å…è®¸ç”¨æˆ·åˆ©ç”¨è¿™äº›è®¾è®¡è§„èŒƒè¿›è¡Œè‡ªå®šä¹‰ï¼Œä»è€ŒåŒæ—¶æé«˜çµæ´»æ€§å’Œä¸€è‡´æ€§ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">VideoRendererCallContent</span><span class="p">(</span>
</span><span class='line'>    <span class="n">call</span><span class="p">:</span> <span class="n">Call</span><span class="p">,</span>
</span><span class='line'>    <span class="n">video</span><span class="p">:</span> <span class="n">ParticipantState</span><span class="p">.</span><span class="n">Video</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onRendered</span><span class="p">:</span> <span class="p">(</span><span class="n">View</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Unit</span> <span class="p">=</span> <span class="p">{},</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">VideoRenderer</span><span class="p">(</span>
</span><span class='line'>        <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span><span class='line'>            <span class="p">.</span><span class="n">fillMaxSize</span><span class="p">()</span>
</span><span class='line'>            <span class="p">.</span><span class="n">background</span><span class="p">(</span><span class="n">VideoTheme</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">baseSheetTertiary</span><span class="p">),</span> <span class="c1">// use pre-defined color styles</span>
</span><span class='line'>        <span class="n">call</span> <span class="p">=</span> <span class="n">call</span><span class="p">,</span>
</span><span class='line'>        <span class="n">video</span> <span class="p">=</span> <span class="n">video</span><span class="p">,</span>
</span><span class='line'>        <span class="n">onRendered</span> <span class="p">=</span> <span class="n">onRendered</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">MyScreen</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">VideoRendererCallContent</span><span class="p">(..)</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// some complicated components</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="n">ComponentActivity</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="n">Bundle</span><span class="p">?)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">super</span><span class="p">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>         <span class="n">setContent</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">VideoTheme</span> <span class="p">{</span>
</span><span class='line'>               <span class="n">MyScreen</span><span class="p">()</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ç§æ–¹æ³•ä¸ä»…å¯¹äºå®ç° APIï¼ˆåº“æˆ– SDKï¼‰æœ‰æ•ˆï¼Œå¯¹äºæ„å»ºåº”ç”¨ç¨‹åºä¹ŸåŒæ ·æœ‰æ•ˆï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿä½¿ç”¨ç»“æ„è‰¯å¥½ã€é¢„å®šä¹‰çš„è®¾è®¡è§„èŒƒè½»æ¾ç»´æŠ¤è®¾è®¡ä¸€è‡´æ€§ã€‚å¯¹äºå®é™…ç¤ºä¾‹å’Œå®é™…ç”¨ä¾‹ï¼Œä½ å¯ä»¥åœ¨<a href="https://github.com/GetStream/stream-video-android/blob/c12db8cb6367e10682be3ab323d50dfcc59032f3/stream-video-android-ui-compose/src/main/kotlin/io/getstream/video/android/compose/theme/VideoTheme.kt"> GitHub </a>ä¸Šæ¢ç´¢å®é™…æœ€ä½³å®è·µã€‚</p>

<h2>å¯å®šåˆ¶æ€§</h2>

<p>åœ¨å®ç° UI ç»„ä»¶æ—¶ï¼Œå°¤å…¶æ˜¯å¯¹äºåº“æˆ– SDKï¼Œä¸º UI å’Œ UX è¡Œä¸ºæä¾›å¼ºå¤§çš„è‡ªå®šä¹‰å’Œçµæ´»æ€§è‡³å…³é‡è¦ã€‚è¿™å¯ç¡®ä¿ç”¨æˆ·å¯ä»¥è½»æ¾é‡å¤ä½¿ç”¨ç»„ä»¶å¹¶æ ¹æ®å…¶ç‰¹å®šè¦æ±‚è¿›è¡Œè°ƒæ•´ã€‚ä½ å¯ä»¥é‡‡ç”¨å„ç§ç­–ç•¥åœ¨ Jetpack Compose ä¸­æœ‰æ•ˆåœ°å®ç°è¿™ç§çº§åˆ«çš„å¯å®šåˆ¶æ€§ã€‚</p>

<h3>1. åˆ©ç”¨æ ·å¼ç±»</h3>

<p>å¦‚æœä½ å¸Œæœ›ä¸ºç‰¹å®šç»„ä»¶æä¾›æ›´å…·é’ˆå¯¹æ€§çš„å®šåˆ¶ï¼Œè¯·è€ƒè™‘æä¾›ä¸“ç”¨çš„æ ·å¼ç±»ã€‚æ­¤ç±»å¯ä»¥å®šä¹‰å¹¶å…è®¸ç”¨æˆ·è½»æ¾ä¿®æ”¹ç»„ä»¶çš„ UI å’Œ UX è¡Œä¸ºä»¥æ»¡è¶³ä»–ä»¬çš„ç‰¹å®šéœ€æ±‚ã€‚</p>

<p>ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ TextStyle ï¼Œå®ƒæ˜¯ Compose UI åº“æä¾›çš„é»˜è®¤ç±»ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Immutable</span>
</span><span class='line'><span class="k">class</span> <span class="nc">TextStyle</span> <span class="k">internal</span> <span class="n">constructor</span><span class="p">(</span>
</span><span class='line'>  <span class="p">..</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">constructor</span><span class="p">(</span>
</span><span class='line'>        <span class="n">color</span><span class="p">:</span> <span class="n">Color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">Unspecified</span><span class="p">,</span>
</span><span class='line'>        <span class="n">fontSize</span><span class="p">:</span> <span class="n">TextUnit</span> <span class="p">=</span> <span class="n">TextUnit</span><span class="p">.</span><span class="n">Unspecified</span><span class="p">,</span>
</span><span class='line'>        <span class="n">fontWeight</span><span class="p">:</span> <span class="n">FontWeight</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
</span><span class='line'>        <span class="n">fontStyle</span><span class="p">:</span> <span class="n">FontStyle</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
</span><span class='line'>        <span class="n">fontSynthesis</span><span class="p">:</span> <span class="n">FontSynthesis</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
</span><span class='line'>        <span class="n">fontFamily</span><span class="p">:</span> <span class="n">FontFamily</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
</span><span class='line'>        <span class="p">..</span>
</span><span class='line'>     <span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚ä¸Šé¢çš„ä»£ç æ‰€ç¤ºï¼ŒTextStyle ç±»å°è£…äº† Text å¯ç»„åˆé¡¹çš„æ‰€æœ‰æ ·å¼å±æ€§ã€‚åªéœ€å°† TextStyle å®ä¾‹ä¼ é€’ç»™ Text å¯ç»„åˆé¡¹ï¼Œä½ å°±å¯ä»¥è½»æ¾è‡ªå®šä¹‰å…¶è®¾è®¡ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">Text</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span><span class='line'>        <span class="p">.</span><span class="n">fillMaxWidth</span><span class="p">()</span>
</span><span class='line'>        <span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="n">top</span> <span class="p">=</span> <span class="m">16.</span><span class="n">dp</span><span class="p">),</span>
</span><span class='line'>    <span class="n">text</span> <span class="p">=</span> <span class="s">&quot;Stats&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">style</span> <span class="p">=</span> <span class="n">TextStyle</span><span class="p">(</span>
</span><span class='line'>        <span class="n">fontSize</span> <span class="p">=</span> <span class="m">16.</span><span class="n">sp</span><span class="p">,</span>
</span><span class='line'>        <span class="n">lineHeight</span> <span class="p">=</span> <span class="m">24.</span><span class="n">sp</span><span class="p">,</span>
</span><span class='line'>        <span class="n">fontWeight</span> <span class="p">=</span> <span class="n">FontWeight</span><span class="p">(</span><span class="m">600</span><span class="p">),</span>
</span><span class='line'>        <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">White</span><span class="p">,</span>
</span><span class='line'>        <span class="n">textAlign</span> <span class="p">=</span> <span class="n">TextAlign</span><span class="p">.</span><span class="n">Center</span><span class="p">,</span>
</span><span class='line'>    <span class="p">),</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½¿ç”¨æ ·å¼ç±»çš„ä¼˜ç‚¹æ˜¯ï¼Œå®ƒä»¬å…è®¸ç»„ä»¶å¼€å‘äººå‘˜å°†æ‰€æœ‰è®¾è®¡è§„èŒƒæ•´åˆåˆ°ä¸€ä¸ªé›†ä¸­çš„ç±»ä¸­ã€‚è¿™ç§æ–¹æ³•å¯ä»¥é˜²æ­¢è®¾è®¡å…ƒç´ åˆ†æ•£åœ¨å¤šä¸ªå¸ƒå±€ä¸­ï¼Œä»è€Œä½¿ä»£ç åº“æ›´ç®€æ´ã€æ›´æ˜“äºç®¡ç†ã€‚</p>

<p>å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œæ ·å¼ç±»æä¾›äº†ä¸€ç§ç›´æ¥ä¸”ç›´è§‚çš„ä¿®æ”¹è®¾è®¡çš„æ–¹æ³•ã€‚æ­¤å¤–ï¼Œç”¨æˆ·å¯ä»¥åœ¨å¤šä¸ªå¸ƒå±€ä¸­é‡å¤ä½¿ç”¨ç›¸åŒçš„æ ·å¼å®ä¾‹ï¼Œä»è€Œæ›´æ–¹ä¾¿åœ°åœ¨ä¸åŒå¸ƒå±€ä¸­åº”ç”¨ä¸€è‡´çš„è‡ªå®šä¹‰ã€‚</p>

<p>ä¸€ä¸ªæ½œåœ¨çš„ç¼ºç‚¹æ˜¯ï¼Œç”±äº<a href="https://getstream.io/blog/jetpack-compose-stability/#jetpack-compose-phases">é‡ç»„æœºåˆ¶ï¼ˆRecompositionï¼‰</a>ï¼Œæ¯å½“è¾“å…¥å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒCompose è¿è¡Œæ—¶éƒ½ä¼šæ¯”è¾ƒæ ·å¼ç±»çš„æ‰€æœ‰å±æ€§ï¼Œä»¥ç¡®å®šæ˜¯å¦éœ€è¦é‡ç»„ã€‚ä¸ç›´æ¥åœ¨å¯ç»„åˆå‡½æ•°ä¸­å®šä¹‰å•ä¸ªå‚æ•°ç›¸æ¯”ï¼Œè¿™ä½¿å…¶æˆæœ¬ç•¥é«˜ã€‚ç„¶è€Œï¼Œä» API è®¾è®¡çš„è§’åº¦æ¥çœ‹ï¼Œæ”¹è¿›çš„ç”¨æˆ·ä½“éªŒå’Œç®€åŒ–çš„ API ç®¡ç†é€šå¸¸è¶…è¿‡äº†è¿™ä¸€æˆæœ¬ï¼Œå› æ­¤åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸€ç§å€¼å¾—çš„æƒè¡¡ã€‚</p>

<h3>2. å€ŸåŠ©æ’æ§½ï¼ˆSlotsï¼‰çš„çµæ´»æ€§</h3>

<p>å¢å¼ºè‡ªå®šä¹‰çµæ´»æ€§çš„å¦ä¸€ç§æœ‰æ•ˆç­–ç•¥æ˜¯æä¾›æ¥å—å¯ç»„åˆå‡½æ•°çš„æ’æ§½ï¼Œè®©ç”¨æˆ·æ ¹æ®è‡ªå·±çš„éœ€æ±‚å®šä¹‰ç‰¹å®šçš„å®ç°ã€‚é€šè¿‡æä¾›é»˜è®¤å®ç°ï¼Œä½ å¯ä»¥ç¡®ä¿ç”¨æˆ·æ— éœ€ä»˜å‡ºé¢å¤–åŠªåŠ›å³å¯åˆ©ç”¨æ‰€æä¾›çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä»ç„¶å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œè‡ªå®šä¹‰ã€‚</p>

<p>ä¾‹å¦‚ï¼ŒStream Video SDK æä¾›çš„ CallContent ç»„ä»¶æ˜¯ä¸€ä¸ªé«˜çº§ APIï¼Œå®ƒé›†æˆäº†å¤šä¸ªå­ç»„ä»¶ï¼ŒåŒ…æ‹¬é¡¶éƒ¨åº”ç”¨æ ã€è§†é¢‘æ¸²æŸ“å™¨ã€å¸ƒå±€ç»“æ„ã€ç½‘æ ¼å‚ä¸è€…ç­‰ã€‚è™½ç„¶ CallContent API åŒ…å«é»˜è®¤å®ç°ä»¥æ–¹ä¾¿ä½¿ç”¨ï¼Œä½†å®ƒè¿˜é€šè¿‡å…è®¸é€šè¿‡æ’æ§½å‚æ•°è¿›è¡Œè‡ªå®šä¹‰æ¥ç¡®ä¿çµæ´»æ€§ï¼Œå¦‚ä»¥ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">fun</span> <span class="nf">CallContent</span><span class="p">(</span>
</span><span class='line'>    <span class="n">call</span><span class="p">:</span> <span class="n">Call</span><span class="p">,</span>
</span><span class='line'>    <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>    <span class="n">style</span><span class="p">:</span> <span class="n">VideoRendererStyle</span> <span class="p">=</span> <span class="n">RegularVideoRendererStyle</span><span class="p">(),</span>
</span><span class='line'>    <span class="n">appBarContent</span><span class="p">:</span> <span class="n">@Composable</span> <span class="p">(</span><span class="n">call</span><span class="p">:</span> <span class="n">Call</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Unit</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">CallAppBar</span><span class="p">(..)</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="n">videoRenderer</span><span class="p">:</span> <span class="n">@Composable</span> <span class="p">(..)</span> <span class="p">-&gt;</span> <span class="n">Unit</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">ParticipantVideo</span><span class="p">(..)</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="n">videoContent</span><span class="p">:</span> <span class="n">@Composable</span> <span class="n">RowScope</span><span class="p">.(</span><span class="n">call</span><span class="p">:</span> <span class="n">Call</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Unit</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">ParticipantsLayout</span><span class="p">(..)</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="p">..</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ç§æ–¹æ³•å…è®¸ç”¨æˆ·å®ç°è‡ªå·±çš„é¡¶éƒ¨åº”ç”¨æ ã€è§†é¢‘æ¸²æŸ“å™¨ã€å¸ƒå±€ç»“æ„ã€ç½‘æ ¼å‚ä¸è€…ç­‰è‡ªå®šä¹‰ç‰ˆæœ¬ã€‚æ­¤å¤–ï¼Œå¦ä¸€ç§æœ‰æ•ˆçš„ç­–ç•¥æ˜¯å°†ç›¸ä¼¼ç±»å‹çš„ç»„ä»¶åˆ†ç»„ï¼Œå¹¶é€šè¿‡æ’æ§½ä½¿å®ƒä»¬å¯è‡ªå®šä¹‰ï¼Œè¿™é€šå¸¸ç§°ä¸ºå¤åˆç»„ä»¶æ¨¡å¼ã€‚</p>

<p>å¤åˆç»„ä»¶æ¨¡å¼æ¶‰åŠåˆ›å»ºä¸€ä¸ªçˆ¶ç»„ä»¶æ¥ç®¡ç†å­ç»„ä»¶é›†åˆï¼Œé€šè¿‡ä¸ºæ¯ä¸ªå­ç»„ä»¶å…¬å¼€æ’æ§½æ¥æä¾›è‡ªå®šä¹‰ã€‚æ­¤æ¨¡å¼å…è®¸ç”¨æˆ·æ›¿æ¢æˆ–è‡ªå®šä¹‰å•ä¸ªå­ç»„ä»¶ï¼ŒåŒæ—¶ä¿æŒæ•´ä½“ç»“æ„å’ŒåŠŸèƒ½çš„ä¸€è‡´æ€§ã€‚</p>

<p>æƒ³è±¡ä¸€ä¸‹è§†é¢‘é€šè¯å±å¹•ä¸Šçš„æ§åˆ¶é¢æ¿åŒ…å«å¤šä¸ªæ“ä½œæŒ‰é’®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>

<p><img src="https://miro.medium.com/v2/resize:fit:886/format:webp/0*mNh-EWJlyCobHHed" alt="Control Panel" /></p>

<p>æœ‰äº›ç”¨æˆ·å¯èƒ½å–œæ¬¢ä¸åŒçš„æ“ä½œæŒ‰é’®é¡ºåºï¼Œä¾‹å¦‚å°†éº¦å…‹é£æŒ‰é’®æ”¾åœ¨ç¬¬ä¸€ä½ï¼Œè€Œå…¶ä»–ç”¨æˆ·å¯èƒ½å¸Œæœ›æ ¹æ®å…¶ç‰¹å®šç”¨ä¾‹æ·»åŠ ã€åˆ é™¤æˆ–è‡ªå®šä¹‰æŒ‰é’®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤åˆç»„ä»¶æ¨¡å¼è¢«è¯æ˜åœ¨æ»¡è¶³è¿™äº›ä¸åŒçš„è¦æ±‚æ–¹é¢éå¸¸æœ‰æ•ˆï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">public</span> <span class="k">fun</span> <span class="nf">ControlActions</span><span class="p">(</span>
</span><span class='line'>    <span class="n">call</span><span class="p">:</span> <span class="n">Call</span><span class="p">,</span>
</span><span class='line'>    <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>    <span class="n">actions</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;(</span><span class="n">@Composable</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">)&gt;</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Box</span><span class="p">(</span>
</span><span class='line'>        <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">LazyRow</span><span class="p">(</span>
</span><span class='line'>            <span class="n">verticalAlignment</span> <span class="p">=</span> <span class="n">Alignment</span><span class="p">.</span><span class="n">CenterVertically</span><span class="p">,</span>
</span><span class='line'>            <span class="n">horizontalArrangement</span> <span class="p">=</span> <span class="n">Arrangement</span><span class="p">.</span><span class="n">spacedBy</span><span class="p">(</span>
</span><span class='line'>                <span class="n">VideoTheme</span><span class="p">.</span><span class="n">dimens</span><span class="p">.</span><span class="n">spacingM</span><span class="p">,</span>
</span><span class='line'>                <span class="n">Alignment</span><span class="p">.</span><span class="n">CenterHorizontally</span><span class="p">,</span>
</span><span class='line'>            <span class="p">),</span>
</span><span class='line'>        <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">items</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span> <span class="p">{</span> <span class="n">action</span> <span class="p">-&gt;</span>
</span><span class='line'>                <span class="n">action</span><span class="p">.</span><span class="n">invoke</span><span class="p">()</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢çš„ä»£ç æ¼”ç¤ºäº†ä¸€ä¸ªæ¥å— Composable å‡½æ•°åˆ—è¡¨çš„å•ä¸ªæ’æ§½ï¼Œç„¶åä½¿ç”¨ Row æˆ– LazyRow è¿›è¡Œæ¸²æŸ“ã€‚è¿™ç§æ–¹æ³•å…è®¸ä½ æä¾›é«˜åº¦çµæ´»çš„ç»„ä»¶ APIï¼ŒåŒæ—¶ä¿æŒå¯¹ç»„ä»¶å¸ƒå±€é¢„æœŸç»“æ„çš„æ§åˆ¶ã€‚</p>

<p>ä¹‹åï¼Œä½ è¿˜å¯ä»¥æä¾›é»˜è®¤å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œä»¥å¢åŠ ä¾¿åˆ©æ€§ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">public</span> <span class="k">fun</span> <span class="nf">buildDefaultCallControlActions</span><span class="p">(</span>
</span><span class='line'>    <span class="n">onCallAction</span><span class="p">:</span> <span class="p">(</span><span class="n">CallAction</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">,</span>
</span><span class='line'><span class="p">):</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">@Composable</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">&gt;</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">listOf</span><span class="p">(</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">ToggleCameraAction</span><span class="p">(</span>
</span><span class='line'>                <span class="n">onCallAction</span> <span class="p">=</span> <span class="n">onCallAction</span><span class="p">,</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">ToggleMicrophoneAction</span><span class="p">(</span>
</span><span class='line'>                <span class="n">onCallAction</span> <span class="p">=</span> <span class="n">onCallAction</span><span class="p">,</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">FlipCameraAction</span><span class="p">(</span>
</span><span class='line'>                <span class="n">onCallAction</span> <span class="p">=</span> <span class="n">onCallAction</span><span class="p">,</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">public</span> <span class="k">fun</span> <span class="nf">ControlActions</span><span class="p">(</span>
</span><span class='line'>    <span class="n">call</span><span class="p">:</span> <span class="n">Call</span><span class="p">,</span>
</span><span class='line'>    <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onCallAction</span><span class="p">:</span> <span class="p">(</span><span class="n">CallAction</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Unit</span> <span class="p">=</span> <span class="p">{</span> <span class="n">DefaultOnCallActionHandler</span><span class="p">.</span><span class="n">onCallAction</span><span class="p">(</span><span class="n">call</span><span class="p">,</span> <span class="n">it</span><span class="p">)</span> <span class="p">},</span>
</span><span class='line'>    <span class="n">actions</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;(</span><span class="n">@Composable</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">)&gt;</span> <span class="p">=</span> <span class="n">buildDefaultCallControlActions</span><span class="p">(</span><span class="n">onCallAction</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚éœ€äº†è§£æ›´å¤š<a href="https://getstream.io/video/docs/android/ui-components/call/call-controls/"> ControlActions </a>çš„çœŸå®ç¤ºä¾‹ï¼Œä½ å¯ä»¥æ¢ç´¢<a href="https://github.com/GetStream/stream-video-android/blob/c12db8cb6367e10682be3ab323d50dfcc59032f3/stream-video-android-ui-compose/src/main/kotlin/io/getstream/video/android/compose/ui/components/call/controls/ControlActions.kt#L48"> GitHub </a>ä¸Šçš„å®ç°ã€‚</p>

<h3>3. ä½¿ç”¨ä¸»é¢˜è¿›è¡Œå®šåˆ¶</h3>

<p>è®¾è®¡ Compose ç»„ä»¶æ—¶çš„å¦ä¸€ä¸ªå¸¸è§æŒ‘æˆ˜æ˜¯ï¼Œéšç€ç»„ä»¶å±‚æ¬¡ç»“æ„çš„å˜å¤§ï¼Œæä¾›æ¸…æ™°ã€ç›´æ¥çš„å¯å®šåˆ¶æ€§å˜å¾—æ›´åŠ å›°éš¾ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æƒ³ä¸ºç»„ä»¶å¤šä¸ªéƒ¨åˆ†ä½¿ç”¨çš„è§†é¢‘æ¸²æŸ“å™¨æä¾›å¯å®šåˆ¶æ€§ï¼Œä½† UI å±‚æ¬¡ç»“æ„åµŒå¥—å¾ˆæ·±ä¸”å¾ˆå¤æ‚ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">CallContent</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">ParticipantsLayout</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">ParticipantsRegularGrid</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">OrientationVideoRenderer</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">LazyVerticalGrid</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">VideoRenderer</span><span class="p">()</span> <span class="c1">// &lt;-- users want to customize this renderer style</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">FloatingVideoRenderer</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">VideoRenderer</span><span class="p">()</span> <span class="c1">// &lt;-- users want to customize this renderer style</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†æ’æ§½æˆ–æ ·å¼å‚æ•°ä»æœ€é¡¶å±‚çš„ç»„ä»¶ä¸€ç›´ä¼ é€’åˆ° VideoRenderer ç»„ä»¶å¹¶ä¸ç†æƒ³ã€‚éšç€ä½ åœ¨ä¸åŒç»„ä»¶ä¹‹é—´æ·»åŠ æ›´å¤šå¯å®šåˆ¶æ€§ï¼Œæœ€é¡¶å±‚çš„ç»„ä»¶ (CallContent) å¯èƒ½ä¼šå› å¤§é‡æ’æ§½å’Œæ ·å¼å‚æ•°è€Œå˜å¾—è¿‡è½½ã€‚è¿™ä¸ä»…ä½¿ä½ çš„ API æ›´éš¾ç»´æŠ¤ï¼Œè€Œä¸”è¿˜å¢åŠ äº†ç”¨æˆ·æ··æ·†æˆ–è¯¯ç”¨çš„å¯èƒ½æ€§ï¼Œå› ä¸ºä¸æ¸…æ¥šå“ªä¸ªå‚æ•°ç”¨äºä»€ä¹ˆç”¨é€”ã€‚</p>

<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥åˆ©ç”¨è‡ªå®šä¹‰ä¸»é¢˜å’Œ<a href="https://developer.android.com/develop/ui/compose/compositionlocal"> CompositionLocal</a>æ¥å®ç°å¯å®šåˆ¶æ€§ï¼ŒåŒæ—¶ä¿æŒ API æ›´æ¸…æ™°ã€æ›´æ˜“äºç®¡ç†ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Immutable</span>
</span><span class='line'><span class="k">public</span> <span class="n">data</span> <span class="k">class</span> <span class="nc">VideoRendererStyle</span><span class="p">(</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">backgroundColor</span><span class="p">:</span> <span class="n">Color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">Black</span><span class="p">,</span>
</span><span class='line'>    <span class="p">..</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">private</span> <span class="k">val</span> <span class="py">LocalVideoRendererStyle</span> <span class="p">=</span> <span class="n">compositionLocalOf</span><span class="p">&lt;</span><span class="n">VideoRendererStyle</span><span class="p">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">error</span><span class="p">(</span><span class="s">&quot;No VideoRendererStyle provided! Make sure to wrap all usages of Stream components in a VideoTheme.&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">public</span> <span class="k">fun</span> <span class="nf">VideoTheme</span><span class="p">(</span>
</span><span class='line'>    <span class="n">videoRendererStyle</span><span class="p">:</span> <span class="n">VideoRendererStyle</span> <span class="p">=</span> <span class="n">VideoRendererStyle</span><span class="p">(),</span>
</span><span class='line'>    <span class="n">content</span><span class="p">:</span> <span class="n">@Composable</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">CompositionLocalProvider</span><span class="p">(</span>
</span><span class='line'>        <span class="n">LocalVideoRendererStyle</span> <span class="n">provides</span> <span class="n">videoRendererStyle</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">content</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç°åœ¨ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨ä¸åŒçš„ç»„ä»¶ä¸­ä½¿ç”¨æä¾›çš„æ ·å¼æ¥ç¡®ä¿ç»„ä»¶æ ·å¼çš„ä¸€è‡´æ€§ï¼Œè€Œæ— éœ€å°†å®ƒä»¬ä½œä¸ºå‚æ•°åå¤ä¼ é€’ã€‚æ­¤å¤–ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡åˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰ä¸»é¢˜è½»æ¾è‡ªå®šä¹‰æ ·å¼ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">setContent</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">VideoTheme</span><span class="p">(</span>
</span><span class='line'>        <span class="n">videoRendererStyle</span> <span class="p">=</span> <span class="n">VideoRendererStyle</span><span class="p">(</span><span class="n">backgroundColor</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">Blue</span><span class="p">)</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="p">..</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœä½ å¸Œæœ›æ›´å¹¿æ³›åœ°åº”ç”¨æ­¤ç­–ç•¥å¹¶é«˜æ•ˆåœ°ç®¡ç†æ›´å¤šæ ·å¼ï¼Œåˆ™å¯ä»¥å°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªç±»ï¼Œä¾‹å¦‚ StreamStyles ï¼Œå¹¶æä¾›ç»Ÿä¸€çš„æ ·å¼ç±»ï¼Œè€Œä¸æ˜¯ CompositionLocal ä¸­çš„å¤šä¸ªå•ç‹¬æ ·å¼ã€‚æœ‰äº›åŒå­¦å¯èƒ½ä¼šæ‹…å¿ƒ CompositionLocal å¸¦æ¥çš„æ€§èƒ½å½±å“ï¼Œå› ä¸ºå®ƒä¼šåœ¨å€¼æ›´æ”¹æ—¶è§¦å‘å¸ƒå±€å±‚æ¬¡ç»“æ„çš„é‡ç»„ï¼Œä½†ä¸»é¢˜é€šå¸¸ä¸ä¼šåœ¨åº”ç”¨ç¨‹åºä¸­é¢‘ç¹æ›´æ–°ã€‚å®ƒä»¬é€šå¸¸æ˜¯é™æ€çš„ï¼Œä»¥ç¡®ä¿è®¾è®¡ä¸€è‡´æ€§ï¼Œå› æ­¤åœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨ CompositionLocal æ˜¯ä¸€ç§åˆé€‚ä¸”æœ‰æ•ˆçš„é€‰æ‹©ã€‚</p>

<h2>é¢„è§ˆï¼ˆPreviewï¼‰çš„å…¼å®¹æ€§</h2>

<p>æä¾›é¢„è§ˆéå¸¸é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨æ„å»ºç»„ä»¶ API æ—¶ï¼Œå› ä¸ºå®ƒä»¬å…è®¸å¼€å‘äººå‘˜ç›´æ¥åœ¨ Android Studio ä¸­å¯è§†åŒ–å’ŒéªŒè¯ä»–ä»¬çš„ UI è®¾è®¡ã€‚
ä¸€äº›åŒå­¦ä¾é <a href="https://developer.android.com/develop/ui/compose/tooling#live-edit-literals"> Live Literals </a>æ¥åŠ¨æ€å±•ç¤ºé¢„è§ˆä¸­çš„å˜åŒ–ï¼Œè€Œå…¶ä»–åŒå­¦åˆ™ä½¿ç”¨å±å¹•æˆªå›¾æµ‹è¯•æ¥ç¡®ä¿å…¶ç»„ä»¶çš„è§†è§‰ä¸€è‡´æ€§ã€‚å› æ­¤ï¼Œåœ¨å®ç° Compose ç»„ä»¶æ—¶ï¼Œå¿…é¡»ç¡®ä¿å®ƒä»¬ä¸ Android Studio ä¸­çš„é¢„è§ˆåŠŸèƒ½å®Œå…¨å…¼å®¹ï¼Œå¦‚ä¸‹é¢çš„å±å¹•æˆªå›¾æ‰€ç¤ºï¼š</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*R74xLmTnWswi86ww" alt="Preview" /></p>

<p>æœ‰æ—¶ï¼Œä½ çš„ç»„ä»¶å¯èƒ½ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼Œä¾‹å¦‚åœ¨å‘å‡ºç½‘ç»œè¯·æ±‚æˆ–å¤„ç†åŠ¨æ€çŠ¶æ€åæ¸²æŸ“å›¾åƒï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é¢„è§ˆå‡ºç°æ•…éšœã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥åˆ©ç”¨<a href="https://developer.android.com/develop/ui/compose/tooling/previews#localinspectionmode"> LocalInspectionMode</a>ã€‚</p>

<p>LocalInspectionMode å…è®¸ä½ ç¡®å®šå¯ç»„åˆé¡¹æ˜¯å¦åœ¨é¢„è§ˆæ¨¡å¼ä¸‹å‘ˆç°ï¼Œä»è€Œä½¿ä½ å¯ä»¥å‘ˆç°ä¸“é—¨ç”¨äºé¢„è§ˆç›®çš„çš„ä¸“ç”¨å¸ƒå±€ã€‚è¿™ç§æ–¹æ³•å¯ç¡®ä¿é¢„è§ˆä¿æŒåŠŸèƒ½ï¼Œå³ä½¿ä½ çš„ç»„ä»¶ä¾èµ–äºå¤æ‚çš„é€»è¾‘æˆ–å¤–éƒ¨èµ„æºã€‚ä½ å¯ä»¥ä»<a href="https://github.com/skydoves/landscapist"> Landscapist </a>ä¸­æ‰¾åˆ°ä¸€ä¸ªç”¨äºç½‘ç»œå›¾åƒåŠ è½½çš„ Jetpack Compose åº“çš„çœŸå®ç¤ºä¾‹ï¼Œå®ƒæ¼”ç¤ºäº†å¤„ç†é¢„è§ˆçš„æœ€ä½³å®è·µã€‚</p>

<p>ä¸‹é¢çš„å¯ç»„åˆå‡½æ•°ä¼šæ£€æŸ¥å®ƒæ˜¯å¦å¤„äºé¢„è§ˆæ¨¡å¼ã€‚å¦‚æœæ˜¯ï¼Œå®ƒä¼šæ¸²æŸ“é™æ€å›¾åƒï¼Œè€Œä¸æ˜¯æ‰§è¡Œè¯¸å¦‚è·å–ç½‘ç»œæ•°æ®ä¹‹ç±»çš„å‰¯ä½œç”¨ã€‚è¿™ç§æ–¹æ³•å…è®¸ç”¨æˆ·ä¸º GlideImage å¯ç»„åˆå‡½æ•°æ„å»ºè‡ªå·±çš„é¢„è§ˆï¼Œè€Œä¸ä¼šåœ¨é¢„è§ˆæ¸²æŸ“æœŸé—´é‡åˆ°è¿è¡Œæ—¶é”™è¯¯ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">public</span> <span class="k">fun</span> <span class="nf">GlideImage</span><span class="p">(</span>
</span><span class='line'>  <span class="n">imageModel</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Any</span><span class="p">?,</span>
</span><span class='line'>  <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>  <span class="n">previewPlaceholder</span><span class="p">:</span> <span class="n">Painter</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
</span><span class='line'>  <span class="p">..</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">LocalInspectionMode</span><span class="p">.</span><span class="n">current</span> <span class="p">&amp;&amp;</span> <span class="n">previewPlaceholder</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">Image</span><span class="p">(</span>
</span><span class='line'>        <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">,</span>
</span><span class='line'>        <span class="n">painter</span> <span class="p">=</span> <span class="n">previewPlaceholder</span><span class="p">,</span>
</span><span class='line'>        <span class="p">..</span>
</span><span class='line'>      <span class="p">)</span>
</span><span class='line'>      <span class="k">return</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// complex logic about requesting network data and render it</span>
</span><span class='line'>  <span class="p">..</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸ºäº†å¢å¼ºé¡¹ç›®ä¸­çš„æ•´ä½“é¢„è§ˆç­–ç•¥ï¼Œè¯·è€ƒè™‘æ¢ç´¢<a href="https://getstream.io/blog/effective-compose-preview/">è®¾è®¡æœ‰æ•ˆçš„ UI ä»¥å¢å¼º Compose é¢„è§ˆ</a>ã€‚æ­¤èµ„æºæä¾›äº†æœ‰ä»·å€¼çš„è§è§£å’ŒæŠ€æœ¯ï¼Œå¯æœ‰æ•ˆä¼˜åŒ–ä½ çš„ Compose é¢„è§ˆã€‚</p>

<h2>ç»“è®º</h2>

<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†åœ¨ Jetpack Compose ä¸­åˆ¶ä½œæœ‰æ•ˆ UI ç»„ä»¶çš„ç­–ç•¥ï¼Œé‡ç‚¹å…³æ³¨æœ€ä½³å®è·µï¼Œä¾‹å¦‚é«˜æ•ˆå¤„ç†Modifierã€ç¡®ä¿è®¾è®¡ä¸ä¸»é¢˜ä¸€è‡´ã€å®æ–½å¯å®šåˆ¶æ€§ç­–ç•¥ä»¥åŠå¢å¼ºé¢„è§ˆå…¼å®¹æ€§ã€‚è®¾è®¡ç›´è§‚ä¸”å¼ºå¤§çš„ API å§‹ç»ˆæ˜¯ä¸€é¡¹æŒ‘æˆ˜ï¼Œä½†åŠªåŠ›ç»ˆå°†è·å¾—å›æŠ¥ï¼Œå› ä¸ºç”¨æˆ·ä½“éªŒå’Œå¼€å‘è€…æ»¡æ„åº¦æ˜¾è‘—æå‡ã€‚</p>

<p>å¦‚æœä½ å¯¹æœ¬æ–‡æœ‰ä»»ä½•ç–‘é—®æˆ–åé¦ˆï¼Œå¯ä»¥åœ¨ Twitter<a href="https://twitter.com/github_skydoves"> @github_skydoves </a>æˆ–<a href="https://github.com/skydoves"> GitHub </a>ä¸Šæ‰¾åˆ°ä½œè€…ã€‚å¦‚æœä½ æƒ³éšæ—¶äº†è§£ Stream çš„æœ€æ–°åŠ¨æ€ï¼Œè¯·åœ¨ Twitter ä¸Šå…³æ³¨æˆ‘ä»¬<a href="https://twitter.com/getstream_io"> @getstream_io</a>ï¼Œè·å–æ›´å¤šç²¾å½©çš„æŠ€æœ¯å†…å®¹ã€‚</p>

<p>è€è§„çŸ©ï¼Œç¥ä½ ç¼–ç æ„‰å¿«ï¼ &ndash; <a href="https://github.com/skydoves">Jaewoong</a></p>

<p>æœ€åˆ<a href="https://getstream.io/blog/designing-effective-compose/">å‘å¸ƒäº GetStream.io</a>ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Understanding Algorithm Tarjan]]></title>
    <link href="https://alexhilton.github.io/blog/2025/03/07/understanding-algorithm-tarjan/"/>
    <updated>2025-03-07T20:45:57+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/03/07/understanding-algorithm-tarjan</id>
    <content type="html"><![CDATA[<h2>Introduction</h2>

<p><a href="https://en.wikipedia.org/wiki/Tarjan%27s_strongly_connected_components_algorithm">Tarjanç®—æ³•</a>æ˜¯ç”¨äºå¯»æ‰¾å›¾ä¸­å¼ºè¿é€šç»„ä»¶çš„é«˜æ•ˆç®—æ³•ã€‚é€šå¸¸å«åšã€Œå‰²ç‚¹ã€æˆ–è€…ã€Œå‰²è¾¹ã€ï¼Œä¹Ÿå«åšæ¡¥ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå»æ‰äº†æŸä¸ªèŠ‚ç‚¹ï¼Œæˆ–è€…æŸæ¡è¾¹ï¼Œå›¾ä¸­çš„è¿é€šåˆ†é‡æ•°é‡ä¼šå¢åŠ ï¼Œé‚£ä¹ˆè¿™æ ·çš„èŠ‚ç‚¹å°±æ˜¯å‰²ç‚¹ï¼Œè¿™æ ·çš„è¾¹å°±æ˜¯æ¡¥ã€‚</p>

<p>æ¯”å¦‚è¯´ï¼Œä¸‹é¢è¿™ä¸ªå›¾ä¸­çš„èŠ‚ç‚¹2å°±æ˜¯ä¸€ä¸ªã€Œå‰²ç‚¹ã€ï¼š</p>

<p><a href="https://alexhilton.github.io/blog/2025/03/07/understanding-algorithm-tarjan/"><img src="https://oi-wiki.org/graph/images/cut1.svg" title="auto auto" ></a></p>

<!-- more -->


<p>è€Œä¸‹é¢è¿™ä¸ªå›¾ä¸­çš„çº¢è‰²çš„è¾¹å°±æ˜¯ã€Œæ¡¥ã€ï¼š</p>

<p><img src="https://oi-wiki.org/graph/images/bridge1.svg" alt="Cut edge/Bridge" /></p>

<h2>Tarjan&rsquo;s Algorithm</h2>

<p>å¯»æ‰¾ã€Œå‰²ç‚¹ã€å’Œã€Œæ¡¥ã€çš„æœ´ç´ æ–¹æ³•æ˜¯ï¼Œéå†æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ–è€…è¾¹ï¼Œå°è¯•å»æ‰å®ƒï¼Œç„¶åæŸ¥çœ‹è¿é€šåˆ†é‡çš„æ•°é‡æœ‰æ²¡æœ‰å¢åŠ ï¼Œæ˜¾ç„¶è¿™æ ·å¤æ‚åº¦å¾ˆé«˜è‡³å°‘æ˜¯O(n<sup>2</sup>)çš„ï¼Œæ‰€ä»¥è¦ä»‹ç»ä¸€ä¸ªå¸¸ç”¨çš„ç®—æ³•ï¼šTarjanã€‚</p>

<p>ä¸ºäº†ç®€å•ï¼Œå‡å®šå›¾çš„èŠ‚ç‚¹ä¸º0~n-1ï¼Œéœ€è¦ä¸¤ä¸ªè¾…åŠ©æ•°ç»„disc[n]ç”¨ä»¥è¡¨ç¤ºæ¯ä¸ªèŠ‚ç‚¹è¢«è®¿é—®åˆ°çš„æ¬¡åºï¼Œæˆ–è€…è¯´è¢«è®¿é—®åˆ°çš„æ—¶é—´æˆ³ï¼Œéœ€è¦æ³¨æ„ï¼Œè¿™ä¸ªå¯¹äºå›¾ä¸­èŠ‚ç‚¹æ¥è¯´æ˜¯å”¯ä¸€çš„ï¼Œä¸”ä¸æ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œä»£è¡¨ç€éå†è¿‡ç¨‹ä¸­è®¿é—®åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„æ¬¡åºã€‚ç›®çš„æ˜¯ç”¨äºå”¯ä¸€æ ‡è¯†æ¯ä¸ªèŠ‚ç‚¹ï¼Œä»¥åŠèŠ‚ç‚¹åœ¨éå†ä¸­çš„æ¬¡åºã€‚</p>

<p>å¦ä¸€ä¸ªè¾…åŠ©æ•°ç»„æ˜¯low[n]ï¼Œå®ƒè®°å½•çš„æ˜¯å½“å‰èŠ‚ç‚¹æ‰€åœ¨çš„å­æ ‘ä¸­è¢«è®¿é—®åˆ°çš„æœ€æ—©çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯å¼ºè¿é€šåˆ†é‡å­æ ‘çš„æ ¹ã€‚ä¹Ÿå°±æ˜¯è¯´low[u]çš„å€¼æ˜¯åŒ…å«uåœ¨å†…çš„å­æ ‘çš„æ ¹ï¼Œå®ƒä¸€å®šæ˜¯æœ€æ—©è¢«è®¿é—®çš„ã€‚åŸç†åœ¨äºï¼Œå¼ºè¿é€šåˆ†é‡ä¸€å®šæœ‰ç¯ï¼Œé‚£ä¹ˆä»å½“å‰èŠ‚ç‚¹uå†å¾€å›è¿”å›åˆ°çš„uä¹‹å‰çš„èŠ‚ç‚¹æ—¶ï¼Œå°±å½¢æˆäº†ç¯ï¼Œä¹Ÿå³æ˜¯è¿é€šåˆ†é‡ï¼Œlow[u]å°±è®°å½•ç€è¿™ä¸ªè¿é€šåˆ†é‡çš„æ ¹ï¼Œä¹Ÿå³æœ€æ—©è¢«è®¿é—®åˆ°çš„èŠ‚ç‚¹ã€‚æ˜¾ç„¶ï¼Œå½“low[u] = uæ—¶ï¼Œå°±æ‰¾åˆ°äº†è¿™ä¸ªæ ¹èŠ‚ç‚¹ï¼Œå½“ç„¶ä¹Ÿæ‰¾åˆ°äº†ä¸€ä¸ªå¼ºè¿é€šåˆ†é‡ï¼Œå¦‚æœåœ¨éå†è¿‡ç¨‹ä¸­è®°å½•é¡¶ç‚¹ï¼Œé‚£ä¹ˆå½“low[u] = uæ—¶ï¼Œè®°å½•è¿‡çš„é¡¶ç‚¹å°±éƒ½åœ¨ä¸€ä¸ªå¼ºè¿é€šåˆ†é‡é‡Œé¢ã€‚</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œéå†çš„æ–¹æ³•è¦ç”¨DFSï¼Œå› ä¸ºDFSè‚¯å®šèƒ½ä»¥æœ€å¿«çš„æ–¹å¼æ‰¾åˆ°ç¯ï¼Œå›åˆ°å·²éå†è¿‡çš„èŠ‚ç‚¹ã€‚</p>

<h2>å…¸å‹é¢˜ç›®</h2>

<table>
<thead>
<tr>
<th style="text-align:left;"> é¢˜ç›® </th>
<th style="text-align:left;"> é¢˜è§£ </th>
<th style="text-align:left;"> è¯´æ˜ </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> <a href="https://leetcode.cn/problems/critical-connections-in-a-network/description/">1192. æŸ¥æ‰¾é›†ç¾¤å†…çš„å…³é”®è¿æ¥</a></td>
<td style="text-align:left;"> <a href="https://leetcode.cn/problems/critical-connections-in-a-network/solutions/3599268/xi-you-yuan-su-1192-cha-zhao-ji-qun-nei-8wm0m/">é¢˜è§£</a> </td>
<td style="text-align:left;"> æ¿å­é¢˜ </td>
</tr>
<tr>
<td style="text-align:left;"> <a href=""></a></td>
<td style="text-align:left;"> <a href="">é¢˜è§£</a> </td>
<td style="text-align:left;"> </td>
</tr>
<tr>
<td style="text-align:left;"> <a href=""></a></td>
<td style="text-align:left;"> <a href="">é¢˜è§£</a> </td>
<td style="text-align:left;"> </td>
</tr>
</tbody>
</table>


<h2>å…³è”çŸ¥è¯†</h2>

<p><a href="https://en.wikipedia.org/wiki/Strongly_connected_component">å¼ºè¿é€šåˆ†é‡</a>ï¼Œå¼ºè¿é€šåˆ†é‡æ˜¯æŒ‡å›¾ä¸­çš„ä¸€ç»„ç›¸äº’å‡å¯è¾¾çš„èŠ‚ç‚¹ç»„æˆçš„å­é›†ã€‚æ³¨æ„ï¼Œå¼ºè¿é€šåˆ†é‡é‡Œé¢çš„èŠ‚ç‚¹ï¼Œåªéœ€è¦ç›¸äº’å‡å¯è¾¾ï¼Œå¹¶ä¸è¦æ±‚ç›´æ¥æœ‰è¾¹è¿æ¥ã€‚</p>

<p>ä¸åŒçš„å¼ºè¿é€šåˆ†é‡ä¹‹é—´çš„è¿æ¥ï¼ˆå³è¾¹æˆ–è€…é¡¶ç‚¹ï¼‰å³æ˜¯ã€Œå‰²ç‚¹ã€å’Œã€Œæ¡¥ã€ã€‚</p>

<p>å¯»æ‰¾å¼ºè¿é€šåˆ†é‡çš„ç®—æ³•ï¼Œé™¤äº†Tarjanä»¥å¤–ï¼Œè¿˜æœ‰<a href="https://en.wikipedia.org/wiki/Kosaraju%27s_algorithm">Kosarajuç®—æ³•</a>ã€‚</p>

<h2>References</h2>

<ul>
<li><a href="https://www.geeksforgeeks.org/tarjan-algorithm-find-strongly-connected-components/">Tarjanâ€™s Algorithm to find Strongly Connected Components</a></li>
<li><a href="https://www.baeldung.com/cs/scc-tarjans-algorithm">Finding Strongly Connected Components: Tarjanâ€™s Algorithm</a></li>
<li><a href="https://oi-wiki.org/graph/cut/">å‰²ç‚¹å’Œæ¡¥</a></li>
<li><a href="https://leetcode.cn/problems/critical-connections-in-a-network/solutions/2078647/mobanjibie-by-lao-song-2f-1r0d/?envType=study-plan-v2&amp;envId=graph-theory">Tarjan ç®—æ³•çš„æ¨¡æ¿é¢˜ï¼ˆJava ç‰ˆæœ¬ï¼‰</a></li>
<li><a href="https://www.geeksforgeeks.org/strongly-connected-components/">Strongly Connected Components</a></li>
<li><a href="https://www.geeksforgeeks.org/kosarajus-algorithm-in-c/">Kosarajuâ€™s Algorithm in C</a></li>
<li><a href="https://www.baeldung.com/cs/kosaraju-algorithm-scc">Finding Strongly Connected Components: Kosarajuâ€™s Algorithm</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä¸ä½¿ç”¨Jetpack Composeçš„10ä¸ªç†ç”±]]></title>
    <link href="https://alexhilton.github.io/blog/2025/03/06/reasons-not-to-use-jetpack-compose/"/>
    <updated>2025-03-06T22:25:19+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/03/06/reasons-not-to-use-jetpack-compose</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ª<a href="https://sonique6784.medium.com/10-reasons-to-not-use-jetpack-compose-719de5d37c9e">10 reasons to NOT use Jetpack Compose</a>ï¼ŒåŸæ–‡å‘å¸ƒäº2024å¹´9æœˆ24æ—¥ã€‚</p></blockquote>

<p><strong>è¯‘è€…æŒ‰ï¼š</strong> è½¯ä»¶å¼€å‘è¡Œä¸šä»ä¸ç¼ºå°‘ä¼˜ç§€çš„å·¥å…·ï¼Œå½“ç„¶ä¹Ÿæ²¡æœ‰é“¶å¼¹ã€‚èº«ä¸ºå¼€å‘è€…è¦å­¦ä¼šé€‰æ‹©åˆé€‚çš„å·¥å…·ï¼Œé¿å…å‡ºç°æ‰‹é‡Œæ‹¿ç€é”¤å­ï¼Œçœ‹ä»€ä¹ˆéƒ½æ˜¯é’‰å­ã€‚é‚£ä¹ˆå°±éœ€è¦ææ¸…æ¥šä¸¤ä¸ªäº‹æƒ…ï¼Œä¸€ä¸ªæ˜¯é¢ä¸´çš„åˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Œä»¥åŠæ¯ç§å·¥å…·å®ƒçš„åˆé€‚åœºæ™¯æ˜¯ä»€ä¹ˆã€‚æ²¡æœ‰å¯¹ä¸é”™ï¼Œåªæœ‰åˆé€‚ä¸åˆé€‚ã€‚è¿™ç¯‡æ–‡ç« å°±æ˜¯å¸®åŠ©å¤§å®¶æ›´æ¸…æ™°åœ°äº†è§£åˆ°Jetpack Composeé€‚ç”¨çš„åœºæ™¯ï¼Œå¸®åŠ©Androidå¼€å‘è€…åšå‡ºæœ€åˆé€‚çš„é€‰æ‹©ã€‚</p>

<h2>ç®€ä»‹</h2>

<p>Jetpack Compose æ˜¯ä¸€æ¬¾å‡ºè‰²çš„ UI å·¥å…·åŒ…ï¼Œå—åˆ° Android ç¤¾â€‹â€‹åŒºçš„çƒ­çƒˆæ¬¢è¿ã€‚å®ƒæä¾›äº†ä¸€ç§ä¸ºä½ çš„ Android åº”ç”¨æ„å»ºä»¤äººæ„‰æ‚¦çš„ UI çš„ç°ä»£æ–¹å¼ã€‚</p>

<p><a href="https://alexhilton.github.io/blog/2025/03/06/reasons-not-to-use-jetpack-compose/"><img src="https://www.sixt.tech/assets/jetpack-compose/jetpack-compose.png" title="auto auto" ></a></p>

<!-- more -->


<p>æˆ‘ç¡®å®å–œæ¬¢ Jetpack Composeï¼Œä½†ä¸ä»»ä½•æŠ€æœ¯ä¸€æ ·ï¼Œå®ƒä¹Ÿæœ‰ä¸€äº›æ³¨æ„äº‹é¡¹ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨ View ç³»ç»Ÿæ›´ä¸ºæ˜æ™ºä»¥åŠåŸå› ã€‚</p>

<h2>1. å°½å¯èƒ½å‡å°‘ä¾èµ–</h2>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BSFMClR4UbDbGhkXdfHhqg.png" alt="Compose Dependencies" /></p>

<p>å¦‚æœä½ éœ€è¦å°½å¯èƒ½å°‘çš„ä¾èµ–é¡¹ï¼Œè¿™å¯èƒ½æ˜¯å‡ºäºå…¼å®¹æ€§æˆ–å®‰å…¨æ€§ç›®çš„ï¼Œé‚£ä¹ˆä½¿ç”¨ View ç³»ç»Ÿå¯èƒ½ä¼šæ›´å¥½ã€‚View ç³»ç»Ÿä¸éœ€è¦é¢å¤–çš„å¯¼å…¥ã€‚å®ƒä½äº Android ç³»ç»Ÿå†…éƒ¨ï¼Œä¸ Jetpack Compose ä¸åŒï¼Œåè€…éœ€è¦å¤§é‡ä¾èµ–é¡¹ï¼Œè¿™ä¼šå¢åŠ åŒ…å ç”¨ç©ºé—´å’Œè¿è¡Œæ—¶çš„å†…å­˜ä½¿ç”¨é‡ï¼Œå¹¶ä¸ºé¢å¤–çš„é£é™©æ‰“å¼€å¤§é—¨ã€‚</p>

<h2>2. æ€§èƒ½</h2>

<p>View ç³»ç»Ÿè‡ª Android çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä»¥æ¥å°±ä¸€ç›´å­˜åœ¨ï¼Œå®ƒéå¸¸æˆç†Ÿï¼Œ15 å¹´æ¥å·²ç»è¿›è¡Œäº†å¤§é‡ä¼˜åŒ–ï¼Œå¯¹äºå¤æ‚çš„å¸ƒå±€ï¼Œå…¶æ€§èƒ½é€šå¸¸æ¯” Jetpack Compose æ›´å¥½ã€‚Jetpack Compose åœ¨æ¯æ¬¡è¿­ä»£ä¸­éƒ½åœ¨æ”¹è¿›ï¼Œæœ‰æ—¶å·²ç»æ¯” View æ›´å¥½ï¼Œè¯·å…³æ³¨è¿™ä¸ªé¢†åŸŸï¼ŒView å¯èƒ½å¾ˆå¿«å°±ä¼šå¤±å»æ€§èƒ½ä¹‹ç‹çš„æ¡‚å† ï¼</p>

<h2>3. Espressoæµ‹è¯•</h2>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xEebB2vruLxuGrxeoePu0g.png" alt="Espressoæµ‹è¯•" /></p>

<p>å¦‚æœä½ æœ‰å¤§é‡åŸºäº View çš„ Espresso æµ‹è¯•ï¼Œæˆ–è€…æƒ³è¦ä½¿ç”¨ Android Studio ä¸­çš„æµ‹è¯•è®°å½•åŠŸèƒ½ï¼Œæœ€å¥½é¿å…ä½¿ç”¨ Jetpack Composeï¼Œæˆ–è€…åªè€ƒè™‘å°† Jetpack Compose ç”¨äºæ–°çš„é¡µé¢ã€‚æ— æ³•è½»æ¾å°†äºView çš„ Espresso æµ‹è¯•è¿ç§»åˆ° Composeã€‚æ­¤å¤–<a href="https://developer.android.com/studio/test/other-testing-tools/espresso-test-recorder">è®°å½• Espresso æµ‹è¯•åŠŸèƒ½</a>ä¸é€‚ç”¨äº Composeã€‚ä½†æ˜¯ï¼Œå¯ä»¥<a href="https://developer.android.com/develop/ui/compose/testing">æ‰‹åŠ¨ç¼–å†™ Espresso </a>æ¥æµ‹è¯• Composeã€‚</p>

<h2>4. ç¨³å®šæ€§å’Œæˆç†Ÿåº¦</h2>

<p>æˆ‘ä»¬åœ¨ã€Œæ€§èƒ½ã€éƒ¨åˆ†ç®€è¦æåˆ°äº†è¿™ä¸€ç‚¹ã€‚Jetpack Compose å·²æœ‰ 3 å¹´å†å²ï¼Œæ¯æ¬¡å‘å¸ƒéƒ½ä¼šæœ‰æ‰€æ”¹è¿›ï¼Œä½†æœ‰æ—¶å¯èƒ½ä¼šå‡ºç°é”™è¯¯ã€‚æ­¤å¤–ï¼Œè®¸å¤š Compose åŠŸèƒ½ä»å¤„äºå®éªŒé˜¶æ®µï¼Œéœ€è¦æ³¨è§£æ‰èƒ½ä½¿ç”¨ã€‚ä½¿ç”¨å®éªŒæ€§åŠŸèƒ½å¯èƒ½ä¼šç»™ä½ çš„ä¸šåŠ¡å¸¦æ¥æ½œåœ¨çš„é—®é¢˜ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// æœ‰äº›ç‰¹æ€§ï¼Œå¦‚Modifierï¼ŒLayoutå’ŒMaterial Designæ˜¯å®éªŒæ€§è´¨çš„ï¼Œéœ€è¦æ˜¾å¼çš„ç”¨OptIntã€‚</span>
</span><span class='line'><span class="n">@OptIn</span><span class="p">(</span><span class="n">ExperimentalMaterialApi</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
</span><span class='line'><span class="n">@OptIn</span><span class="p">(</span><span class="n">@ExperimentalFoundationApi</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
</span><span class='line'><span class="n">@OptIn</span><span class="p">(</span><span class="n">ExperimentalComposeUiApi</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
</span><span class='line'><span class="n">@OptIn</span><span class="p">(</span><span class="n">ExperimentalLayoutApi</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœä½ éœ€è¦éå¸¸é«˜çš„æˆç†Ÿåº¦å’Œç¨³å®šæ€§ï¼Œä½ å¯èƒ½å¸Œæœ›åšæŒä½¿ç”¨View ç³»ç»Ÿã€‚</p>

<h2>5. åŠŸèƒ½ç¼ºå¤±</h2>

<p>View ç³»ç»Ÿæ˜¯ Android å†å²çš„ä¸€éƒ¨åˆ†ã€‚è®¸å¤š Android åŠŸèƒ½é¦–å…ˆåœ¨ View ä¸Šå¯ç”¨ï¼Œç„¶åç§»æ¤åˆ° Composeï¼Œé€šå¸¸ Compose å¯èƒ½åªæä¾›ä¸€ä¸ªåŒ…è£…å™¨ï¼ˆä¾‹å¦‚ Google Mapsï¼‰ã€‚å› æ­¤ï¼Œä½ å¯èƒ½å¸Œæœ›ä¿ç•™ View ç³»ç»Ÿï¼Œç›´åˆ°è¿™äº›åŠŸèƒ½åœ¨ Compose ä¸Šå¯ç”¨ã€‚è¯·æ³¨æ„ï¼Œä½ å¯ä»¥ä½¿ç”¨ AndroidView è®¿é—®é‚£äº›ä»…é™ View çš„åŠŸèƒ½ï¼ŒCompose æœ€ç»ˆä¼šå®ç°è¿™ä¸€ç‚¹ã€‚</p>

<h2>6. å¹¿æ³›åº”ç”¨äºç°æœ‰åº”ç”¨ä¸­</h2>

<p>åœ¨ä½ çš„èŒä¸šç”Ÿæ¶¯ä¸­ï¼Œä½ å¾ˆå¯èƒ½éœ€è¦å¤„ç† Viewã€‚è®¸å¤šå¤§å…¬å¸å³ä½¿é‡‡ç”¨äº† Jetpack Composeï¼Œä»ç„¶ä½¿ç”¨ Viewã€‚å°† View é¡µé¢è¿ç§»åˆ° Compose å¯èƒ½ä¼šå¸¦æ¥é«˜æ˜‚çš„æˆæœ¬ï¼Œè€Œå¯¹æœ€ç»ˆå®¢æˆ·è€Œè¨€ï¼Œä»·å€¼ç›¸å¯¹è¾ƒä½ã€‚å¤§å¤šæ•°å…¬å¸é€‰æ‹©é€æ­¥é‡‡ç”¨ Composeï¼Œä½¿ç”¨ View ç³»ç»Ÿæ¥ç»´æŠ¤è¾ƒæ—§çš„ UIã€‚ä½ å¯èƒ½éœ€è¦ View æŠ€èƒ½æ‰èƒ½æœ‰æ•ˆåœ°å°† View è½¬æ¢ä¸º Composeã€‚</p>

<h2>7.APK å¤§å°</h2>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MyanicOBr--xVFZUqSaxEg.png" alt="APKå¤§å°" /></p>

<p>å¦‚æœä½ æ‹…å¿ƒè½¯ä»¶åŒ…çš„å¤§å°ï¼Œä½ å¯ä»¥é‡æ–°è€ƒè™‘æ˜¯å¦é‡‡ç”¨ Jetpack Composeã€‚å®ƒå°†ä½¿ä½ çš„è½¯ä»¶åŒ…å¤§å°è‡³å°‘<a href="https://www.reddit.com/r/androiddev/comments/1c5vjhi/i_see_your_enterprisegrade_jetpack_compose_11mb/">å¢åŠ å‡ MB</a>ï¼Œè™½ç„¶ä½ å¯ä»¥å¯ç”¨<a href="https://r8.googlesource.com/r8/+/refs/heads/master/compatibility-faq.md#r8-full-mode"> R8 å®Œæ•´æ¨¡å¼</a>ä»¥è¿›ä¸€æ­¥å‡å°å¤§å°ã€‚ä½†æ˜¯ï¼ŒView ç³»ç»Ÿçš„å ç”¨çš„é¢å¤–ç©ºé—´å‡ ä¹ä¸ºé›¶ï¼Œå› ä¸ºç»„ä»¶æ˜¯ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œä¸éœ€è¦é¢å¤–çš„åº“ã€‚</p>

<h2>8. ä¸æ—§è®¾å¤‡çš„å…¼å®¹æ€§</h2>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C-GWYdBlBQfjl4jHLexP7Q.png" alt="è€æ—§è®¾å¤‡ä½ " /></p>

<p>Jetpack Compose æœ€é«˜å¯å…¼å®¹ Android API 21ï¼ˆLollipopğŸ­ ã€Android 5.0ï¼‰ã€‚å¦‚æœä½ æƒ³è¦é’ˆå¯¹æ€§åœ°é€‚é…ä»¥å‰çš„ Android ç‰ˆæœ¬ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ Viewã€‚</p>

<h2>9. åµŒå…¥å’Œç‰©è”ç½‘è®¾å¤‡</h2>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WMYdpUZ4oDT6Axy2GSp0CQ.png" alt="ç‰©è”ç½‘è®¾å¤‡" /></p>

<p>å•ä¸€ç”¨é€”çš„è®¾å¤‡ï¼ˆè‡ªåŠ©æœåŠ¡ç»ˆç«¯ã€æ”¯ä»˜ç»ˆç«¯ã€è‡ªåŠ©ç»“è´¦ï¼‰é€šå¸¸åªè¿è¡Œä¸€ä¸ªåº”ç”¨ï¼Œå¹¶ä¸” CPU å’Œ RAM èµ„æºæœ‰é™ã€‚å¯¹äºè¿™äº›è®¾å¤‡æ¥è¯´ï¼ŒJetpack Compose å¯èƒ½å¤ªé‡äº†ï¼Œå¯èƒ½éœ€è¦ Android å¼€å‘äººå‘˜ä½¿ç”¨ View ç³»ç»Ÿæ¥é€‚åº”è®¾å¤‡è§„æ ¼ã€‚è¿™äº›è®¾å¤‡ä¹Ÿå¯èƒ½è¿è¡Œæ¯”è¾ƒæ—§çš„Androidç‰ˆæœ¬ï¼Œå¦‚ 4.0 ç‰ˆã€‚</p>

<h2>10. ä½ ä¸æƒ³å­¦ä¹ æ–°ä¸œè¥¿</h2>

<p>ä¹Ÿè®¸ä½ å·²ç»æ¥è¿‘èŒä¸šç”Ÿæ¶¯çš„å°¾å£°ï¼Œæˆ–è€…æƒ³è¦è½¬åˆ°å…¶ä»–é¢†åŸŸï¼Œé‚£ä¹ˆåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå­¦ä¹  Jetpack Compose æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚å­¦ä¹ æ›²çº¿æœ‰ç‚¹é™¡å³­ï¼Œå› ä¸ºä¸ View ç›¸æ¯”ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸æ–°çš„ UI å¼€å‘æ–¹æ³•ã€‚ä¸è¿‡ï¼Œå­¦ä¹ å®ƒå¯èƒ½å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå…¶ä»–æ¡†æ¶ï¼ˆå¦‚ React å’Œ Flutterï¼‰ä¹Ÿä½¿ç”¨äº†æŸäº›ç±»ä¼¼çš„åŸç†ã€‚</p>

<h2>ç»“è®º</h2>

<p>Jetpack Compose æ˜¯ä¸€æ¬¾å‡ºè‰²çš„ UI å·¥å…·åŒ…ï¼Œæ— ç–‘æ˜¯ Android çš„æœªæ¥ï¼Œä½†å®ƒå¹¶ä¸æ˜¯å”¯ä¸€çš„ UI å·¥å…·åŒ…ï¼ŒView å·²ç»è¯æ˜å®ƒå·¥ä½œå¾—å¾ˆå¥½ï¼Œè™½ç„¶æœ‰äº›äººè®¤ä¸ºå®ƒæ˜¯é—ç•™çš„ï¼Œä½†æœ€å¥½é€‰æ‹©é€‚åˆä½ çš„éœ€æ±‚å’Œé™åˆ¶çš„æ¡†æ¶ã€‚
æ— è®ºä½ é€‰æ‹©å“ªç§æ¡†æ¶ï¼Œç©å¾—å¼€å¿ƒï¼Android å¼€å‘ä¸°å¯Œå¤šæ ·ï¼Œä½œä¸º Android å¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬çš„èŒè´£å°±æ˜¯åˆ©ç”¨è¿™äº›ä¼˜åŠ¿ã€‚</p>

<p>æ„Ÿè°¢ä½ é˜…è¯»æœ¬æ–‡ï¼Œå¸Œæœ›ä½ å–œæ¬¢å¹¶å­¦åˆ°ä¸€äº›ä¸œè¥¿ã€‚è¯·å¸®å¿™ç‚¹èµï¼Œä»¥è¡¨ç¤ºä½ çš„æ”¯æŒï¼</p>

<p>æœ¬æ–‡ç”±<a href="http://androiddev.news/"> Android å¼€å‘è€…æ–°é—»</a>èµåŠ©ï¼Œåœ¨<a href="https://play.google.com/store/apps/details?id=sonique.fr.adn"> Play å•†åº—ä¸‹è½½</a>åº”ç”¨ç¨‹åºã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç†è§£Androidä¸­çš„å†…å­˜æ³„æ¼ä»¥åŠå¦‚ä½•è®©LeakCanaryæ¥å¸®å¿™]]></title>
    <link href="https://alexhilton.github.io/blog/2025/03/01/understanding-memory-leaks/"/>
    <updated>2025-03-01T11:05:54+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/03/01/understanding-memory-leaks</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ª<a href="https://proandroiddev.com/understanding-memory-leaks-in-android-how-leakcanary-can-help-4768df60f646">Understanding Memory Leaks in Android &amp; How LeakCanary Can Help</a>ï¼ŒåŸæ–‡å‘å¸ƒäº2024å¹´12æœˆ27æ—¥ã€‚</p></blockquote>

<p><strong>è¯‘è€…æ³¨ï¼š</strong> å…³äºå†…å­˜ä¼˜åŒ–ï¼Œç¬”è€…ä¹Ÿæ›¾ç»å†™è¿‡ä¸¤ç¯‡æ–‡ç« ï¼Œä¾§é‡äºå†…å­˜é—®é¢˜çš„æ·±å…¥åˆ†æï¼Œå¦‚æœ‰å…´è¶£å¯ä»¥ä½œä¸ºæ‹“å±•é˜…è¯»ï¼š<a href="https://juejin.cn/post/7277489569958756364">è®©ä½ ä¸å†æƒ§æ€•å†…å­˜ä¼˜åŒ–</a>å’Œ<a href="https://juejin.cn/post/7287913786038992915">Androidåº”ç”¨æ€§èƒ½å‰–æå…¨æ”»ç•¥</a>ã€‚</p>

<p><a href="https://alexhilton.github.io/blog/2025/03/01/understanding-memory-leaks/"><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sx4veSpq_Z1oYBsP5Q7nwQ.jpeg" title="auto auto" ></a></p>

<!-- more -->


<p>ä½œä¸º Android å¼€å‘è€…ï¼Œç®¡ç†å†…å­˜æ˜¯æ„å»ºé«˜æ€§èƒ½åº”ç”¨çš„ä¸€ä¸ªæœ€å…³é”®æ–¹é¢ã€‚å¼€å‘è€…é¢ä¸´çš„ä¸€ä¸ªæœ€å¸¸è§é—®é¢˜æ˜¯å†…å­˜æ³„æ¼ã€‚è¿™äº›æ³„æ¼ä¼šå¯¹åº”ç”¨çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒäº§ç”Ÿè´Ÿé¢å½±å“ï¼Œå¯¼è‡´è¿è¡Œç¼“æ…¢ã€å´©æºƒç”šè‡³ç”µæ± è€—å°½ä½ ã€‚ä½†åˆ«æ‹…å¿ƒâ€”â€”æœ‰ä¸€ç§è§£å†³æ–¹æ¡ˆå¯ä»¥è®©å‘ç°å’Œä¿®å¤å†…å­˜æ³„æ¼å˜å¾—æ›´å®¹æ˜“ï¼Œé‚£å°±æ˜¯LeakCanaryã€‚</p>

<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†é¦–å…ˆæ¢è®¨ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ã€ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œç„¶åä»‹ç» LeakCanary ä½œä¸ºæ£€æµ‹å’Œä¿®å¤ Android åº”ç”¨ç¨‹åºä¸­è¿™äº›æ³„æ¼çš„å¼ºå¤§å·¥å…·ã€‚</p>

<h2>ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼Ÿ</h2>

<p>å½“ä½ çš„åº”ç”¨ä¿ç•™ä¸å†éœ€è¦çš„å†…å­˜æ—¶ï¼Œå°±ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä¸å†ä½¿ç”¨çš„å¯¹è±¡æ²¡æœ‰ä»å†…å­˜ä¸­æ­£ç¡®æ¸…é™¤æ—¶ï¼Œå°±ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œä»è€Œå¯¼è‡´ä½ çš„åº”ç”¨æ¶ˆè€—äº†ä¸å¿…è¦çš„å†…å­˜ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œåœ¨æç«¯æƒ…å†µä¸‹ï¼Œè¿˜ä¼šå¯¼è‡´åº”ç”¨å´©æºƒã€‚</p>

<h2>å†…å­˜æ³„æ¼ä¸ºä½•å¦‚æ­¤å±é™©ï¼Ÿ</h2>

<p>å†…å­˜æ³„æ¼ä¹ä¸€çœ‹ä¼¼ä¹æ— å®³ï¼Œä½†å®ƒå¯èƒ½ä¼šç»™ä½ çš„ Android åº”ç”¨å¸¦æ¥ä¸¥é‡é—®é¢˜ï¼š</p>

<ol>
<li><strong>å†…å­˜ä½¿ç”¨é‡å¢åŠ ï¼š</strong> å½“å†…å­˜æœªé‡Šæ”¾æ—¶ï¼Œåº”ç”¨ä¼šä¸æ–­æ¶ˆè€—æ›´å¤šèµ„æºï¼Œå¯¼è‡´å†…å­˜æ¶ˆè€—è¿‡é«˜ã€‚</li>
<li><strong>æ€§èƒ½ä¸‹é™ï¼š</strong> éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå†…å­˜ä¸­ä¿å­˜çš„å¯¹è±¡è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨ä¼šå˜å¾—è¶Šæ¥è¶Šæ…¢ï¼Œå¯¼è‡´å»¶è¿Ÿå’Œç”¨æˆ·ä½“éªŒä¸ä½³ã€‚</li>
<li><strong>åº”ç”¨å´©æºƒï¼š</strong> å¦‚æœå†…å­˜æ¶ˆè€—è¾¾åˆ°ä¸´ç•Œæ°´å¹³ï¼Œä½ çš„åº”ç”¨å¯èƒ½ä¼šå´©æºƒç”šè‡³å¼ºåˆ¶å…³é—­ã€‚</li>
<li><strong>ç”µæ± è€—å°½ï¼š</strong> å†…å­˜æ³„æ¼å¯èƒ½å¯¼è‡´è¿›ç¨‹åœ¨åå°è¿è¡Œï¼Œä»è€Œæ¯”é¢„æœŸæ›´å¿«åœ°è€—å°½è®¾å¤‡ç”µæ± ã€‚</li>
</ol>


<h2>Android ä¸­å†…å­˜æ³„æ¼çš„å¸¸è§åŸå› </h2>

<ol>
<li><strong>ä¿å­˜å¯¹ä¸Šä¸‹æ–‡çš„å¼•ç”¨ï¼š</strong> å¦‚æœä½ åœ¨é™æ€å˜é‡æˆ–å•ä¾‹ä¸­ä¿å­˜å¯¹ Activity æˆ– Context çš„å¼•ç”¨ï¼Œå®ƒå°†æ°¸è¿œä¸ä¼šè¢«åƒåœ¾å›æ”¶ï¼Œå› ä¸ºç³»ç»Ÿä»ä¼šè€ƒè™‘æ­£åœ¨ä½¿ç”¨çš„ Activity æˆ– Contextã€‚</li>
<li><strong>å†…éƒ¨ç±»å’ŒåŒ¿åç±»ï¼š</strong> å®ƒä»¬éšå¼ä¿å­˜å¯¹å¤–éƒ¨ç±»ï¼ˆé€šå¸¸æ˜¯ Activity æˆ– Fragmentï¼‰çš„å¼•ç”¨ï¼Œä»è€Œé˜²æ­¢å®ƒä»¬è¢«åƒåœ¾å›æ”¶ã€‚</li>
<li><strong>æœªå…³é—­çš„èµ„æºï¼š</strong> å®Œæˆåä¸å…³é—­ Cursorã€Stream æˆ–æ•°æ®åº“è¿æ¥ç­‰èµ„æºå¯èƒ½ä¼šå¯¼è‡´å†…å­˜å †ç§¯ã€‚</li>
<li><strong>äº‹ä»¶ä¾¦å¬å™¨ï¼š</strong> å¦‚æœä½ å‘ UI å…ƒç´ æ·»åŠ ä¾¦å¬å™¨ï¼ˆä¾‹å¦‚ OnClickListenerï¼‰ï¼Œä½†åœ¨ä¸å†éœ€è¦å®ƒä»¬åæ²¡æœ‰å°†å…¶åˆ é™¤ï¼Œè¿™äº›å¯¹è±¡å¯èƒ½ä¼šæ³„æ¼å†…å­˜ã€‚</li>
</ol>


<h2>LeakCanary å¦‚ä½•å¸®åŠ©æ£€æµ‹ Android ä¸­çš„å†…å­˜æ³„æ¼</h2>

<p>ç°åœ¨æˆ‘ä»¬äº†è§£äº†å†…å­˜æ³„æ¼å¯èƒ½å¯¼è‡´çš„é—®é¢˜ï¼Œè®©æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ£€æµ‹å†…å­˜æ³„æ¼çš„å·¥å…·ï¼šLeakCanaryã€‚</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xas01FOk-1FlwDFe.png" alt="LeakCanary" /></p>

<p>LeakCanary æ˜¯ä¸€ä¸ªé€‚ç”¨äº Android çš„å¼€æºå†…å­˜æ³„æ¼æ£€æµ‹åº“ã€‚å®ƒæ—¨åœ¨è‡ªåŠ¨è¯†åˆ«å¼€å‘è¿‡ç¨‹ä¸­åº”ç”¨ä¸­çš„å†…å­˜æ³„æ¼ï¼Œè®©ä½ åœ¨å½±å“ç”¨æˆ·ä¹‹å‰ä¿®å¤å®ƒä»¬ã€‚</p>

<ul>
<li>å½“å‘ç”Ÿå†…å­˜æ³„æ¼æ—¶ï¼ŒLeakCanary ä¼šè‡ªåŠ¨è§¦å‘å †è½¬å‚¨ï¼Œå¯¹å…¶è¿›è¡Œåˆ†æï¼Œå¹¶å‘å¼€å‘äººå‘˜æä¾›ä¸€ä»½æŠ¥å‘Šï¼ŒæŒ‡å‡ºæ³„æ¼å‘ç”Ÿçš„ä½ç½®ã€‚è¿™ä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿæ›´è½»æ¾åœ°å‘ç°å’Œè§£å†³å†…å­˜æ³„æ¼ï¼Œä»¥å…å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚</li>
</ul>


<h3>LeakCanary å¦‚ä½•å·¥ä½œï¼Ÿ</h3>

<p>LeakCanary çš„å·¥ä½œåŸç†æ˜¯ç›‘æ§åº”ç”¨çš„å†…å­˜å¹¶åˆ†æå †è½¬å‚¨ä»¥è¯†åˆ«ä¸åº”è¯¥å­˜åœ¨çš„å¯¹è±¡ã€‚å½“æ£€æµ‹åˆ°å†…å­˜æ³„æ¼æ—¶ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä»½æŠ¥å‘Šï¼Œæ˜¾ç¤ºæ³„æ¼å‘ç”Ÿçš„ä½ç½®ï¼Œä»è€Œå¸®åŠ©ä½ æ‰¾å‡ºæ ¹æœ¬åŸå› ã€‚</p>

<ol>
<li><strong>å †è½¬å‚¨ï¼š</strong> å½“ LeakCanary æ£€æµ‹åˆ°æ½œåœ¨æ³„æ¼æ—¶ï¼Œå®ƒä¼šè¿›è¡Œå †è½¬å‚¨ï¼ˆåº”ç”¨å†…å­˜çš„å¿«ç…§ï¼‰ï¼Œå¹¶å°†å…¶ä¸åƒåœ¾å›æ”¶åçš„å †è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå®ƒå‘ç°ä¸åº”ä¿ç•™çš„å¯¹è±¡ï¼Œå®ƒä¼šå°†å…¶æ ‡è®°ä¸ºæ³„æ¼ã€‚</li>
<li><strong>æ³„æ¼çš„å¯¹è±¡ï¼š</strong> LeakCanary ä¼šå‘ä½ æ˜¾ç¤ºå“ªäº›å¯¹è±¡è¢«ä¿å­˜åœ¨å†…å­˜ä¸­ä»¥åŠå¼•ç”¨é“¾ä¸­ï¼Œå¸®åŠ©ä½ è¯†åˆ«å¯¼è‡´æ³„æ¼çš„å¯¹è±¡ä»¥åŠå®ƒä»è¢«ä¿ç•™çš„åŸå› ã€‚</li>
<li><strong>é€šçŸ¥ï¼š</strong> æ¯å½“ LeakCanary å‘ç°å†…å­˜æ³„æ¼æ—¶ï¼Œå®ƒéƒ½ä¼šåœ¨åº”ç”¨çš„è°ƒè¯•ç‰ˆæœ¬ä¸­é€šçŸ¥ä½ ã€‚ä½ å¯ä»¥å¿«é€Ÿè®¿é—®æŠ¥å‘Šå¹¶å¼€å§‹è§£å†³é—®é¢˜ã€‚</li>
</ol>


<p>LeakCanary è‡ªåŠ¨æ£€æµ‹ä»¥ä¸‹å¯¹è±¡çš„æ³„æ¼ï¼š</p>

<ul>
<li>é”€æ¯çš„ Activity å®ä¾‹</li>
<li>é”€æ¯çš„ Fragment å®ä¾‹</li>
<li>é”€æ¯çš„ fragment View å®ä¾‹</li>
<li>æ¸…é™¤çš„ ViewModel å®ä¾‹</li>
<li>é”€æ¯çš„ Service å®ä¾‹</li>
</ul>


<h3>å¦‚ä½•å°† LeakCanary é›†æˆåˆ° Android é¡¹ç›®ä¸­ï¼Ÿ</h3>

<p>è¦å°† LeakCanary é›†æˆåˆ° Android é¡¹ç›®ä¸­ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p>

<ul>
<li><strong>æ·»åŠ  LeakCanary ä¾èµ–é¡¹ï¼š</strong> åœ¨ build.gradle æ–‡ä»¶ï¼ˆåº”ç”¨ç¨‹åºçº§åˆ«ï¼‰ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='Groovy'><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">debugImplementation</span> <span class="s1">&#39;com.squareup.leakcanary:leakcanary-android:2.9.1&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>åˆå§‹åŒ– LeakCanaryï¼š</strong> LeakCanary åœ¨è°ƒè¯•æ„å»ºç±»å‹ä¸­è‡ªåŠ¨åˆå§‹åŒ–ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥åœ¨ Application ç±»ä¸­æ‰‹åŠ¨åˆå§‹åŒ–å®ƒï¼š</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='Java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyApplication</span> <span class="kd">extends</span> <span class="n">Application</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">LeakCanary</span><span class="o">.</span><span class="na">isInAnalyzerProcess</span><span class="o">(</span><span class="k">this</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span><span class="o">;</span> <span class="c1">// LeakCanary is in heap analysis process</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">LeakCanary</span><span class="o">.</span><span class="na">install</span><span class="o">(</span><span class="k">this</span><span class="o">);</span> <span class="c1">// Initialize LeakCanary</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><strong>åœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¿è¡Œåº”ç”¨ç¨‹åº</strong>ï¼ŒLeakCanary å°†åœ¨å¼€å‘é˜¶æ®µæ£€æµ‹å†…å­˜æ³„æ¼ã€‚</li>
</ul>


<h3>å¦‚ä½•åœ¨ç”Ÿäº§ç‰ˆæœ¬ä¸­ä½¿ç”¨ LeakCanaryï¼Ÿ</h3>

<p>è™½ç„¶ LeakCanary ä¸“ä¸ºè°ƒè¯•å’Œå¼€å‘è€Œè®¾è®¡ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å®ƒæ—¶åº”è°¨æ…ã€‚å®ƒå¯èƒ½ä¼šå½±å“åº”ç”¨æ€§èƒ½ï¼Œå¹¶å¯èƒ½ä¸å¿…è¦åœ°æš´éœ²ä¸å†…å­˜ç›¸å…³çš„æ•°æ®ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å‡ºäºæŸç§åŸå› éœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨å®ƒï¼Œåˆ™å¯ä»¥æœ‰æ¡ä»¶åœ°ä»…åœ¨æŸäº›æ„å»ºç‰ˆæœ¬ä¸­æ·»åŠ  LeakCanaryï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='Groovy'><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">releaseImplementation</span> <span class="s1">&#39;com.squareup.leakcanary:leakcanary-android-no-op:2.9.1&#39;</span> <span class="c1">// No-op for release</span>
</span><span class='line'>    <span class="n">debugImplementation</span> <span class="s1">&#39;com.squareup.leakcanary:leakcanary-android:2.9.1&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ ·ï¼ŒLeakCanary ä»…åœ¨è°ƒè¯•ç‰ˆæœ¬ä¸­å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œè€Œæ— æ“ä½œç‰ˆæœ¬åˆ™ç”¨äºç”Ÿäº§ã€‚</p>

<h3>ä½ å°†é‡‡å–ä»€ä¹ˆæ­¥éª¤æ¥ä¿®å¤ LeakCanary æŠ¥å‘Šçš„å†…å­˜æ³„æ¼ï¼Ÿ</h3>

<p>å½“ LeakCanary æŠ¥å‘Šå†…å­˜æ³„æ¼æ—¶ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è§£å†³ï¼š</p>

<ol>
<li><p><strong>åˆ†ææ³„æ¼æŠ¥å‘Šï¼š</strong> LeakCanary æä¾›ä¸€ä»½è¯¦ç»†çš„æŠ¥å‘Šï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå¯¹è±¡å¼•ç”¨é“¾ï¼Œæ˜¾ç¤ºæ³„æ¼å‘ç”Ÿçš„ä½ç½®ã€‚</p></li>
<li><p><strong>è¯†åˆ«æ³„æ¼å¯¹è±¡ï¼š</strong> æŸ¥æ‰¾æ„å¤–ä¿å­˜åœ¨å†…å­˜ä¸­çš„å¯¹è±¡ï¼ˆå¦‚ Activityã€Fragment æˆ– Contextï¼‰ã€‚</p></li>
<li><p><strong>ä¿®å¤æ³„æ¼ï¼š</strong></p>

<ul>
<li>é¿å…å°† Activity æˆ– Context å¼•ç”¨å­˜å‚¨åœ¨é™æ€å˜é‡æˆ–é•¿å¯¿å‘½å¯¹è±¡ä¸­ã€‚</li>
<li>ç¡®ä¿å…³é—­ Cursorã€Stream ç­‰èµ„æºã€‚</li>
<li>åœ¨ä¸å†éœ€è¦æ—¶åˆ é™¤ä¾¦å¬å™¨å’Œå›è°ƒã€‚</li>
</ul>
</li>
<li><strong>æµ‹è¯•ä¿®å¤ï¼š</strong> è¿›è¡Œæ›´æ”¹åï¼Œé‡æ–°è¿è¡Œä½ çš„åº”ç”¨ä»¥ç¡®è®¤å†…å­˜æ³„æ¼å·²è§£å†³ã€‚</li>
</ol>


<h3>LeakCanary æœ‰å“ªäº›å±€é™æ€§ï¼Ÿ</h3>

<p>è™½ç„¶ LeakCanary æ˜¯ä¸€æ¬¾å‡ºè‰²çš„å·¥å…·ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›å±€é™æ€§ï¼š</p>

<ul>
<li><strong>å¹¶éæ‰€æœ‰æ³„æ¼éƒ½èƒ½è¢«æ£€æµ‹åˆ°ï¼š</strong> LeakCanary ä¸“æ³¨äº Java å †å†…å­˜æ³„æ¼ï¼Œä½†å®ƒå¯èƒ½æ— æ³•æ£€æµ‹æœ¬æœºå†…å­˜æ³„æ¼æˆ–ä½çº§é—®é¢˜ã€‚</li>
<li><strong>å¯¹æ€§èƒ½çš„å½±å“ï¼š</strong> ç”±äºå †åˆ†æè¿‡ç¨‹ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­è¿è¡Œ LeakCanary å¯èƒ½ä¼šç¨å¾®å‡æ…¢ä½ çš„åº”ç”¨é€Ÿåº¦ã€‚</li>
<li><strong>ä¸èƒ½å–ä»£è‰¯å¥½çš„å†…å­˜ç®¡ç†ï¼š</strong> è™½ç„¶ LeakCanary æœ‰åŠ©äºæ£€æµ‹æ³„æ¼ï¼Œä½†å¼€å‘äººå‘˜ä»åº”éµå¾ªå†…å­˜ç®¡ç†çš„æœ€ä½³å®è·µï¼Œä»¥é˜²æ­¢æ³„æ¼å‘ç”Ÿã€‚</li>
</ul>


<h2>ç»“è®º</h2>

<p>å†…å­˜ç®¡ç†å¯¹äºç¡®ä¿ Android åº”ç”¨é«˜æ•ˆè¿è¡Œè‡³å…³é‡è¦ã€‚LeakCanary æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„å·¥å…·ï¼Œå¯å¸®åŠ©ä½ åœ¨å†…å­˜æ³„æ¼å½±å“åº”ç”¨æ€§èƒ½ä¹‹å‰æ£€æµ‹å¹¶è§£å†³å†…å­˜æ³„æ¼é—®é¢˜ã€‚é€šè¿‡éµå¾ªæœ€ä½³å®è·µå¹¶å°† LeakCanary é›†æˆåˆ°ä½ çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ å¯ä»¥ç¡®ä¿ä½ çš„åº”ç”¨ä¿æŒä¼˜åŒ–çŠ¶æ€å¹¶ä¸”ä¸ä¼šå‡ºç°ä¸å†…å­˜ç›¸å…³çš„é—®é¢˜ã€‚</p>

<p>æ£€æŸ¥ä½ æ˜¯å¦å·²åœ¨ Android åº”ç”¨ç¨‹åºä¸­å®Œæˆä»¥ä¸‹æ‰€æœ‰æ“ä½œï¼š</p>

<ol>
<li><a href="https://developers.google.com/maps/documentation/places/android-sdk/memory-best-practices#rel-unused">é‡Šæ”¾æœªä½¿ç”¨çš„èµ„æºã€‚</a></li>
<li><a href="https://developers.google.com/maps/documentation/places/android-sdk/memory-best-practices#unreg">ä¸å†éœ€è¦æ—¶å–æ¶ˆæ³¨å†Œç›‘å¬å™¨ã€‚</a></li>
<li><a href="https://developers.google.com/maps/documentation/places/android-sdk/memory-best-practices#cancel-tasks">ä¸éœ€è¦æ—¶å–æ¶ˆä»»åŠ¡ã€‚</a></li>
<li><a href="https://developers.google.com/maps/documentation/places/android-sdk/memory-best-practices#fwd-lifecyc">å‘ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä»¥é‡Šæ”¾èµ„æºã€‚</a></li>
<li><a href="https://developers.google.com/maps/documentation/places/android-sdk/memory-best-practices#latest-versions">ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ SDKã€‚</a></li>
</ol>


<h2>å‚è€ƒ</h2>

<ul>
<li><a href="https://developers.google.com/maps/documentation/places/android-sdk/memory-best-practices">https://developers.google.com/maps/documentation/places/android-sdk/memory-best-practices</a></li>
<li><a href="https://square.github.io/leakcanary/">https://square.github.io/leakcanary/</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[é€‰æ‹©Retrofitè¿˜æ˜¯Ktorï¼šç»™Androidå¼€å‘è€…çš„æŒ‡å—]]></title>
    <link href="https://alexhilton.github.io/blog/2025/02/26/retrofit-vs-ktor/"/>
    <updated>2025-02-26T22:50:55+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/02/26/retrofit-vs-ktor</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ª<a href="https://proandroiddev.com/when-to-use-retrofit-and-when-to-use-ktor-a-guide-for-android-developers-918491dcf69a">When to Use Retrofit and When to Use Ktor: A Guide for Android Developers</a></p></blockquote>

<p>ä½œä¸º Android å¼€å‘äººå‘˜ï¼Œä¸ºä½ çš„é¡¹ç›®é€‰æ‹©æ­£ç¡®çš„ HTTP å®¢æˆ·ç«¯æ˜¯ä¸€é¡¹å…³é”®çš„å†³å®šã€‚å½“ä»Šæœ€å—æ¬¢è¿çš„ä¸¤ä¸ªé€‰é¡¹è«è¿‡äº Retrofit å’Œ Ktorã€‚è™½ç„¶Retrofit å¤šå¹´æ¥ä¸€ç›´æ˜¯äº‹å®ä¸Šçš„æ ‡å‡†ï¼Œä½† Ktor å› å…¶ç°ä»£æ¶æ„å’Œçµæ´»æ€§è€ŒåŠ¿å¤´å¼ºåŠ²ã€‚</p>

<p><a href="https://alexhilton.github.io/blog/2025/02/26/retrofit-vs-ktor/"><img src="https://robotqa.com/blog/wp-content/uploads/2024/06/202406120818248.png" title="auto auto" ></a></p>

<!-- more -->


<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ä½ åº”è¯¥é€‰æ‹© Retrofit æˆ– Ktor çš„åœºæ™¯ï¼Œä»¥åŠå®ƒä»¬çš„ä¼˜åŠ¿å¦‚ä½•æ»¡è¶³ä½ çš„åº”ç”¨è¦æ±‚ã€‚</p>

<h2>äº†è§£åŸºç¡€çŸ¥è¯†</h2>

<p>å…ˆæ¥äº†è§£ä¸€ä¸‹åŸºç¡€çŸ¥è¯†ï¼š</p>

<h3>Retrofit</h3>

<p>Retrofit æ˜¯ Square å¼€å‘çš„é€‚ç”¨äº Android å’Œ Java çš„ç±»å‹å®‰å…¨ HTTP å®¢æˆ·ç«¯ã€‚å®ƒå°† API è°ƒç”¨æŠ½è±¡ä¸ºå£°æ˜å¼æ¥å£ï¼Œå¹¶ä½¿ç”¨ Gson æˆ– Moshi ç­‰åº“æ— ç¼åœ°å°† JSON è§£æä¸º Java/Kotlin å¯¹è±¡ã€‚</p>

<h3>Ktor</h3>

<p>Ktor ç”± JetBrains å¼€å‘ï¼Œæ˜¯ä¸€æ¬¾åŸºäº Kotlin çš„å¼‚æ­¥æ¡†æ¶ï¼Œç”¨äºæ„å»ºè”ç½‘åº”ç”¨ç¨‹åºã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ª HTTP å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯ä¸€ä¸ªå¤šç”¨é€”æ¡†æ¶ï¼Œè®©ä½ èƒ½å¤Ÿä½¿ç”¨åŒä¸€ä¸ªåº“æ„å»ºåç«¯æœåŠ¡å¹¶å‘å‡ºç½‘ç»œè¯·æ±‚ã€‚</p>

<h2>ä½•æ—¶ä½¿ç”¨ Retrofitï¼Ÿ</h2>

<h3>1. ä½ éœ€è¦ç®€å•å’Œå¯è¯»æ€§</h3>

<p>å¦‚æœä½ æ›´å–œæ¬¢ä½¿ç”¨é¢„å®šä¹‰æ¥å£ä»¥ç›´è§‚çš„æ–¹å¼è¿›è¡Œ API è°ƒç”¨ï¼ŒRetrofit æ˜¯ä¸€ä¸ªç»ä½³çš„é€‰æ‹©ã€‚</p>

<p>ä¾‹å­ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">interface</span> <span class="n">ApiService</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">@GET</span><span class="p">(</span><span class="s">&quot;posts&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">suspend</span> <span class="k">fun</span> <span class="nf">getPosts</span><span class="p">():</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½¿ç”¨ Retrofitï¼Œä½ å¯ä»¥é¢„å…ˆå®šä¹‰ API ç»“æ„å¹¶ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ã€‚</p>

<h3>2. ä½ çš„å›¢é˜Ÿå·²ç»ç†Ÿæ‚‰ Retrofit</h3>

<p>å¦‚æœä½ çš„å›¢é˜Ÿå·²æœ‰ä½¿ç”¨ Retrofit çš„ç»éªŒï¼Œé‚£ä¹ˆåšæŒä½¿ç”¨å®ƒå¯ä»¥é™ä½å­¦ä¹ æ›²çº¿å¹¶åŠ é€Ÿå¼€å‘ã€‚</p>

<h3>3. ä½ éœ€è¦å¼€ç®±å³ç”¨çš„åŠŸèƒ½</h3>

<p>Retrofit æä¾›å¼ºå¤§çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š</p>

<ul>
<li>è‡ªåŠ¨è§£æ JSON å“åº”ã€‚</li>
<li>å†…ç½®å¯¹ OkHttp æ‹¦æˆªå™¨çš„æ”¯æŒã€‚</li>
<li>è½»æ¾å®ç°é‡è¯•ã€ç¼“å­˜å’Œæ—¥å¿—è®°å½•ã€‚</li>
</ul>


<h3>4. ä½ åœ¨å¤šè¯­è¨€ç¯å¢ƒä¸­å·¥ä½œ</h3>

<p>Retrofit éå¸¸é€‚åˆæ¶‰åŠ Java å’Œ Kotlin çš„é¡¹ç›®ï¼Œå› æ­¤å®ƒå¯¹äºé—ç•™ä»£ç åº“æ¥è¯´æ˜¯ä¸€ä¸ªç»ä½³çš„é€‰æ‹©ã€‚</p>

<h3>5.ä½ éœ€è¦ä¸€ä¸ªåºå¤§çš„ç¤¾åŒºå’Œèµ„æº</h3>

<p>Retrofit çš„æˆç†Ÿæ„å‘³ç€ä¸°å¯Œçš„æ–‡æ¡£ã€æ•™ç¨‹å’Œç¤¾åŒºæ”¯æŒï¼Œè¿™ä½¿å…¶æˆä¸ºè®¸å¤šå›¢é˜Ÿæ›´å®‰å…¨çš„é€‰æ‹©ã€‚</p>

<h2>ä½•æ—¶ä½¿ç”¨ Ktorï¼Ÿ</h2>

<h3>1. ä½ éœ€è¦é«˜åº¦å¯å®šåˆ¶æ€§</h3>

<p>Ktor å…è®¸ä½ æ„å»º HTTP å®¢æˆ·ç«¯ï¼Œå¹¶å¯¹è¯·æ±‚æ„å»ºã€æ—¥å¿—è®°å½•å’Œè‡ªå®šä¹‰ç®¡é“è¿›è¡Œç»†ç²’åº¦çš„æ§åˆ¶ã€‚</p>

<p>ä¾‹å­ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">val</span> <span class="py">client</span> <span class="p">=</span> <span class="n">HttpClient</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">install</span><span class="p">(</span><span class="n">JsonFeature</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">serializer</span> <span class="p">=</span> <span class="n">KotlinxSerializer</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>2. ä½ æƒ³åˆ©ç”¨ Kotlin Multiplatform</h3>

<p>Ktor çš„å¤šå¹³å°æ”¯æŒæ˜¯å…¶çªå‡ºçš„åŠŸèƒ½ä¹‹ä¸€ã€‚å¦‚æœä½ æ­£åœ¨ä¸º Androidã€iOS å’Œå…¶ä»–å¹³å°æ„å»ºåº”ç”¨ç¨‹åºï¼ŒKtor å¯ç¡®ä¿ä½ åœ¨æ‰€æœ‰å¹³å°ä¸Šä½¿ç”¨ç›¸åŒçš„ç½‘ç»œé€»è¾‘ã€‚</p>

<h3>3. ä½ æ­£åœ¨æ„å»ºè½»é‡çº§æˆ–æ¨¡å—åŒ–åº”ç”¨ç¨‹åº</h3>

<p>Ktor çš„æ¨¡å—åŒ–è®¾è®¡ä½¿å…¶æˆä¸ºè½»é‡çº§åº”ç”¨ç¨‹åºæˆ–ç½‘ç»œå †æ ˆéœ€è¦ç²¾ç®€å’Œé›†ä¸­çš„é¡¹ç›®çš„ç†æƒ³é€‰æ‹©ã€‚</p>

<h3>4.ä½ éœ€è¦å¼‚æ­¥é€šä¿¡</h3>

<p>Ktor åŸç”Ÿä½¿ç”¨åç¨‹ï¼Œè¿™ä½¿å¾—å¤„ç†å¹¶å‘æ¯”ä¼ ç»Ÿçš„åŸºäºå›è°ƒçš„æ–¹æ³•æ›´ç®€å•ã€æ›´é«˜æ•ˆã€‚</p>

<h3>5. ä½ éœ€è¦ç»Ÿä¸€çš„åç«¯å’Œå‰ç«¯ä»£ç </h3>

<p>å€ŸåŠ© Ktorï¼Œä½ å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ¡†æ¶æ„å»ºæœåŠ¡å™¨ç«¯ API å’Œç§»åŠ¨åº”ç”¨ç¨‹åºï¼Œä»è€Œç®€åŒ–å¼€å‘å¹¶ç¡®ä¿ä¸€è‡´æ€§ã€‚</p>

<h2>ä½ åº”è¯¥é€‰æ‹©å“ªä¸€ä¸ªï¼Ÿ</h2>

<p>ç”¨ä¸€å¼ è¡¨æ ¼æ¥æ€»ç»“ä¸€ä¸‹ä¸¤è€…å„è‡ªçš„ç‰¹ç‚¹ï¼š</p>

<table>
<thead>
<tr>
<th style="text-align:center;"> ç‰¹ç‚¹ </th>
<th style="text-align:center;"> Retrofit </th>
<th style="text-align:center;"> Ktor </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;"> æ˜“äºä½¿ç”¨ </td>
<td style="text-align:center;"> é«˜ </td>
<td style="text-align:center;"> ä¸­ç­‰ </td>
</tr>
<tr>
<td style="text-align:center;"> Kotlin-first è®¾è®¡ </td>
<td style="text-align:center;"> å¦ </td>
<td style="text-align:center;"> æ˜¯ </td>
</tr>
<tr>
<td style="text-align:center;"> è·¨å¹³å°æ”¯æŒ </td>
<td style="text-align:center;"> å¦ </td>
<td style="text-align:center;"> æ˜¯ </td>
</tr>
<tr>
<td style="text-align:center;"> å¯å®šåˆ¶æ€§ </td>
<td style="text-align:center;"> ä¸­ç­‰ </td>
<td style="text-align:center;"> é«˜ </td>
</tr>
<tr>
<td style="text-align:center;"> å­¦ä¹ æ›²çº¿ </td>
<td style="text-align:center;"> ä½ </td>
<td style="text-align:center;"> ä¸­ç­‰ </td>
</tr>
<tr>
<td style="text-align:center;"> ç¤¾åŒºæ”¯æŒ </td>
<td style="text-align:center;"> è§„æ¨¡å¾ˆå¤§ </td>
<td style="text-align:center;"> å¿«é€Ÿå‘å±• </td>
</tr>
<tr>
<td style="text-align:center;"> ä¸åç¨‹é›†æˆ </td>
<td style="text-align:center;"> é€šè¿‡æ·»åŠ suspend </td>
<td style="text-align:center;"> æ˜¯ï¼ˆé›†æˆäº†åŸç”Ÿåç¨‹ï¼‰ </td>
</tr>
<tr>
<td style="text-align:center;"> åç«¯èƒ½åŠ› </td>
<td style="text-align:center;"> å¦ </td>
<td style="text-align:center;"> æ˜¯ </td>
</tr>
</tbody>
</table>


<h3>å¦‚æœç¬¦åˆä»¥ä¸‹æƒ…å†µåˆ™é€‰æ‹© Retrofitï¼š</h3>

<ul>
<li>ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª Kotlin æˆ– Java é¡¹ç›®ï¼Œå…¶ä¸­ç®€å•æ€§å’Œå¿«é€Ÿå¼€å‘æ˜¯é¦–è¦ä»»åŠ¡ã€‚</li>
<li>ä½ çš„é¡¹ç›®ä¾èµ–äºä¹…ç»è€ƒéªŒçš„å·¥å…·å’Œå¹¿æ³›çš„ç¤¾åŒºæ”¯æŒã€‚</li>
<li>ä½ éœ€è¦å¯¹ REST API è¿›è¡Œæœ€ä½é™åº¦çš„é…ç½®ã€‚</li>
</ul>


<h3>ä»¥ä¸‹æƒ…å†µè¯·é€‰æ‹© Ktorï¼š</h3>

<ul>
<li>ä½ æ­£åœ¨æ„å»ºä¸€ä¸ª Kotlin Multiplatform é¡¹ç›®ã€‚</li>
<li>ä½ éœ€è¦ä¸€ä¸ªç°ä»£ã€çµæ´»çš„ç½‘ç»œå †æ ˆã€‚</li>
<li>ä½ éœ€è¦åŒæ—¶æ”¯æŒå‰ç«¯å’Œåç«¯å¼€å‘ã€‚</li>
</ul>


<h2>ç»“è®º</h2>

<p>åœ¨ Retrofit å’Œ Ktor ä¹‹é—´è¿›è¡Œé€‰æ‹©å–å†³äºä½ çš„é¡¹ç›®éœ€æ±‚å’Œä½ çš„å›¢é˜Ÿå¯¹è¿™äº›å·¥å…·çš„ç†Ÿæ‚‰ç¨‹åº¦ã€‚Retrofit æ˜¯ä¼ ç»Ÿ Android é¡¹ç›®çš„å¯é é€‰æ‹©ï¼Œè€Œ Ktor åˆ™åœ¨ç°ä»£ Kotlin ä¼˜å…ˆå’Œå¤šå¹³å°åº”ç”¨ç¨‹åºä¸­è¡¨ç°å‡ºè‰²ã€‚äº†è§£è¿™äº›å·®å¼‚å°†æœ‰åŠ©äºä½ ä¸ºä¸‹ä¸€ä¸ª Android åº”ç”¨åšå‡ºæ­£ç¡®çš„é€‰æ‹©ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä¸€æ–‡å¸¦ä½ ç†è§£OkHttpä¸­çš„Gzipå‹ç¼©]]></title>
    <link href="https://alexhilton.github.io/blog/2025/02/25/understanding-okhttp-gzip-compression/"/>
    <updated>2025-02-25T22:28:09+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/02/25/understanding-okhttp-gzip-compression</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ª<a href="ttps://medium.com/tech-insider/okhttps-gzip-compression-904919638458">OkHttpâ€™s Gzip Compression</a>ï¼ŒåŸæ–‡å‘å¸ƒäº2020å¹´5æœˆ1æ—¥ã€‚æœ¬æ–‡å‡å®šè¯»è€…å¯¹HTTPæœ‰åŸºæœ¬çš„äº†è§£ï¼Œä»¥åŠä½¿ç”¨è¿‡OkHttpï¼Œå¦åˆ™ç†è§£èµ·æ¥å¯èƒ½ä¼šä¸€ç‚¹å›°éš¾ã€‚</p></blockquote>

<p><strong>è¯‘æ³¨ï¼š</strong> OkHttpç¡®å®ä¼šè‡ªåŠ¨æ·»åŠ gzipå¹¶å¤„ç†å“åº”ã€‚ä½†å¦‚æœæ˜¾ç¤ºçš„ç»™è¯·æ±‚æ·»åŠ é™¤äº†gzipä¹‹å¤–çš„å­—æ®µï¼Œå¦‚&#8221;Accept-Encoding: gzip, deflate, br&#8221;ï¼Œé‚£ä¹ˆå°±éœ€è¦æ‰‹åŠ¨å¤„ç†å“åº”ã€‚å…¶å®ä¸€èˆ¬æ—¶å€™æˆ‘ä»¬å¹¶ä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®ï¼Œé™¤éæ˜¯æ¨¡æ‹Ÿæµè§ˆå™¨æ—¶ï¼ˆæ¯”å¦‚ç”¨äº†æµè§ˆå™¨çš„UAï¼‰ï¼Œæˆ–è€…æŸäº›æœåŠ¡å™¨å¼ºåˆ¶deflateå­—æ®µã€‚æ›´å¤šçš„ä¿¡æ¯å¯ä»¥<a href="https://stackoverflow.com/questions/51901333/okhttp-3-how-to-decompress-gzip-deflate-response-manually-using-java-android">çœ‹è¿™é‡Œ</a>ã€‚</p>

<p><a href="https://alexhilton.github.io/blog/2025/02/25/understanding-okhttp-gzip-compression/"><img src="https://img-blog.csdnimg.cn/879e064594104e0ab5671f6710ffea24.png" title="auto auto" ></a></p>

<!-- more -->


<p>å‹ç¼©æ˜¯ä¸€ç§ç®€å•æœ‰æ•ˆçš„èŠ‚çœå¸¦å®½å’ŒåŠ å¿«ç§»åŠ¨ç”¨æˆ·äº¤äº’é€Ÿåº¦çš„æ–¹æ³•ã€‚å½“ç”¨æˆ·ç‚¹å‡»ä½ çš„é¡µé¢å±å¹•æ—¶ï¼Œä¼šè°ƒç”¨ä½ çš„æœåŠ¡å™¨æ¥æä¾›è¯·æ±‚çš„å“åº”ã€‚å“åº”è¶Šå¤§ï¼Œå±å¹•ä¸Šæ˜¾ç¤ºæ•°æ®çš„æ—¶é—´å°±è¶Šé•¿ã€‚é€šè¿‡å‹ç¼©ï¼Œå³ä½¿ä½ çš„è®¿é—®è€…çš„äº’è”ç½‘è¿æ¥é€Ÿåº¦éå¸¸æ…¢å¹¶ä¸”ä½ çš„ API å“åº”è¿‡äºç¹é‡ï¼Œä»–ä»¬ä¹Ÿèƒ½äº«å—å¿«é€ŸåŠ è½½ã€‚</p>

<h2>è¿™æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ</h2>

<p><strong>Gzip ä¼šæ‰¾åˆ°ç›¸ä¼¼çš„å­—ç¬¦ä¸²ï¼Œå¹¶ç”¨ä¸€äº›å ä½ç¬¦ä¸´æ—¶æ›¿æ¢è¿™äº›å­—ç¬¦ä¸²ï¼Œä»¥ç¼©å°æ•´ä½“å¤§å°ã€‚</strong>å¦‚æœä½ ä½¿ç”¨å¤§é‡é‡å¤æ–‡æœ¬ï¼Œå¹¶ä¸”æœ‰å¤§é‡ç©ºæ ¼ï¼Œ è¿™ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚ä½ å¯ä»¥ä½¿ç”¨ Gzip å‹ç¼©ä½ çš„å“åº”ä¸»ä½“ä»¥åŠè¯·æ±‚ä¸»ä½“ã€‚ç”±äºæ–‡ä»¶å°å¾—å¤šï¼Œæ­¤æ“ä½œå¯å¤§å¤§å‡å°‘ä¼ è¾“æ—¶é—´ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong>å¦‚æœä½ å°è¯•ä½¿ç”¨postmanï¼Œå®ƒä¼šé»˜è®¤åœ¨headerçš„éšè—éƒ¨åˆ†ä¸­æ·»åŠ  Accept-Encoding: gzipå­—æ®µã€‚</p>

<blockquote><p>é‡è¦æç¤ºï¼šOkHttp ä¹Ÿä¼šè‡ªåŠ¨åœ¨è¯·æ±‚ä¸­æ·»åŠ å­—æ®µ Accept-Encoding å¹¶è‡ªåŠ¨è¯†åˆ«å“åº”ä¸­çš„ Content-Encodingï¼Œå› æ­¤ä¼šè‡ªè¡Œè§£å‹ç¼©å“åº”æ•°æ®ï¼Œå› æ­¤æ— éœ€å•ç‹¬è®¾ç½®ï¼Œä½†å‡è®¾å½“æˆ‘ä»¬å¿…é¡»å°†å‹ç¼©çš„è¯·æ±‚æ•°æ®å‘é€åˆ°æœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬å°±å¿…é¡»ç¼–å†™è‡ªå·±çš„æ‹¦æˆªå™¨ã€‚</p></blockquote>

<p>è¿™ç§å‹ç¼©çš„æ£˜æ‰‹ä¹‹å¤„åœ¨äºè¯·æ±‚è€…å’ŒæœåŠ¡å™¨éƒ½çŸ¥é“å¯ä»¥å‘é€å‹ç¼©æ–‡ä»¶ã€‚ä½ å¿…é¡»å‘Šè¯‰æœåŠ¡å™¨æ‚¨æ¥å—è¿™ç§ç¼–ç ï¼Œç„¶åå®ƒæ‰ä¼šæä¾›ã€‚è¯¥åè®®åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p>

<ul>
<li>è¯·æ±‚è€…å‘é€ä¸€ä¸ªheaderï¼Œå‘ŠçŸ¥æœåŠ¡å™¨å®ƒæ¥å—å‹ç¼©å†…å®¹ï¼šAccept-Encodingï¼šgzip</li>
<li>æœåŠ¡å™¨ä½¿ç”¨æ­¤headerç¡®è®¤ä½ çš„è¯·æ±‚ï¼šContent-Encodingï¼šgzip</li>
</ul>


<p>è¯´å¾—å¤Ÿå¤šçš„äº†ï¼Œæˆ‘æƒ³ä½ è¿˜æœ‰è€å¿ƒï¼Œæ‰€ä»¥è®©æˆ‘ä»¬çœ‹ä¸€äº›ä»£ç ã€‚</p>

<h2>ç¼–å†™è‡ªå·±çš„æ‹¦æˆªå™¨</h2>

<p>å…ˆå†³æ¡ä»¶ï¼šäº†è§£ OkHttp ä¸­çš„<a href="https://square.github.io/okhttp/features/interceptors/">æ‹¦æˆªå™¨ï¼ˆInterceptorsï¼‰</a>ã€‚</p>

<ol>
<li>è§£å¼€ Gzip å“åº”ï¼šåœ¨è¯·æ±‚headerä¸­æ·»åŠ  Accept-Encoding: gzipï¼Œå¹¶åœ¨è·å–å“åº”æ—¶åœ¨å…¶å“åº”headerä¸­æŸ¥æ‰¾ Content-Encoding: gzipã€‚å¦‚æœå­˜åœ¨åˆ™è§£å‹ç¼©ï¼Œå¦åˆ™ç›´æ¥è¿”å›å“åº”ã€‚</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='Java'><span class='line'><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">okhttp3.Headers</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">okhttp3.Interceptor</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">okhttp3.Request</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">okhttp3.Response</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">okhttp3.ResponseBody</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">okio.GzipSource</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">okio.Okio</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GzipInterceptor</span> <span class="kd">implements</span> <span class="n">Interceptor</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Response</span> <span class="nf">intercept</span><span class="o">(</span><span class="n">Chain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Request</span><span class="o">.</span><span class="na">Builder</span> <span class="n">newRequest</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="na">request</span><span class="o">().</span><span class="na">newBuilder</span><span class="o">();</span>
</span><span class='line'>        <span class="n">newRequest</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&quot;Accept-Encoding&quot;</span><span class="o">,</span> <span class="s">&quot;gzip&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">Response</span> <span class="n">response</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="na">proceed</span><span class="o">(</span><span class="n">newRequest</span><span class="o">.</span><span class="na">build</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">isGzipped</span><span class="o">(</span><span class="n">response</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nf">unzip</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">response</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Response</span> <span class="nf">unzip</span><span class="o">(</span><span class="kd">final</span> <span class="n">Response</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">response</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">GzipSource</span> <span class="n">gzipSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">GzipSource</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="o">().</span><span class="na">source</span><span class="o">());</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">bodyString</span> <span class="o">=</span> <span class="n">Okio</span><span class="o">.</span><span class="na">buffer</span><span class="o">(</span><span class="n">gzipSource</span><span class="o">).</span><span class="na">readUtf8</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">ResponseBody</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">ResponseBody</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="o">().</span><span class="na">contentType</span><span class="o">(),</span> <span class="n">bodyString</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Headers</span> <span class="n">strippedHeaders</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">newBuilder</span><span class="o">()</span>
</span><span class='line'>                <span class="o">.</span><span class="na">removeAll</span><span class="o">(</span><span class="s">&quot;Content-Encoding&quot;</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">removeAll</span><span class="o">(</span><span class="s">&quot;Content-Length&quot;</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
</span><span class='line'>                <span class="o">.</span><span class="na">headers</span><span class="o">(</span><span class="n">strippedHeaders</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">responseBody</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">message</span><span class="o">())</span>
</span><span class='line'>                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">Boolean</span> <span class="nf">isGzipped</span><span class="o">(</span><span class="n">Response</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">&quot;Content-Encoding&quot;</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">response</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">&quot;Content-Encoding&quot;</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;gzip&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>åˆ›å»º Gzip è¯·æ±‚ï¼šå¦‚æœä½ çš„è¯·æ±‚è¿‡å¤§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥å‹ç¼©æˆ‘ä»¬çš„è¯·æ±‚ã€‚ä¸ºäº†é€šçŸ¥æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°†åœ¨è¯·æ±‚headerä¸­æ·»åŠ  Content-Encoding: gzipã€‚</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='Java'><span class='line'><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">okhttp3.Interceptor</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">okhttp3.MediaType</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">okhttp3.Request</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">okhttp3.RequestBody</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">okhttp3.Response</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">okio.BufferedSink</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">okio.GzipSink</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">okio.Okio</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GzipInterceptor</span> <span class="kd">implements</span> <span class="n">Interceptor</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span> <span class="kd">public</span> <span class="n">Response</span> <span class="nf">intercept</span><span class="o">(</span><span class="n">Interceptor</span><span class="o">.</span><span class="na">Chain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Request</span> <span class="n">originalRequest</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="na">request</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">originalRequest</span><span class="o">.</span><span class="na">body</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">originalRequest</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">&quot;Content-Encoding&quot;</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">chain</span><span class="o">.</span><span class="na">proceed</span><span class="o">(</span><span class="n">originalRequest</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Request</span> <span class="n">compressedRequest</span> <span class="o">=</span> <span class="n">originalRequest</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
</span><span class='line'>                <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">&quot;Content-Encoding&quot;</span><span class="o">,</span> <span class="s">&quot;gzip&quot;</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="n">originalRequest</span><span class="o">.</span><span class="na">method</span><span class="o">(),</span> <span class="n">gzip</span><span class="o">(</span><span class="n">originalRequest</span><span class="o">.</span><span class="na">body</span><span class="o">()))</span>
</span><span class='line'>                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">chain</span><span class="o">.</span><span class="na">proceed</span><span class="o">(</span><span class="n">compressedRequest</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="n">RequestBody</span> <span class="nf">gzip</span><span class="o">(</span><span class="kd">final</span> <span class="n">RequestBody</span> <span class="n">body</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">RequestBody</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="nd">@Override</span> <span class="kd">public</span> <span class="n">MediaType</span> <span class="nf">contentType</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="n">body</span><span class="o">.</span><span class="na">contentType</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">long</span> <span class="nf">contentLength</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span> <span class="c1">// äº‹å…ˆä¸çŸ¥é“è¯·æ±‚å†…å®¹çš„é•¿åº¦</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">writeTo</span><span class="o">(</span><span class="n">BufferedSink</span> <span class="n">sink</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">BufferedSink</span> <span class="n">gzipSink</span> <span class="o">=</span> <span class="n">Okio</span><span class="o">.</span><span class="na">buffer</span><span class="o">(</span><span class="k">new</span> <span class="nf">GzipSink</span><span class="o">(</span><span class="n">sink</span><span class="o">));</span>
</span><span class='line'>                <span class="n">body</span><span class="o">.</span><span class="na">writeTo</span><span class="o">(</span><span class="n">gzipSink</span><span class="o">);</span>
</span><span class='line'>                <span class="n">gzipSink</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">};</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¥½äº†ï¼Œå°±åˆ°è¿™é‡Œå§ï¼Œå¦‚æœä½ æ„¿æ„çš„è¯ï¼Œå¯ä»¥èµä¸€ä¸‹ã€‚</p>

<p>å‚è€ƒèµ„æ–™ï¼š</p>

<ol>
<li><a href="https://square.github.io/okhttp/">https://square.github.io/okhttp/</a></li>
<li><a href="https://www.apphp.com/tutorials/index.php?page=gzip-and-deflate-compression-in-web-development">https://www.apphp.com/tutorials/index.php?page=gzip-and-deflate-
compression-in-web-development</a></li>
<li><a href="https://www.youtube.com/watch?v=Mjab_aZsdxw">https://en.wikipedia.org/wiki/Gzip</a></li>
<li><a href="https://www.youtube.com/watch?v=Mjab_aZsdxw">https://www.youtube.com/watch?v=Mjab_aZsdxw</a></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è¯¦è§£DiffUtilsã€Myersç®—æ³•å’Œ Jetpack Compose]]></title>
    <link href="https://alexhilton.github.io/blog/2025/02/24/diffutils-and-jetpack-compose/"/>
    <updated>2025-02-24T22:33:47+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/02/24/diffutils-and-jetpack-compose</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ª<a href="https://proandroiddev.com/diffutils-myers-algorithm-and-jetpack-compose-028c726e574d">ã€ŠDiffUtils, Myersâ€™ Algorithm and Jetpack Composeã€‹</a>ï¼ŒåŸæ–‡å‘å¸ƒäº2024å¹´12æœˆ27æ—¥ã€‚</p></blockquote>

<p>åœ¨ Android UI å¼€å‘é¢†åŸŸï¼ŒDiffUtils æ˜¯ä¼˜åŒ– RecyclerView ä¸­åˆ—è¡¨æ›´æ–°çš„å¿…å¤‡å·¥å…·ã€‚DiffUtils æ˜¯ä¸€ä¸ªå®ç”¨ç¨‹åºç±»ï¼Œå®ƒè®¡ç®—å°†ä¸€ä¸ªåˆ—è¡¨è½¬æ¢ä¸ºå¦ä¸€ä¸ªåˆ—è¡¨æ‰€éœ€çš„<strong>æœ€å°æ›´æ”¹</strong>ï¼Œå¹¶ä»…æ›´æ–° UI ä¸­å·²æ›´æ”¹çš„éƒ¨åˆ†ï¼Œä»è€Œ<strong>èŠ‚çœæ€§èƒ½å¹¶å‡å°‘ä¸å¿…è¦çš„é‡ç»˜</strong>ã€‚è¿™ä¸ªå¼ºå¤§çš„å·¥å…·ä¾èµ–äº<strong>Myersç®—æ³•</strong>ï¼Œè¿™æ˜¯ä¸€ç§åœ¨ä¸¤ä¸ªåºåˆ—ä¹‹é—´æ‰¾åˆ°<strong>æœ€çŸ­ç¼–è¾‘è„šæœ¬ï¼ˆShortest edit scriptï¼‰</strong>çš„æœ‰æ•ˆæ–¹æ³•ã€‚</p>

<p><a href="https://alexhilton.github.io/blog/2025/02/24/diffutils-and-jetpack-compose/"><img src="https://www.pngmart.com/files/Android-App-Development-PNG-Free-Download.png" title="auto auto" ></a></p>

<!-- more -->


<p>ä½†åœ¨ Jetpack Compose ä¸­ï¼Œæ˜¯æ²¡æœ‰DiffUtilsçš„ï¼Œè¿™åˆæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>

<p>åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæˆ‘å°†è¯¦ç»†åˆ†æ DiffUtils çš„å·¥ä½œåŸç†ã€å®ƒä¸ Myers ç®—æ³•çš„è”ç³»ã€ä¸ºä»€ä¹ˆå®ƒæ˜¯ç°ä»£ Android å¼€å‘çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå¹¶æ¢è®¨ä¸ºä»€ä¹ˆ DiffUtil åœ¨ Compose ä¸­æ˜¯ä¸å¿…è¦çš„ã€Compose å¦‚ä½•ä¼˜åŒ– UI æ›´æ–°ï¼Œä»¥åŠä½ åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ¥ä»£æ›¿ã€‚</p>

<p>è®©æˆ‘ä»¬å¼€å§‹å§ï¼</p>

<h2>DiffUtils æ˜¯ä»€ä¹ˆï¼Ÿ</h2>

<p>DiffUtils æ˜¯ Android ä¸­çš„ä¸€ä¸ªå®ç”¨ç¨‹åºï¼Œå®ƒå¯ä»¥æ¯”è¾ƒä¸¤ä¸ªåˆ—è¡¨å¹¶ç”Ÿæˆä¸€ç³»åˆ—æ›´æ–°æ“ä½œï¼Œä¾‹å¦‚ï¼š</p>

<ul>
<li>æ’å…¥ï¼šæ·»åŠ æ–°é¡¹ç›®ã€‚</li>
<li>åˆ é™¤ï¼šç§»é™¤è¿‡æ—¶çš„é¡¹ç›®ã€‚</li>
<li>ç§»åŠ¨ï¼šé‡æ–°æ’åºç°æœ‰é¡¹ç›®ã€‚</li>
</ul>


<p>ç„¶åå¯ä»¥åº”ç”¨è¿™äº›æ“ä½œæ¥æœ‰æ•ˆåœ°æ›´æ–°åˆ—è¡¨ï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘ä¸å¿…è¦çš„é‡ç»˜æˆ–é‡æ–°è®¡ç®—ã€‚è¿™åœ¨ RecyclerView ç­‰æ€§èƒ½è‡³å…³é‡è¦çš„ç»„ä»¶ä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚</p>

<h3>DiffUtils çš„å·¥ä½œåŸç†</h3>

<blockquote><p>DiffUtil ä½¿ç”¨ Eugene W. Myers çš„å·®å¼‚ç®—æ³•æ¥è®¡ç®—å°†ä¸€ä¸ªåˆ—è¡¨è½¬æ¢ä¸ºå¦ä¸€ä¸ªåˆ—è¡¨æ‰€éœ€çš„æœ€å°‘æ›´æ–°æ¬¡æ•°ã€‚Myers çš„ç®—æ³•ä¸å¤„ç†ç§»åŠ¨çš„é¡¹ç›®ï¼Œå› æ­¤ DiffUtil å¯¹ç»“æœè¿›è¡Œç¬¬äºŒæ¬¡éå†ä»¥æ£€æµ‹ç§»åŠ¨çš„é¡¹ç›®ã€‚&ndash; <a href="https://developer.android.com/reference/androidx/recyclerview/widget/DiffUtil">https://developer.android.com/reference/androidx/recyclerview/widget/DiffUtil</a></p></blockquote>

<p>Android ä¸­çš„ DiffUtils åŸºäº Myers ç®—æ³•ï¼Œç”¨äºæ¯”è¾ƒåˆ—è¡¨å¹¶æ‰¾å‡ºå®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚Myers ç®—æ³•å’Œ DiffUtils çš„ç›®æ ‡æ˜¯ç›¸åŒçš„ï¼šç¡®å®šå°†ä¸€ä¸ªåºåˆ—ï¼ˆåˆ—è¡¨ï¼‰è½¬æ¢ä¸ºå¦ä¸€ä¸ªåºåˆ—ï¼ˆåˆ—è¡¨ï¼‰æ‰€éœ€çš„æœ€å°æ›´æ”¹æ¬¡æ•°ï¼ŒåŒ…æ‹¬æ’å…¥ã€åˆ é™¤å’Œç§»åŠ¨ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼ŒDiffUtils é€šè¿‡è¯†åˆ«ä»¥ä¸‹å†…å®¹æ¥è®¡ç®—ä¸¤ä¸ªåˆ—è¡¨ä¹‹é—´çš„å·®å¼‚ï¼š</p>

<ol>
<li>æœ€é•¿å…¬å…±å­åºåˆ— (LCS)ï¼šæ–°æ—§åˆ—è¡¨ä¹‹é—´ä¿æŒä¸å˜çš„å…ƒç´ ã€‚</li>
<li>ç¼–è¾‘æ“ä½œï¼šå°†æ—§åˆ—è¡¨è½¬æ¢ä¸ºæ–°åˆ—è¡¨æ‰€éœ€çš„æ’å…¥ã€åˆ é™¤å’Œç§»åŠ¨ã€‚</li>
</ol>


<p><strong>å…³é”®è§è§£ï¼š</strong>
DiffUtilsä½¿ç”¨ LCS çš„æ¦‚å¿µæ¥æœ€å°åŒ–æ›´æ”¹ï¼ˆæ’å…¥å’Œåˆ é™¤ï¼‰ï¼Œå¹¶ä¸”è¿˜é’ˆå¯¹ç§»åŠ¨è¿›è¡Œäº†ä¼˜åŒ–â€”â€”è¿™æ˜¯åŸºäºåˆ—è¡¨çš„æ¯”è¾ƒæ‰€ç‰¹æœ‰çš„åŠŸèƒ½ï¼Œå…¶ä¸­å…ƒç´ ä¸ä»…è¢«åˆ é™¤å’Œæ’å…¥ï¼Œè€Œä¸”è¿˜è¢«é‡æ–°å®šä½ã€‚</p>

<h3>Myers ç®—æ³•ï¼šDiffUtils çš„åŸºç¡€</h3>

<p>Myers ç®—æ³•äº 1986 å¹´æ¨å‡ºï¼Œæ—¨åœ¨è®¡ç®—ä¸¤ä¸ªåºåˆ—ä¹‹é—´çš„<strong>æœ€çŸ­ç¼–è¾‘è„šæœ¬ (SESï¼ŒShortest Edit Script)</strong>ã€‚å®ƒæ‰¾åˆ°å°†ä¸€ä¸ªåºåˆ—è½¬æ¢ä¸ºå¦ä¸€ä¸ªåºåˆ—æ‰€éœ€çš„æœ€å°‘æ“ä½œæ•°ã€‚è¿™äº›æ“ä½œåŒ…æ‹¬ï¼š</p>

<ul>
<li>æ’å…¥</li>
<li>åˆ é™¤</li>
<li>åŒ¹é…ï¼ˆæŒ‰é¡ºåºæ’åˆ—çš„å…¬å…±å…ƒç´ ï¼‰</li>
</ul>


<h4>Myers ç®—æ³•çš„å…³é”®æ¦‚å¿µ</h4>

<p>Myers ç®—æ³•æ—¨åœ¨æ‰¾åˆ°å°†ä¸€ä¸ªåºåˆ—ï¼ˆä¾‹å¦‚ï¼Œæ—§åˆ—è¡¨ï¼‰è½¬æ¢ä¸ºå¦ä¸€ä¸ªåºåˆ—ï¼ˆæ–°åˆ—è¡¨ï¼‰æ‰€éœ€çš„æœ€å°‘<strong>æ’å…¥ã€åˆ é™¤å’Œç§»åŠ¨</strong>æ¬¡æ•°ã€‚è¯¥ç®—æ³•åŸºäº<strong>ç¼–è¾‘è·ç¦»ï¼ˆEdit Distanceï¼‰</strong>çš„æ¦‚å¿µï¼Œå¹¶ä¸“é—¨è®¡ç®—å°†ä¸€ä¸ªåºåˆ—è½¬æ¢ä¸ºå¦ä¸€ä¸ªåºåˆ—çš„ä¸€ç³»åˆ—æ“ä½œã€‚</p>

<p>Myers ç®—æ³•åœ¨è®¡ç®—<strong>æœ€çŸ­çš„ç¼–è¾‘æ“ä½œåºåˆ—</strong>æ–¹é¢ç‰¹åˆ«æœ‰æ•ˆï¼Œä»è€Œæœ€å°åŒ–æ‰€éœ€çš„æ€»æ›´æ”¹æ¬¡æ•°ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯æ‰¾åˆ°ä¸¤ä¸ªåºåˆ—ä¹‹é—´çš„<strong>æœ€é•¿å…¬å…±å­åºåˆ— (LCS)</strong>ï¼Œç„¶åç¡®å®šå°†æ—§åºåˆ—è½¬æ¢ä¸ºæ–°åºåˆ—çš„æœ€å°æ“ä½œã€‚</p>

<p>æœ€é•¿å…¬å…±å­åºåˆ— (LCS)ï¼šMyers ç®—æ³•é¦–å…ˆç¡®å®šä¸¤ä¸ªåˆ—è¡¨ä¹‹é—´çš„ LCSã€‚LCS è¡¨ç¤ºä¸éœ€è¦ä¿®æ”¹çš„å…ƒç´ ã€‚</p>

<p><strong>ç¼–è¾‘å›¾ï¼š</strong></p>

<ul>
<li>è¯¥ç®—æ³•å°†è½¬æ¢å¯è§†åŒ–ä¸ºä¸€ä¸ªå›¾ï¼Œå…¶ä¸­æ¯æ¡è·¯å¾„
ä»£è¡¨ä¸€ç³»åˆ—æ“ä½œï¼ˆæ’å…¥ã€åˆ é™¤æˆ–åŒ¹é…ï¼‰ã€‚</li>
<li>é€šè¿‡è¯¥å›¾çš„æœ€çŸ­è·¯å¾„å¯¹åº”äºæœ€çŸ­ç¼–è¾‘è„šæœ¬
ï¼ˆSESï¼‰ã€‚</li>
</ul>


<p><strong>ä¼˜åŒ–ï¼š</strong></p>

<ul>
<li>Myers ç®—æ³•ä½¿ç”¨åŠ¨æ€è§„åˆ’æ¥å‡å°‘è®¡ç®—å¼€é”€ï¼Œå®ç°é«˜æ•ˆçš„ O(ND) æ—¶é—´å¤æ‚åº¦ï¼Œå…¶ä¸­ N å’Œ D æ˜¯åºåˆ—çš„é•¿åº¦å’Œå®ƒä»¬ä¹‹é—´çš„è·ç¦»ã€‚</li>
</ul>


<h3>DiffUtils å®é™…åº”ç”¨ç¤ºä¾‹</h3>

<p>è®©æˆ‘ä»¬è€ƒè™‘ä¸¤ä¸ªåˆ—è¡¨ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// Old list</span>
</span><span class='line'><span class="na">[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;]</span>
</span><span class='line'><span class="c1">// New List</span>
</span><span class='line'><span class="na">[&quot;a&quot;, &quot;d&quot;, &quot;c&quot;, &quot;b&quot;]</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><strong>ç¡®å®š LCS</strong>ï¼šæ­¤å¤„çš„ LCS ä¸º [&ldquo;a&rdquo;] ã€‚</li>
<li><strong>è®¡ç®—ç¼–è¾‘è„šæœ¬</strong>ï¼š</li>
<li>åˆ é™¤â€œbâ€ï¼ˆæ—§åˆ—è¡¨ï¼‰ã€‚</li>
<li>å°†â€œdâ€ç§»åˆ°â€œcâ€ä¹‹å‰ã€‚</li>
<li>åœ¨â€œcâ€ä¹‹åæ’å…¥â€œbâ€ã€‚</li>
<li><strong>åº”ç”¨æ›´æ”¹</strong>ï¼šä½¿ç”¨è¿™äº›æœ€å°‘çš„æ“ä½œå°†æ—§åˆ—è¡¨è½¬æ¢ä¸ºæ–°åˆ—è¡¨ã€‚</li>
</ol>


<h3>DiffUtils åœ¨ RecyclerView ä¸­çš„ä½œç”¨</h3>

<p>åœ¨ RecyclerView ä¸­ï¼Œæ¯æ¬¡æ›´æ–°éƒ½æ¶‰åŠè®¡ç®—å“ªäº›é¡¹ç›®å‘ç”Ÿäº†å˜åŒ–ã€å“ªäº›é¡¹ç›®è¢«æ·»åŠ ä»¥åŠå“ªäº›é¡¹ç›®è¢«åˆ é™¤ã€‚å•çº¯åœ°æ›´æ–°æ•´ä¸ªåˆ—è¡¨å¯èƒ½ä¼šå¯¼è‡´å¡é¡¿æˆ–æ— å“åº”ç­‰æ€§èƒ½é—®é¢˜ã€‚DiffUtils é€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³æ­¤é—®é¢˜ï¼š</p>

<ul>
<li>æœ€å°åŒ–æ›´æ”¹ï¼šä»…æ‰§è¡Œå¿…è¦çš„æ›´æ–°ã€‚</li>
<li>ä¼˜åŒ–æ€§èƒ½ï¼šå®ç°æµç•…çš„åŠ¨ç”»å’Œé«˜æ•ˆçš„åˆ—è¡¨æ›´æ–°ã€‚</li>
<li>å‡å°‘é‡ç»˜ï¼šä»…é‡æ–°æ¸²æŸ“å—å½±å“çš„é¡¹ç›®ï¼Œä»è€Œæé«˜æ•´ä½“ UI å“åº”èƒ½åŠ›ã€‚</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='Java'><span class='line'><span class="c1">// ç¬¬1æ­¥: åˆ›å»ºä¸€ä¸ªDiffUtil.Callback</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyDiffCallback</span> <span class="kd">extends</span> <span class="n">DiffUtil</span><span class="o">.</span><span class="na">Callback</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">oldList</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">newList</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">MyDiffCallback</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">oldList</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">newList</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">oldList</span> <span class="o">=</span> <span class="n">oldList</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">newList</span> <span class="o">=</span> <span class="n">newList</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getOldListSize</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">oldList</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getNewListSize</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">newList</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">areItemsTheSame</span><span class="o">(</span><span class="kt">int</span> <span class="n">oldItemPosition</span><span class="o">,</span> <span class="kt">int</span> <span class="n">newItemPosition</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">oldList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oldItemPosition</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="n">newList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">newItemPosition</span><span class="o">));</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">areContentsTheSame</span><span class="o">(</span><span class="kt">int</span> <span class="n">oldItemPosition</span><span class="o">,</span> <span class="kt">int</span> <span class="n">newItemPosition</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">oldList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">oldItemPosition</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="n">newList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">newItemPosition</span><span class="o">));</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ç¬¬2æ­¥: è®¡ç®—å·®å¼‚</span>
</span><span class='line'><span class="n">DiffUtil</span><span class="o">.</span><span class="na">DiffResult</span> <span class="n">diffResult</span> <span class="o">=</span> <span class="n">DiffUtil</span><span class="o">.</span><span class="na">calculateDiff</span><span class="o">(</span>
</span><span class='line'>    <span class="k">new</span> <span class="nf">MyDiffCallback</span><span class="o">(</span><span class="n">oldList</span><span class="o">,</span> <span class="n">newList</span><span class="o">)</span>
</span><span class='line'><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ç¬¬3æ­¥: æ´¾å‘æ›´æ–°</span>
</span><span class='line'><span class="n">myAdapter</span><span class="o">.</span><span class="na">submitList</span><span class="o">(</span><span class="n">newList</span><span class="o">);</span>
</span><span class='line'><span class="n">diffResult</span><span class="o">.</span><span class="na">dispatchUpdatesTo</span><span class="o">(</span><span class="n">myAdapter</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>DiffUtils æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºå¤„ç† Android ä¸­çš„åˆ—è¡¨æ›´æ–°ï¼Œç¡®ä¿é«˜æ•ˆä¸”æœ€å°çš„æ›´æ”¹ã€‚é€šè¿‡åˆ©ç”¨ Myers ç®—æ³•ï¼Œå®ƒå¯ä»¥è®¡ç®—å‡ºå°†ä¸€ä¸ªåˆ—è¡¨è½¬æ¢ä¸ºå¦ä¸€ä¸ªåˆ—è¡¨çš„æœ€çŸ­ç¼–è¾‘è„šæœ¬ã€‚äº†è§£å…¶å·¥ä½œåŸç†ä¸ä»…å¯ä»¥æé«˜ä½ å¯¹ Android å¼€å‘çš„æŒæ¡ï¼Œè¿˜å¯ä»¥å¸®åŠ©ä½ ä¼˜åŒ– RecyclerView çš„æ€§èƒ½ã€‚</p>

<h2>ä¸ºä»€ä¹ˆ Compose ä¸éœ€è¦ DiffUtils</h2>

<p>Jetpack Compose å»ºç«‹åœ¨<strong>å£°æ˜æ€§ UI åŸåˆ™</strong>ä¹‹ä¸Šï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥æ ¹æ®å½“å‰çŠ¶æ€<strong>æè¿° UI åº”è¯¥æ˜¯</strong>ä»€ä¹ˆæ ·å­ï¼Œè€Œ Compose ä¼šå¤„ç†å…¶ä½™çš„äº‹æƒ…ã€‚</p>

<p><strong>å‘½ä»¤å¼ UIï¼ˆè§†å›¾ï¼‰ï¼š</strong></p>

<ul>
<li>é€šè¿‡ç¡®å®šéœ€è¦åº”ç”¨å“ªäº›æ›´æ”¹ï¼Œä½ å¯ä»¥æ‰‹åŠ¨æ›´æ–° UI ç»„ä»¶ã€‚</li>
<li>DiffUtil ç­‰å·¥å…·å¯¹äºè®¡ç®—åˆ—è¡¨çš„æœ€å°æ›´æ–°ä»¥æ§åˆ¶æ€§èƒ½å¿…ä¸å¯å°‘ã€‚</li>
</ul>


<p><strong>å£°æ˜å¼ UIï¼ˆComposeï¼‰ï¼š</strong></p>

<ul>
<li>ä½ æè¿°ç»™å®šçŠ¶æ€ä¸‹çš„ UI åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼Œè€Œä¸æ˜¯å¦‚ä½•æ›´æ”¹å®ƒã€‚</li>
<li>Compose ä¼šè‡ªåŠ¨é‡æ–°ç»„åˆå—çŠ¶æ€æ›´æ”¹å½±å“çš„ UI éƒ¨åˆ†ã€‚</li>
</ul>


<p>åœ¨ Compose ä¸­ï¼Œ<strong>çŠ¶æ€é©±åŠ¨ UIï¼Œé‡ç»„å¤„ç†æ›´æ–°</strong>ã€‚DiffUtils æ— éœ€è®¡ç®—å¢é‡ï¼Œå› ä¸ºç³»ç»Ÿä¼šè‡ªåŠ¨ä¼˜åŒ–è¦é‡æ–°æ¸²æŸ“çš„å†…å®¹ã€‚</p>

<p>ä»¥ä¸‹æ˜¯ Compose ä¸å†éœ€è¦ DiffUtils çš„ä¸»è¦åŸå› ï¼š</p>

<ol>
<li><strong>çŠ¶æ€é©±åŠ¨çš„UI</strong></li>
</ol>


<p>åœ¨ Compose ä¸­ï¼Œå½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒUI ä¼šè‡ªåŠ¨é‡ç»„ã€‚ä½ æ— éœ€æ‰‹åŠ¨è®¡ç®—åˆ—è¡¨ä¹‹é—´çš„å·®å¼‚ï¼›Compose ä¼šä¸ºä½ å¤„ç†ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">val</span> <span class="py">items</span> <span class="p">=</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">mutableStateListOf</span><span class="p">(</span><span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="s">&quot;Banana&quot;</span><span class="p">,</span> <span class="s">&quot;Cherry&quot;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">LazyColumn</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">items</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="p">{</span> <span class="n">item</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="n">Text</span><span class="p">(</span><span class="n">text</span> <span class="p">=</span> <span class="n">item</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœä½ ä» items ä¸­æ·»åŠ æˆ–åˆ é™¤é¡¹ç›®ï¼ŒCompose å°†ä»…é‡ç»„ UI ä¸­å—å½±å“çš„éƒ¨åˆ†ã€‚æ— éœ€ DiffUtilsï¼</p>

<ol>
<li><strong>å†…ç½®ä¼˜åŒ–</strong></li>
</ol>


<p>Compose ä½¿ç”¨ LazyColumn å’Œ LazyRow ä¸­çš„é”®æ¥ä¼˜åŒ–é¡¹ç›®æ¸²æŸ“ã€‚é€šè¿‡ä¸ºæ¯ä¸ªé¡¹ç›®æŒ‡å®šä¸€ä¸ªå”¯ä¸€é”®ï¼ŒCompose å¯ä»¥è¯†åˆ«å“ªäº›é¡¹ç›®å·²æ›´æ”¹ã€å·²æ·»åŠ æˆ–å·²ç§»é™¤ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">LazyColumn</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">items</span><span class="p">(</span><span class="n">items</span> <span class="p">=</span> <span class="n">yourList</span><span class="p">,</span> <span class="n">key</span> <span class="p">=</span> <span class="p">{</span> <span class="n">item</span> <span class="p">-&gt;</span> <span class="n">item</span><span class="p">.</span><span class="n">id</span> <span class="p">})</span> <span class="p">{</span> <span class="n">item</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="n">Text</span><span class="p">(</span><span class="n">text</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¯¥keyç¡®ä¿ Compose æœ‰æ•ˆåœ°ä»…æ›´æ–°å—å½±å“çš„é¡¹ç›®ï¼Œç±»ä¼¼äº DiffUtils æ‰€åšçš„ã€‚</p>

<ol>
<li><strong>æ™ºèƒ½é‡ç»„</strong></li>
</ol>


<p>Compose å¯ä»¥æ™ºèƒ½åœ°è·³è¿‡æœªå‘ç”Ÿæ”¹å˜çš„ UI å…ƒç´ çš„é‡ç»„ã€‚ä½¿ç”¨ Remember å’Œ RememberSaveable ç­‰å·¥å…·ï¼Œä½ å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–é‡ç»„è¡Œä¸ºã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">RememberExample</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">count</span> <span class="p">=</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">mutableStateOf</span><span class="p">(</span><span class="m">0</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Button</span><span class="p">(</span><span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span> <span class="n">count</span><span class="p">.</span><span class="n">value</span><span class="p">++</span> <span class="p">})</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Text</span><span class="p">(</span><span class="s">&quot;Clicked ${count.value} times&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// åœ¨è¿™é‡Œï¼Œå½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåªæœ‰Buttonä¸­çš„Textï¼Œè€Œä¸æ˜¯æ•´ä¸ªç»„ä»¶ï¼Œä¼šå‘ç”Ÿé‡ç»„</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Compose ä¸­çš„é‡ç»„ï¼š</strong></p>

<ul>
<li>Compose ä¼šè§‚å¯ŸçŠ¶æ€å˜åŒ–ã€‚å½“ç‰¹å®š UI å…ƒç´ çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåªä¼šé‡ç»„è¯¥å…ƒç´ ï¼ˆåŠå…¶ä¾èµ–é¡¹ï¼‰ã€‚</li>
<li>ç³»ç»Ÿä¼šå®Œå…¨è·³è¿‡æœªæ›´æ”¹çš„ UI å…ƒç´ ã€‚</li>
</ul>


<p><strong>Views ä¸­çš„ DiffUtilsï¼š</strong></p>

<ul>
<li>éœ€è¦æ˜ç¡®è®¡ç®—åˆ—è¡¨çš„æ–°æ—§çŠ¶æ€ä¹‹é—´çš„å˜åŒ–ã€‚</li>
<li>ç„¶ååˆ†æ´¾è®¡ç®—å‡ºçš„æ›´æ”¹ä»¥æ›´æ–° RecyclerViewã€‚</li>
</ul>


<h3>åœ¨ Compose ä¸­ç”¨ä»€ä¹ˆæ¥ä»£æ›¿ DiffUtils</h3>

<p>è™½ç„¶ä½ ä¸éœ€è¦ DiffUtils ï¼Œä½† Compose æä¾›äº†å®ç°ç±»ä¼¼ä¼˜åŒ–çš„å·¥å…·ï¼š</p>

<ol>
<li>å¸¦ Keys çš„ LazyColumn</li>
</ol>


<p>ä½¿ç”¨ key å¯ä»¥æœ‰æ•ˆåœ°è¯†åˆ«å’Œç®¡ç†åˆ—è¡¨ä¸­çš„æ›´æ”¹ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">LazyColumn</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">items</span><span class="p">(</span><span class="n">items</span> <span class="p">=</span> <span class="n">yourList</span><span class="p">,</span> <span class="n">key</span> <span class="p">=</span> <span class="p">{</span> <span class="n">item</span> <span class="p">-&gt;</span> <span class="n">item</span><span class="p">.</span><span class="n">id</span> <span class="p">})</span> <span class="p">{</span> <span class="n">item</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="n">Text</span><span class="p">(</span><span class="n">text</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>SnapshotStateList</li>
</ol>


<p>è‹¥è¦ä»¥è¢«åŠ¨æ–¹å¼ç®¡ç†åˆ—è¡¨ï¼Œè¯·ä½¿ç”¨ SnapshotStateList ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">val</span> <span class="py">items</span> <span class="p">=</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">mutableStateListOf</span><span class="p">(</span><span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="s">&quot;Banana&quot;</span><span class="p">,</span> <span class="s">&quot;Cherry&quot;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'><span class="n">Button</span><span class="p">(</span><span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span> <span class="n">items</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Date&quot;</span><span class="p">)</span> <span class="p">})</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Text</span><span class="p">(</span><span class="s">&quot;Add Item&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="n">LazyColumn</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">items</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="p">{</span> <span class="n">item</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="n">Text</span><span class="p">(</span><span class="n">text</span> <span class="p">=</span> <span class="n">item</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>SubcomposeLayout</li>
</ol>


<p>å¯¹äºå¤æ‚çš„åœºæ™¯ï¼ŒSubcomposeLayout å¯ä»¥ç²¾ç¡®æ§åˆ¶è¦é‡ç»„çš„å†…å®¹ã€‚</p>

<h2>ç›¸å…³çš„é¢è¯•é—®é¢˜</h2>

<ol>
<li>ä¸ºä»€ä¹ˆ Jetpack Compose ä¸éœ€è¦ DiffUtils ï¼Ÿ</li>
</ol>


<p>Compose ä¾èµ–äºå£°æ˜æ€§ UI æ¨¡å‹ã€‚å®ƒä¼šæ ¹æ®çŠ¶æ€å˜åŒ–è‡ªåŠ¨æ›´æ–° UIï¼Œæ— éœ€åƒ DiffUtil é‚£æ ·æ‰‹åŠ¨è®¡ç®—åˆ—è¡¨å·®å¼‚ã€‚ä½¿ç”¨ LazyColumn ä¸­çš„é”®å¯ç¡®ä¿é«˜æ•ˆæ›´æ–°ï¼Œè€Œæ— éœ€ä½¿ç”¨å¤–éƒ¨å·¥å…·ã€‚</p>

<ol>
<li>Jetpack Compose å¤„ç†åˆ—è¡¨æ›´æ–°çš„æ–¹å¼ä¸ RecyclerView æœ‰ä½•ä¸åŒï¼Ÿ</li>
</ol>


<p>Compose ä¸ä¾èµ–æ‰‹åŠ¨å·®å¼‚è®¡ç®— (DiffUtils)ï¼Œè€Œæ˜¯è§‚å¯ŸçŠ¶æ€å˜åŒ–å¹¶ä»…é‡ç»„å—å½±å“çš„ç»„ä»¶ã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨é”®å’Œ Compose çš„é‡ç»„é€»è¾‘åœ¨å†…éƒ¨ç®¡ç†çš„ã€‚</p>

<ol>
<li><p>åœ¨ Android å¼€å‘ä¸­ï¼Œå£°æ˜å¼ UI ä¸å‘½ä»¤å¼ UI ç›¸æ¯”æœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿ</p></li>
<li><p>ä»£ç æ›´ç®€å•ï¼šå£°æ˜å¼ UI é€šè¿‡å…³æ³¨å†…å®¹è€Œä¸æ˜¯æ–¹å¼æ¥å‡å°‘æ ·æ¿ä»£ç ã€‚</p></li>
<li>è‡ªåŠ¨çŠ¶æ€ç®¡ç†ï¼šCompose æ ¹æ®çŠ¶æ€å˜åŒ–è‡ªåŠ¨æ›´æ–° UIã€‚</li>
<li>å¯æµ‹è¯•æ€§æé«˜ï¼šæ— çŠ¶æ€å¯ç»„åˆé¡¹å¯ä»¥ç‹¬ç«‹æµ‹è¯•ã€‚</li>
<li>ä¸€è‡´æ€§ï¼šé‡ç»„ç¡®ä¿ UI å§‹ç»ˆåæ˜ å½“å‰çŠ¶æ€ã€‚</li>
<li><p>Compose ä¸­çš„é‡ç»„æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä¸ RecyclerView ä¸­çš„ä¼ ç»Ÿè§†å›¾å¤±æ•ˆæœ‰ä½•ä¸åŒï¼Ÿ</p></li>
<li><p>é‡ç»„ï¼šå½“ Compose æ£€æµ‹åˆ°çŠ¶æ€å˜åŒ–æ—¶å‘ç”Ÿã€‚å®ƒä»…é‡æ–°ç”Ÿæˆå—å˜åŒ–å½±å“çš„ UI éƒ¨åˆ†ã€‚</p></li>
<li>è§†å›¾å¤±æ•ˆï¼šåœ¨ RecyclerView ä¸­ï¼Œå¤±æ•ˆä¼šè§¦å‘è§†å›¾é‡ç»˜ï¼Œå¦‚æœæ²¡æœ‰ DiffUtil ä¹‹ç±»çš„å·¥å…·ï¼Œè¿™å¯èƒ½ä¼šå¾ˆä½æ•ˆã€‚</li>
<li><p>ä½•æ—¶åº”åœ¨ Compose ä¸­ä½¿ç”¨ Remember å’Œ RememberSaveableï¼Ÿ</p></li>
<li><p>ä½¿ç”¨ Remember åœ¨å•ä¸ªç»„åˆç”Ÿå‘½å‘¨æœŸå†…å­˜å‚¨çŠ¶æ€ã€‚</p></li>
<li>ä½¿ç”¨ RememberSaveable åœ¨é…ç½®æ›´æ”¹ï¼ˆå¦‚å±å¹•æ—‹è½¬ï¼‰æœŸé—´ä¿ç•™çŠ¶æ€ã€‚</li>
<li>Compose å¦‚ä½•å†³å®šè¦é‡ç»„ UI çš„å“ªäº›éƒ¨åˆ†ï¼Ÿ</li>
</ol>


<p>Compose ä¼šè·Ÿè¸ªæ¯ä¸ªå¯ç»„åˆé¡¹ä¸­çš„çŠ¶æ€è¯»å–ã€‚å½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåªæœ‰è¯»å–å·²æ›´æ”¹çŠ¶æ€çš„å¯ç»„åˆé¡¹æ‰ä¼šè¢«é‡ç»„ã€‚</p>

<ol>
<li>åœ¨ Compose ä¸­å®ç° LazyColumn ä»¥æ˜¾ç¤ºé¡¹ç›®åˆ—è¡¨å¹¶æ·»åŠ æŒ‰é’®æ¥æ›´æ–°åˆ—è¡¨ã€‚ç¡®ä¿å®ƒèƒ½å¤Ÿé«˜æ•ˆæ›´æ–°ã€‚</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">LazyColumnExample</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">items</span> <span class="p">=</span> <span class="n">remember</span> <span class="p">{</span> <span class="n">mutableStateListOf</span><span class="p">(</span><span class="s">&quot;Apple&quot;</span><span class="p">,</span> <span class="s">&quot;Banana&quot;</span><span class="p">,</span> <span class="s">&quot;Cherry&quot;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Column</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Button</span><span class="p">(</span><span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span> <span class="n">items</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;Date&quot;</span><span class="p">)</span> <span class="p">})</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">Text</span><span class="p">(</span><span class="s">&quot;Add Item&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">LazyColumn</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">items</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">key</span> <span class="p">=</span> <span class="p">{</span> <span class="n">it</span> <span class="p">})</span> <span class="p">{</span> <span class="n">item</span> <span class="p">-&gt;</span>
</span><span class='line'>                <span class="n">Text</span><span class="p">(</span><span class="n">text</span> <span class="p">=</span> <span class="n">item</span><span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>è¯†åˆ«å¹¶ä¿®å¤ Compose ç»„ä»¶ä¸­ä¸å¿…è¦çš„é‡ç»„ã€‚</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">LazyColumn</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">items</span><span class="p">(</span><span class="n">items</span> <span class="p">=</span> <span class="n">list</span><span class="p">,</span> <span class="n">key</span> <span class="p">=</span> <span class="p">{</span> <span class="n">item</span> <span class="p">-&gt;</span> <span class="n">item</span><span class="p">.</span><span class="n">id</span> <span class="p">})</span> <span class="p">{</span> <span class="n">item</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="n">Text</span><span class="p">(</span><span class="n">text</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ol>
<li><p>è¯Šæ–­ LazyColumn ä¸­çš„æ»åï¼š</p></li>
<li><p>æ£€æŸ¥å…³é”®å‚æ•°ï¼šç¡®ä¿æ¯ä¸ªé¡¹ç›®éƒ½æœ‰å”¯ä¸€çš„é”®ã€‚</p></li>
<li>ä½¿ç”¨åˆ†æå·¥å…·ï¼šä½¿ç”¨ Android Studio çš„Compose è°ƒè¯•å™¨åˆ†æé‡ç»„è®¡æ•°ã€‚</li>
<li>ä¼˜åŒ–é¡¹ç›®æ¸²æŸ“ï¼šé¿å…åœ¨ LazyColumn ä¸­ä½¿ç”¨çš„å¯ç»„åˆå‡½æ•°ä¸­è¿›è¡Œå¤§é‡è®¡ç®—ã€‚</li>
<li>è°ƒè¯•åˆ—è¡¨æ›´æ–°ä¸­çš„ä¸ä¸€è‡´è¡Œä¸ºï¼š</li>
</ol>


<p>ç¡®ä¿æ•°æ®æºç¨³å®šå¹¶ç¬¦åˆ UI é¢„æœŸã€‚ä½¿ç”¨SnapshotStateList å¯ä»¥å¸®åŠ©ä¿æŒååº”æ€§ã€‚</p>

<ol>
<li>SnapshotStateList å’Œ ArrayList ä¹‹é—´çš„åŒºåˆ«ï¼š</li>
</ol>


<p>SnapshotStateList æ˜¯è¢«åŠ¨çš„ï¼›æ›´æ”¹ä¼šè‡ªåŠ¨è§¦å‘ Compose ä¸­çš„é‡ç»„ã€‚ArrayList ä¸æ˜¯è¢«åŠ¨çš„ï¼Œéœ€è¦æ‰‹åŠ¨é€šçŸ¥ UI æ›´æ–°ã€‚</p>

<ol>
<li>ä½¿ç”¨ SubcomposeLayout</li>
</ol>


<p>SubcomposeLayout æ˜¯ Jetpack Compose ä¸­ä¸€ä¸ªå¼ºå¤§çš„å¸ƒå±€å·¥å…·ï¼Œå¯è®©ä½ æŒ‰éœ€ç»„åˆå¸ƒå±€çš„å„ä¸ªéƒ¨åˆ†ã€‚è¿™å¯¹äº UI çš„æŸäº›éƒ¨åˆ†å ç”¨å¤§é‡èµ„æºæˆ–å¯èƒ½æ— æ³•ç«‹å³ä½¿ç”¨çš„æƒ…å†µå°¤å…¶æœ‰ç”¨ï¼Œä¾‹å¦‚ä»ç½‘ç»œæˆ–æ•°æ®åº“åŠ è½½å›¾åƒã€‚SubcomposeLayout å…è®¸æŒ‰éœ€ç»„åˆå¸ƒå±€çš„å„ä¸ªéƒ¨åˆ†ã€‚</p>

<p>ç¤ºä¾‹ï¼šåŠ¨æ€åŠ è½½å›¾åƒå¹¶æ˜¾ç¤ºå ä½ç¬¦ï¼Œç›´åˆ°å‡†å¤‡å¥½ä¸ºæ­¢ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">ImageWithPlaceholder</span><span class="p">(</span><span class="n">imageUrl</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">placeholder</span><span class="p">:</span> <span class="n">Painter</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Box</span><span class="p">(</span><span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">fillMaxSize</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">SubcomposeLayout</span> <span class="p">{</span> <span class="n">constraints</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="c1">// First, compose the placeholder</span>
</span><span class='line'>            <span class="k">val</span> <span class="py">placeholderLayout</span> <span class="p">=</span> <span class="n">subcompose</span><span class="p">(</span><span class="m">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">Image</span><span class="p">(</span><span class="n">painter</span> <span class="p">=</span> <span class="n">placeholder</span><span class="p">,</span> <span class="n">contentDescription</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">fillMaxSize</span><span class="p">())</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Compose the image once it&#39;s loaded</span>
</span><span class='line'>            <span class="k">val</span> <span class="py">imageLayout</span> <span class="p">=</span> <span class="n">subcompose</span><span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">AsyncImage</span><span class="p">(</span>
</span><span class='line'>                    <span class="n">model</span> <span class="p">=</span> <span class="n">imageUrl</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">contentDescription</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">fillMaxSize</span><span class="p">(),</span>
</span><span class='line'>                    <span class="n">contentScale</span> <span class="p">=</span> <span class="n">ContentScale</span><span class="p">.</span><span class="n">Crop</span>
</span><span class='line'>                <span class="p">)</span><span class="err">ä½ </span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Return the max size for the layout</span>
</span><span class='line'>            <span class="n">layout</span><span class="p">(</span><span class="n">constraints</span><span class="p">.</span><span class="n">maxWidth</span><span class="p">,</span> <span class="n">constraints</span><span class="p">.</span><span class="n">maxHeight</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">placeholderLayout</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">measure</span><span class="p">(</span><span class="n">constraints</span><span class="p">).</span><span class="n">placeRelative</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
</span><span class='line'>                <span class="n">imageLayout</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">measure</span><span class="p">(</span><span class="n">constraints</span><span class="p">).</span><span class="n">placeRelative</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Preview</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">ImageWithPlaceholderPreview</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">ImageWithPlaceholder</span><span class="p">(</span>
</span><span class='line'>        <span class="n">imageUrl</span> <span class="p">=</span> <span class="s">&quot;https://www.example.com/image.jpg&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="n">placeholder</span> <span class="p">=</span> <span class="n">painterResource</span><span class="p">(</span><span class="n">id</span> <span class="p">=</span> <span class="n">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">placeholder_image</span><span class="p">)</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>SubcomposeLayoutï¼šæ­¤å¸ƒå±€å…è®¸ä½ æ ¹æ®éœ€è¦ç»„åˆå¸ƒå±€çš„å„ä¸ªéƒ¨åˆ†ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆç»„åˆå ä½ç¬¦ï¼Œç„¶ååœ¨å›¾åƒå‡†å¤‡å¥½åç»„åˆå›¾åƒã€‚</li>
<li>subcompose()ï¼šæ­¤å‡½æ•°ç”¨äºç»„åˆå¸ƒå±€çš„å„ä¸ªéƒ¨åˆ†ã€‚subcompose å‡½æ•°è¿”å› MeasureResult å¯¹è±¡åˆ—è¡¨ï¼Œç„¶åä½ å¯ä»¥æµ‹é‡è¿™äº›å¯¹è±¡å¹¶å°†å…¶æ”¾ç½®åœ¨å±å¹•ä¸Šã€‚</li>
<li>AsyncImageï¼šæˆ‘ä»¬ä½¿ç”¨ coil-compose åº“ä¸­çš„ AsyncImage å¼‚æ­¥åŠ è½½å›¾åƒã€‚åŠ è½½æ—¶ï¼Œä¼šæ˜¾ç¤ºå ä½ç¬¦ã€‚</li>
<li>å ä½ç¬¦ï¼šé¦–å…ˆæ˜¾ç¤ºå ä½ç¬¦ã€‚å›¾åƒå‡†å¤‡å¥½åï¼Œå®ƒä¼šæ¥ç®¡ã€‚</li>
</ul>


<p>æ­¤æ–¹æ³•å¯å¸®åŠ©ä½ é€šè¿‡å‡å°‘ä¸å¿…è¦çš„é‡æ–°ç»„åˆå’Œæ›´ä¼˜é›…åœ°å¤„ç†å›¾åƒæˆ–æ•°æ®ç­‰åŠ¨æ€å†…å®¹æ¥åˆ›å»ºæ›´é«˜æ•ˆâ€‹â€‹çš„ UIã€‚</p>

<ol>
<li><p>å°†æ—§ç‰ˆ RecyclerView è¿ç§»åˆ° Composeï¼š</p></li>
<li><p>ç”¨ LazyColumn æ›¿æ¢ RecyclerViewã€‚</p></li>
<li>å°†é€‚é…å™¨é€»è¾‘ç§»è‡³å¯ç»„åˆå‡½æ•°ã€‚</li>
<li>ä½¿ç”¨ Remember æˆ– SnapshotStateList è¿›è¡ŒçŠ¶æ€ç®¡ç†ã€‚</li>
<li>ä½¿ç”¨ Keys è¿›è¡Œä¼˜åŒ–ã€‚</li>
</ol>


<h2>ç»“è®º</h2>

<ul>
<li>Compose ä¸éœ€è¦ DiffUtilsï¼Œå› ä¸ºå®ƒå»ºç«‹åœ¨å£°æ˜æ€§å’ŒçŠ¶æ€é©±åŠ¨çš„æ¶æ„ä¸Šã€‚</li>
<li>å¸¦æœ‰ key çš„ LazyColumn å’Œ SnapshotStateList æä¾›ç±»ä¼¼çš„ä¼˜åŒ–ã€‚</li>
<li>æ™ºèƒ½é‡ç»„å¯ç¡®ä¿é«˜æ•ˆçš„ UI æ›´æ–°ï¼Œä»è€Œå‡å°‘æ‰‹åŠ¨ä¼˜åŒ–çš„éœ€è¦ã€‚</li>
</ul>


<p>é€šè¿‡æ‹¥æŠ± Compose çš„å£°æ˜æ€§ç‰¹æ€§ï¼Œä½ å¯ä»¥ä¸“æ³¨äºæ„å»ºç¾è§‚ã€å“åº”è¿…é€Ÿçš„ UIï¼Œè€Œæ— éœ€æ‹…å¿ƒåˆ—è¡¨æ›´æ–°çš„å¤æ‚æ€§ã€‚</p>

<p>Happy Composingï¼</p>

<h2>å‚è€ƒæ–‡çŒ®</h2>

<ol>
<li>Myers, E. (1986)ã€‚O(ND) å·®åˆ†ç®—æ³•åŠå…¶å˜ä½“ã€‚ACMç¼–ç¨‹è¯­è¨€å’Œç³»ç»Ÿäº‹åŠ¡ï¼Œ1(2)ï¼Œ251â€“266ã€‚</li>
<li><a href="https://developer.android.com/reference/androidx/recyclerview/widget/DiffUtil">Android å¼€å‘è€…æ–‡æ¡£ â€” DiffUtils</a></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Composeå¤šå¹³å° (CMP) å¼€å‘çš„å››ä¸ªå®ç”¨æŠ€å·§]]></title>
    <link href="https://alexhilton.github.io/blog/2025/02/04/tips-to-migrate-to-kmp/"/>
    <updated>2025-02-04T17:21:07+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/02/04/tips-to-migrate-to-kmp</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ª<a href="https://proandroiddev.com/4-useful-tips-for-compose-kotlin-multiplatform-kmp-8809ba1cac51">Four useful tips for Compose Kotlin Multiplatform (KMP)</a></p></blockquote>

<p><strong>è¯‘æ³¨ï¼š</strong> è¿™ç¯‡æ–‡ç« è™½ç„¶æ¯”è¾ƒçŸ­ï¼Œä½†æåˆ°çš„é—®é¢˜è¿˜æ˜¯æ¯”è¾ƒå…·ä½“å’Œå…¸å‹çš„ï¼Œé’ˆå¯¹CMPé¡¹ç›®çš„ä¸€äº›é…ç½®è¿˜æ˜¯å¾ˆæœ‰å€Ÿé‰´æ„ä¹‰çš„ã€‚</p>

<p><a href="https://alexhilton.github.io/blog/2025/02/04/tips-to-migrate-to-kmp/"><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/j9tap6mygsqvxh6aauc8.png" title="auto auto" ></a></p>

<!-- more -->


<h2>ç®€ä»‹</h2>

<p>æ­£å¦‚æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« <a href="https://medium.com/@lizarraga.iosu/a-complete-migration-of-a-multi-module-app-to-compose-kotlin-multiplatform-kmp-682905266bde">ã€Šå°†å¤šæ¨¡å—åº”ç”¨ç¨‹åºå®Œå…¨è¿ç§»åˆ° Compose Kotlin Multiplatform (KMP)ã€‹</a>ä¸­æ‰€è¯´ï¼Œä¸Šä¸ªæœˆæˆ‘ä¸€ç›´åœ¨å°†ç°æœ‰çš„å¤šæ¨¡å—åº”ç”¨ç¨‹åºè¿ç§»åˆ° Compose Multiplatformï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘è¿˜ä»å¤´å¼€å§‹åˆ›å»ºä¸€ä¸ªæ–°çš„ Compose Multiplatform å¤šæ¨¡å—é¡¹ç›®ã€‚åœ¨è¿™ä¸¤ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘éƒ½é‡åˆ°äº†ç›¸åŒçš„â€œé—®é¢˜â€æˆ–è€…è¯´â€œé˜»ç¢â€ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨æ­£åœ¨è¿ç§»æˆ–ä»å¤´å¼€å§‹å¯åŠ¨ CMP é¡¹ç›®ï¼Œé‚£ä¹ˆæœ¬æ–‡å°±æ˜¯ä¸ºä½ é‡èº«å®šåšçš„ã€‚</p>

<h2>æç¤º 1ï¼šé¢„è§ˆ</h2>

<p>KMP ä¸æ”¯æŒ commonMain ç›®å½•Composeç»„ä»¶çš„é¢„è§ˆï¼Œå› æ­¤æˆ‘æƒ³åˆ°äº†åœ¨ androidMain ç›®å½•ä¸­åˆ›å»ºå®ƒä»¬ï¼Œå¹¶ä¸”å®ƒä»¬çš„é¢„è§ˆè¿è¡Œå¾—å¾ˆå¥½ã€‚</p>

<blockquote><p><strong>è¯‘æ³¨ï¼š</strong>æ­¤æ–‡åŸæ–‡å‘å¸ƒäº2024å¹´12æœˆåˆï¼Œå½¼æ—¶éAndroidä¾§çš„æºç ç¡®å®æ— æ³•Previewï¼Œåæ¥JetBrainsè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡ä¸€ä¸ª<a href="https://plugins.jetbrains.com/plugin/16541-compose-multiplatform-ide-support">æ”¯æŒæ¡Œé¢Composeçš„æ’ä»¶</a>ã€‚</p></blockquote>

<p>ä¾‹å¦‚ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>commonMain/com/example/feature/component/FeatureScreen.kt
</span><span class='line'>androidMain/com/example/feature/component/FeatureScreenPreview.kt
</span></code></pre></td></tr></table></div></figure>


<h2>æç¤º 2ï¼šBackHandler</h2>

<p>KMP ä¸æ”¯æŒ BackHandler æ“ä½œï¼Œå› æ­¤æˆ‘åˆ›å»ºäº†ä¸€ä¸ªç”¨äºå±å¹•çš„expectå‡½æ•°ï¼Œå¹¶åœ¨ androidMain ä¸­çš„actualå‡½æ•°ä¸Šæ·»åŠ äº† BackHandler æ“ä½œï¼Œå¹¶å°† iosMain ç•™ç©ºï¼ˆå› ä¸ºæˆ‘åœ¨ iOS ä¸­æ²¡æœ‰æ‰¾åˆ°ç±»ä¼¼çš„æ“ä½œï¼‰ã€‚</p>

<p>ä¾‹å¦‚ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// commonMain/ com.example.feature.component.FeatureScreen.kt</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="n">expect</span> <span class="k">fun</span> <span class="nf">FeatureScreen</span><span class="p">(</span>
</span><span class='line'>    <span class="n">viewModel</span><span class="p">:</span> <span class="n">FeatureScreenViewModel</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">internal</span> <span class="k">fun</span> <span class="nf">Content</span><span class="p">(</span>
</span><span class='line'>    <span class="n">viewModel</span><span class="p">:</span> <span class="n">FeatureScreenViewModel</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// androidMain/ com.example.feature.component.FeatureScreenActual.kt (needs a name different from common)</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="n">actual</span> <span class="k">fun</span> <span class="nf">FeatureScreen</span><span class="p">(</span>
</span><span class='line'>    <span class="n">viewModel</span><span class="p">:</span> <span class="n">WorkScreenViewModel</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">BackHandler</span> <span class="p">{</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">onIntent</span><span class="p">(</span><span class="n">WorkIntent</span><span class="p">.</span><span class="n">Back</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Content</span><span class="p">(</span>
</span><span class='line'>        <span class="n">viewModel</span> <span class="p">=</span> <span class="n">viewModel</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// extra: I have joined the preview in this same class to have it better organized.</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// iosMain/ com.example.feature.component.FeatureScreenActual.kt (needs a name different from common)</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="n">actual</span> <span class="k">fun</span> <span class="nf">FeatureScreen</span><span class="p">(</span>
</span><span class='line'>    <span class="n">viewModel</span><span class="p">:</span> <span class="n">WorkScreenViewModel</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Content</span><span class="p">(</span>
</span><span class='line'>        <span class="n">viewModel</span> <span class="p">=</span> <span class="n">viewModel</span><span class="p">,</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>æç¤º 3ï¼šæµ‹è¯•æ¨¡æ‹Ÿ</h2>

<p>æˆ‘å–œæ¬¢ä½¿ç”¨ <a href="https://mockk.io/">mockk</a> åº“è¿›è¡Œæ¨¡æ‹Ÿæµ‹è¯•ï¼Œåœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼ŒKMP å°šä¸æ”¯æŒè¯¥åº“ï¼Œå› æ­¤æˆ‘å†³å®šåœ¨ androidUnitTest ç›®å½•ä¸­åˆ›å»º UnitTestï¼Œå¹¶å°†åº“ä¾èµ–é¡¹æ·»åŠ åˆ° androidUnitTest.dependencies {} å—ä¸­ã€‚</p>

<p>å¯¹äºæ­¤ç±»æµ‹è¯•ï¼Œæˆ‘ä½¿ç”¨äº†æ”¯æŒ KMP çš„ kotlin-test jetbrains åº“ã€‚</p>

<p>ä¾‹å¦‚ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">mockk</span> <span class="p">=</span> <span class="p">{</span> <span class="n">group</span> <span class="p">=</span> <span class="s">&quot;io.mockk&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;mockk&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">.</span><span class="n">ref</span> <span class="p">=</span> <span class="s">&quot;mockk-version&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="n">kotlin</span><span class="p">-</span><span class="n">test</span> <span class="p">=</span> <span class="p">{</span> <span class="n">group</span> <span class="p">=</span> <span class="s">&quot;org.jetbrains.kotlin&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;kotlin-test&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">.</span><span class="n">ref</span> <span class="p">=</span> <span class="s">&quot;kotlin-version&quot;</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// feature build.gradle.kts</span>
</span><span class='line'><span class="n">kotlin</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">sourceSets</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">androidUnitTest</span><span class="p">.</span><span class="n">dependencies</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="n">libs</span><span class="p">.</span><span class="n">mockk</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">commonTest</span><span class="p">.</span><span class="n">dependencies</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="n">libs</span><span class="p">.</span><span class="n">kotlin</span><span class="p">.</span><span class="n">test</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>androidUnitTest/com/example/feature/usecase/UseCaseTest.kt
</span></code></pre></td></tr></table></div></figure>


<h2>æç¤º 4ï¼šUI æµ‹è¯•</h2>

<p><a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/compose-test.html">å®˜æ–¹çš„ Compose å¤šå¹³å° UI æµ‹è¯•æŒ‡å—</a>æŒ‡å‡ºï¼Œå¿…é¡»ä½¿ç”¨commonTest ç›®å½•è¿›è¡Œ UI æµ‹è¯•ï¼Œä½†æˆ‘æ›´å–œæ¬¢ä½¿ç”¨androidInstrumentedTestç›®å½•ï¼Œå› ä¸ºä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘å¯ä»¥å°†å•å…ƒæµ‹è¯•ä¸ UI æµ‹è¯•åˆ†å¼€ï¼Œå¹¶ä¸”æˆ‘å¯ä»¥ç›´æ¥ä»åŒä¸€ä¸ªæµ‹è¯•ç±»æ‰§è¡Œå®ƒä»¬ï¼Œå¹¶ä»ç›®å½•è¿è¡Œæ‰€æœ‰ UI æµ‹è¯•ã€‚</p>

<p>ä¾‹å¦‚ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">mockk</span><span class="p">-</span><span class="n">android</span> <span class="p">=</span> <span class="p">{</span> <span class="n">group</span> <span class="p">=</span> <span class="s">&quot;io.mockk&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;mockk-android&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">.</span><span class="n">ref</span> <span class="p">=</span> <span class="s">&quot;mockk-version&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="n">ui</span><span class="p">-</span><span class="n">test</span><span class="p">-</span><span class="n">junit4</span><span class="p">-</span><span class="n">android</span> <span class="p">=</span> <span class="p">{</span> <span class="n">group</span> <span class="p">=</span> <span class="s">&quot;androidx.compose.ui&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;ui-test-junit4-android&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">.</span><span class="n">ref</span> <span class="p">=</span> <span class="s">&quot;uiTestJunit4AndroidVersion&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="n">ui</span><span class="p">-</span><span class="n">test</span><span class="p">-</span><span class="n">manifest</span> <span class="p">=</span> <span class="p">{</span> <span class="n">group</span> <span class="p">=</span> <span class="s">&quot;androidx.compose.ui&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;ui-test-manifest&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">.</span><span class="n">ref</span> <span class="p">=</span> <span class="s">&quot;uiTestManifestVersion&quot;</span> <span class="p">}</span>
</span><span class='line'><span class="n">kotlin</span><span class="p">-</span><span class="n">test</span> <span class="p">=</span> <span class="p">{</span> <span class="n">group</span> <span class="p">=</span> <span class="s">&quot;org.jetbrains.kotlin&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;kotlin-test&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">.</span><span class="n">ref</span> <span class="p">=</span> <span class="s">&quot;kotlin-version&quot;</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// feature build.gradle.kts</span>
</span><span class='line'><span class="n">plugins</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>    <span class="n">alias</span><span class="p">(</span><span class="n">libs</span><span class="p">.</span><span class="n">plugins</span><span class="p">.</span><span class="n">compose</span><span class="p">.</span><span class="n">multiplatform</span><span class="p">)</span>
</span><span class='line'>    <span class="n">alias</span><span class="p">(</span><span class="n">libs</span><span class="p">.</span><span class="n">plugins</span><span class="p">.</span><span class="n">compose</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">kotlin</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">sourceSets</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">androidInstrumentedTest</span><span class="p">.</span><span class="n">dependencies</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="n">libs</span><span class="p">.</span><span class="n">mockk</span><span class="p">.</span><span class="n">android</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="n">libs</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">junit4</span><span class="p">.</span><span class="n">android</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">commonTest</span><span class="p">.</span><span class="n">dependencies</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="n">libs</span><span class="p">.</span><span class="n">kotlin</span><span class="p">.</span><span class="n">test</span><span class="p">)</span>
</span><span class='line'>            <span class="n">@OptIn</span><span class="p">(</span><span class="n">ExperimentalComposeLibrary</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="n">compose</span><span class="p">.</span><span class="n">uiTest</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>
</span><span class='line'><span class="n">dependencies</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">debugImplementation</span><span class="p">(</span><span class="n">libs</span><span class="p">.</span><span class="n">ui</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">manifest</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>androidInstrumentedTest/com/example/feature/component/ScreenAndroidTest.kt
</span></code></pre></td></tr></table></div></figure>


<h2>ç»“è®º</h2>

<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€äº› Compose Multiplatform æŠ€å·§ï¼Œå¸Œæœ›æ‚¨è§‰å¾—å®ƒä»¬æœ‰ç”¨ã€‚æ„Ÿè°¢æ‚¨é˜…è¯»æœ¬æ–‡ï¼Œæ¬¢è¿æä¾›ä»»ä½•åé¦ˆã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å…³äºAndroid 16ä½ æƒ³çŸ¥é“çš„éƒ½åœ¨è¿™é‡Œ]]></title>
    <link href="https://alexhilton.github.io/blog/2025/01/02/android-16-is-comming/"/>
    <updated>2025-01-02T22:14:32+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/01/02/android-16-is-comming</id>
    <content type="html"><![CDATA[<p>2025å¹´çš„Androidæ–°ç‰ˆæœ¬æ¥çš„æ¯”2024å¹´ç¨æ—©äº†ä¸€äº›ã€‚ä»Šå¹´Googleéå¸¸åå¸¸åœ°æå‰å°±å‘å¸ƒäº†Androidçš„<a href="https://developer.android.com/about/versions/16">æ–°ç‰ˆæœ¬Android 16 Baklava</a>ï¼Œæ•´ä½“çš„è®¡åˆ’æ¯”å¾€å¹´æå‰äº†2ï½3ä¸ªæœˆã€‚å¦å¤–ï¼Œè°·æ­ŒæŠŠ<a href="https://www.androidfaithful.com/android-16-code-name/">Android 16çš„ä»£ç å‘½åä¸ºã€ŒBaklavaã€</a>,è¿™ä¸å…ˆå‰çš„å­—æ¯è¡¨é¡ºåºçš„ç‚¹å¿ƒé£Ÿç‰©å‘½åæ–¹å¼æˆªç„¶ä¸åŒï¼Œä¸è¿‡ã€ŒBaklavaã€å·´å…‹æ‹‰ç“¦ï¼Œåˆç§°æœä»èœœé¥¼ï¼Œæ˜¯ä¸€ç§å£å‘³æµ“éƒã€ç”œèœœçš„åœŸè€³å…¶é…¥çš®ç‚¹å¿ƒã€‚</p>

<p><a href="https://alexhilton.github.io/blog/2025/01/02/android-16-is-comming/"><img src="https://www.android-user.de/wp-content/uploads/2024/11/20241101-Android-16-Baklava-Beitragsbild.jpg" title="auto auto" ></a></p>

<!-- more -->


<h2>è°·æ­Œçš„å‘å¸ƒè®¡åˆ’</h2>

<p>ä»<a href="https://developer.android.com/about/versions/16">å®˜æ–¹çš„æ¶ˆæ¯</a>æ¥çœ‹ä¼šåœ¨24å¹´ç»“æŸPreviewï¼Œåœ¨25å¹´1æœˆå…¶å®æ˜¯Q1å°±å¼€å§‹Beta releaseï¼Œå¹¶åœ¨Q2è¿›å…¥Platform Stabilityï¼Œé¢„è®¡ä¸ŠåŠå¹´å°±å¯èƒ½ä¼šæ­£å¼å‘å¸ƒï¼Œæ•´ä½“çš„èŠ‚å¥è¾ƒå¾€å¹´æå‰äº†çº¦2ï½3ä¸ªæœˆï¼ˆå¾€å¹´æ˜¯Q1ä¼šæœ‰Previewï¼ŒQ2å‘å¸ƒBeta,6~7æœˆå·¦å³å¼€å§‹Platform Stabilityï¼ŒQ3 9æœˆï½10æœˆæ­£å¼å‘å¸ƒï¼‰ã€‚</p>

<p><img src="file:///Users/alexhilton/Downloads/android-16-release.webp" alt="å›¾1. Android 16çš„å‘å¸ƒè®¡åˆ’" /></p>

<p>ä¸è¿‡ç°ä»åœ¨éå¸¸ä¸ºåˆå§‹çš„Previewé˜¶æ®µï¼Œåé¢å¯èƒ½ä¼šæœ‰å˜æ•°ï¼Œå®˜æ–¹ä¹Ÿæ²¡æœ‰ç»™å…·ä½“çš„è®¡åˆ’ã€‚ä½†æœ‰ä¸€ç‚¹æ˜¯ç¡®å®šçš„ï¼Œé‚£å°±æ˜¯ä»Šå¹´Android 16çš„å‘å¸ƒè‚¯å®šè¾ƒå¾€å¹´ä¼šææ‹‰ä¸€äº›ï¼Œè‡³å°‘ææ‹‰2ä¸ªæœˆã€‚</p>

<p>å¯¹äºåº”ç”¨å¼€å‘è€…æ¥è¯´ï¼Œæ›´ä¸ºå…³å¿ƒçš„æ˜¯APIçš„å‘å¸ƒæƒ…å†µï¼Œä¸€èˆ¬æƒ…å†µä¸‹APIä¼šè¾ƒç³»ç»Ÿç‰ˆæœ¬æå‰ä¸€ä¸ªå­£åº¦å°±ä¼šæ­£å¼ç¨³å®šä¸‹æ¥ï¼ˆä¹Ÿå³ä¸ä¼šå†æœ‰å¤§çš„å˜åŠ¨ï¼‰ï¼Œæ¢å¥è¯è¯´ï¼Œä»Šå¹´åœ¨Q2å°±èƒ½å¾—åˆ°è¾ƒä¸ºç¨³å®šçš„APIç‰ˆæœ¬ï¼Œå½“ç„¶æ¯”å¾€å¹´è¿˜æ˜¯æœ‰ææ‹‰çš„ã€‚</p>

<p><img src="file:///Users/alexhilton/Downloads/android16-api-release.webp" alt="å›¾2. Android 16 APIçš„å‘å¸ƒè®¡åˆ’" /></p>

<p>å‘å¸ƒè®¡åˆ’ä¸å—æˆ‘ä»¬æ§åˆ¶ï¼Œäº†è§£ä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ç”¨æ¡ä»¶åŒºåˆ†è¿™äº›æ–°çš„APIã€‚</p>

<h2>åŒºåˆ†ä½¿ç”¨æ–°çš„APIçš„æ–¹å¼</h2>

<p>å¦‚æœåº”ç”¨ä¸æ˜¯è¿è¡Œåœ¨æœ€æ–°çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆæ–°çš„APIä¸åº”è¯¥è¢«æ‰§è¡Œï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç”¨æ¡ä»¶æ¥åŒºåˆ†ä¸åŒçš„APIç‰ˆæœ¬ï¼Œç”¨<a href="https://developer.android.com/reference/android/os/Build.VERSION#SDK_INT">SDK_INT</a>å’Œ<a href="https://developer.android.com/reference/android/os/Build.VERSION_CODES">VERSION_CODES</a>å°±å¯ä»¥åšåˆ°ã€‚å½“ç„¶ï¼Œéœ€è¦å…ˆåœ¨Android Studioä¸­æŠŠSDKä¸­çš„Android 16 Previewç‰ˆæœ¬ä¸‹è½½ä¸‹æ¥æ‰èƒ½ç¼–è¯‘ã€‚</p>

<p><img src="file:///Users/alexhilton/Downloads/install-baklava-sdk.png" alt="å›¾3. å‡çº§SDK" /></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">SDK_INT</span> <span class="p">&gt;=</span> <span class="n">VERSION_CODES</span><span class="p">.</span><span class="n">BAKLAVA</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// ä½¿ç”¨Android 16ä¸­æ‰æœ‰çš„API</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸ºäº†èƒ½æ›´ç»†è‡´åœ°åŒºåˆ†ç‰ˆæœ¬ï¼ŒAndroid 16æ–°å¢åŠ äº†ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬å¸¸é‡<a href="https://developer.android.com/reference/android/os/Build.VERSION#SDK_INT_FULL">SDK_INT_FULL</a>ï¼Œå¹¶åœ¨<a href="https://developer.android.com/reference/android/os/Build.VERSION_CODES_FULL">VERSION_CODES_FULL</a>ä¸­å®šä¹‰äº†å…·ä½“çš„å¸¸é‡å€¼ã€‚å®ƒå¯ä»¥ç²’åº¦æ›´ç»†åœ°æ£€æŸ¥APIçš„ç‰ˆæœ¬ï¼Œåˆ†ä¸ºMajorç‰ˆæœ¬å’ŒMinorç‰ˆæœ¬ã€‚ä»¥å¾€çš„SDK_INTåªèƒ½åŒºåˆ†å¤§çš„ç‰ˆæœ¬ï¼ˆMajorç‰ˆæœ¬ï¼‰ï¼Œè¿™æ˜¯å®ƒä»¬æœ€å¤§çš„ä¸åŒã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">SDK_INT_FULL</span> <span class="p">&gt;=</span> <span class="n">VERSION_CODES_FULL</span><span class="p">.[</span><span class="n">MAJOR</span> <span class="n">or</span> <span class="n">MINOR</span> <span class="n">RELEASE</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// ç”¨Majorç‰ˆæœ¬æˆ–è€…Minorç‰ˆæœ¬æ‰æœ‰çš„API</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¯ä¸ªMajorç‰ˆæœ¬å¯èƒ½ä¼šå¤šä¸ªMinorç‰ˆæœ¬ï¼Œå¦‚æœä¸æƒ³éº»çƒ¦ï¼Œå¯ä»¥ç”¨<a href="https://developer.android.com/reference/android/os/Build#getMinorSdkVersion%28int%29">Build.getMinorSdkVersion()</a>æ¥ä»VERSION_CODES_FULLä¸­å–å‡ºMinorç‰ˆæœ¬å·ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong> SDK_INT_FULLï¼ŒVERSION_CODES_FULLä»¥åŠgetMinorSdkVersionéƒ½æ˜¯Android 16ä¸­æ–°å¢çš„APIï¼Œç¡®ä¿æŠŠSDKå‡çº§åˆ°æœ€æ–°æ‰å¯ä»¥ç¼–è¯‘æˆåŠŸã€‚</p>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬é‡ç‚¹æ¥çœ‹ä¸€ä¸‹æ–°ä¸€ä»£çš„Androidå¸¦æ¥äº†å“ªäº›å˜åŒ–ã€‚</p>

<h2>æ–°çš„åŠŸèƒ½å’Œæ–°çš„API</h2>

<p>å¾ˆä¸å¹¸ï¼ŒAndroid 16å¹¶æ²¡æœ‰å¸¦æ¥å…¨æ–°çš„åŠŸèƒ½ã€‚åªæœ‰ä¸€äº›å°çš„æ–°APIã€‚</p>

<h3>ç”¨æˆ·ä½“éªŒå’Œç³»ç»ŸUI</h3>

<p>æä¾›ä¸€äº›çš„æ–°çš„APIä»¥æ›´å¥½æ›´çµæ´»çš„æ§åˆ¶ç³»ç»Ÿçš„è¡Œä¸ºã€‚</p>

<h4>å¯é¢„è§çš„è¿”å›æ›´æ–°</h4>

<p>Android 16å¢åŠ äº†æ–°çš„APIä»¥ä½¿èƒ½æ‰‹åŠ¿å¯¼èˆªä¸­çš„å¯é¢„è§è¿”å›ç³»ç»ŸåŠ¨ç”»ï¼Œæ¯”å¦‚ä»åº”ç”¨è¿”å›åˆ°æ¡Œé¢çš„åŠ¨ç”»ã€‚ä½¿ç”¨æ–°çš„<a href="https://developer.android.com/reference/android/window/OnBackInvokedDispatcher#PRIORITY_SYSTEM_NAVIGATION_OBSERVER">PRIORITY_SYSTEM_NAVIGATION_OBSERVER</a>å‘ç³»ç»Ÿæ³¨å†Œä¸€ä¸ªå›è°ƒ<a href="https://developer.android.com/reference/android/window/OnBackInvokedDispatcher#registerOnBackInvokedCallback(int,%20android.window.OnBackInvokedCallback">onBackInvokedCallback</a>)ï¼Œæ¯å½“ç³»ç»Ÿå¤„ç†ä¸€ä¸ªè¿”å›å¯¼èˆªæ—¶å°±èƒ½å¤Ÿæ”¶åˆ°<a href="https://developer.android.com/reference/android/window/OnBackInvokedCallback#onBackInvoked(">onBackInvoked</a>)å›è°ƒï¼Œè€Œä¸å½±å“å¸¸è§„çš„è¿”å›å¯¼èˆªæµç¨‹ã€‚</p>

<p>Android 16è¿˜å¢åŠ äº†ä¸¤ä¸ªAPI <a href="https://developer.android.com/reference/android/window/SystemOnBackInvokedCallbacks#finishAndRemoveTaskCallback(android.app.Activity">finishAndRemoveTaskCallback</a>)å’Œ<a href="https://developer.android.com/reference/android/window/SystemOnBackInvokedCallbacks#moveTaskToBackCallback(android.app.Activity">moveTaskToBackCallback</a>)ã€‚é€šè¿‡å‘<a href="https://developer.android.com/reference/android/window/OnBackInvokedDispatcher">OnBackInvokedDispatcher</a>æ³¨å†Œè¿™äº›å›è°ƒï¼Œå½“æ‰§è¡Œè¿”å›æ‰‹åŠ¿æ—¶ç³»ç»Ÿå°±èƒ½è§¦å‘å…·ä½“çš„è¡Œä¸ºå’Œæ’­æ”¾ç›¸å…³çš„åŠ¨ç”»ã€‚</p>

<h4>æ›´åŠ ä¸°å¯Œçš„éœ‡æ„Ÿåé¦ˆ</h4>

<p>Android 16å¢åŠ äº†<a href="https://developer.android.com/reference/android/os/vibrator/package-summary">éœ‡æ„ŸAPI</a>ï¼Œèƒ½è®©åº”ç”¨å®šä¹‰éœ‡æ„Ÿæ•ˆæœçš„æŒ¯å¹…å’Œé¢‘ç‡çš„æ›²çº¿ï¼ŒåŒæ—¶å±è”½è®¾å¤‡çš„å·®å¼‚ã€‚</p>

<h3>æ€§èƒ½å’Œç”µæ± </h3>

<p>Android 16æä¾›äº†æ–°çš„APIä»¥å¸®åŠ©æ”¶é›†åº”ç”¨çš„æ´å¯Ÿã€‚</p>

<h4>ç³»ç»Ÿè§¦å‘çš„åˆ†æ</h4>

<p><a href="https://developer.android.com/about/versions/15/features#app-start-info">Android 15</a>æ·»åŠ çš„<a href="https://developer.android.com/reference/android/os/ProfilingManager">ProfilingManager</a>èƒ½è®©åº”ç”¨è¯·æ±‚åˆ†ææ•°æ®é›†ã€‚ç„¶è€Œï¼Œè¿™ä¸ªåˆ†æå¿…é¡»ç”±åº”ç”¨æ¥å‘èµ·ï¼Œä¸€äº›åƒå¯åŠ¨è¿‡ç¨‹ä»¥åŠANRå°±å¾ˆæŠ“å–å¾—åˆ°ï¼ˆå› ä¸ºåº”ç”¨å¿…é¡»è¦å…ˆæ­£å¸¸å¯åŠ¨èµ·æ¥åï¼Œæ‰èƒ½è°ƒç”¨ProfilingManagerå»è·å–åˆ†ææ•°æ®ï¼‰ã€‚</p>

<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒAndroid 16åœ¨ProfilingManagerä¸­å¢åŠ äº†ç³»ç»Ÿè§¦å‘çš„åˆ†ææ•°æ®ã€‚åº”ç”¨å¯ä»¥æ³¨å†Œæ„Ÿå…´è¶£çš„ç‰¹å®šåœºæ™¯çš„traceï¼Œè¯¸å¦‚å†·èµ·åŠ¨æˆ–è€…ANRï¼Œç³»ç»Ÿä¼šæ›¿åº”ç”¨å¼€å¯å’Œåœæ­¢traceã€‚traceæ”¶é›†å®Œæ¯•åï¼Œç»“æœä¼šä¼ åˆ°åº”ç”¨çš„dataç›®å½•ã€‚</p>

<h3>ApplicationStartInfoä¸­å¢åŠ Start component</h3>

<p>ApplicationStateInfoæ˜¯åœ¨Android 15å¢åŠ çš„ï¼Œè®©åº”ç”¨èƒ½å¤Ÿçœ‹åˆ°è¿›ç¨‹å¯åŠ¨åŸå› ï¼Œå¯åŠ¨ç±»å‹ï¼Œå¯åŠ¨æ—¶é—´ç­‰ä¸€ç³»åˆ—è¯Šæ–­æ•°æ®ã€‚Android 16å¢åŠ äº†æ–¹æ³•<a href="">getStartComponent</a>ä»¥è¾¨è¯†å“ªç§ç»„ä»¶ç±»å‹è§¦å‘çš„å¯åŠ¨ï¼Œè¿™å¯¹äºä¼˜åŒ–åº”ç”¨å¯åŠ¨è¿‡ç¨‹å°†ä¼šéå¸¸æœ‰å¸®åŠ©ã€‚</p>

<h3>æ›´å¥½çš„ï¼ˆåå°ï¼‰ä»»åŠ¡åæŸ¥</h3>

<p>API <a href="https://developer.android.com/reference/android/app/job/JobScheduler#getPendingJobReason(int">JobScheduler#getPendingJobReason()</a>)èƒ½è¿”å›ä»»ä½•å¤„äºå¾…å¤„ç†çš„åŸå› ã€‚å½“ç„¶ï¼Œä¸€ä¸ªä»»åŠ¡å¯èƒ½ç”±äºå¾ˆå¤šç§åŸå› å¾…å¤„ç†ã€‚</p>

<p>åœ¨Android 16ä¸­ï¼Œå¢åŠ äº†ä¸€ä¸ªæ–°çš„API <a href="https://developer.android.com/reference/android/app/job/JobScheduler#getPendingJobReasons(int">JobScheduler#getPendingJobReasons(int jobId)</a>)ï¼Œç”¨ä»¥è¿”å›ä»»åŠ¡å¤„äºå¾…å¤„ç†çš„å¤šä¸ªåŸå› ï¼Œæ¯”å¦‚ç¼˜äºå¼€å‘è€…è®¾ç½®äº†æ˜¾æ€§çš„é™åˆ¶æˆ–è€…ç³»ç»Ÿè®¾ç½®çš„éšæ€§é™åˆ¶ã€‚</p>

<p>è¿˜å¢åŠ äº†ä¸€ä¸ªAPI <a href="https://developer.android.com/reference/android/app/job/JobScheduler#getPendingJobReasonsHistory(int">JobScheduler#getPendingJobReasonsHistory(int jobId)</a>)ï¼Œç”¨ä»¥è¿”å›æœ€è¿‘çš„é™åˆ¶å˜æ›´åˆ—è¡¨ã€‚</p>

<p>æ¨èä½¿ç”¨è¿™äº›APIæ¥è°ƒè¯•ä¸ºä½•åå°ä»»åŠ¡æ²¡è¢«æ‰§è¡Œï¼Œå°¤å…¶æ˜¯å½“çœ‹åˆ°ç‰¹å®šä»»åŠ¡çš„æˆåŠŸç‡é™ä½æ—¶ï¼Œæˆ–è€…ç‰¹å®šä»»åŠ¡å®Œæˆæœ‰å»¶è¿Ÿæ—¶ã€‚ä¾‹å¦‚ï¼Œåœ¨åå°æ›´æ–°æ¡Œé¢å°éƒ¨ä»¶æ—¶å¤±è´¥æˆ–è€…é¢„å…ˆæ‹‰å–ä»»åŠ¡åœ¨åº”ç”¨å¯åŠ¨å‰å¤±è´¥ç­‰ç­‰ã€‚</p>

<p>è¿™ä¹Ÿèƒ½å¤Ÿæ›´å¥½çš„å¸®åŠ©ä½ æ˜ç™½å› ä¸ºç³»ç»Ÿå®šä¹‰çš„é™åˆ¶è¿˜æ˜¯å› ä¸ºæ˜¾æ€§çš„é™åˆ¶è€Œå¯¼è‡´ç‰¹å®šçš„ä»»åŠ¡æœªæ‰§è¡Œå®Œæˆã€‚</p>

<h3>è‡ªé€‚åº”åˆ·æ–°é¢‘ç‡</h3>

<p>Android 15å¼•å…¥çš„è‡ªé€‚åº”åˆ·æ–°é¢‘ç‡(Adaptive refresh rate ARR)é€šè¿‡ç¦»æ•£åŒ–çš„VSyncæ­¥é•¿èƒ½å¤Ÿè®©å±å¹•åˆ·æ–°é¢‘ç‡é€‚é…å†…å®¹é¢‘ç‡ã€‚è¿™ä¼šé™ä½åŠŸè€—åŒæ—¶æ¶ˆé™¤æ½œåœ¨çš„æ‰å¸§ã€‚</p>

<p>Android 16å¢åŠ äº†æ–¹æ³•<a href="https://developer.android.com/reference/android/view/Display#hasArrSupport(">hasArrSupport</a>)å’Œæ–¹æ³•<a href="https://developer.android.com/reference/android/view/Display#getSuggestedFrameRate(int">getSuggestedFrameRate(int)</a>)ä»¥åŠ<a href="https://developer.android.com/reference/android/view/Display#getSupportedRefreshRates(">getSupportedRefreshRates()</a>)ï¼Œè®©åº”ç”¨å®¹æ˜“åˆ©ç”¨ARRã€‚Jetpackä¸­çš„å¾ˆå¤šç»„ä»¶åœ¨å†…éƒ¨å®ç°ä¸Šå·²ç»åˆ©ç”¨ARRä»¥å¢å¼ºå¹³æ»‘çš„æ»‘åŠ¨ï¼Œè¯¦ç»†çš„å¯<a href="https://developer.android.com/media/optimize/performance/frame-rate">å‚è§äº†æ­¤æ–‡ç« </a>ã€‚</p>

<h3>è¿æ¥</h3>

<p>WiFiå¯ä»¥ç”¨æ¥å®¤å†…å®šä½ï¼ŒAndroid 16å¢åŠ äº†å¯¹WiFiä½ç½®å®‰å…¨æ€§çš„æ”¯æŒï¼Œé€šè¿‡<a href="https://developer.android.com/reference/android/net/wifi/rtt/SecureRangingConfig">è¿™ä¸ªç‰¹æ€§</a>ã€‚</p>

<h3>åª’ä½“</h3>

<h4>ç…§ç‰‡é€‰æ‹©å¢å¼º</h4>

<p><a href="https://developer.android.com/training/data-storage/shared/photopicker">ç…§ç‰‡é€‰æ‹©å™¨(photo picker)</a>æä¾›äº†ä¸€ä¸ªå®‰å…¨ä¸”å†…ç½®çš„æ–¹å¼è®©åº”ç”¨åœ¨ç”¨æˆ·æˆæƒçš„æƒ…å†µä¸‹ä»å­˜å‚¨ä¸­é€‰æ‹©åª’ä½“æ–‡ä»¶ã€‚</p>

<p>Android 16å¸¦æ¥çš„å¢å¼ºç‚¹æœ‰ï¼š</p>

<ul>
<li>åµŒå…¥å¼çš„å›¾ç‰‡é€‰æ‹©å™¨ï¼š<a href="https://developer.android.com/reference/android/widget/photopicker/package-summary">æ–°çš„API</a>èƒ½å¤Ÿè®©åº”ç”¨æŠŠå›¾ç‰‡é€‰æ‹©å™¨åµŒå…¥åˆ°è‡ªå·±çš„è§†å›¾ä¸­ã€‚è¿™ä¼šè®©å›¾ç‰‡é€‰æ‹©çœ‹èµ·æ¥æ›´åƒæ˜¯åº”ç”¨æ•´ä½“çš„ä¸€éƒ¨åˆ†ã€‚åç»­çš„Jetpackä¸­ä¼šæä¾›å¯åµŒå…¥çš„å›¾ç‰‡é€‰æ‹©å™¨ã€‚</li>
<li>å›¾ç‰‡é€‰æ‹©å™¨æ”¯æŒäº‘æœç´¢ï¼š<a href="https://developer.android.com/sdk/api_diff/b-dp2-incr/changes/pkg_android.provider">æ–°çš„API</a>åœ¨å›¾ç‰‡é€‰æ‹©å™¨å°†æ”¯æŒäº‘æœç´¢ã€‚</li>
</ul>


<h3>éšç§</h3>

<h4>å¥åº·è¿æ¥æ›´æ–°</h4>

<p>å¼€å‘è€…Previewç‰ˆæœ¬ä¸­çš„å¥åº·è¿æ¥å¢åŠ äº†ACTIVITY_INTENSITYï¼ˆæ´»åŠ¨å¼ºåº¦ï¼‰ï¼Œä¾æ®ä¸–ç•Œå¥åº·ç»„ç»‡ï¼ˆWHOï¼‰ç»™å‡ºçš„æŒ‡å—ä¸­å®šä¹‰çš„ä¸€ä¸ªæ–°çš„æ•°æ®ç±»å‹ã€‚æ¯ä¸€æ¡è®°å½•å°†å¿…é¡»åŒ…æ‹¬å¼€å§‹æ—¶é—´ï¼Œç»“æŸæ—¶é—´ä»¥åŠæ´»åŠ¨å¼ºåº¦ã€‚</p>

<h4>éšç§æ²™ç›’</h4>

<p>Android 16é›†æˆäº†<a href="https://developers.google.com/privacy-sandbox/overview/android">Androidéšç§æ²™ç›’</a>çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¿™æ˜¯ä¸€é¡¹ä¸ºä¿æŠ¤ç”¨æˆ·éšç§è€ŒæŒç»­è¿›è¡Œçš„å·¥ä½œã€‚å¯ä»¥æŸ¥çœ‹<a href="https://developer.android.com/design-for-safety/privacy-sandbox/program-overview">ç½‘ç«™å†…å®¹</a>ä»¥äº†è§£æ›´å¤šã€‚</p>

<h2>è¡Œä¸ºå˜æ›´</h2>

<p>æ¯”èµ·æ–°çš„APIï¼ŒAndroid 16å¸¦æ¥çš„è¡Œä¸ºå˜æ›´æ›´å€¼å¾—æˆ‘ä»¬å…³æ³¨ï¼Œå› ä¸ºè¿™ä¼šç›´æ¥å½±å“æ‰€æœ‰åº”ç”¨ï¼Œæ— è®ºtargetSdkVersionæ˜¯å¦æ˜¯Baklavaã€‚</p>

<h3>æ ¸å¿ƒåŠŸèƒ½</h3>

<h4>JobScheduleré…é¢ä¼˜åŒ–</h4>

<p>ä»Android 16å¼€å§‹ï¼Œä»¥åŸºäºä»¥ä¸‹å› ç´ æ¥è°ƒæ•´å¸¸è§„ä»»åŠ¡å’ŒåŠ æ€¥ä»»åŠ¡çš„è¿è¡Œæ—¶é…é¢ï¼š</p>

<ul>
<li>åº”ç”¨å¤„äº<a href="https://developer.android.com/topic/performance/appstandby">å“ªä¸ªç­‰å¾…åŒº</a>ï¼šåœ¨Android 16ä¸­ï¼Œæ´»è·ƒçš„ç­‰å¾…åŒºä¼šå‡å°‘é™åˆ¶ã€‚</li>
<li>å¦‚æœä»»åŠ¡å¼€å§‹æ‰§è¡Œæ—¶åº”ç”¨å¤„äºå¤´éƒ¨çŠ¶æ€ï¼šåœ¨Android 16ä¸­ï¼Œä»»åŠ¡å¯åŠ¨æ—¶ï¼Œå¦‚æœåº”ç”¨æ˜¯ç”¨æˆ·å¯è§çš„ä¸”åº”ç”¨å˜æˆå¯è§åä»åœ¨ç»§ç»­æ‰§è¡Œï¼Œä¼šåŠ å…¥åˆ°è¿è¡Œæ—¶é…é¢ä¸­ã€‚</li>
<li>å¦‚æœä»»åŠ¡æ‰§è¡Œæ—¶æ­£åœ¨è¿è¡Œä¸€ä¸ªå‰å°æœåŠ¡ï¼šåœ¨Android 16ä¸­ï¼Œå½“æ­£åœ¨æ‰§è¡Œä¸€ä¸ªå‰å°æœåŠ¡æ—¶ï¼Œæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å°†åŠ å…¥åˆ°è¿è¡Œæ—¶é…é¢ä¸­ã€‚å¦‚æœä»»åŠ¡æ˜¯ç”¨äºç”¨æˆ·æ•°æ®ä¼ é€ï¼Œå»ºè®®<a href="https://developer.android.com/develop/background-work/background-tasks/uidt">è€ƒè™‘æ›¿æ¢æ–¹æ¡ˆ</a>ã€‚</li>
</ul>


<p>è¿™äº›å˜åŠ¨å°†ä¼šå½±å“ç”±WorkManagerï¼ŒJobSchedulerå’ŒDownloadManagerè°ƒåº¦çš„ä»»åŠ¡ã€‚å¦‚æœè¦è°ƒè¯•ä¸ºä½•ä¸€ä¸ªä»»åŠ¡è¢«ç»ˆæ­¢äº†ï¼Œå»ºè®®é€šè¿‡è°ƒç”¨<a href="https://developer.android.com/reference/androidx/work/WorkInfo#getStopReason(">WorkInfo.getStopReason()</a>)æ¥æ‰“å°æ—¥å¿—ã€‚</p>

<p>ä¹Ÿå¯ä»¥é€šè¿‡Android 16æ–°å¢åŠ çš„API <a href="https://developer.android.com/partners/android-16/features#feature-pending-job-reason-history">JobScheduler#getPendingJobReasonsHistory</a>æ¥äº†è§£ä¸ºä½•ä»»åŠ¡æœªæ‰§è¡Œã€‚</p>

<p>å¦å¤–ï¼Œåœ¨Android 16ä¸Šè¿˜å¯ä»¥é€šè¿‡adbå‘½ä»¤å¼ºåˆ¶è°ƒæ•´è¿è¡Œæ—¶ä»»åŠ¡é…é¢ï¼Œä»¥æ–¹ä¾¿æµ‹è¯•ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='Bash'><span class='line'><span class="c"># å–æ¶ˆå¤´éƒ¨çŠ¶æ€é…é¢é™åˆ¶</span>
</span><span class='line'>adb shell am compat <span class="nb">enable </span>OVERRIDE_QUOTA_ENFORCEMENT_TO_TOP_STARTED_JOBS &lt;APP_PACKAGE_NAME&gt;
</span><span class='line'>
</span><span class='line'><span class="c"># è®¾ç½®ç­‰å¾…åŒº</span>
</span><span class='line'>adb shell am <span class="nb">set</span>-standby-bucket &lt;APP_PACKAGE_NAME&gt; active<span class="p">|</span>working_set<span class="p">|</span>frequent<span class="p">|</span>rare<span class="p">|</span>restricted
</span><span class='line'>
</span><span class='line'><span class="c"># è·å–æ‰€å¤„çš„ç­‰å¾…åŒºçŠ¶æ€</span>
</span><span class='line'>adb shell am get-standby-bucket &lt;APP_PACKAGE_NAME&gt;
</span></code></pre></td></tr></table></div></figure>


<h3>ç”¨æˆ·ä½“éªŒå’Œç³»ç»ŸUI</h3>

<p>Android 16åºŸå¼ƒäº†æ— éšœç¢å…¬å‘Š(announcement)ï¼Œä¸€ç§ä½¿ç”¨<a href="https://developer.android.com/reference/android/view/View#announceForAccessibility(java.lang.CharSequence">announceForAccessibility</a>)æˆ–è€…æ´¾å‘<a href="https://developer.android.com/reference/android/view/accessibility/AccessibilityEvent#TYPE_ANNOUNCEMENT">TYPE_ANNOUNCEMENT</a>å¼•èµ·çš„æ— éšœç¢äº‹ä»¶ã€‚è¿™äº›å…¬å‘Šä¼šé€ æˆTalkbackå’Œå±å¹•å‘å£°çš„æ··ä¹±ï¼Œå®¹æ˜“è¢«æ»¥ç”¨ï¼Œä¸€äº›å¯è¡Œçš„æ›¿æ¢æ–¹æ¡ˆæœ‰ï¼š</p>

<ul>
<li>å¯¹äºåƒçª—å£å˜åŒ–ä¹‹ç±»çš„æé‡è¦çš„UIå˜åŒ–ï¼Œå¯ä»¥ç”¨<a href="https://developer.android.com/reference/android/app/Activity#setTitle(java.lang.CharSequence">Activity.setTitle(CharSequence)</a>)å’Œ<a href="https://developer.android.com/reference/android/view/View#setAccessibilityPaneTitle(java.lang.CharSequence">setAccessibilityPaneTitle(java.lang.CharSequence)</a>)ã€‚åœ¨Composeä¸­ä½¿ç”¨<a href="https://developer.android.com/reference/kotlin/androidx/compose/ui/semantics/package-summary#(androidx.compose.ui.semantics.SemanticsPropertyReceiver">Modifier.semantics { paneTitle = &ldquo;paneTitle&rdquo; }</a>.liveRegion)ã€‚</li>
<li>å‘ŠçŸ¥ç”¨æˆ·é‡è¦UIå˜åŒ–ï¼Œä½¿ç”¨<a href="https://developer.android.com/reference/android/view/View#setAccessibilityLiveRegion(int">setAccessibilityLiveRegion(int)</a>)ã€‚åœ¨Composeä¸­ï¼Œç”¨<a href="https://developer.android.com/reference/kotlin/androidx/compose/ui/semantics/package-summary#(androidx.compose.ui.semantics.SemanticsPropertyReceiver">Modifier.semantics { liveRegion = LiveRegionMode.[Polite|Assertive]}</a>.liveRegion)ã€‚è¿™äº›ä¹Ÿè¦å°å¿ƒä½¿ç”¨ï¼Œå› ä¸ºæ¯å½“Viewåˆ·æ–°å°±ä¼šè§¦å‘ä¸€ä¸ªæ— éšœç¢äº‹ä»¶ã€‚</li>
<li>é€šçŸ¥ç”¨æˆ·æœ‰é”™è¯¯ï¼Œå‘é€ä¸€ä¸ªç±»å‹ä¸º<a href="https://developer.android.com/reference/android/view/accessibility/AccessibilityEvent#CONTENT_CHANGE_TYPE_ERROR">AccessibilityEvent#CONTENT_CHANGE_TYPE_ERROR</a>çš„æ— éšœç¢äº‹ä»¶ï¼Œå¹¶ä¸”è®¾ç½®<a href="https://developer.android.com/reference/android/view/accessibility/AccessibilityNodeInfo#setError(java.lang.CharSequence">AccessibilityNodeInfo#setError(CharSequence)</a>)ï¼Œæˆ–è€…<a href="https://developer.android.com/reference/android/widget/TextView#setError(java.lang.CharSequence">TextView#setError(CharSequence)</a>)ã€‚</li>
</ul>


<p>å¯ä»¥<a href="https://developer.android.com/reference/android/view/View#announceForAccessibility(java.lang.CharSequence">çœ‹æ–‡æ¡£</a>)ä»¥äº†è§£åºŸå¼ƒannounceForAccessibilityçš„ç»†èŠ‚ä»¥åŠæ¨èçš„æ›¿ä»£æ–¹æ¡ˆã€‚</p>

<h2>é€‚é…å»ºè®®</h2>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬èƒ½äº†è§£åˆ°çš„Android 16çš„å˜åŒ–å°±è¿™ä¹ˆå¤šï¼Œæ€»çš„æ¥çœ‹å¢é‡å˜åŒ–å¹¶ä¸å¤šï¼Œæ–°çš„API éƒ½æ˜¯ä¸€äº›å°çš„ç»†èŠ‚ä¸Šçš„å¢å¼ºï¼›è¡Œä¸ºçš„å˜æ›´ä¹Ÿå¾ˆå°‘å¾ˆå°‘ï¼Œåªæ¶‰åŠåå°ä»»åŠ¡å’Œæ— éšœç¢ã€‚æ–°çš„APIä¸ä¼šå½±å“ç°æœ‰çš„åº”ç”¨ï¼Œè¡Œä¸ºå˜æ›´ä¹Ÿä¸å¤šï¼Œå¯ä»¥è¯´å¯¹äºç»å¤§å¤šæ•°åº”ç”¨æ¥è¯´å½±å“ç”šå¾®ã€‚</p>

<p>ç°åœ¨ä»æ˜¯å¼€å‘è€…Previewé˜¶æ®µï¼Œåªæœ‰äº²å„¿å­Pixelç³»åˆ—ä¼šæ”¶åˆ°OTAç‰ˆæœ¬ï¼Œæˆ‘ä»¬äº†è§£ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚å³ä½¿æ˜¯åº”ç”¨å¯èƒ½ä¼šå—åˆ°è¡Œä¸ºå˜æ›´çš„å½±å“ï¼Œä¹Ÿä¸ç”¨ç€æ€¥ï¼Œå»ºè®®å†ç­‰2ï½3ä¸ªæœˆï¼Œç­‰åˆ°æœ‰æ›´å¤šçš„å‚å•†å‘å‡ºBetaç‰ˆæœ¬äº†ï¼Œå¹¶ä¸”APIä¹Ÿç¨³å®šäº†æ—¶å†åšé€‚é…ä¹Ÿä¸è¿Ÿã€‚</p>

<h2>References</h2>

<ul>
<li><a href="https://developer.android.com/about/versions/16/features">Features and APIs</a></li>
<li><a href="https://android-developers.googleblog.com/2024/11/the-first-developer-preview-android16.html">The First Developer Preview of Android 16</a></li>
<li><a href="https://android-developers.googleblog.com/2024/12/second-developer-preview-android16.html">The Second Developer Preview of Android 16</a></li>
<li><a href="https://developer.android.com/about/versions/16/behavior-changes-16">Behavior changes: Apps targeting Android 16 or higher</a></li>
<li><a href="https://developer.android.com/about/versions/16/behavior-changes-all">Behavior changes: all apps</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç¾¤æ˜Ÿé—ªè€€çš„å¤§å‰ç«¯å¼€å‘]]></title>
    <link href="https://alexhilton.github.io/blog/2024/12/10/a-brief-history-of-cross-platform-development/"/>
    <updated>2024-12-10T22:01:05+08:00</updated>
    <id>https://alexhilton.github.io/blog/2024/12/10/a-brief-history-of-cross-platform-development</id>
    <content type="html"><![CDATA[<p>ä¹”å¸®ä¸»å‘å¸ƒiPhoneä»¥é™ï¼ŒæŠŠä¸–ç•Œæ¨å‘äº†æ™ºèƒ½æ‰‹æœºæ—¶ä»£ï¼Œéšä¹‹è€Œæ¥çš„æ˜¯ç§»åŠ¨äº’è”ç½‘å¤§æ½®ï¼Œä¸€æ—¶é—´ç§»åŠ¨åº”ç”¨å¼€å‘å˜å¾—ç‚™æ‰‹å¯çƒ­èµ·æ¥ï¼Œæ¸æ¸çš„è¶…è¶Šäº†ä¼ ç»Ÿæ¡Œé¢ç«¯å’Œä¼ ç»Ÿå‰ç«¯ï¼Œæˆä¸ºäº†ä¸»æµã€‚éšä¹‹è€Œæ¥çš„å°±æ˜¯é‡å¤å¼€å‘çš„é—®é¢˜ï¼ŒåŒæ ·çš„ä¸šåŠ¡éœ€è¦åœ¨Androidä¸Šé¢å®ç°ä¸€æ¬¡ï¼Œåœ¨iOSä¸Šé¢å®ç°ä¸€æ¬¡ï¼Œé€šå¸¸ä¹Ÿéœ€è¦åœ¨Mobile Webï¼ˆç§»åŠ¨ç«¯H5ï¼‰å®ç°ä¸€æ¬¡ï¼Œè‡ªæ­¤è·¨ç«¯å¼€å‘æˆäº†ç§»åŠ¨äº’è”æ—¶ä»£ä¸€ä¸ªå¿…é¡»è¦æ”»å…‹çš„éš¾é¢˜ã€‚</p>

<p><a href="https://alexhilton.github.io/blog/2024/12/10/a-brief-history-of-cross-platform-development/"><img src="https://www.ropstam.com/wp-content/uploads/2023/09/Best-Cross-Platform-App-Development-Frameworks.jpg" title="auto auto" ></a></p>

<!-- more -->


<h2>å¤§å‰ç«¯å¼€å‘ç®€å²</h2>

<p>å·¥ç¨‹å¸ˆçš„ä½¿å‘½æ˜¯<strong>æŠŠä¸å¯èƒ½å˜å¯èƒ½ï¼ŒæŠŠå¯èƒ½å˜ç®€å•ï¼ŒæŠŠç®€å•å˜ä¼˜é›…</strong>ã€‚å¦‚æœèƒ½ç”¨åŒä¸€å¥—ä»£ç åœ¨ä¸åŒçš„ç«¯ä¾§éƒ½è¿è¡Œï¼Œé‚£å°†æ˜¯å†ç¾å¥½ä¸è¿‡çš„äº†ï¼Œæ¯•ç«Ÿå¯¹äºç«¯ä¾§ä¸šåŠ¡é€»è¾‘ä¸€æ ·çš„ï¼Œä½†å´è¦ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼Œä¸åŒçš„æ¡†æ¶ï¼Œä¸åŒçš„å¹³å°ï¼Œä¸åŒçš„å›¢é˜Ÿå„å¼€å‘ä¸€æ¬¡ã€‚å¦‚æœèƒ½å¤Ÿåšåˆ°ã€Œå¼€å‘ä¸€æ¬¡ï¼Œå¤šç«¯è¿è¡Œã€ï¼Œå°†æå¤§çš„èŠ‚çœäººåŠ›ç‰©åŠ›å’Œè´¢åŠ›ï¼Œå¼€å‘æ•ˆç‡ä¹Ÿå°†å¤§å¤§æå‡ã€‚é‚ä¸šç•Œä¸€ç›´åœ¨æ¢ç´¢å¦‚ä½•è·¨ç§»åŠ¨ç«¯å¼€å‘ï¼Œä¹Ÿå³åªç”¨ä¸€å¥—ä»£ç ï¼Œå¼€å‘ä¸€æ¬¡ï¼Œå°±å¯ä»¥åœ¨Androidç«¯ï¼ŒiOSç«¯å’Œç§»åŠ¨Webç«¯ä¸‰ç«¯è¿è¡Œã€‚</p>

<h3>å²å‰æ—¶ä»£ï¼šHybrid app</h3>

<p>æœ€å…ˆå‡ºæ¥çš„æ¡†æ¶æ˜¯Hybrid appï¼ˆ<a href="https://phonegap.com/">PhoneGap</a>å’Œ<a href="https://cordova.apache.org/docs/en/latest/">Cordova</a>ï¼‰ï¼Œåˆ©ç”¨Androidç«¯å’ŒiOSç«¯éƒ½å¯¹WebViewæœ‰è¾ƒå¥½çš„æ”¯æŒï¼Œå› æ­¤ç”¨ç§»åŠ¨å‰ç«¯ï¼ˆä¹Ÿå³ç½‘é¡µï¼‰çš„æ–¹å¼æ¥å¼€å‘åº”ç”¨ï¼Œç»å¤§å¤šæ•°çš„ä¸šåŠ¡é€»è¾‘éƒ½åœ¨ç½‘é¡µé‡Œï¼ŒAndroidç«¯å’ŒiOSç«¯éƒ½æ˜¯ç”¨WebViewå»å±•ç¤ºç½‘é¡µï¼Œå¯¹äºJavaScriptåœ¨ç½‘é¡µä¸­æ— æ³•å®ç°çš„ï¼Œä¸å¹³å°å¼ºç›¸å…³çš„äº‹æƒ…å¯ä»¥é€šè¿‡JavaScript Bridgeæ¥è°ƒç”¨å¹³å°å®ç°çš„APIï¼Œç§°ä¹‹ä¸ºJsBridgeã€‚</p>

<p>è¿™ç§æ¶æ„éå¸¸ç®€å•ï¼Œå¯¹äºAndroidå’ŒiOSæ¥è¯´ï¼Œä½¿ç”¨ä¸€ä¸ªWebViewï¼Œå†å®ç°ä¸€äº›native APIå°±å¯ä»¥äº†ï¼Œå…¶ä½™çš„éƒ½æ˜¯æ ‡å‡†çš„ç§»åŠ¨å‰ç«¯ã€‚å¾—ç›Šäºå¹³å°å¯¹HTML 5çš„æ”¯æŒï¼Œä»¥åŠåƒjQuery Mobileç­‰ä¼˜ç§€çš„å‰ç«¯åº“çš„åŠ æŒï¼Œæ— è®ºæ˜¯å¼€å‘ä½“éªŒè¿˜æ˜¯ä½¿ç”¨ä½“éªŒï¼ŒHybrid appå¹¶ä¸å·®ã€‚æœ€é‡çš„æ˜¯å®ƒè·¨å¹³å°æ€§ç‰¹åˆ«å¥½ï¼Œæ€§ä»·æ¯”è¶…é«˜ï¼Œå¯¹äºUIéƒ¨åˆ†å¾ˆé‡ï¼Œäº¤äº’ ä¹Ÿä¸å¤æ‚çš„ä»¥å±•ç¤ºä¸ºä¸»çš„é¡µé¢æ¥è¯´ï¼Œè¿™æ˜¯æ€§ä»·æ¯”è¶…é«˜çš„å®ç°æ–¹å¼ã€‚</p>

<p>è¿™ä¸ªå¯ä»¥ç§°ä¹‹ä¸ºå²å‰æ—¶ä»£ã€‚</p>

<h3>é»‘æš—æ—¶ä»£ï¼šä¸æˆç†Ÿçš„å„ç§å°è¯•</h3>

<p>Hybrid appæ–¹å¼è™½ç„¶å¯è¡Œï¼Œä½†åœ¨ä¸åŒçš„ç»ˆç«¯ä¸Šé¢ä½“éªŒå·®è·å¾ˆæ˜æ˜¾ã€‚å¯¹äºæ€§èƒ½è¾ƒå¥½çš„ä¸­é«˜ç«¯è®¾å¤‡ï¼Œå› ä¸ºè®¾å¤‡æ•´ä½“æ€§èƒ½è¾ƒå¥½ï¼ŒHybrid appä½“éªŒå°šå¯ï¼Œè™½ç„¶ä¸åŸç”ŸUIç›¸æ¯”ä»æœ‰å·®è·ï¼Œä½†å±äºå¯æ¥å—èŒƒå›´ã€‚ä½†å¯¹äºä¸­ä½ç«¯è®¾å¤‡æ¥è¯´ï¼ŒWebViewä¸ä½†æ€§èƒ½å·®ï¼Œè€Œä¸”å…¼å®¹æ€§ä¸å¥½ï¼Œä½“éªŒä¸¥é‡å·®äºåŸç”ŸUIã€‚å¦å¤–ï¼Œå¦‚æœUIäº¤äº’å˜å¾—å¤æ‚ï¼Œæˆ–è€…å¯¹ä½“éªŒå’Œå®æ—¶æ€§æ“ä½œè¦æ±‚æ¯”è¾ƒé«˜ï¼ˆå¦‚æ–‡æ¡£ç¼–è¾‘ç±»ç­‰ï¼‰Hybridæ–¹å¼ä¸åŸç”Ÿæ›´æ˜¯ç›¸è·ç”šè¿œã€‚å·¥ç¨‹å¸ˆä»¬å¼€å§‹å°è¯•æ–°çš„æ–¹æ¡ˆã€‚</p>

<p>æ¯”å¦‚åŠé—´æœ‰ç”¨jsonæ ¼å¼æ¥å®šä¹‰UIï¼Œå®šä¹‰å¥½æ ¼å¼åï¼Œæ¯ä¸ªç«¯æ‹¿åˆ°ä¸€å¨jsonæ•°æ®è§£æï¼Œç„¶åç”ŸæˆUIã€‚è¿™å…¶å®éƒ½ç®—ä¸ä¸Šæ˜¯æ¡†æ¶ï¼Œå…¶å®å°±æ˜¯ç”¨jsonæ¥æè¿°ä¸€ä¸ªé¡µé¢ï¼Œè§£æä¸æ„å»ºUIä»æ˜¯ç”±æ¯ä¸ªç«¯è‡ªå·±æï¼Œé¡¶å¤šç®—æ˜¯ä¸€ç§UIæè¿°æ ¼å¼ã€‚ä½†éš¾ä»¥é€šç”¨ï¼Œå¹¶ä¸”åªèƒ½æè¿°UIçš„é™æ€ç»“æ„ï¼Œæ— æ³•æœ‰åŠ¨æ€çš„è¡Œä¸ºä¹‹ç±»çš„ã€‚è¿™ç§æ–¹æ¡ˆä¹Ÿæ›¾æœ‰ä¸å°‘å¤§å‚ç”¨è¿‡ï¼Œå®ƒéå¸¸é€‚ç”¨äºå±€éƒ¨çš„ï¼Œå¹¶ä¸å¤æ‚çš„UIï¼Œä¸šåŠ¡é€»è¾‘å›ºå®šï¼Œä½†UIæ’ç‰ˆæ ·å¼å¯èƒ½éšæ—¶ä¼šå˜é¡µé¢ã€‚ä½†è¦è¯´ç”¨å®ƒæ¥å†™æ•´ä¸ªåº”ç”¨ï¼Œæ˜¯ä¸ç°å®çš„ã€‚</p>

<p>è¿™æœŸé—´Googleä¹Ÿåšäº†å°è¯•ï¼Œæå‡ºä¸€ä¸ªå«åš<a href="https://developers.google.com/j2objc">j2objcçš„å·¥å…·</a>ï¼Œå®ƒèƒ½æŠŠJavaä»£ç ç¿»è¯‘ æˆä¸ºObjective&#45;Cä»£ç ï¼Œè½¬æ¢åçš„Objective-Cä»£ç æ— éœ€ä¿®æ”¹å¯ä»¥ç›´æ¥ç¼–è¯‘è¿è¡Œã€‚æ˜¾ç„¶ï¼Œè¿™ä¸ªå·¥å…·å¹¶ä¸é€‚ç”¨äºUIï¼Œå› ä¸ºUIéƒ½æ˜¯ä¸å¹³å°å¼ºç›¸å…³çš„ï¼Œéœ€è¦å¤§é‡çš„ä¾èµ–äºå¹³å°çš„SDKï¼Œå¹¶ä¸æ˜¯æŠŠä»£ç ã€Œç¿»è¯‘ã€è¿‡æ¥å°±å®Œäº‹äº†ã€‚è¿™ä¸ªå·¥å…·é€‚ç”¨äºéUIéƒ¨åˆ†çš„ä¸šåŠ¡é€»è¾‘ä»£ç ï¼Œæ•ˆæœä¹Ÿéå¸¸çš„å¥½ï¼Œç»å…¶è½¬æ¢åçš„ä»£ç å¯ä»¥ç›´æ¥ç¼–è¯‘è¿è¡Œã€‚æ®è¯´Googleè‡ªå·±ä¹Ÿåœ¨ç”¨ï¼Œå½“æ—¶çš„GMSäº§å“Google Inboxç­‰éƒ½ç”¨j2objcè¾¾åˆ°äº†70%ä»£ç å…±ç”¨ã€‚</p>

<p>è¿™æ˜¯å¤§å‰ç«¯çš„ä¸€ä¸ªé»‘æš—æ—¶ä»£ï¼Œè™½ç„¶å¤§å®¶éƒ½åœ¨å°è¯•ï¼Œä½†å§‹ç»ˆæ²¡æœ‰ä¸€ä¸ªæ¯”è¾ƒç†æƒ³çš„å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚</p>

<h3>é»æ˜çš„ç½²å…‰ï¼šåˆ’æ—¶ä»£çš„ReactNative</h3>

<p>Hybridæ–¹å¼æœ€å¤§çš„é—®é¢˜åœ¨äºWebViewæ˜¯æ€§èƒ½å’Œä½“éªŒçš„ç“¶é¢ˆï¼ŒWebViewä¹‹æ‰€ä»¥æ˜¯ç“¶é¢ˆ åœ¨äºå®ƒæ˜¯ä¸€ä¸ªå®Œå…¨çš„æµè§ˆå™¨ï¼Œå®ƒè¦å®Œå…¨æ”¯æŒJavaScriptï¼ŒHTMLå’ŒCSSã€‚ä½†éšç€HTML5å’ŒWebå‰ç«¯æŠ€æœ¯çš„å‘å±•ï¼Œæœ‰å¾ˆå¤šåº“å¯èƒ½åªç”¨JavaScriptæ¥å®ç°ã€‚JavaScriptç‹¬ç«‹å‡ºæ¥ä¸Node.jsç»“åˆï¼ˆä¸¥è°¨çš„è¯´æ˜¯JSå¼•æŒšï¼‰ï¼ŒåŒæ ·å¯ä»¥åšå‰ç«¯ï¼Œä½†å´å°‘äº†HTMLå’ŒCSSçš„æ‹–ç´¯ï¼Œæ²¿ç€è¿™ä¸ªæ€è·¯éæ­»ä¸å¯ï¼ˆå½¼æ—¶å«åšFacebookï¼Œç°åœ¨å«åšMetaï¼‰æ¨å‡ºäº†ä¸€ä¸ªè·¨ç§»åŠ¨ç«¯å¹³å°çš„å¼€å‘æ¡†æ¶ReactNativeã€‚å®ƒæ˜¯åŸºäºFacebookçš„Reactæ¡†æ¶ï¼Œåšäº†é¢å‘ç§»åŠ¨ç«¯çš„å»¶ä¼¸ã€‚å®ƒçš„ä¸»è¦å®ç°æ–¹æ³•æ˜¯ç”¨Reactæ¥å†™é¡µé¢ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºJavaScriptè¯­è¨€çš„å£°æ˜å¼UIæ¡†æ¶ï¼ŒåŠ å…¥äº†ä¸€ä¸ªè™šæ‹ŸDOMå±‚ï¼Œç”¨ä»¥å±è”½é¢‘ç¹çš„DOMæ”¹åŠ¨ï¼Œç„¶åå†æŠŠè™šæ‹ŸDOMè½¬æˆä¸€ä¸ªæ¸²æŸ“æ ‘ï¼Œæœ€åç”±Nodeå¼€å‡ºå£å­ï¼ŒæŠŠæ¸²æŸ“æ ‘ç”¨Nativeçš„APIå»å®ç°ï¼Œç”±æ­¤å®ç°äº†åŸç”ŸUIã€‚</p>

<p>ReactNativeå¯ä»¥å®ç°è·¨ä¸‰ç«¯ï¼Œé¡µé¢ç”¨Reactå†™å¥½åï¼Œä¸ç”¨ä¿®æ”¹å°±å¯ä»¥åœ¨Webï¼ŒAndroidå’ŒiOSä¸Šè¿è¡Œã€‚ä¸€ç»å‘å¸ƒå¼•å‘äº†å·¨å¤§åå“ï¼ŒåŠé—´ä¼—äººçš†æ‹å¤§è…¿ã€Œå§è‰ï¼Œè¿˜å¯ä»¥è¿™æ ·ç©å„¿å•Šï¼ã€ã€‚</p>

<p>ReactNativeæ˜¯åˆ’æ—¶ä»£çš„ï¼Œå› ä¸ºå®ƒç¡®å®šäº†è·¨ç«¯æ¡†æ¶çš„åŸºæœ¬ç»“æ„ï¼šå£°æ˜å¼UIï¼Œè™šæ‹ŸDOMå’Œæ¸²æŸ“æ ‘ï¼Œç”¨åŸç”ŸAPIå»å®ç°æ¸²æŸ“æ ‘ï¼ˆæ˜ å°„ä¸ºNativeçš„ç»„ä»¶ï¼Œæˆ–è€…ç”¨Native graphics APIå»å®ç°æ¸²æŸ“æ ‘ï¼‰ã€‚åç»­çš„è·¨ç«¯æ¡†æ¶åŸºæœ¬ä¸Šéƒ½æ˜¯è¿™ä¸ªè·¯å­ã€‚</p>

<h3>ç¾¤æ˜Ÿé—ªè€€çš„å½“ä¸‹</h3>

<p>æ—¶å…‰èè‹’ï¼Œç§»åŠ¨äº’è”å¤§æ½®å·²ç»è¿‡äº†åå‡ å¹´ï¼ŒæŠ€æœ¯ä¹Ÿå±‚å‡ºä¸ç©·ï¼Œæ–°çš„æ¡†æ¶åœ¨ä¸æ–­çš„æ¶Œç°ã€‚ç°å¦‚ä»Šè·¨ç«¯è¿™ä¸€é¢†åŸŸç™¾èŠ±é½æ”¾ï¼Œç¾¤æ˜Ÿé—ªè€€ï¼Œå„å¤§æ¡†æ¶ç»è¿‡å‡ å¹´çš„æ²‰æ·€ä¸å‘å±•å·²ç»æ¯”è¾ƒæˆç†Ÿã€‚é™¤äº†<a href="https://reactnative.dev/">ReactNative</a>ä»¥å¤–ï¼Œè¿˜æœ‰äº†NativeScriptï¼ŒFlutterä»¥åŠCMPã€‚è¿™å…¶ä¸­<a href="https://nativescript.org/">NativeScript</a>å…¶å®ä¸ReactNativeå·®ä¸å¤šï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºå®ƒå…è®¸ç”¨JavaScriptå®¶æ—è¯­è¨€ï¼ˆå¦‚<a href="https://www.typescriptlang.org/">TypeScript</a>å’Œ<a href="https://coffeescript.org/">CoffeeScript</a>ï¼‰ï¼Œä»¥åŠä¸é™åˆ¶å¼€å‘æ¡†æ¶ï¼Œå¯ä»¥ç”¨Vue.jsæˆ–è€…Angular.jsæ¥å†™UIã€‚</p>

<p>å½“ç„¶ï¼Œæœ€ä¸ºå¹¿æ³›æµè¡Œï¼Œä¸šç•Œä½¿ç”¨æœ€å¤šçš„å½“å±äºFlutterå’ŒReactNativeï¼ŒCMPä½œä¸ºä¸€é¢—æ–°æ˜Ÿä¹Ÿè¶Šæ¥è¶Šå—å…³æ³¨ã€‚</p>

<h2>æµè¡Œæ¡†æ¶å¯¹æ¯”</h2>

<p>è¿™é‡Œç®€è¦å¯¹æ¯”ä¸€ä¸‹æœ€ä¸ºæµè¡Œçš„ReactNativeå’ŒFlutterä»¥åŠæ–°æ˜ŸCMPï¼Œä»¥æ–¹ä¾¿ä½¿ç”¨è€…åšå‡ºæ›´å¥½çš„é€‰æ‹©ã€‚</p>

<table>
<thead>
<tr>
<th style="text-align:center;"> æ¡†æ¶ </th>
<th style="text-align:center;"> å¼€å‘è€… </th>
<th style="text-align:center;"> å¼€å‘è¯­è¨€ </th>
<th style="text-align:center;"> UIå¼€å‘åº“ </th>
<th style="text-align:center;"> æ”¯æŒçš„ç«¯ </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;"> ReactNative </td>
<td style="text-align:center;"> Meta </td>
<td style="text-align:center;"> JavaScript </td>
<td style="text-align:center;"> React </td>
<td style="text-align:center;"> Android, iOS, Web </td>
</tr>
<tr>
<td style="text-align:center;"> Flutter </td>
<td style="text-align:center;"> Google </td>
<td style="text-align:center;"> Dart </td>
<td style="text-align:center;"> </td>
<td style="text-align:center;"> Android, iOS, Desktop, Web </td>
</tr>
<tr>
<td style="text-align:center;"> CMP </td>
<td style="text-align:center;"> JetBrains </td>
<td style="text-align:center;"> Kotlin </td>
<td style="text-align:center;"> Jetpack Compose </td>
<td style="text-align:center;"> Android, iOS, Desktop, Web </td>
</tr>
</tbody>
</table>


<p>ReactNativeå’ŒFlutteréƒ½ç›¸å¯¹è¾ƒæˆç†Ÿå’Œç¨³å®šäº†ï¼Œä½¿ç”¨è€…ä¹Ÿè¾ƒå¤šï¼Œç¤¾åŒºå¾ˆæ´»è·ƒã€‚ReactNativeæ›´é€‚åˆç§»åŠ¨ç«¯ï¼Œè€ŒFlutterèƒ½è·¨çš„ç«¯å’ŒCMPè¦æ›´å¤šä¸€äº›ã€‚æ­¤å¤–ï¼ŒFlutterå’ŒCMPä¸å…¶ä»–æ¡†æ¶æœ€å¤§çš„åŒºåˆ«åœ¨äºå®ƒä½¿ç”¨Skiaåº“æ„å»ºäº†ä¸€ä¸ªæ¸²æŸ“å¼•æŒšï¼Œå¯ä»¥ç›´æ¥æŠŠæ¸²æŸ“æ ‘æ¸²æŸ“æˆä¸ºå¹³å°æ”¯æŒçš„æ›´ä¸ºåº•å±‚çš„canvasï¼Œç›´æ¥æ¥å…¥nativeå±‚çš„graphics APIè€Œä¸æ˜¯æ˜ å°„æˆnativeç»„ä»¶ï¼Œä¸ºæ­¤ï¼Œå®ƒçš„æ¸²æŸ“æ•ˆç‡æ›´ä¸ºé«˜æ•ˆä¸€äº›ï¼Œè¿›è€Œæ€§èƒ½æ›´ä¼˜ä¸€äº›ï¼Œå¯ä»¥æŠŠå®ƒä»¬æƒ³åƒæˆä¸ºä¸€ä¸ªæµè§ˆå™¨ã€‚</p>

<p>æŠ€æœ¯æ ˆä¹Ÿä¸ä¸€æ ·ï¼ŒReactNativeæ˜¯åŸºäºNodeå’ŒJavaScriptï¼Œå±äºå‰ç«¯æŠ€æœ¯æ ˆï¼Œä¸å‰ç«¯èåˆæ›´ä¸ºç´§å¯†ä¸€äº›ï¼›è€ŒCMPæ˜¯åŸºäºKotlinå’ŒJVMä¸Androidæ›´ä¸ºç´§å¯†ä¸€äº›ï¼Œå±äºJavaæ´¾ç³»ï¼›è€ŒFlutterè‡ªæˆä¸€æ´¾ã€‚</p>

<h2>é€‰æ‹©æ˜¯ç—›è‹¦çš„</h2>

<p>å®äº‹æ±‚æ˜¯çš„æ¥è¯´<a href="https://flutter.dev/">Flutter</a>æ˜¯å½“å‰æœ€ä¸ºæˆç†Ÿ ä¹Ÿæœ€ä¸ºå®Œå¤‡çš„ä¸€ä¸ªè·¨ç«¯æ¡†æ¶ï¼Œåªä¸è¿‡å¯èƒ½å­¦ä¹ æˆæœ¬ç•¥å¤§ï¼Œå¯¹äºå¤§éƒ¨åˆ†åŒå­¦æ¥è¯´Dartæ˜¯ä¸€é—¨å°ä¼—çš„ç¼–ç¨‹è¯­è¨€ã€‚è€ŒReactNativeæœ€å¤§çš„é—®é¢˜å°±åœ¨äºReactï¼Œå®ƒå¤ªå‰ç«¯åŒ–äº†ï¼Œå¯¹äºå®¢æˆ·ç«¯åŒå­¦æ¥è¯´å†™ä¸€å¨HTMLå¼çš„æ ‡ç­¾è¿˜æ˜¯ç›¸å½“éš¾å—çš„ã€‚</p>

<p>åº”è¯¥è¯´Flutterå·²ç»éå¸¸æˆåŠŸäº†ï¼Œè¾¾åˆ°äº†å®ƒåº”è¯¥æœ‰é«˜åº¦ï¼Œå®ç°äº†å®ƒçš„ä»·å€¼ï¼Œæ¢å¥è¯è¯´å®ƒçš„å‰æ™¯ä¹Ÿä¸æ˜¯ç‰¹åˆ«æ˜æœ—äº†ï¼Œå› ä¸ºå®ƒå·²ç»å¾ˆæˆç†Ÿäº†ï¼Œæ‰€ä»¥æœ‰ä¼ è¨€è°·æ­Œå†…éƒ¨ä¹Ÿåœ¨è£æ’¤Flutterçš„ç ”å‘èµ„æºã€‚ReactNativeä¹Ÿä¸€æ ·ï¼Œè¿™ä¹ˆå¤šå¹´äº†ï¼Œç‰ˆæœ¬è¿˜æ²¡æœ‰åˆ°1.0ã€‚</p>

<p><img src="https://blog.droidchef.dev/content/images/size/w1000/2022/11/Flutter-vs-Jetpack-Compose-Header--2-.png" alt="å›¾1. Flutter vs CMP" /></p>

<p>è€ŒCMPåˆšåˆšå…´èµ·ï¼Œä½¿ç”¨èµ·æ¥éå¸¸çš„æ–¹ä¾¿å’Œç®€å•ï¼Œå®ƒçš„å®‰è£…ä¸é…ç½®æ˜¯æ‰€æœ‰æ¡†æ¶ä¹‹ä¸­æœ€ä¸ºç®€ä¾¿çš„ï¼ˆåªéœ€è¦å®‰è£…ä¸€ä¸ªAndroid Studioçš„æ’ä»¶ï¼Œå…¶ä½™çš„éƒ½æ˜¯ç¼–è¯‘æ’ä»¶å’Œä¾èµ–ï¼Œå¹¶ä¸åƒFlutterå’ŒReactNativeéƒ½éœ€è¦åœ¨å¼€å‘æœºå™¨ä¸Šå®‰è£…å…¶ä»–ä¸œè¥¿ï¼‰ï¼Œå‰é€”æ— é‡ï¼Œéå¸¸å€¼å¾—æŠ•å…¥ã€‚å¹¶ä¸”Flutterå¯¹äºè°·æ­Œæ¥è¯´ä¹ç‰›ä¸€æ¯›ï¼Œæ˜¯éå¸¸ä¸èµ·çœ¼çš„ä¸œè¥¿ï¼Œè°·æ­Œæ¯•ç«Ÿå®¶å¤§ä¸šå¤§ï¼Œåƒè°·æ­Œå’ŒMetaç­‰å·¨å¤´ç°åœ¨éƒ½åœ¨ç‹‚å·AIï¼Œå…¶ä»–çš„å°ä¸šåŠ¡éƒ½ä¸å—é‡è§†ã€‚</p>

<p>ä½†CMPä¸ä¸€æ ·ï¼ŒJetBrainsæœ¬èº«å°±æ˜¯ä¸“é—¨æå¼€å‘å·¥å…·çš„ï¼Œè¿™æ˜¯ä»–ä»¬çš„ä¸»ä¸šè‚¯å®š ä¼šå¥½å¥½æï¼ŒæŠŠCMPä¸å…¶IDEæ·±åº¦ç»“åˆï¼Œå¯¹äºå¼€å‘è€…ä½¿ç”¨èµ·æ¥é‚£å°±ç›¸å½“çš„æ–¹ä¾¿äº†ã€‚äº‹å®ä¸ŠJetBrainså·²ç»å¼€å§‹å¼„äº†ï¼Œå®ƒçš„æœ€æ–°çš„<a href="https://www.jetbrains.com/fleet/">IDE Fleet</a>ï¼ˆä¸€ä¸ªé€šç”¨çš„IDEï¼‰å°†ä¼šæ·±åº¦ç»‘å®šCMPï¼Œéå¸¸å€¼å¾—æœŸå¾…ã€‚</p>

<p>ç»¼åˆè€ƒè™‘ï¼Œç»™å‡ºçš„å»ºè®®å°±æ˜¯å¦‚æœæ˜¯<strong>ä¸€ä¸ªçº¯æ–°çš„é¡¹ç›®ï¼Œç‰¹åˆ«æ˜¯MVPé˜¶æ®µï¼Œä¸è¦çŠ¹è±«å°±æ˜¯ç”¨Flutter</strong>ã€‚è€Œå¦‚æœæ˜¯<strong>ç°æœ‰é¡¹ç›®ï¼Œæƒ³è¦è·¨ç«¯ï¼Œå°±é€‰æ‹©CMP</strong>ï¼Œå®ƒæ˜¯å¯¹ç°æœ‰é¡¹ç›®æœ€ä¸ºå‹å¥½çš„ä¸€ä¸ªã€‚é™¤éä½ æ˜¯èµ„æºå‰ç«¯ä¸”æ˜¯Reactç²‰ï¼Œå¦åˆ™ä¸è¦è€ƒè™‘ReactNativeã€‚</p>

<h2>æ¡†æ¶åªèƒ½è§£å†³ä¸€éƒ¨åˆ†é—®é¢˜</h2>

<p>æœ€åæƒ³è¯´çš„æ˜¯ï¼Œå¯¹äºè·¨ç«¯å¼€å‘ï¼Œæ¡†æ¶åªèƒ½è§£å†³ä¸€å°éƒ¨åˆ†é—®é¢˜ã€‚</p>

<p>è·¨ç«¯å¼€å‘æœ€éš¾çš„åœ°æ–¹åœ¨äºåˆç†çš„æ¶æ„å’Œå›¢é˜Ÿçš„ååŒã€‚æ¶æ„éœ€è¦åšå¥½å±‚ä¸å±‚çš„éš”ç¦»ï¼Œç‰¹åˆ«æ˜¯æŠŠä¸å¹³å°å¼ºç›¸å…³çš„APIåšå¥½éš”ç¦»å±‚ï¼Œä»¥æœ€å¤§é™åº¦ çš„å…±ç”¨ä»£ç ï¼Œå¦‚æœåˆ°å¤„éƒ½æ˜¯ç²—ç²’åº¦çš„å¹³å°ç›¸å…³çš„å®ç°ï¼Œå¤æ‚åº¦å°†æ€¥å‰§ä¸Šå‡ï¼Œé‚£æœ€åä¼šå˜æˆå¤šç«¯çš„æ‹¼ç›˜è€Œéä¸€ä¸ªè·¨ç«¯é¡¹ç›®ã€‚äººå‘˜çš„åä½œåº”è¯¥ä»¥åŠŸèƒ½ä¸ºå•ä½æ¥åˆ’åˆ†è€Œä¸èƒ½å†ä»¥ç«¯çš„ç»´åº¦ï¼Œè¦å½»åº•æ¶ˆç­ç«¯çš„æ€ç»´ï¼Œè¦ä»¥UIï¼ŒåŠŸèƒ½å’Œä¸šåŠ¡é€»è¾‘è§’åº¦æ¥æ€è€ƒé—®é¢˜ï¼Œè¿™æ ·æ‰èƒ½æ›´å¥½çš„åä½œã€‚æ€»ä¹‹è·¨ç«¯å¯¹å›¢é˜Ÿçš„è¦æ±‚æ›´é«˜ï¼Œå¦åˆ™åªä¼šåˆ¶é€ æ›´å¤šçš„é—®é¢˜ã€‚</p>

<p>äººçš„é—®é¢˜æ°¸è¿œè¦æ¯”æŠ€æœ¯é—®é¢˜è¦å¤æ‚ä¸€äº›ï¼Œä¸¾ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œä»¥å¾€æ¯ä¸ªç«¯å„è‡ªä¸ºæ”¿ï¼ŒAndroidç«¯æŸä¸ªåŒå­¦çŠ¯äº†é”™ï¼Œé¡¶å¤šå°±æ˜¯Androidç«¯ä¸èƒ½ç”¨äº†ï¼Œå¯èƒ½æœ€å¤šå°±3.25ã€‚çœŸè·¨ç«¯äº†ä»¥åï¼Œå†çŠ¯é”™é‚£å¯å°±æ˜¯æ‰€æœ‰ç«¯éƒ½ææŒ‚äº†ï¼Œå¯èƒ½æœ€å°‘æ˜¯3.25èµ·æ­¥ï¼Œè¿™é‡Œå¤´çš„å·®åˆ«è¿˜æ˜¯ç›¸å½“å¤§çš„ï¼Œå¦‚æœæ²¡æœ‰å¼ºæœ‰åŠ›çš„å¤§ä¸€ç‚¹çš„è€æ¿æ¥æ¨ï¼Œæ˜¯å¾ˆéš¾æ¨å¾—åŠ¨çš„ã€‚</p>

<p>ç ”å‘åŒå­¦éƒ½å–œæ¬¢æŠ˜è…¾ï¼Œå…‰å®Œæˆä¸šåŠ¡æ˜¯å¾ˆæ— èŠçš„ï¼Œä¹Ÿä¸å¯èƒ½å‡ºæˆç»©ï¼Œéƒ½æƒ³æ–¹è®¾æ³•çš„æå‡ºç‚¹ã€ŒæŠ€æœ¯äº§å‡ºã€ï¼ˆä¿—ç§°é€ è½®å­ï¼‰ã€‚è®°å¾—ReactNativeåˆšå‡ºæ¥æ—¶ï¼ŒåŠé—´å¾ˆçƒ­æƒ…éƒ½åœ¨æŠŠå…¶å¼•å…¥åˆ°å„è‡ªçš„ä¸šåŠ¡ä¸­å»ï¼Œä½†æœ€ç»ˆçš„ç»“æœæ˜¯ï¼Œæ²¡æœ‰äººä¼šçœŸçš„åœ¨ä¸šåŠ¡ä¸­é‡ç‚¹ä½¿ç”¨ï¼Œè€Œæ˜¯éƒ½èŠ±å¿ƒæ€æå‡ºäº†ä¸€å¥—å±äºè‡ªå·±çš„è·¨ç«¯æ¡†æ¶ï¼Œå¹¶ä¸”å‘å…¶ä»–å›¢é˜Ÿæ¨å¹¿ã€‚å¹´ç»ˆæ±‡æŠ¥æ—¶ï¼ŒPPTå¾ˆæ¼‚äº®ï¼šã€Œè€æ¿æ‚¨çœ‹ï¼Œæˆ‘ä»¬ä¸å…‰å®Œæˆäº†ä¸šåŠ¡ï¼Œè¿˜æäº†ä¸€å¥—è·¨ç«¯æ¡†æ¶ï¼Œå®ƒæ¯”ReactNativeå¥½åœ¨å“ªé‡Œï¼Œå·²ç»åœ¨æˆ‘ä»¬çš„ä¸šåŠ¡ä½¿ç”¨äº†ï¼Œä¹Ÿç»™å…¶ä»–å›¢é˜Ÿæ¨å¹¿äº†ã€ã€‚ç›¸åï¼Œå‡å¦‚ä½ çœŸçš„ä½¿ç”¨äº†è·¨ç«¯ï¼Œä½ å’‹ æ±‡æŠ¥ï¼Ÿã€Œè€æ¿ï¼Œæ‚¨çœ‹ï¼Œæˆ‘ä»¬ç”¨äº†åˆ«äººçš„è·¨ç«¯æŠ€æœ¯ï¼ŒæˆåŠŸçš„å®ç°äº†è·¨ç«¯ï¼ŒåŸæ¥ä¸‰ä¸ªç«¯15ä¸ªäººèƒ½åšå®Œçš„äº‹æƒ…ï¼Œç°åœ¨åªéœ€è¦8ä¸ªäººï¼ã€ã€‚è€æ¿å¬äº†ï¼Œå¾ˆæ¿€åŠ¨ï¼Œ3.25ç»ˆäºæ‰¾åˆ°äººé€‰äº†ï¼Œå¼€çŒ¿èŠ‚æµä¹Ÿæœ‰ç€è½äº†ï¼</p>

<p>Anywayï¼Œæ€»çš„æ¥è¯´è·¨ç«¯å¼€å‘æ›´é€‚åˆä¸šåŠ¡ä¸å¤æ‚ï¼ŒUIäº¤äº’ä¹Ÿä¸é‡çš„ä¸­å°å‹Appï¼Œæˆ–è€…é‚£ç§UIå æ¯”è¾ƒå°éUIé€»è¾‘å æ¯”å¤§çš„åº”ç”¨ï¼ˆæœ€å…¸å‹çš„å°±æ˜¯æµè§ˆå™¨ï¼‰ï¼Œæ‰èƒ½å‘æŒ¥å‡ºæœ€å¤§çš„ä»·å€¼ã€‚ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„åˆ¤æ–­æ ‡å‡†å°±æ˜¯ï¼Œå¦‚æœæ¯ä¸ªç«¯çš„ç ”å‘äººå‘˜éƒ½è¶…è¿‡10ä¸ªäººï¼Œå¯èƒ½å°±ä¸å¤ªé€‚åˆç”¨è·¨å¹³å°çš„å¼€å‘æ–¹å¼ã€‚</p>

<h2>References</h2>

<ul>
<li><a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/cross-platform-frameworks.html">The Six Most Popular Cross-Platform App Development Frameworks</a></li>
<li><a href="https://developers.google.com/j2objc">What J2ObjC is</a></li>
<li><a href="https://github.com/google/j2objc">A Java to iOS Objective-C translation tool and runtime.</a></li>
<li><a href="https://hackernoon.com/getting-started-with-react-native-for-windows-and-macos">Getting started with React Native for Windows &amp; macOS</a></li>
<li><a href="https://medium.com/@ankit-detroja/react-native-or-flutter-in-2024-7cfb0605698f">React native or Flutter in 2024</a></li>
<li><a href="https://leancode.co/blog/flutter-vs-react-native">Flutter vs. React Native: A Detailed Comparison for 2024</a></li>
<li><a href="https://nateshmbhat.medium.com/flutter-vs-react-native-performance-benchmarks-you-cant-miss-%EF%B8%8F-2e31905df9b4">Flutter Vs React Native : Performance Benchmarks you canâ€™t miss ! ğŸ”¥âš¡ï¸ [Part -1]</a></li>
<li><a href="https://medium.com/newsoft-official/compose-multiplatform-vs-flutter-771673612c61">Compose Multiplatform VS. Flutter</a></li>
<li><a href="https://infinitelambda.com/flutter-kotlin-multiplatform-native-comparison/">FLUTTER VS KOTLIN MULTIPLATFORM VS NATIVE</a></li>
<li><a href="https://www.miquido.com/blog/kotlin-multiplatform-vs-flutter/">Flutter vs. Kotlin Multiplatform Mobile</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å®æˆ˜ï¼šæŠŠä¸€ä¸ªç°æœ‰çš„Composeé¡¹ç›®è½¬åŒ–ä¸ºCMPé¡¹ç›®]]></title>
    <link href="https://alexhilton.github.io/blog/2024/12/09/migrate-existing-project-to-cmp/"/>
    <updated>2024-12-09T22:09:28+08:00</updated>
    <id>https://alexhilton.github.io/blog/2024/12/09/migrate-existing-project-to-cmp</id>
    <content type="html"><![CDATA[<p>é€šè¿‡<a href="https://juejin.cn/column/7367555191338467337">å‰é¢ä¸¤ç¯‡æ–‡ç« </a>çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»å¯¹CMPæœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œæ¥ä¸‹æ¥è¦è¿›å…¥å®æˆ˜é˜¶æ®µã€‚åœ¨ç°å®çš„ä¸–ç•Œä¸­æå°æ•°é¡¹ç›®ä¼šä»0å¼€å§‹ï¼Œä»Šå¤©é‡ç‚¹ç ”ç©¶ä¸€ä¸‹å¦‚ä½•æŠŠä¸€ä¸ªç°æˆçš„ç”¨Jetpack Composeå¼€å‘çš„Androidé¡¹ç›®è½¬æˆCMPé¡¹ç›®ã€‚</p>

<p><a href="https://alexhilton.github.io/blog/2024/12/09/migrate-existing-project-to-cmp/"><img src="https://www.mouritech.com/wp-content/uploads/2024/01/Compose-Multiplatform.png" title="auto auto" ></a></p>

<!-- more -->


<h2>æ€»ä½“æ€è·¯</h2>

<p>åœ¨å‰é¢çš„æ–‡ç« <a href="https://juejin.cn/post/7439251025385996307">Composeå¤§å‰ç«¯ä»ä¸Šè½¦åˆ°èµ·é£</a>é‡Œé¢æˆ‘ä»¬å­¦ä¹ åˆ°äº†ï¼ŒCMPå¯¹Androidå¼€å‘åŒå­¦æ˜¯ç›¸å½“å‹å¥½çš„ï¼ŒCMPé¡¹ç›®ä¸Androidé¡¹ç›®åœ¨é¡¹ç›®ç»“æ„ä¸Šé¢æ˜¯éå¸¸ç›¸ä¼¼çš„ã€‚å¹¶ä¸”å› ä¸ºCMPçš„å¼€å‘IDEå°±æ˜¯Android Studioï¼Œå› æ­¤ï¼Œå¯ä»¥ç›´æ¥æŠŠä¸€ä¸ªAndroidé¡¹ç›®æ”¹é€ æˆä¸ºCMPé¡¹ç›®ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„CMPé¡¹ç›®ä¹‹åæŠŠé¡¹ç›®ä»£ç ç§»åŠ¨è¿›å»ã€‚</p>

<p>å…·ä½“çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>

<ol>
<li>æ·»åŠ CMPçš„æ’ä»¶ï¼Œæ·»åŠ æºç é›†åˆï¼Œé…ç½®CMPçš„ä¾èµ–</li>
<li>æŠŠä»£ç ä»ã€ŒandroidMainã€ç§»åŠ¨åˆ°ã€ŒcommonMainã€ä¸­å»</li>
<li>æŠŠèµ„æºè½¬æ¢æˆä¸ºCMPæ–¹å¼</li>
<li>æ·»åŠ å¹¶é€‚é…å…¶ä»–å¹³å°</li>
</ol>


<p><strong>å°è´´å£«ï¼š</strong> é’ˆå¯¹ ä¸åŒçš„ç±»å‹çš„ä»»åŠ¡éœ€è¦é‡‡å– ä¸åŒçš„ç­–ç•¥ï¼Œæ¯”å¦‚å¼€å‘åŠŸèƒ½çš„æ—¶å€™ä½¿ç”¨ã€Œè‡ªä¸Šè€Œä¸‹ã€çš„æ–¹å¼è¦æ›´ä¸ºå¥½ä¸€äº›ï¼Œå› ä¸ºå…ˆå…³æ³¨å¤§ç²’åº¦çš„ç»„ä»¶ï¼Œç±»ä¸æ–¹æ³•ï¼Œä¸è¢«ç»†èŠ‚æ‹–ä½ï¼Œæ›´æœ‰åˆ©äºæˆ‘ä»¬çœ‹æ¸…æ¶æ„å’Œä¼˜å…ˆè§£å†³æ‰é‡ç‚¹é—®é¢˜ï¼›ä½†å½“åšç§»æ¤ä»»åŠ¡æ—¶ï¼Œåº”è¯¥é‡‡ç”¨ã€Œè‡ªä¸‹è€Œä¸Šã€ï¼Œå› ä¸ºä¾èµ–æ˜¯ä¸€å±‚å¥—ä¸€å±‚ï¼Œå…ˆæŠŠä¸‹é¢çš„ç§»å¥½ï¼Œä¸Šé¢çš„è‡ªç„¶å°±ä¼šæ›´åŠ å®¹æ˜“ã€‚</p>

<p>è¿™é‡Œé€‰ç”¨çš„é¡¹ç›®æ˜¯å…ˆå‰ç”¨çº¯Jetpack Composeå¼€å‘çš„<a href="https://github.com/alexhilton/Aeolus">ä¸€æ¬¾å¤©æ°”åº”ç”¨</a>ï¼Œé¡¹ç›®æ¯”è¾ƒç®€å•ï¼Œä¾èµ–ä¸å¤šï¼Œå®Œå…¨æ˜¯ç”¨Jetpack Composeå®ç°çš„UIï¼Œä¹Ÿç¬¦åˆ<a href="https://juejin.cn/post/7411812014047461387">ç°ä»£åº”ç”¨å¼€å‘æ¶æ„åŸåˆ™</a>ï¼Œéå¸¸é€‚åˆå½“ä½œæ¡ˆä¾‹ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong> å…¶å®è¿™é‡Œçš„é¡¹ç›®å¹¶æ²¡æœ‰ä¸¥æ ¼è¦æ±‚ï¼Œåªè¦æ˜¯ä¸€ä¸ªèƒ½è¿è¡Œçš„Androidé¡¹ç›®å³å¯ï¼Œå…¶ä»–çš„ï¼ˆæ˜¯ä¸æ˜¯Jetpack Composeå®ç°çš„ï¼Œç”¨çš„æ˜¯ä¸æ˜¯Kotlinï¼‰å¹¶ä¸æ˜¯æœ€å…³é”®çš„ã€‚å› ä¸ºCMPé¡¹ç›®å¯¹äºæ¯ä¸ªæºç é›†åˆæœ¬èº«å¹¶æ²¡æœ‰æ˜ç¡®çš„è¦æ±‚ï¼Œå‰é¢çš„æ–‡ç« ä¹Ÿè®²äº†ï¼Œæ¯ä¸ªå¹³å°çš„æºç é›†åˆï¼Œå…¶å®å°±æ˜¯å…¶å¹³å°çš„å®Œæ•´çš„é¡¹ç›®ã€‚ç§»æ¤çš„ç›®çš„å°±æ˜¯æŠŠ <strong>å¯å…±ç”¨å…±äº«</strong> çš„ä»£ç ä»ç°æœ‰é¡¹ç›®ä¸­æŠ½å‡ºæ¥æ”¾è¿›ã€ŒcommonMainã€ä¸­ï¼Œå³å¯ä»¥æ˜¯åŸæœ‰çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¹Ÿå¯ä»¥æ˜¯æ–°å¼€å‘çš„ä»£ç ã€‚é‡‡ç”¨æ–°æŠ€æœ¯æˆ–è€…æ–°å·¥å…·çš„ä¸€ä¸ªéå¸¸é‡è¦çš„åŸåˆ™ å°±æ˜¯è¦å¾ªåºæ¸è¿›ï¼Œä¸æä¸€åˆ€åˆ‡ã€‚å¦‚æœæ—¶é—´ä¸å……è£•ï¼Œå®Œå…¨å¯ä»¥æ–°åŠŸèƒ½å’Œæ–°ä»£ç å…ˆç”¨CMPæ–¹å¼å¼€å‘ï¼Œè€ä»£ç æš‚ä¸”ä¸åŠ¨å®ƒï¼Œå¾…æ—¥åæ…¢æ…¢å†ç§»æ¤ã€‚å½“ç„¶äº†ï¼Œçº¯Jetpack Composeå®ç°çš„é¡¹ç›®ç§»æ¤è¿‡ç¨‹ä¼šç›¸å¯¹å®¹æ˜“ä¸€äº›ã€‚</p>

<p>ä¸‹é¢æˆ‘ä»¬è¿›è¡Œè¯¦ç»†çš„ä¸€æ­¥ä¸€æ­¥çš„å®è·µã€‚</p>

<h2>é…ç½®CMPçš„æ’ä»¶ï¼Œæºç é›†åˆå’Œä¾èµ–</h2>

<p>é¦–å…ˆè¦åšçš„æ˜¯é…ç½®Gradleæ„å»ºæ’ä»¶ï¼ˆè¿™æ˜¯æŠŠGradleå¸¸ç”¨çš„Tasksç­‰æ‰“åŒ…æˆä¸ºä¸€ä¸ªæ„å»º æ’ä»¶ï¼Œæ˜¯ç¼–è¯‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ï¼‰ï¼š</p>

<ul>
<li>ä½¿ç”¨Kotlin Multiplatformï¼ˆã€Œorg.jetbrains.kotlin.multiplatformã€ï¼‰æ›¿æ¢Kotlin Androidï¼ˆã€Œorg.jetbrains.kotlin.androidã€ï¼‰ï¼Œè¿™ä¸ªä¸»è¦æ˜¯Kotlinè¯­è¨€çš„ä¸œè¥¿ï¼Œç‰ˆæœ¬å·å°±æ˜¯Kotlinçš„ç‰ˆæœ¬å·ï¼Œæ³¨æ„è¦ä¸å…¶ä»–ï¼ˆå¦‚KSPï¼Œå¦‚Coroutinesï¼‰ç‰ˆæœ¬è¿›è¡ŒåŒ¹é…ï¼›</li>
<li>æ·»åŠ Compose compilerï¼ˆã€Œorg.jetbrains.kotlin.plugin.composeã€ï¼‰çš„æ’ä»¶ï¼Œç‰ˆæœ¬å·è¦ä¸Kotlinç‰ˆæœ¬å·ä¿æŒä¸€è‡´ï¼›</li>
<li>ä»¥åŠæ·»åŠ Compose Multiplatformï¼ˆorg.jetbrains.composeã€ï¼‰æ’ä»¶ï¼Œç‰ˆæœ¬å·æ˜¯CMPçš„ç‰ˆæœ¬å·ã€‚</li>
</ul>


<p>æ³¨æ„ï¼Œæ„å»ºæ’ä»¶é…ç½®æ˜¯ä¿®æ”¹é¡¹ç›®æ ¹ç›®å½•çš„é‚£ä¸ªbuild.gradle.ktsï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span>
</span><span class='line'><span class="n">plugins</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">id</span><span class="p">(</span><span class="s">&quot;com.android.application&quot;</span><span class="p">)</span> <span class="n">version</span> <span class="s">&quot;8.1.4&quot;</span> <span class="n">apply</span> <span class="k">false</span>
</span><span class='line'>    <span class="n">id</span><span class="p">(</span><span class="s">&quot;com.android.library&quot;</span><span class="p">)</span> <span class="n">version</span> <span class="s">&quot;8.1.4&quot;</span> <span class="n">apply</span> <span class="k">false</span>
</span><span class='line'>    <span class="n">id</span><span class="p">(</span><span class="s">&quot;org.jetbrains.kotlin.multiplatform&quot;</span><span class="p">)</span> <span class="n">version</span> <span class="s">&quot;2.0.21&quot;</span> <span class="n">apply</span> <span class="k">false</span>
</span><span class='line'>    <span class="n">id</span><span class="p">(</span><span class="s">&quot;com.google.devtools.ksp&quot;</span><span class="p">)</span> <span class="n">version</span> <span class="s">&quot;2.0.21-1.0.28&quot;</span> <span class="n">apply</span> <span class="k">false</span>
</span><span class='line'>    <span class="n">id</span><span class="p">(</span><span class="s">&quot;org.jetbrains.kotlin.plugin.compose&quot;</span><span class="p">)</span> <span class="n">version</span> <span class="s">&quot;2.0.21&quot;</span> <span class="n">apply</span> <span class="k">false</span>
</span><span class='line'>    <span class="n">id</span><span class="p">(</span><span class="s">&quot;org.jetbrains.compose&quot;</span><span class="p">)</span> <span class="n">version</span> <span class="s">&quot;1.7.0&quot;</span> <span class="n">apply</span> <span class="k">false</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¹‹åæ˜¯ä¿®æ”¹moduleçš„build.gradle.ktsï¼Œå…ˆæ˜¯å¯ç”¨éœ€è¦çš„æ’ä»¶ï¼Œç„¶åæ˜¯æ·»åŠ kotlinç›¸å…³çš„é…ç½®ï¼ˆå³DSL kotlin {&hellip;}ï¼‰ï¼Œåœ¨å…¶ä¸­æŒ‡å®šéœ€è¦ç¼–è¯‘çš„ç›®æ ‡ï¼Œæºç é›†åˆä»¥åŠå…¶ä¾èµ–ï¼Œå…·ä½“çš„å¯ä»¥ä»¿ç…§ç€CMPçš„demoå»ç…§æŠ„å°±å¥½äº†ã€‚å¯¹äºä¾èµ–ï¼Œå¯ä»¥æŠŠå…¶éƒ½ä»é¡¶å±‚DSL dependenciesä¸­ç§»åŠ¨åˆ°androidMain.dependenciesé‡Œé¢ï¼Œå¦‚æœæœ‰æ— æ³•ç§»åŠ¨çš„å°±å…ˆæ”¾åœ¨åŸæ¥çš„ä½ç½®ï¼Œæš‚ä¸åŠ¨å®ƒï¼Œæœ€ç»ˆbuild.gradle.ktsä¼šæ˜¯é…±ç´«ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">plugins</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">id</span><span class="p">(</span><span class="s">&quot;com.android.application&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">id</span><span class="p">(</span><span class="s">&quot;com.google.devtools.ksp&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">id</span><span class="p">(</span><span class="s">&quot;org.jetbrains.kotlin.multiplatform&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">id</span><span class="p">(</span><span class="s">&quot;org.jetbrains.kotlin.plugin.compose&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">id</span><span class="p">(</span><span class="s">&quot;org.jetbrains.compose&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">kotlin</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">androidTarget</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">@OptIn</span><span class="p">(</span><span class="n">org</span><span class="p">.</span><span class="n">jetbrains</span><span class="p">.</span><span class="n">kotlin</span><span class="p">.</span><span class="n">gradle</span><span class="p">.</span><span class="n">ExperimentalKotlinGradlePluginApi</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
</span><span class='line'>        <span class="n">compilerOptions</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">jvmTarget</span><span class="p">.</span><span class="k">set</span><span class="p">(</span><span class="n">org</span><span class="p">.</span><span class="n">jetbrains</span><span class="p">.</span><span class="n">kotlin</span><span class="p">.</span><span class="n">gradle</span><span class="p">.</span><span class="n">dsl</span><span class="p">.</span><span class="n">JvmTarget</span><span class="p">.</span><span class="n">JVM_17</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">sourceSets</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">androidMain</span><span class="p">.</span><span class="n">dependencies</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// Jetpack</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.core:core-ktx:1.15.0&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.appcompat:appcompat:1.7.0&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.activity:activity-compose:1.9.3&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="k">val</span> <span class="py">lifecycleVersion</span> <span class="p">=</span> <span class="s">&quot;2.8.7&quot;</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.lifecycle:lifecycle-runtime-ktx:$lifecycleVersion&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.lifecycle:lifecycle-runtime-compose:$lifecycleVersion&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.lifecycle:lifecycle-viewmodel-compose:$lifecycleVersion&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="k">val</span> <span class="py">navVersion</span> <span class="p">=</span> <span class="s">&quot;2.8.4&quot;</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.navigation:navigation-runtime-ktx:$navVersion&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.navigation:navigation-compose:$navVersion&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.datastore:datastore-preferences:1.1.1&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Google Play Services</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;com.google.android.gms:play-services-location:21.3.0&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Compose</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="n">compose</span><span class="p">.</span><span class="n">preview</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="n">project</span><span class="p">.</span><span class="n">dependencies</span><span class="p">.</span><span class="n">platform</span><span class="p">(</span><span class="s">&quot;androidx.compose:compose-bom:2024.02.00&quot;</span><span class="p">))</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.compose.ui:ui&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.compose.ui:ui-graphics&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.compose.ui:ui-tooling-preview&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.compose.material3:material3&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;androidx.compose.material:material&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Network</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;com.google.code.gson:gson:2.10.1&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;com.squareup.retrofit2:retrofit:2.9.0&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;com.squareup.retrofit2:converter-gson:2.9.0&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;com.squareup.okhttp3:logging-interceptor:4.12.0&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Accompanist</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;com.google.accompanist:accompanist-permissions:0.32.0&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="n">commonMain</span><span class="p">.</span><span class="n">dependencies</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="n">compose</span><span class="p">.</span><span class="n">runtime</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="n">compose</span><span class="p">.</span><span class="n">foundation</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="n">compose</span><span class="p">.</span><span class="n">material</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="n">compose</span><span class="p">.</span><span class="n">ui</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="n">compose</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">resources</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="n">compose</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">uiToolingPreview</span><span class="p">)</span>
</span><span class='line'>            <span class="k">val</span> <span class="py">lifecycleVersion</span> <span class="p">=</span> <span class="s">&quot;2.8.3&quot;</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.jetbrains.androidx.lifecycle:lifecycle-viewmodel:$lifecycleVersion&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;org.jetbrains.androidx.lifecycle:lifecycle-runtime-compose:$lifecycleVersion&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">android</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">dependencies</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æœ€åï¼ŒæŠŠDSL android {&hellip;}ä¸­ä¸æ”¯æŒçš„å­—æ®µåˆ é™¤æ‰å³å¯ï¼Œå¦‚kotlinOptionsï¼Œå®ƒç”¨æ¥æŒ‡å®šKotlin JVM targetçš„ï¼Œç°æ”¹åœ¨DSL kotlinä¸­çš„androidTarget()ä¸­æŒ‡å®šäº†ï¼Œä½†è¦æ³¨æ„Kotlinçš„JVM targetè¦ä¸androidä¸­çš„compileOptionsçš„sourceCompatibilityä»¥åŠtargetCompatibilityç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œæ¯”å¦‚éƒ½æ˜¯17æˆ–è€…éƒ½æ˜¯11ï¼Œå¦åˆ™ä¼šæœ‰ç¼–è¯‘é”™è¯¯ã€‚</p>

<p>éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯DSL kotlinä¸­çš„æºç é›†åˆåå­—è¦ä¸çœŸå®çš„ç›®å½•ä¸€è‡´ï¼Œå¦åˆ™ç¼–è¯‘ä¼šå‡ºé”™ã€‚å»ºè®®çš„æ–¹å¼å°±æ˜¯ä¾ç…§CMPçš„demoé‚£æ ·åœ¨moduleä¸­å»åˆ›å»ºandroidMainå’ŒcommonMainå³å¯ã€‚å¦å¤–ï¼Œå¯ä»¥æŠŠmoduleåå­—ä»ã€Œappã€æ”¹ä¸ºã€ŒcomposeAppã€ï¼Œç„¶åæŠŠè¿è¡Œé…ç½®ä»ã€Œappã€æ”¹ä¸ºã€ŒandroidAppã€ï¼Œè¿™ä¸‹å°±é½æ´»å„¿äº†ï¼š</p>

<p><img src="file:///Users/alexhilton/Downloads/compose_libs/migrate-struct.png" alt="å›¾1. é‡å‘½ååçš„é¡¹ç›®ç»“æ„" /></p>

<p>CMPçš„æ’ä»¶å’Œä¾èµ–é…ç½®å¥½äº†ä»¥åï¼Œè¿è¡Œã€ŒandroidAppã€åº”è¯¥å°±å¯ä»¥æ­£å¸¸è¿è¡Œã€‚å› ä¸ºä»…æ˜¯é…ç½®ä¸€äº›ä¾èµ–ï¼Œè¿™ä»æ˜¯ä¸€ä¸ªå®Œæ•´çš„Androidåº”ç”¨ï¼Œåº”è¯¥èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚è¿™æ—¶ç¬¬ä¸€æ­¥å°±åšå®Œäº†ï¼Œè™½ç„¶çœ‹èµ·æ¥è²Œä¼¼å•¥ä¹Ÿæ²¡å¹²ï¼Œä½†è¿™å·²ç»æ˜¯ä¸€ä¸ªCMPé¡¹ç›®äº†ï¼ŒåŸºç¡€æ‰“å¥½äº†ï¼Œå¯ä»¥å¤§æ­¥å‘å‰äº†ã€‚</p>

<p><strong>å°è´´å£«ï¼š</strong> é€šè¿‡é…ç½®ä¾èµ–å¯ä»¥å‘ç°ï¼ŒCMPçš„artifactä¾èµ–éƒ½æ˜¯ä»¥org.jetbrans.*å¼€å¤´çš„ï¼Œå“ªæ€•æ˜¯å¯¹äºComposeæœ¬èº«ï¼Œçº¯Androidä¸Šé¢Jetpack Composeçš„ä¾èµ–æ˜¯ã€Œ&#8221;androidx.compose.ui:ui&#8221;ã€ï¼Œè€ŒCMPä¸­çš„åˆ™æ˜¯ã€Œ&#8221;org.jetbrains.compose.ui:ui&#8221;ã€ã€‚è™½ç„¶éƒ½æ˜¯Jetpack Composeï¼Œä»£ç æ˜¯å…¼å®¹çš„ï¼Œä½†æŠ€æœ¯ä¸Šæ¥è®²æ˜¯ä¸¤ä¸ªä¸åŒçš„å®ç°ã€‚ç¡®åˆ‡åœ°è¯´JetBrainsçš„Composeæ˜¯ä»è°·æ­Œçš„ä¸Šé¢forkå‡ºæ¥çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œä»¥è®©å…¶æ›´å¥½çš„é€‚ç”¨äºCMPï¼Œä½†å®Œå…¨å…¼å®¹ï¼Œæ ‡å‡†çš„Composeä»£ç éƒ½æ˜¯èƒ½æ­£å¸¸è·‘çš„ã€‚</p>

<h2>æŠŠä»£ç ä»ã€ŒandroidMainã€ç§»åŠ¨åˆ°ã€ŒcommonMainã€</h2>

<p>è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥äº†ï¼Œä¹Ÿæ˜¯æœ€éš¾å•ƒçš„ç¡¬éª¨å¤´ï¼Œå…·ä½“çš„éš¾åº¦å–å†³äºé¡¹ç›®ä¸­ä½¿ç”¨äº†å¤šå°‘ã€Œä¸å…¼å®¹ã€çš„åº“å’ŒAPIã€‚Composeå’ŒJetpackä¸­çš„ç»å¤§å¤šæ•°åº“éƒ½æ˜¯æ”¯æŒçš„ï¼Œå¯ä»¥åœ¨CMPä¸­ä½¿ç”¨ï¼Œå¯ä»¥æ— ç¼åˆ‡æ¢ï¼Œè¿™æ˜¯JetBrainså’ŒGoogleå…±åŒåŠªåŠ›çš„ç»“æœï¼Œè°·æ­Œç°åœ¨å¯¹CMP/KMPçš„æ€åº¦éå¸¸çš„ç§¯æï¼Œç»™ä¸ã€Œç¬¬ä¸€ä¼˜å…ˆæ”¯æŒï¼ˆFirst class supportï¼‰ã€ã€‚æ‰€ä»¥å¯¹äºä¾èµ–äºroomï¼Œnavigationï¼Œmaterialå’Œviewmodelçš„ä»£ç éƒ½å¯ä»¥ç›´æ¥ç§»åˆ°commonä¸­ã€‚</p>

<p>ä¹Ÿå°±æ˜¯è¯´å¯¹äºdataéƒ¨åˆ†ï¼Œmodeléƒ¨åˆ†ä»¥åŠdomainéƒ¨åˆ†ï¼ˆå³view modelsï¼‰éƒ½å¯ä»¥ç›´æ¥å…ˆç§»åˆ°commonä¸­ï¼Œå› ä¸ºè¿™äº›å±‚ï¼Œä»æ¶æ„è§’åº¦æ¥è¯´éƒ½å±äºä¸šåŠ¡é€»è¾‘ï¼Œéƒ½åº”è¯¥æ˜¯å¹³å°ç‹¬ç«‹çš„ï¼Œå®ƒä»¬çš„ä¸»è¦ä¾èµ–åº”è¯¥æ˜¯Jetpackä»¥åŠä¸‰æ–¹çš„åº“ï¼Œè¿™äº›åº“å¤§å¤šä¹Ÿéƒ½å¯ä»¥ç›´æ¥è·¨å¹³å°ã€‚</p>

<p>å½“ç„¶ï¼Œä¸å¯èƒ½è¿™ä¹ˆé¡ºåˆ©ï¼Œå› ä¸ºæˆ–å¤šæˆ–å°‘ä¼šç”¨åˆ°ä¸å¹³å°å¼ºç›¸å…³çš„APIï¼Œæ¯”å¦‚æœ€ä¸ºå¸¸è§çš„å°±æ˜¯ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆContextï¼‰ä»¥åŠåƒæƒé™ç®¡ç†å’Œç¡¬ä»¶èµ„æºï¼ˆå¦‚ä½ç½®ä¿¡æ¯ï¼‰ï¼Œè¿™å°±éœ€è¦ç”¨åˆ°å¹³å°å®šåˆ¶æœºåˆ¶ï¼ˆå³expect/actualï¼‰æ¥è¿›è¡Œå®šåˆ¶ã€‚</p>

<p>å¯èƒ½æœ‰åŒå­¦ä¼šå¾ˆå¥‡æ€ªï¼Œä¸ºå•¥UIå±‚è¿˜ä¸ç§»åŠ¨åˆ°commonä¸­ï¼ŒUIæ˜¯ç”¨Composeå†™çš„å•Šï¼Œè€ŒComposeæ˜¯å¯ä»¥ç›´æ¥åœ¨CMPä¸Šè·‘çš„å•Šã€‚Composeå†™çš„UIç¡®å®å¯ä»¥ç›´æ¥è·‘ï¼Œä½†UIå¿…ç„¶ä¼šç”¨åˆ°èµ„æºï¼Œå¿…é¡» å…ˆæŠŠèµ„æºä»androidä¸­ç§»åˆ°commonä¸­ï¼Œå¦åˆ™UIæ˜¯è·‘ä¸èµ·æ¥çš„ã€‚</p>

<h2>æŠŠèµ„æºè½¬åŒ–æˆä¸ºCMPæ–¹å¼</h2>

<p>åœ¨å‰ä¸€ç¯‡æ–‡ç« <a href="https://juejin.cn/post/7439251025385996307">Composeå¤§å‰ç«¯ä»ä¸Šè½¦åˆ°èµ·é£</a>æœ‰è®²è¿‡CMPç”¨ä¸€ä¸ªåº“resourcesæ¥ä¸“é—¨å¤„ç†èµ„æºï¼Œè§„åˆ™ä¸Androidå¼€å‘ç®¡ç†èµ„æºçš„æ–¹å¼å¾ˆåƒï¼Œæ‰€ä»¥å¯ä»¥æŠŠUIç”¨åˆ°çš„èµ„æºç§»åŠ¨åˆ°commonä¸­çš„composeResourcesé‡Œé¢ï¼Œå°±å·®ä¸å¤šäº†ã€‚</p>

<p>ä½†éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œä¸è¦æŠŠå…¨éƒ¨çš„èµ„æºéƒ½ä»androidMainä¸­ç§»å‡ºï¼Œåªéœ€è¦æŠŠUIå±‚ç”¨åˆ°çš„é‚£éƒ¨åˆ†èµ„æºç§»å‡ºå³å¯ã€‚androidMainä¸­è‡³å°‘è¦æŠŠAndroidå¼ºç›¸å…³çš„èµ„æºç•™ä¸‹ï¼Œå¦‚åº”ç”¨çš„iconï¼Œåº”ç”¨çš„åå­—ï¼Œä»¥åŠä¸€äº›å…³é”®çš„éœ€è¦åœ¨manifestä¸­ä½¿ç”¨çš„xmlç­‰ã€‚è¿™æ˜¯å› ä¸ºè¿™äº›èµ„æºæ˜¯éœ€è¦åœ¨Androidåº”ç”¨çš„é…ç½®æ–‡ä»¶AndroidManifestä¸­ä½¿ç”¨çš„ï¼Œæ‰€ä»¥å¿…é¡»è¿˜æ”¾åœ¨androidæºç é›†ä¸­ã€‚</p>

<p>èµ„æºæ–‡ä»¶ç§»åŠ¨å¥½åï¼Œå°±å¯ä»¥æŠŠUIç§»åŠ¨åˆ°commonä¸­äº†ï¼Œæœ€åä¸€æ­¥å°±æ˜¯ä½¿ç”¨CMPçš„èµ„æºç±»Resä»£æ›¿Androidçš„èµ„æºç±»Rå³å¯ã€‚</p>

<p>åˆ°æ­¤ï¼Œå°±å®Œæˆäº†ä»Androidé¡¹ç›®åˆ°CMPé¡¹ç›®çš„è½¬å˜ã€‚</p>

<h2>æ·»åŠ å¹¶é€‚é…å…¶ä»–å¹³å°</h2>

<p>å‰é¢çš„å·¥ä½œåšå¥½åï¼Œå†é€‚é…å…¶ä»–çš„å¹³å°å°±éå¸¸å®¹æ˜“äº†ï¼Œæ·»åŠ å…¶ä»–å¹³å°çš„targetå’Œå…¥å£ï¼ˆå¯ä»¥ä»¿ç…§CMPçš„demoï¼‰ï¼Œç„¶åå®ç°ç›¸å…³çš„expectæ¥å£å³å¯ã€‚ç”±æ­¤ï¼Œä¸€ä¸ªå¤§å‰ç«¯ é¡¹ç›®å°±å½»åº•å¤§åŠŸå‘Šæˆäº†ã€‚</p>

<h2>æ€»ç»“</h2>

<p>CMPå¯¹é¡¹ç›®ç»“æ„ä¸­æºç  é›†åˆ çš„é™åˆ¶ å¹¶ä¸å¤šï¼Œæ¯ä¸ªå¹³å°ç›¸å…³çš„sourceSetå¯ä»¥ä¿æŒå…¶åŸæ¥çš„æ ·å­ï¼Œè¿™å¯¹ç°æœ‰é¡¹ç›®æ˜¯éå¸¸å‹å¥½çš„ï¼Œå¯ä»¥è®©ç°æœ‰çš„é¡¹ç›®è½»æ¾çš„è½¬æˆä¸ºCMPé¡¹ç›®ï¼Œè¿™ä¹Ÿæ˜¯CMPæœ€å¤§çš„ä¸€ä¸ªä¼˜åŠ¿ã€‚</p>

<h2>References</h2>

<ul>
<li><a href="https://touchlab.co/compose-multiplatform-transition-guide">Jetpack Compose to Compose Multiplatform: Transition Guide</a></li>
<li><a href="https://stackoverflow.com/questions/71510247/how-to-convert-kotlin-project-to-kotlin-multiplatform-mobile-after-the-project-c">How to convert Kotlin project to Kotlin Multiplatform Mobile after the project completion?</a></li>
<li><a href="https://markonovakovic.medium.com/from-android-to-multiplatform-migrating-real-100-jetpack-compose-app-to-fully-multiplatform-app-2d65dc9e212e">From Android to Multiplatform: Migrating real 100% Jetpack Compose App to fully Multiplatform App. Intro</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Composeå¤§å‰ç«¯ä»ä¸Šè½¦åˆ°èµ·é£]]></title>
    <link href="https://alexhilton.github.io/blog/2024/11/24/master-compose-multiplatform/"/>
    <updated>2024-11-24T08:45:46+08:00</updated>
    <id>https://alexhilton.github.io/blog/2024/11/24/master-compose-multiplatform</id>
    <content type="html"><![CDATA[<p>åœ¨å‰é¢çš„ä¸€ç¯‡æ–‡ç« <a href="https://juejin.cn/post/7436648335380496434">èµ¶ç´§ä¸Šè½¦å¼€å¯Composeå¤§å‰ç«¯ä¹‹è·¯</a>ä¸­æˆ‘ä»¬å­¦ä¹ äº†CMPçš„åŸºæœ¬æ¦‚å¿µä»¥åŠå¦‚ä½•åˆ›å»ºä¸€ä¸ªCMPé¡¹ç›®ã€‚ä»Šå¤©å°†ç»§ç»­å­¦ä¹ CMPï¼Œæ·±å…¥ç ”ç©¶é¡¹ç›®çš„é…ç½®æ–¹æ³•ï¼Œäº†è§£CMPçš„å†…éƒ¨æœºåˆ¶å¹¶æ€»ç»“ä¸€äº›CMPå¼€å‘çš„æœ€ä½³å®è·µã€‚</p>

<p><a href="https://alexhilton.github.io/blog/2024/11/24/master-compose-multiplatform/"><img src="https://repository-images.githubusercontent.com/293498508/6469be07-159b-49de-9ffe-56340d5dfd07" title="auto auto" ></a></p>

<!-- more -->


<h2>æ·±å…¥äº†è§£é¡¹ç›®ç»“æ„</h2>

<p>CMPçš„åŸºç¡€ç»“æ„ä¸ä¸€ä¸ªæ ‡å‡†çš„Androidåº”ç”¨çš„é¡¹ç›®ç»“æ„åŸºæœ¬ä¸€æ ·ï¼Œåªä¸è¿‡ä¸»moduleåå­—å˜æˆäº†ã€ŒcomposeAppã€ã€‚é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„build.gradle.ktsæ˜¯æ•´ä¸ªé¡¹ç›®çš„é…ç½®ï¼Œä¸»è¦æ˜¯æŒ‡å®šä½¿ç”¨çš„æ’ä»¶ï¼›settings.gradle.ktsæŒ‡å®šé¡¹ç›®çš„ä¾èµ–ä»“åº“ï¼Œä»¥åŠé¡¹ç›®åŒ…å«å“ªäº›moduleï¼›gradle/wrapper/libs.version.tomlå®šä¹‰ç€ä¾èµ–çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚æ¨¡å—ã€ŒcomposeAppã€åŒ…å«ç€æºç é›†åˆï¼ˆsource setsï¼‰ä»¥åŠä¸€ä¸ªbuild.gradle.ktsï¼Œè¿™æ˜¯æè¿°è¿™ä¸ªæ¨¡å—å¦‚ä½•æ„å»ºçš„è„šæœ¬ã€‚</p>

<p><img src="file:///Users/alexhilton/Downloads/compose_libs/project-view.png" alt="å›¾1. é¡¹ç›®ç»“æ„" /></p>

<p>å¯¹äºAndroidå¼€å‘åŒå­¦æ¥è¯´ï¼Œè¿™æ ·çš„é¡¹ç›®ç»“æ„éå¸¸ç†Ÿæ‚‰ï¼Œäº‹å®ä¸Šå¦‚æœæŠŠé¡¹ç›®è§†å›¾åˆ‡æ¢åˆ°ã€ŒAndroidã€ï¼Œå°±ä¼šå‘ç°ï¼Œè¿™æ¯”èµ·å¸¸è§„çš„Androidé¡¹ç›®ï¼Œæ— éå°±æ˜¯å¤šäº†ä¸€äº›æºç é›†åˆã€‚</p>

<p>ä»”ç»†çœ‹ä¸€ä¸‹æºç é›†åˆã€ŒandroidMainã€å®ƒå°±æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Androidé¡¹ç›®ï¼Œé‡Œé¢æœ‰AndroidManifestæ–‡ä»¶ï¼Œä»¥åŠä¸€ä¸ªå…¥å£MainActivityï¼Œå®ƒä¼šè°ƒç”¨ã€ŒcommonMainã€ä¸­å®šä¹‰çš„composable App()ï¼Œç”±æ­¤å°±è¿›å…¥åˆ°äº†ã€ŒcommonMainã€ä¸­ã€‚</p>

<p><img src="file:///Users/alexhilton/Downloads/compose_libs/android-entry.png" alt="å›¾2. Androidæºç å…³ç³»" /></p>

<p>è™½ç„¶å¹¶ä¸åœ¨æºç é›†åˆä¸­ï¼ŒiosAppå­ç›®å½•å…¶å®æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Xcodeé¡¹ç›®ï¼Œé‡Œé¢å…¨æ˜¯Xcodeé¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ç”¨Xcodeç›´æ¥æ‰“å¼€ã€‚å®ƒæ˜¯iOSåº”ç”¨çš„å…¥å£ï¼Œå®ƒçš„è°ƒç”¨é¡ºåºæ˜¯iOSAppï¼Œåˆ°ContentViewï¼Œè¿™ä¸¤ä¸ªæ˜¯æ ‡å‡†çš„iOSçš„ä»£ç ï¼Œç”¨çš„æ˜¯Swiftã€‚ç„¶åä¼šè¿›å…¥åˆ°ã€ŒiosMainã€ä¸­çš„MainConntrollerï¼Œè¿™é‡Œå°±åˆ°äº†Kotlinåœ°ç•Œäº†ï¼ŒMainControllerï¼Œå†è¿›å…¥åˆ°commonä¸­çš„composable App()ï¼Œç”±æ­¤è¿›å…¥äº†ã€ŒcommonMainã€ä¸­ã€‚</p>

<p><img src="file:///Users/alexhilton/Downloads/compose_libs/ios-entry.png" alt="å›¾3. iOSæºç å…³ç³»" /></p>

<h2>ä¾èµ–é…ç½®æ–¹æ³•</h2>

<p>ç°ä»£çš„è½¯ä»¶ä¸å¯èƒ½å…¨éƒ½æ˜¯ä»é›¶å¼€å§‹ï¼Œæœ‰å¾ˆå¤šç°æˆçš„ä»£ç åº“å¯ä»¥ä½¿ç”¨ï¼Œè¿™å°±éœ€è¦ä¸ºé¡¹ç›®é…ç½®ä¾èµ–ã€‚CMPä¸­ä¾èµ–é…ç½®æ–¹æ³•ä¸å¸¸è§„çš„Androidç•¥ä¸ä¸€æ ·ï¼Œè§†ä¾èµ–çš„ä½¿ç”¨ï¼Œä»¥åŠä¾èµ–çš„å¹³å°ä¾èµ–æ€§ï¼Œéœ€è¦åˆ†åˆ«é’ˆå¯¹ä¸åŒçš„æºç é›†åˆé…ç½®ã€‚</p>

<p>éœ€è¦æ³¨æ„çš„å°±æ˜¯ä¾èµ–çš„ä½œç”¨åŸŸï¼Œå¦‚æœæ˜¯åœ¨commonMainä¸­é…ç½®çš„ï¼Œé‚£å°±ä¼šå¯¹æ‰€æœ‰çš„å¹³å°ç”Ÿæ•ˆï¼›å¦‚æœæ˜¯ä¸ºandroidMainé…ç½®çš„ä¾èµ–ï¼Œåªèƒ½åœ¨Androidä¸­ç”Ÿæ•ˆï¼Œä»¥æ¬¡ç±»æ¨ã€‚</p>

<h3>åœ¨æºç é›†åˆä¸­é…ç½®ä¾èµ–</h3>

<p>æœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯é’ˆå¯¹æ¯ä¸ªæºç é›†åˆé…ç½®å…¶ä¾èµ–ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">kotlin</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">sourceSets</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">commonMain</span><span class="p">.</span><span class="n">dependencies</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="s">&quot;com.example:my-library:1.0&quot;</span><span class="p">)</span> <span class="c1">// æ‰€æœ‰å¹³å°å…±äº«çš„ä¾èµ–</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>åœ¨é¡¶å±‚DSL dependenciesä¸­é…ç½®</h3>

<p>é™¤äº†åœ¨æºç é›†åˆå¤„é…ç½®ä¾èµ–ï¼Œä¹Ÿå¯ä»¥åœ¨é¡¶å±‚DSL dependenciesä¸­é…ç½®ï¼Œæœ¬è´¨éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ˜¯æ–¹å¼ç•¥æœ‰ä¸åŒã€‚å…·ä½“çš„æ ¼å¼æ˜¯<strong> &lt;æºç é›†åˆ&gt;&lt;å…·ä½“çš„ä¾èµ–&gt; </strong>ï¼Œæ¯”å¦‚ä¸Šé¢é…±ç´«å†™ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">dependencies</span> <span class="p">{</span>
</span><span class='line'>    <span class="s">&quot;commonMainImplementation&quot;</span><span class="p">(</span><span class="s">&quot;com.example:my-library:1.0&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ä¸åƒä¸Šé¢åœ¨æºç é›†åˆcommonMainä¸­é…ç½®æ˜¯ä¸€æ ·çš„ã€‚åœ¨é¡¶å±‚é…ç½®ä¾èµ–çš„å¥½å¤„åœ¨äºè¿™é‡Œå¯ä»¥é…ç½®ä¸€äº›æºç é›†åˆä¸­æ‰¾ä¸åˆ°çš„ä¾èµ–ï¼Œå¦‚testingç­‰ç­‰ã€‚</p>

<h3>æœ¬åœ°moduleå¦‚ä½•ç›¸äº’ä¾èµ–</h3>

<p>å¦‚æœæ˜¯æœ¬åœ°çš„åº“ï¼ˆmoduleï¼‰ï¼Œå¯ä»¥é€šè¿‡projectæ–¹å¼å¼•å…¥ï¼ŒåŒæ ·çš„å¦‚æœæ˜¯å…±äº«çš„åº“åŠ åœ¨commoné‡Œï¼Œå¦‚æœæ˜¯æŸä¸ªå¹³å°ç‰¹æœ‰çš„ï¼Œæˆ–è€…åªæƒ³åœ¨æŸä¸ªå¹³å°ä½¿ç”¨å°±å•ç‹¬åŠ åˆ°å®ƒä¸Šé¢ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">kotlin</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">sourceSets</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">commonMain</span><span class="p">.</span><span class="n">dependencies</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="n">project</span><span class="p">(</span><span class="s">&quot;:some-other-multiplatform-module&quot;</span><span class="p">))</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>å¦‚ä½•å…±äº«å’Œå®šåˆ¶ä»£ç </h2>

<p>CMPçš„ç»ˆæç›®çš„æ˜¯è¦å°½å¯èƒ½çš„å…±äº«ä»£ç ï¼Œè®©ä¸€å¥—ä»£ç èƒ½å¤Ÿè·‘åœ¨å¤šä¸ªå¹³å°ä¸Šé¢ã€‚ä½†ç°å®çš„ä¸–ç•Œæ˜¯ä¸å®Œç¾çš„ï¼Œå¹³å°çš„å·®å¼‚æ˜¯ä¸å¯å¿½è§†çš„ã€‚åƒå­˜å‚¨ï¼ŒI/Oï¼Œç¡¬ä»¶èµ„æºç­‰ç­‰éƒ½æ˜¯å¹³å°å¼ºç›¸å…³çš„ã€‚æˆ‘ä»¬åªèƒ½å°½å¯èƒ½å¤šçš„å…±äº«æˆ‘ä»¬è‡ªå·±å†™çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¯¹äºå®ç°ä¸šåŠ¡é€»è¾‘è€Œéœ€è¦çš„ç³»ç»Ÿå¹³å°ç›¸å…³çš„APIï¼Œè‚¯å®šè¿˜æ˜¯éœ€è¦æ¯ä¸ªå¹³å°å®šåˆ¶åŒ–çš„å»å®ç°ã€‚</p>

<p>CMPé€šè¿‡Kotlinä¸­çš„å…³é”®å­—expectå’Œactualæ¥å¤„ç†å¹³å°å®šåˆ¶APIã€‚</p>

<p>å…·ä½“çš„åšæ³•å°±æ˜¯åœ¨commonä¸­å®šä¹‰ä¸€ä¸ªç”¨å…³é”®å­—expectä¿®é¥°çš„ç±»å‹ï¼ˆå‡½æ•°ï¼Œç±»ï¼Œæ¥å£æšä¸¾ï¼Œå±æ€§ç­‰ï¼‰ï¼Œç„¶ååœ¨æ¯ä¸ªå¹³å°çš„æºç é›†åˆä¸­å»å…·ä½“å®ç°ï¼Œå¹¶ç”¨å…³é”®å­—actualæ¥ä¿®é¥°ã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„ç±»å‹æ²¡æœ‰é™åˆ¶ï¼Œå¯ä»¥æ˜¯å‡½æ•°ï¼Œå¯ä»¥æ˜¯ç±»/æ¥å£/æšä¸¾ï¼Œä¹Ÿå¯ä»¥æ˜¯å±æ€§ï¼Œå°½ç®¡ç»å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯å‡½æ•°ã€‚</p>

<p><img src="https://resources.jetbrains.com/help/img/kotlin-multiplatform-dev/expect-functions-properties.svg" alt="å›¾4. ç”¨expectå’Œactualæ¥å®šåˆ¶API" /></p>

<p>å¯ä»¥ç†è§£ä¸ºOOä¸­çš„æ¥å£ï¼Œä½†åˆä¸å®Œå…¨ä¸€æ ·ã€‚åŒºåˆ«åœ¨äºï¼Œcommonä¸­çš„expectå‡½æ•°ä¸èƒ½æœ‰é»˜è®¤å®ç°ä»£ç ï¼Œå¹¶ä¸”å‡½æ•°çš„å£°æ˜è¦åœ¨åŒä¸€ä¸ªåŒ…ä¸‹é¢ã€‚ç¼–è¯‘çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šç”¨å¹³å°ä»£ç é‡Œé¢çš„actualå»æ›¿æ¢commonä¸­çš„expectå‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™æ˜¯å‘ç”Ÿåœ¨ç¼–è¯‘æ—¶çš„è¡Œä¸ºï¼Œæ‰€ä»¥å®ƒè¦æ±‚åŒ…åå’Œå‡½æ•°çš„ç­¾åå®Œå…¨ä¸€è‡´ã€‚</p>

<h2>èµ„æºç®¡ç†</h2>

<p>CMPæ˜¯èƒ½æ„å»ºè·¨å¹³å°UIçš„ï¼Œè€ŒUIå¿…ç„¶ä¼šæ¶‰åŠèµ„æºï¼Œæœ€å¸¸è§çš„èµ„æºå°±æ˜¯å›¾ç‰‡å’Œå­—ç¬¦ä¸²ï¼Œèµ„æºçš„å¤æ‚åœ°æ–¹åœ¨äºå®ƒä¼šæœ‰é™å®šå±æ€§ï¼Œæ¯”å¦‚ä¸åŒå±å¹•åˆ†è¾¨ç‡è¦ç”¨ä¸åŒçš„å›¾ç‰‡ï¼Œæ¯”å¦‚ä¸åŒçš„åœ°åŒºè¯­è¨€è¦ç”¨ä¸åŒçš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥èµ„æºæ˜¯ç›¸å½“å¤æ‚çš„ï¼Œè€Œä¸”å¹³å°å¼ºç›¸å…³ã€‚</p>

<p>ä¸ºæ­¤CMPæä¾›äº†ä¸€ä¸ªä¸“é—¨çš„åº“ç”¨äºç®¡ç†èµ„æºï¼Œå¯ä»¥å±è”½å¹³å°ç‰¹å®šï¼Œä»¥ç»Ÿä¸€çš„æ–¹å¼æ¥ç®¡ç†èµ„æºã€‚åªéœ€è¦åœ¨commonMainä¸­å¼•å…¥ä¾èµ–å³å¯ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">kotlin</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">sourceSets</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">commonMain</span><span class="p">.</span><span class="n">dependencies</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">implementation</span><span class="p">(</span><span class="n">compose</span><span class="p">.</span><span class="n">components</span><span class="p">.</span><span class="n">resources</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>èµ„æºæ˜¯æ”¾åœ¨commonMainä¸­ä¸kotlinåŒçº§åˆ«çš„ç›®å½•ä¸­ï¼š</p>

<p><img src="https://resources.jetbrains.com/help/img/kotlin-multiplatform-dev/compose-resources-qualifiers.png" alt="å›¾5. èµ„æºæ–‡ä»¶ç®¡ç†" /></p>

<p>èµ„æºå¯ä»¥åˆ†ä¸ºå‡ ç§ç±»å‹ï¼Œå›¾ç‰‡åº”è¯¥æ”¾åœ¨å­ç›®å½•drawableä¸­ï¼Œå­—ä½“èµ„æºæ”¾åœ¨fontsä¸­ï¼Œå­—ç¬¦ä¸²æ”¾åœ¨valuesä¸­ï¼Œå…¶ä»–æ–‡ä»¶æ”¾åœ¨filesä¸­ã€‚</p>

<p>èµ„æºæ–‡ä»¶è¿˜å¯ä»¥æœ‰é™å®šç¬¦ä»¥æ”¯æŒå®šåˆ¶åŒ–ï¼Œå¦‚å±å¹•åˆ†è¾¨ç‡ï¼ˆxhdpiï¼Œxxhdpiç­‰ï¼‰ï¼ŒåŒºåŸŸè¯­è¨€ï¼ˆenï¼Œzh-rCNç­‰ï¼‰å’Œä¸»é¢˜ï¼ˆdarkï¼Œlightç­‰ï¼‰ã€‚å¯ä»¥å‘ç°ï¼Œè§„åˆ™ä¸Androidå¹³å°èµ„æºç®¡ç†è§„åˆ™æ˜¯éå¸¸æ¥è¿‘çš„ã€‚</p>

<p>å›¾ç‰‡å­—ä½“ç­‰ç›´æ¥æ·»åŠ æ–‡ä»¶å³å¯ï¼Œå­—ç¬¦ä¸²çš„è¯æ”¾åœ¨ä¸€ä¸ªxmlæ–‡ä»¶ä¸­ï¼Œæ ¹Tagæ˜¯resourcesï¼Œæ¯ä¸ªå­—ç¬¦ä¸²çš„Tagæ˜¯stringï¼Œå¦‚ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="p">&lt;</span><span class="n">resources</span><span class="p">&gt;</span>
</span><span class='line'>    <span class="p">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="p">=</span><span class="s">&quot;app_name&quot;</span><span class="p">&gt;</span><span class="n">My</span> <span class="n">awesome</span> <span class="n">app</span><span class="p">&lt;/</span><span class="n">string</span><span class="p">&gt;</span>
</span><span class='line'>    <span class="p">&lt;</span><span class="n">string</span> <span class="n">name</span><span class="p">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span><span class="n">Some</span> <span class="n">title</span><span class="p">&lt;/</span><span class="n">string</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">resources</span><span class="p">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>éœ€è¦æ³¨æ„èµ„æºçš„å‘½åï¼Œä¸Androidçš„èµ„æºè§„åˆ™ä¸€æ ·ï¼Œè¦æ˜¯å°å†™å­—ç¬¦ï¼Œå¯ä»¥æœ‰æ•°å­—å’Œä¸‹åˆ’çº¿ã€‚</p>

<p>æ·»åŠ å¥½èµ„æºåï¼Œç¼–è¯‘æ’ä»¶ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç±»Resï¼Œé€šè¿‡å®ƒå°±å¯ä»¥å¼•ç”¨å„ç§èµ„æºï¼Œå¦‚ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">Image</span><span class="p">(</span>
</span><span class='line'>    <span class="n">painter</span> <span class="p">=</span> <span class="n">painterResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">my_icon</span><span class="p">),</span>
</span><span class='line'>    <span class="n">contentDescription</span> <span class="p">=</span> <span class="k">null</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">Text</span><span class="p">(</span><span class="n">stringResource</span><span class="p">(</span><span class="n">Res</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">app_name</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>ä¸€äº›å¼€å‘å®è·µå»ºè®®</h2>

<p>CMPæ˜¯ä¸ºäº†æ„å»ºè·¨å¹³å°åº”ç”¨çš„ï¼Œé‚£ä¹ˆåº”è¯¥å°½æœ€å¤§çš„å¯èƒ½å»å…±äº«ä»£ç ã€‚è™½ç„¶æœ‰å¹³å°å®šåˆ¶æœºåˆ¶ï¼Œä½†åªåº”è¯¥ç”¨å®ƒæ¥å®šåˆ¶ç»†ç²’åº¦çš„å…·ä½“çš„APIï¼Œè€Œä¸æ˜¯ä¸šåŠ¡é€»è¾‘ã€‚æ¯”å¦‚è¯´ï¼Œä»ä¸€ä¸ªæ–‡ä»¶ä¸­è¯»æ–‡æœ¬å†…å®¹ï¼Œä¸åº”è¯¥å®šä¹‰ä¸€ä¸ªgetFileContentï¼Œè€Œæ˜¯åº”è¯¥å®šåˆ¶ç»†ç²’åº¦çš„openFileï¼ŒcloseFileå’ŒreadLineï¼Œè¿™æ˜¯å› ä¸ºè¯»å–æ–‡ä»¶è¿‡ç¨‹çœŸæ­£ä¸åŒçš„æ˜¯å¤„ç†æ–‡ä»¶çš„APIï¼Œé™¤æ‰“å¼€æ–‡ä»¶ï¼Œè¯»å‡ºæ¯ä¸€è¡Œä»¥å¤–ï¼Œå…¶ä»–çš„é€»è¾‘æ˜¯ä¸€æ ·çš„ï¼Œåº”è¯¥å…±äº«ã€‚</p>

<p>è¿˜æœ‰ï¼Œåœ¨å†™ä¸šåŠ¡çš„æ—¶å€™è¦æ³¨æ„çœ‹Composeæ–‡æ¡£ä¸­ä»¥åŠKotlinæ–‡æ¡£ä¸­APIæ ‡æ³¨çš„å¹³å°èŒƒå›´ï¼Œå°½å¯èƒ½é€‰æ‹©æ ‡è®°ä¸ºã€ŒCommonã€æˆ–è€…ã€ŒCmnã€çš„APIã€‚</p>

<p>å¦å¤–ï¼Œå› ä¸ºKotlinæ˜¯åŸºäºJVMçš„è¯­è¨€ï¼Œæ ‡å‡†JDKä¸­çš„APIéƒ½å¯ä»¥ç”¨ï¼Œä½†åœ¨CMPçš„iOSï¼ˆç›®æ ‡æ˜¯Nativeï¼‰å¹³å°å’ŒWebï¼ˆç›®æ ‡æ˜¯Wasmï¼‰å´æ— æ³•ä½¿ç”¨JDKçš„APIï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å¤šä½¿ç”¨Kotlinæ ‡å‡†åº“ä»¥åŠKotlinæ‰©å±•åº“ï¼ˆkotlinxï¼‰ï¼Œè¿™äº›APIéƒ½åšäº†å¤šå¹³å°é€‚é…ã€‚</p>

<h2>æ€»ç»“</h2>

<p>åˆ©ç›ŠäºGradleä¸­çš„æºç é›†åˆï¼ŒCMPå¯¹æºç çš„ç»“æ„æ˜¯å¾ˆå®½å®¹çš„ï¼Œå¹¶æ²¡æœ‰ä¸¥æ ¼çš„è¦æ±‚ï¼Œè¿™å¯¹äºç°æœ‰é¡¹ç›®æ¥è¯´æ˜¯ç›¸å½“å‹å¥½çš„ï¼Œå› ä¸ºæŠŠç°æœ‰çš„é¡¹ç›®æºç æ¬è¿›æ¥å°±å¯ä»¥äº†ï¼Œä¸ç”¨æ”¹å¤ªå¤šï¼Œç„¶åé€šè¿‡æºç é›†åˆæ¥åšå…·ä½“çš„æŒ‡å®šå’Œé€»è¾‘ä¸Šçš„å…³ç³»å¤„ç†ã€‚æ¯ä¸ªæºç é›†åˆå…¶å®éƒ½æ˜¯å…¶å¹³å°çš„ä¸€ä¸ªæ ‡å‡†é¡¹ç›®ï¼ŒæŠŠcommonä½œä¸ºå…¶ä¾èµ–è€Œå·²ï¼Œå…³ç³»å°±è¿™ä¹ˆç®€å•ï¼Œç”šè‡³è¿˜å¯ä»¥ç”¨å…¶å¹³å°çš„åŸç”Ÿæ–¹å¼å»å†™UIï¼Œå†™é€»è¾‘ï¼Œè¿™éƒ½æ˜¯å¯ä»¥çš„ã€‚</p>

<p>è™½ç„¶è¿™æ ·åšè²Œä¼¼ä¼šå¤±å»å…±äº«ä»£ç å’Œé€»è¾‘çš„æ„ä¹‰ï¼Œä½†æ˜¯è¿™å¯¹æ”¹é€ ç°æœ‰é¡¹ç›®æ˜¯ååˆ†å‹å¥½çš„ï¼Œæ¯”å¦‚ç¬¬ä¸€æ­¥å¯èƒ½æ˜¯æŠŠAndroidé¡¹ç›®å’ŒiOSé¡¹ç›®å…ˆèåˆè¿›æ¥ï¼Œç„¶åå†æ…¢æ…¢çš„æŠŠä¸¤ä¸ªå¹³å°çš„å…±äº«ä»£ç æŠ½ç¦»å‡ºæ¥å…¥è¿›commonã€‚è¿™æ ·åšä¸ä½†èƒ½æ…¢æ…¢æ¨è¿›è·¨ç«¯ï¼Œæ¯ä¸ªé¡¹ç›®å„è‡ªä»æ˜¯å®Œæ•´çš„ï¼Œå¦‚æœæœ‰ç´§æ€¥ çš„äº‹æƒ…ä»å¯å…ˆç”¨åŸç”Ÿæ–¹å¼å»å¼€å‘æ„å»ºã€‚</p>

<h2>References</h2>

<ul>
<li><a href="https://kotlinlang.org/docs/multiplatform-add-dependencies.html">Adding dependencies on multiplatform libraries</a></li>
<li><a href="https://kotlinlang.org/docs/gradle-configure-project.html#configure-dependencies">Configure dependencies</a></li>
<li><a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-connect-to-apis.html">Use platform-specific APIs</a></li>
<li><a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/compose-multiplatform-resources.html">Resources overview</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[èµ¶ç´§ä¸Šè½¦å¼€å¯Composeå¤§å‰ç«¯ä¹‹è·¯]]></title>
    <link href="https://alexhilton.github.io/blog/2024/11/17/compose-multiplatform-made-easy/"/>
    <updated>2024-11-17T20:33:51+08:00</updated>
    <id>https://alexhilton.github.io/blog/2024/11/17/compose-multiplatform-made-easy</id>
    <content type="html"><![CDATA[<p>åœ¨<a href="https://juejin.cn/column/7367555191338467337">å‰é¢çš„æ–‡ç« ä¸­</a>ï¼Œæˆ‘ä»¬ä¸€å†å¼ºè°ƒJetpack Composeæ˜¯ä¸€ä¸ªå£°æ˜å¼çš„UIæ¡†æ¶ï¼Œå°½ç®¡æˆ‘ä»¬éƒ½æ˜¯åŸºäºAndroidå¼€å‘æ¥å®æˆ˜çš„ï¼Œä½†Composeå¹¶ä¸å±€é™äºAndroidå¼€å‘ï¼Œå®ƒå…¶å®ä¸ç‰¹å®šçš„å¼€å‘å¹³å°æ²¡æœ‰å…³ç³»ï¼Œæ˜¯å¯ä»¥åšåˆ°è·¨å¹³å°å¼€å‘çš„ã€‚äº‹å®ä¸ŠJetBrainsæ—©å°±å·²ç»å‡†å¤‡å¥½äº†ä¸€å¥—å·¥å…·ï¼Œä»¥è®©Composeè·¨å¹³å°ï¼Œå¼€å‘å¤šç«¯åº”ç”¨ï¼Œè·»èº«äºå¤§å‰ç«¯çš„ä¸€å‘˜ã€‚ä»Šå¤©å°±æ¥å­¦ä¹ ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨Composeè¿›è¡Œå¤§å‰ç«¯å¼€å‘ã€‚</p>

<p><a href="https://alexhilton.github.io/blog/2024/11/17/compose-multiplatform-made-easy/"><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/j9tap6mygsqvxh6aauc8.png" title="auto auto" ></a></p>

<!-- more -->


<h2>ç¼˜èµ·</h2>

<p>æ—¶å…‰èè‹’ï¼Œç™½äº‘è‹ç‹—ï¼Œè‡ªä¹”å¸®ä¸»å‘å¸ƒiPhoneå¼€å¯ç§»åŠ¨äº’ç½‘è”è‡³ä»Šå·²æœ‰åä½™è½½ã€‚å¯¹äºäº’è”ç½‘åº”ç”¨æ¥è¯´ï¼Œæ—©å·²ä»æœ€åˆçš„AndroidåŠ iOSä¸¤ç«¯å¹¶è¡Œï¼Œå‘å±•åˆ°ç°åœ¨çš„å¤§å‰ç«¯æ—¶ä»£ã€‚æ—¶è‡³ä»Šæ—¥ï¼Œä¸è®ºå¤§å‚å°å‚ï¼Œå¤šç«¯æ‹‰é½ï¼ˆWebï¼ŒAndroid, iOS, Desktopï¼Œé¸¿è’™ï¼‰å·²ç»æ˜¯ä¸€ä¸ªæ ‡é…å’Œå¼ºéœ€æ±‚ã€‚é‚£ä¹ˆå¦‚ä½•å‡å°‘å¤šç«¯çš„é‡å¤å¼€å‘ï¼Œå¦‚ä½•è·¨å¤šç«¯å¼€å‘å°±æˆäº†ä¸€ä¸ªæ°¸ä¸è¿‡æ—¶çš„ç ”ç©¶æ–¹å‘ã€‚ä»æœ€åˆçš„Mobile H5ï¼Œåˆ°Hybrid Appï¼Œå†åˆ°React Nativeï¼Œå†åˆ°åæ¥çš„Flutterï¼Œå¤§å‰ç«¯å·²ç»å¾—åˆ°äº†é•¿è¶³çš„å‘å±•ã€‚å¾—ç›ŠäºKotlin Multiplatformï¼ˆKMPï¼‰ï¼ŒComposeä¹Ÿæœ‰äº†è·¨ç«¯çš„èƒ½åŠ›ï¼Œè·»èº«äºå¤§å‰ç«¯å·¥å…·ä¹‹åˆ—ã€‚</p>

<p>åœ¨æ·±å…¥ä¸»é¢˜å­¦ä¹ ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ç†è§£ä¸€ä¸‹é‡è¦çš„æ¦‚å¿µã€‚</p>

<h2>æ¦‚å¿µç†è§£</h2>

<p>ä¸ºäº†é¿å…æ··æ·†å’ŒåŠ å¼ºç†è§£ï¼Œéœ€è¦å¯¹ä¸€äº›æ¦‚å¿µè¿›è¡Œæ¾„æ¸…ã€‚</p>

<table>
<thead>
<tr>
<th style="text-align:left;"> æ¦‚å¿µ </th>
<th style="text-align:left;"> ç¼©å†™ </th>
<th style="text-align:left;"> è¯´æ˜ </th>
<th style="text-align:left;"> å¼€å‘è€… </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;"> Jetpack Compose </td>
<td style="text-align:left;"> Compose </td>
<td style="text-align:left;"> åŸºäºKotlinè¯­è¨€çš„å£°æ˜å¼UIå¼€å‘æ¡†æ¶ï¼Œä¸å¹³å°æ— å…³ï¼Œæºäºä»¥åŠä¸»è¦ç”¨äºAndroidå¼€å‘ </td>
<td style="text-align:left;"> Google </td>
</tr>
<tr>
<td style="text-align:left;"> Compose Multiplatform </td>
<td style="text-align:left;"> CMP </td>
<td style="text-align:left;"> ç”¨äºæŠŠComposeè½¬åŒ–ä¸ºå¤šç«¯çš„ä¸€ä¸ªæ¡†æ¶ </td>
<td style="text-align:left;"> JetBrains </td>
</tr>
<tr>
<td style="text-align:left;"> Kotlin Multiplatform </td>
<td style="text-align:left;"> KMP </td>
<td style="text-align:left;"> æŠŠKotlinç¼–è¯‘ä¸ºå¤šç«¯çš„æ¡†æ¶ï¼Œè¿™æ˜¯Composeèƒ½è·¨å¹³å°çš„æ ¹åŸº </td>
<td style="text-align:left;"> JetBrains </td>
</tr>
</tbody>
</table>


<p>ä¸ºäº†ç®€ä¾¿ï¼Œåœ¨åæ–‡ä»¥åŠä»¥åçš„æ–‡ç« ä¸­å°†ä½¿ç”¨ç¼©å†™ã€‚è™½ç„¶ä¸¥æ ¼æ¥è¯´CMPä¸“æŒ‡æŠŠComposeè½¬åŒ–ä¸ºå¤šç«¯çš„UIæ¡†æ¶ï¼Œä½†å¤§éƒ¨åˆ†åœºåˆä¹Ÿç”¨å®ƒæ¥ä»£æŒ‡Composeè·¨ç«¯å¼€å‘ï¼Œåé¢ä¹Ÿä¼šè¿™æ ·ç”¨ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong> åœ¨æ—©äº›æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯åœ¨JetBrainsåˆšæ¨å‡ºKMPçš„æ—¶å€™ï¼Œä»…é’ˆå¯¹å’Œæ”¯æŒAndroidå’ŒiOSä¸¤ä¸ªå¹³å°ï¼Œæ‰€ä»¥å½“æ—¶å°±å«åšKotlin Multiplatform Mobileï¼Œç¼©å†™ä¸ºKMMï¼Œåæ¥ä¹Ÿèƒ½ç¼–è¯‘å‡ºæ¡Œé¢ï¼ˆDesktopï¼‰å’ŒWebç«¯äº†ï¼Œå°±æŠŠMobileå»æ‰äº†ï¼Œå°±æ˜¯ç°åœ¨çš„KMPï¼Œä»£è¡¨Kotlin Multiplatformã€‚æ‰€ä»¥ï¼Œå¦‚æœ åœ¨å…¶ä»–åœ°æ–¹çœ‹åˆ°äº†KMMï¼ŒæŠŠå®ƒå½“æˆKMPå°±å¯ä»¥äº†ã€‚</p>

<h2>Composeå¤§å‰ç«¯æŠ€æœ¯æ ˆ</h2>

<p>åœ¨ç»§ç»­æ·±å…¥ä¹‹å‰ï¼Œæ‹æ‹æŠ€æœ¯æ ˆï¼Œä»å¤§çš„è§’åº¦æ¥äº†è§£ä¸€ä¸‹ç”¨åˆ°çš„æŠ€æœ¯å·¥å…·çš„å…³ç³»æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</p>

<p>ä»æ˜¯ç”¨Jetpack Composeæ¥å†™UIï¼Œç”¨Kotlinæ¥å†™ä¸šåŠ¡é€»è¾‘ï¼Œè¿™æ˜¯ä¸ªæ˜¯æ²¡æœ‰å˜çš„ã€‚è€ŒCompose Multiplatformï¼ˆCMPï¼‰ç›¸å½“äºæ˜¯ä¸€ä¸ªè½¬æ¢å·¥å…·ï¼Œèƒ½æŠŠComposeå†™çš„UIè½¬å˜æˆä¸ºä¸åŒå¹³å°çš„UIå®ç°ã€‚ç¼–ç¨‹è¯­è¨€ç”¨çš„æ˜¯éƒ½æ˜¯Kotlinï¼Œæœ€ç»ˆè¦ä¾èµ–KMMç¼–è¯‘å‡ºå…·ä½“å¹³å°çš„ç›®æ ‡æ–‡ä»¶ï¼ˆTargetï¼‰ã€‚æ‰€ä»¥ï¼Œå®ƒä»¬ä¸‰ä¸ªæ˜¯ä¾èµ–å…³ç³»Composeä¾èµ–CMPï¼Œå®ƒä»¬åˆéƒ½ä¾èµ–KMMã€‚</p>

<p>æœ€å…ˆå‡ºç°çš„å½“ç„¶æ˜¯ç¼–ç¨‹è¯­è¨€Kotlinï¼Œä¹‹åGoogleæ¨å‡ºäº†å£°æ˜å¼UIæ¡†æ¶Jetpack Composeï¼Œé‡‡ç”¨äº†Kotlinè¯­è¨€ã€‚éšç€Kotlinçš„å‘å±•ï¼ŒJetBrainsæ¨å‡ºäº†KMPï¼Œè®©Kotlinå®ç°è·¨å¤šç«¯ï¼Œåœ¨è¿™ä¹‹ååˆåŸºäºComposeï¼Œæ¨å‡ºäº†CMPï¼Œå› ä¸ºéƒ½æ˜¯Kotlinè¯­è¨€ï¼Œä¸KMPä¸€èµ·å‡‘æˆäº†Compose/Kotlinçš„è·¨ç«¯ã€‚ç°åœ¨è°·æ­Œä¹Ÿä¸JetBrainsç´§å¯†çš„åˆä½œï¼Œä¸€èµ·åŠªåŠ›æŠŠComposeå¾€å‰æ¨è¿›ï¼Œå»æŒ‘æˆ˜React Nativeå’ŒFlutterã€‚</p>

<p>å­¦ä¹ æˆæœ¬å¹¶ä¸é«˜ï¼Œå› ä¸ºå¯¹äºå¼€å‘è€…æ¥è¯´ä»æ—§æ˜¯Composeå’ŒKotlinï¼ŒCMPå’ŒKMPæ˜¯é€æ˜çš„ï¼Œå®ƒä»¬ä»¥æ’ä»¶å’Œä¾èµ–åº“çš„å½¢å¼å­˜åœ¨ï¼Œæ²¡æœ‰é¢å¤–çš„å­¦ä¹ æˆæœ¬ã€‚å½“ç„¶ï¼Œè¿™å¯¹Androidå¼€å‘åŒå­¦æ¥è¯´æ›´ä¸ºå‹å¥½ä¸€äº›ï¼Œå› ä¸ºå¤§éƒ¨åˆ†Androidå¼€å‘åŒå­¦æ—©å·²æŒæ¡äº†Composeå’ŒKotlinã€‚</p>

<h2>å¼€å‘ç¯å¢ƒæ­å»º</h2>

<p>CMPçš„æŠ€æœ¯æ ˆå¹¶ä¸å¤æ‚ï¼Œå¦‚æœå·²å…·å¤‡Androidå¼€å‘ç¯å¢ƒï¼Œé‚£åŸºæœ¬ä¸Šå°±é½æ´»å„¿äº†ï¼Œè¿™å†æ¬¡è¯´æ˜CMPå¯¹Androidå¼€å‘åŒå­¦æ˜¯ç›¸å½“å‹å¥½çš„ã€‚å¼€å‘ç”¨çš„IDEå°±æ˜¯Android Studioï¼Œç¼–è¯‘å·¥å…·ç”¨çš„æ˜¯Gradleï¼Œè¿™å¯¹AndroidåŒå­¦æ¥è¯´å·²ç»æ˜¯æ ‡é…äº†ï¼Œä¸ç†Ÿæ‚‰çš„åŒå­¦å¯è‡ªè¡ŒGoogleã€‚</p>

<p>å”¯ä¸€éœ€è¦å®‰è£…çš„å°±æ˜¯KMPçš„æ’ä»¶ï¼ˆpluginï¼‰ï¼Œä¹Ÿå³Android Studioä¸­ï¼Œåˆ°æ’ä»¶å¸‚åœºæœç´¢Kotlin Multiplatformï¼Œè¿™æ˜¯JetBrainså®˜æ–¹æä¾›çš„æ’ä»¶ï¼Œæ‰¾åˆ°åå¯æ”¾å¿ƒå®‰è£…ï¼Œä¹‹åé‡å¯ASå³å¯ã€‚</p>

<p>ä»¥ä¸Šæ˜¯é€šç”¨å¼€å‘é…ç½®ï¼Œä½†å¦‚æœç›®æ ‡å¹³å°æ˜¯iOSå°±ç•¥éº»çƒ¦ä¸€äº›ã€‚æ­¤å°èŠ‚åé¢çš„å†…å®¹ï¼Œä»…å½“ç›®æ ‡å¹³å°åŒ…å«iOSæ—¶éœ€è¦ï¼Œå¦åˆ™å¯ä»¥è·³è¿‡ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong> Macè™½ç„¶ä¹Ÿæ˜¯æ°´æœç³»ç»Ÿï¼Œä½†Macå±äºæ¡Œé¢ç«¯ï¼ˆDesktopï¼‰ï¼Œå¦‚æœä¸ºMacæ„å»ºåº”ç”¨è¦é€‰æ‹©Desktopä¸ºç›®æ ‡å¹³å°ã€‚</p>

<p>å› ä¸ºæ°´æœçš„ç”Ÿæ€æ˜¯å°é—­çš„ï¼Œè¦æƒ³æ„å»ºiOSå°±å¿…é¡»è¦ç”¨Xcodeï¼Œè€ŒXcodeåªåœ¨Macä¸Šé¢æ‰èƒ½ç”¨ï¼Œæ‰€ä»¥è¦æƒ³æ„å»ºiOSç«¯åº”ç”¨ï¼Œå¿…é¡»è¦ç”¨Macæ¥å¼€å‘ï¼Œè€Œä¸”è¦æ˜¯æ–°ä¸€ç‚¹çš„Macï¼ˆä¸‰å¹´ä»¥å†…ï¼‰ã€‚ç„¶åå®‰è£…æœ€æ–°çš„Xcodeå°±å·®ä¸å¤šäº†ï¼Œå®˜æ–¹æä¾›äº†ä¸€ä¸ªMacä¸Šä¸ºiOSç¯å¢ƒçš„æ£€æŸ¥å·¥å…·kdoctorï¼ˆç”¨brew install kdoctoræ¥å®‰è£…ï¼‰ï¼Œä½†å…¶å®å¦‚æœé…ç½®äº†Androidå¼€å‘ç¯å¢ƒåï¼Œå†è£…ä¸ŠXcodeå°±å¤Ÿäº†ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong> å¦‚æœæ˜¯æ¯”è¾ƒæ—§çš„Macï¼ŒBig Surä»¥å‰çš„ï¼Œå°±ä¸ç”¨å†æŠ˜è…¾äº†ï¼Œæ— æ³•æ„å»ºiOSï¼Œå› ä¸ºæ„å»ºiOSéœ€è¦Xcode 12.5ï¼Œè€Œ<a href="https://developer.apple.com/support/xcode/">Xcode 12.5åˆè‡³å°‘éœ€è¦macOS 11.7ï¼ˆå³Big Surï¼‰</a>ã€‚ç¯å¢ƒæ£€æŸ¥å·¥å…·kdoctoræœ¬èº«ä¹Ÿæ˜¯è¦æ±‚Xcode 12.5ä»¥ä¸Šï¼Œå»ºè®®åœ¨å®‰è£…ä¹‹å‰å¯ä»¥å…ˆç”¨brew info kdoctoræ¥æ£€æŸ¥ä¸€ä¸‹ã€‚æ°´æœå°±è¿™ç‚¹ä¸å¥½ï¼Œç¡¬ä»¶å’Œè½¯ä»¶æ›´æ–°éƒ½ç‰¹åˆ«å¿«ï¼Œå‘åå…¼å®¹åˆä¸å‹å¥½ï¼Œæœ€å¤šæ”¯æŒä¸‰ä¸ªç‰ˆæœ¬ï¼ˆæ—¶é—´è·¨åº¦åœ¨3å¹´å·¦å³ï¼‰ã€‚</p>

<h2>åˆ›å»ºä¸€ä¸ªå¤šç«¯åº”ç”¨</h2>

<p>ç¯å¢ƒé…ç½®å¥½åï¼Œå°±å¯ä»¥å¼€å§‹åˆ›å»ºCMPäº†ï¼Œå®˜æ–¹æä¾›äº†ä¸€ä¸ª<a href="https://kmp.jetbrains.com/?_gl=1*271nsz*_gcl_au*MTE5MzE4NTY0NS4xNzMxMzIzNDU3*_ga*MzUyNjc2MzcuMTU5NDM3NDQ0MA..*_ga_9J976DJZ68*MTczMTQwMDc1MC4xOC4wLjE3MzE0MDA3NTAuNjAuMC4w">KMPé¡¹ç›®åˆ›å»ºå‘å¯¼</a>å¯ä»¥æ–¹ä¾¿çš„ç”Ÿæˆä¸€ä¸ªé¡¹ç›®æ¨¡æ¿ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å°±æ˜¯ï¼Œå¦‚æœè¦æ„å»ºiOSï¼Œä¸€å®šè¦å‹¾é€‰ã€Share UIã€ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong> è¦æƒ³æ„å»ºiOSç›®æ ‡éœ€è¦è¾ƒæ–°çš„Macæ‰å¯ä»¥ï¼Œå¦‚æœå¼€å‘ç¯å¢ƒä¸æ˜¯Macï¼Œæˆ–è€…Macè¾ƒæ—§ï¼Œå°±ä¸ç”¨é’©é€‰iOSäº†ï¼Œå› ä¸ºé€‰äº†ä¹Ÿæ— æ³•æ„å»ºå‡ºæ¥å’Œè¿è¡Œç›®æ ‡äº§ç‰©ã€‚</p>

<p><img src="https://resources.jetbrains.com/help/img/kotlin-multiplatform-dev/multiplatform-web-wizard.png" alt="å›¾1. CMPé¡¹ç›®åˆ›å»ºå‘å¯¼" /></p>

<p>åœ¨åˆ›å»ºå‘å¯¼ä¸­é…ç½®å¥½åï¼Œç‚¹å‡»ä¸‹è½½å°±å¯ä»¥äº†ã€‚è§£å‹ä¹‹åï¼Œç”¨Android Studioæ‰“å¼€ï¼ˆFile | Openï¼‰é¡¹ç›®æ–‡ä»¶ï¼Œå°±å¯ä»¥å¼€å§‹CMPçš„å¼€å‘äº†ã€‚æ³¨æ„ï¼Œè¦ç›´æ¥æ‰“å¼€è§£å‹å‡ºæ¥çš„æ ¹ç›®å½•ï¼Œè€Œä¸æ˜¯é‡Œé¢çš„æŸä¸ªå­ç›®å½•ã€‚å› ä¸ºASæ‰“å¼€çš„é¡¹ç›®é»˜è®¤ä½¿ç”¨ä¸“ä¸ºAndroidå¼€å‘ä¼˜åŒ–åçš„è§†å›¾ç»“æ„ã€ŒAndroidã€ï¼Œä¸ºäº†æ›´æ–¹ä¾¿éœ€è¦åˆ‡æ¢ä¸ºã€ŒProjectã€ã€‚</p>

<p>å¯ä»¥çœ‹ä¸€çœ¼é¡¹ç›®ç»“æ„ï¼Œä¸å¸¸è§„çš„Androidé¡¹ç›®ç›¸æ¯”å·®ä¸å¤šï¼ŒåŒ…å«äº†ä¸¤ä¸ªæ¨¡å—ï¼ˆmoduleï¼‰ï¼š</p>

<ul>
<li>composeApp è¿™æ˜¯æœ€ä¸»è¦çš„æ¨¡å—ï¼Œå¯ä»¥è¯´ä¸œè¥¿éƒ½åœ¨è¿™é‡Œé¢ã€‚å®ƒæ˜¯ä¸€ä¸ªKotlinæ¨¡å—ï¼ˆKotlin moduleï¼‰ï¼ŒåŒ…å«äº†å¤šç«¯å…±ç”¨ä»£ç ï¼Œä»¥åŠä¸åŒå¹³å°çš„å®šåˆ¶ä»£ç ã€‚ä½¿ç”¨Gradleæ¥æ„å»ºï¼Œç”¨Gradleçš„è„šæœ¬æ¥æè¿°æ„å»ºæ–¹å¼ã€‚</li>
<li>iosApp è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„Xcodeé¡¹ç›®ï¼Œä¸»è¦ç”¨äºæ„å»ºiOSç›®æ ‡ï¼Œå®ƒä¼šä¾èµ–äºcomposeAppã€‚</li>
</ul>


<p><strong>æ³¨æ„ï¼š</strong> å¦‚æœåœ¨<a href="https://kmp.jetbrains.com/?_gl=1*zmaxre*_gcl_au*NDM5ODU1NDAyLjE3Mjc1OTk1MDU.*_ga*MzEyMDU2NTg5LjE2NzQwMDg5NjM.*_ga_9J976DJZ68*MTczMTQwMTE0NC45NC4xLjE3MzE0MDExNDguNTYuMC4w">é¡¹ç›®åˆ›å»ºå‘å¯¼</a>ä¸­æ²¡æœ‰é’©é€‰iOSï¼Œå°†ä¸ä¼šæœ‰æ¨¡å—iosAppï¼Œä»¥åŠcomposeAppä¸­çš„iosMainã€‚</p>

<p><img src="file:///Users/alexhilton/Downloads/compose_libs/cmp-structure.png" alt="å›¾2. é¡¹ç›®ç»“æ„" /></p>

<p>é‡ç‚¹éœ€è¦å…³æ³¨<strong>composeApp</strong>ï¼Œå®ƒåŒ…å«äº†å‡ ä¸ªæºç é›†åˆï¼ˆsource setsï¼‰ï¼š</p>

<ul>
<li>commonMain è¿™æ˜¯æœ€ä¸»è¦çš„é›†åˆï¼ŒåŒ…å«å…±äº«ä»£ç ï¼Œç”±ä¸€ä¸ªcomposableå‡½æ•°ä½œä¸ºå…¥å£å¼€å§‹ï¼ˆå¦‚App()ï¼‰å¼€å§‹ã€‚è¿™é‡Œåº”è¯¥æ˜¯é¡¹ç›®çš„ä¸»è¦ä»£ç é›†åˆã€‚</li>
<li>androidMain åŒ…å«ä¸Androidå¹³å°ç›¸å…³çš„ä»£ç ï¼ŒåŒ…æ‹¬å…¥å£ï¼ˆå¦‚Android manifestå’ŒActivityï¼‰ï¼Œå…¥å£ä¼šè°ƒç”¨commonMainä¸­çš„å…¥å£composableã€‚ä»¥åŠæä¾›å¹³å°ç‰¹å®šçš„å®šåˆ¶åŒ–å®ç°ã€‚</li>
<li>desktopMain æ¡Œé¢ç«¯çš„å…¥å£ï¼Œä»¥åŠå®šåˆ¶åŒ–å®ç°ã€‚</li>
<li>iosMain æ°´æœç§»åŠ¨ç«¯çš„å…¥å£ï¼Œä»¥åŠå®šåˆ¶åŒ–å®ç°ã€‚</li>
<li>wasmJsMain Webç«¯çš„å…¥å£ï¼Œä»¥åŠå®šåˆ¶åŒ–å®ç°ã€‚</li>
</ul>


<p><strong>æ³¨æ„ï¼š</strong> æºç é›†çš„å…·ä½“æ•°é‡å–å†³äºåˆ›å»ºé¡¹ç›®æ—¶é’©é€‰çš„ç›®æ ‡å¹³å°ã€‚</p>

<p>æºç é›†åˆï¼ˆsource setï¼‰æ„å»ºå·¥å…·Gradleçš„ä¸€ä¸ªæ¦‚å¿µï¼Œå®ƒåŒ…å«é€»è¾‘ä¸Šç›¸å…³çš„ä¸€å¨æºç æ–‡ä»¶ï¼Œèµ„æºæ–‡ä»¶ï¼Œä»¥åŠå…¶ä¾èµ–ï¼Œå¯¹äºAndroidå¼€å‘åŒå­¦æ¥è¯´è¿™ä¸ªæ¦‚å¿µå¹¶ä¸é™Œç”Ÿã€‚</p>

<p><img src="https://resources.jetbrains.com/help/img/kotlin-multiplatform-dev/module-structure.png" alt="å›¾3. é¡¹ç›®æºç é›†åˆå…³ç³»" /></p>

<p>è¿™ç§é¡¹ç›®æºç é›†åˆå…³ç³»æ˜¯ç”±KMPå®šä¹‰çš„ï¼Œç¼–è¯‘æ„å»ºçš„æ—¶å€™commonéƒ¨åˆ†ä¼šç¼–è¯‘æˆä¸ºä¸€ä¸ªä¾èµ–ç»„ä»¶ï¼Œå¹³å°éƒ¨åˆ†æŠŠcommonå½“æˆä¸€ä¸ªä¾èµ–ä½¿ç”¨ï¼Œç„¶åæœ€ç»ˆæ„å»ºå‡ºç›®æ ‡äº§ç‰©ï¼Œè¯¦ç»†çš„è¿‡ç¨‹å¯ä»¥<a href="https://kotlinlang.org/docs/multiplatform-discover-project.html">çœ‹KMPçš„æ–‡æ¡£</a>ã€‚</p>

<p>è¿™ä¸ªæ¨¡æ¿æœ‰é»˜è®¤çš„é¡µé¢ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ï¼Œæ‰“å¼€æ–‡ä»¶commonMainä¸­çš„App.ktï¼Œå®ƒåŒ…å«ä¸€ä¸ªcomposableå‡½æ•°App()ï¼Œè¿™å°±æ˜¯CMPçš„å…¥å£ï¼Œå¯ä»¥ä»è¿™é‡Œå¼€å§‹ç”¨Composeå†™åº”ç”¨äº†ã€‚</p>

<h2>æ„å»ºä¸è¿è¡Œ</h2>

<p>é¡¹ç›®åˆ›å»ºå‘å¯¼åˆ›å»ºå‡ºæ¥çš„æ¨¡æ¿é¡¹ç›®ï¼ŒåŒ…å«äº†åŸºæœ¬çš„é¡µé¢ï¼Œå¯ä»¥ç›´æ¥æ„å»ºå’Œè¿è¡Œã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong> é¦–æ¬¡æ‰“å¼€é¡¹ç›®ä¼šæ¯”è¾ƒæ…¢ï¼Œè¿™æ˜¯å› ä¸ºè¦ä¸‹è½½Gradleå·¥å…·é“¾ä»¥åŠé¡¹ç›®çš„ä¾èµ–ï¼Œè§†ç½‘ç»œæƒ…å†µï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿåˆ°åå‡ åˆ†é’Ÿä¸ç­‰ï¼Œä¹‹åå°±èƒ½ç§’å¼€ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong> åˆ›å»ºå‡ºæ¥çš„é¡¹ç›®ä¾èµ–ç”¨çš„éƒ½æ¯”è¾ƒæ–°ï¼Œæ¯”å¦‚åƒAndroidå¼€å‘æ’ä»¶AGPå¯èƒ½ä¼šç”¨8.5.2ï¼Œä½†AGPçš„ç‰ˆæœ¬å—åˆ¶äºAndroid Studioï¼Œ<a href="https://developer.android.com/build/releases/gradle-plugin#android_gradle_plugin_and_android_studio_compatibility">AGPä¸ASçš„å…¼å®¹å¯¹åº”å…³ç³»å¯ä»¥çœ‹è¿™é‡Œ</a>ã€‚å¦‚æœä½¿ç”¨çš„ASç‰ˆæœ¬è¾ƒæ—§ï¼Œéœ€è¦è°ƒæ•´AGPçš„ç‰ˆæœ¬ã€‚</p>

<p>å¾…Gradle syncå®Œæˆä¹‹åï¼Œå°±å¯ä»¥è¿è¡Œäº†ã€‚</p>

<h3>è¿è¡ŒAndroid app</h3>

<p>å¯¹äºAndroid appæ¥è¯´å¯ä»¥ç›´æ¥è¿è¡Œï¼Œåœ¨è¿è¡Œé…ç½®é‚£é‡Œé€‰æ‹©ã€ŒcomposeAppã€ï¼Œè¿ä¸Šæ‰‹æœºï¼ˆæˆ–è€…æ¨¡æ‹Ÿå™¨ï¼‰ï¼Œè¿è¡Œå°±å¯ä»¥äº†ã€‚</p>

<p><img src="https://resources.jetbrains.com/help/img/kotlin-multiplatform-dev/compose-run-android.png" alt="å›¾4. è¿è¡ŒAndroid app" /></p>

<h3>è¿è¡Œæ¡Œé¢ç«¯ï¼ˆDesktopï¼‰App</h3>

<p>æ¡Œé¢ç«¯æ²¡æœ‰é»˜è®¤è¿è¡Œé…ç½®ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªã€‚åœ¨èœå•ä¸­ç¼–è¾‘è¿è¡Œé…ç½®ï¼ˆRun | Edit Configurationsï¼‰ï¼Œç‚¹å·¦ä¸Šçš„åŠ å·ï¼Œé€‰æ‹©ã€ŒGradleã€ï¼Œè¾“å…¥ä¸ªåå­—å¦‚ã€ŒdesktopRunã€ï¼Œç„¶ååœ¨é…ç½®é‚£ä¸€ä¾§ä¸­çš„ã€ŒTasks and argumentsã€è¾“å…¥ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='Bash'><span class='line'>composeApp:run
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://resources.jetbrains.com/help/img/kotlin-multiplatform-dev/compose-run-desktop-temp.png" alt="å›¾5. è¿è¡Œæ¡Œé¢ç«¯App" />
ä¹‹åï¼Œé€‰æ‹©ã€ŒdesktopRunã€è¿è¡Œå³å¯ã€‚</p>

<h3>è¿è¡ŒiOS app</h3>

<p>å¦‚æœé€‰æ‹©äº†iOSçš„è¯ï¼Œä¹Ÿæœ‰é»˜è®¤è¿è¡Œé…ç½®ï¼Œå¯ç›´æ¥è¿è¡Œã€‚ä½†æ°´æœçš„ä¸œè¥¿å¿…é¡»ä¾èµ–äºæ°´æœçš„å·¥å…·ï¼Œæ‰€ä»¥è¦å…ˆæ‰“å¼€Xcodeï¼Œæ‰“å¼€å°±è¡Œï¼Œæ”¾åœ¨ä¸€è¾¹ä¸ç”¨åšå•¥ã€‚ç„¶åå›åˆ°ASï¼Œé€‰æ‹©ã€ŒiosAppã€ï¼Œè¿è¡Œï¼Œå¦‚æœé¡ºåˆ©ï¼Œåœ¨Xcodeé‚£å¤´å°±ä¼šå¯åŠ¨iOSçš„æ¨¡æ‹Ÿå™¨ï¼Œå¹¶è¿è¡ŒAppäº†ã€‚</p>

<p><img src="https://resources.jetbrains.com/help/img/kotlin-multiplatform-dev/compose-run-ios.png" alt="å›¾6. è¿è¡ŒiOS app" /></p>

<p><strong>æ³¨æ„ï¼š</strong> è¦æƒ³è¿è¡ŒiOSï¼ŒXcodeç‰ˆæœ¬å¿…é¡»è¦åœ¨12.5ä»¥ä¸Šï¼Œå› ä¸ºiOSæ„å»ºæ–¹å¼æ˜¯åŸºäºXcode 12.5çš„ã€‚</p>

<h2>è¿è¡ŒWeb app</h2>

<p>Webç«¯ä¹Ÿæ²¡æœ‰é»˜è®¤é…ç½®ï¼Œéœ€è¦åƒæ¡Œé¢ç«¯é‚£æ ·åˆ›å»ºä¸€ä¸ªï¼ŒåŒæ ·æ˜¯Gradleï¼ŒåŒºåˆ«åœ¨äºå‘½ä»¤ä¸ä¸€æ ·ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='Bash'><span class='line'>wasmJsBrowserRun -t --quiet
</span></code></pre></td></tr></table></div></figure>


<p><img src="https://resources.jetbrains.com/help/img/kotlin-multiplatform-dev/compose-run-web.png" alt="å›¾7. è¿è¡ŒWeb app" />
ç„¶åï¼Œè¿è¡Œï¼Œè¿™ä¼šå¼€å¯ä¸€ä¸ªæœ¬åœ°serverï¼Œå¦‚æœæµè§ˆå™¨æ²¡æœ‰è‡ªåŠ¨æ‰“å¼€çš„è¯ï¼Œå°±æ‰‹åŠ¨æ‰“å¼€æµè§ˆå™¨ï¼Œå¹¶è¾“å…¥ã€Œlocalhost:8080ã€ï¼Œå°±èƒ½çœ‹åˆ°ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong> å¦‚æœå¼€å‘å¹³å°æ˜¯Macï¼Œè¿è¡ŒWeb appæ—¶ä¼šæœ‰ç¼–è¯‘é”™è¯¯ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='Bash'><span class='line'>Continuous build does not work when file system watching is disabled
</span></code></pre></td></tr></table></div></figure>


<p>å¯ä»¥é€šè¿‡ä¿®æ”¹æ„å»ºæŒ‡ä»¤å‚æ•°ï¼Œæ·»åŠ &#45;&#45;watch&#45;fsæ¥è§£å†³ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='Bash'><span class='line'>wasmJsBrowserRun -t --quiet --watch-fs
</span></code></pre></td></tr></table></div></figure>


<p>æˆ–è€…æ·»åŠ Gradleé€‰é¡¹ï¼Œä»¥å¯¹æ‰€æœ‰çš„æ„å»ºé…ç½®å‘½ä»¤éƒ½ç”Ÿæ•ˆï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='Bash'><span class='line'>org.gradle.vfs.watch<span class="o">=</span><span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½†æ˜¯ï¼Œæ— è®ºæ˜¯&#45;&#45;watch&#45;fsï¼Œè¿˜æ˜¯Gradleé€‰é¡¹ï¼Œå¯¹äºmacOS 12ï¼ˆMontereyï¼‰ä»¥åæ‰ç”Ÿæ•ˆï¼Œè¯¦è§<a href="https://docs.gradle.org/current/userguide/file_system_watching.html">Gradleæ–‡æ¡£</a>ã€‚</p>

<p>åˆ°æ­¤ï¼Œåº”è¯¥è¯´CMPçš„å¼€å‘å·²ç»å®Œå…¨å°±ä½äº†ã€‚</p>

<h2>æ€»ç»“</h2>

<p>CMPé…ç½®ç®€å•ï¼Œä¸Šæ‰‹è¾ƒå¿«ï¼Œå‰æ™¯å…‰æ˜ï¼Œç›¸ä¿¡é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ å¯ä»¥äº†è§£å¹¶å®Œå…¨ä¸Šè½¦CMPå¼€å‘äº†ï¼Œè¿˜ç­‰å•¥å‘¢èµ¶ç´§ä¸Šæ‰‹æ’¸ä¸€æ’¸å§ï¼</p>

<h2>References</h2>

<ul>
<li><a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/get-started.html">Get started with Kotlin Multiplatform</a></li>
<li><a href="https://kotlinlang.org/docs/multiplatform-intro.html">Introduction to Kotlin Multiplatform</a></li>
<li><a href="https://getstream.io/blog/build-app-kotlin-multiplatform/">Build Your First Android and iOS Mobile App With Kotlin Multiplatform</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
