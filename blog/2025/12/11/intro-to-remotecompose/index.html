
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>借助RemoteCompose开发动态化页面 - 稀有猿诉</title>
  <meta name="author" content="Alex Hilton">

  
  <meta name="description" content="本文将探讨 RemoteCompose 的概念，理解其核心架构，并探索它如何为 Jetpack Compose 的动态页面设计带来诸多优势。本文并非库的使用教程，而是着重探讨它所代表的 Android UI 开发范式转变。">
  <meta name="keywords" content="Jetpack Compose, Remote, Dynamic">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://alexhilton.github.io/blog/2025/12/11/intro-to-remotecompose">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="稀有猿诉" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script src="/javascripts/toolbar.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.lug.ustc.edu.cn/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.lug.ustc.edu.cn/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<!-- for Gitment -->
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">

<!-- for favicon -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">稀有猿诉</a></h1>
  
    <h2>十年磨一剑，历炼出锋芒，说话千百句，不如码二行。</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com.hk/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:alexhilton.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/donation">Donation</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">借助RemoteCompose开发动态化页面</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2025-12-11'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2025</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><blockquote><p>本文译自「RemoteCompose: Another Paradigm for Server-Driven UI in Jetpack Compose」，原文链接<a href="https://proandroiddev.com/remotecompose-another-paradigm-for-server-driven-ui-in-jetpack-compose-92186619ba8f">https://proandroiddev.com/remotecompose-another-paradigm-for-server-driven-ui-in-jetpack-compose-92186619ba8f</a>，由Jaewoong Eum发布于2025年11月29日。</p></blockquote>

<p><a href="/blog/2025/12/11/intro-to-remotecompose/"><img src="https://miro.medium.com/v2/resize:fit:2000/0*o9-kxXHKgJcB-Bvh" title="auto auto" ></a></p>

<!-- more -->


<p>构建动态用户界面一直是 Android 开发中的一项根本性挑战。传统方法要求每次 UI 需要更改时都必须重新编译和重新部署整个应用程序，这给 A/B 测试、功能开关和实时内容更新带来了极大的不便。</p>

<p>试想一下，你的营销团队想要测试一个新的结账按钮设计：在传统模式下，这种简单的更改需要开发人员花费时间、进行代码审查、QA 测试、提交到应用商店，以及等待数周才能获得用户采纳。RemoteCompose 的出现为解决这一问题提供了一个强大的方案，它使开发人员能够在运行时创建、传输和渲染 Jetpack Compose UI 布局，而无需重新编译。</p>

<p>本文将探讨 RemoteCompose 的概念，理解其核心架构，并探索它如何为 Jetpack Compose 的动态页面设计带来诸多优势。本文并非库的使用教程，而是着重探讨它所代表的 Android UI 开发范式转变。</p>

<h3><strong>集成与依赖</strong></h3>

<p>在深入探讨概念之前，我们先来了解如何将 RemoteCompose 添加到你的项目中。对于运行在 JVM 上且不依赖 Android 的服务器和后端：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="c1">// settings.gradle</span>
</span><span class='line'><span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">maven</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">url</span> <span class="o">=</span> <span class="n">uri</span><span class="o">(</span><span class="s2">&quot;https://androidx.dev/snapshots/builds/14511716/artifacts/repository&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// JVM server - no Android dependencies</span>
</span><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">implementation</span><span class="o">(</span><span class="s2">&quot;androidx.compose.remote:remote-core:1.0.0-SNAPSHOT&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="n">implementation</span><span class="o">(</span><span class="s2">&quot;androidx.compose.remote:remote-creation-compose:1.0.0-SNAPSHOT&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Compose-based app</span>
</span><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">implementation</span><span class="o">(</span><span class="s2">&quot;androidx.compose.remote:remote-player-compose:1.0.0-SNAPSHOT&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="n">implementation</span><span class="o">(</span><span class="s2">&quot;androidx.compose.remote:remote-tooling-preview:1.0.0-SNAPSHOT&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// View-based app</span>
</span><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">implementation</span><span class="o">(</span><span class="s2">&quot;androidx.compose.remote:remote-player-view:1.0.0-SNAPSHOT&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>请注意，RemoteCompose 仍在由 AndroidX 团队开发中，尚未正式发布；它仅可通过 AndroidX 快照 Maven 仓库获取。</p>

<h3>理解核心抽象</h3>

<p>RemoteCompose 的核心是一个框架，它支持 Compose UI 组件的远程渲染。它与传统 UI 方法的区别在于它遵循两个基本原则：声明式文档序列化和平台无关渲染。这些不仅仅是技术特性；这些架构决策从根本上改变了你对 UI 部署的思考方式。</p>

<p><strong>声明式文档序列化</strong></p>

<p>声明式文档序列化意味着你可以将任何 Jetpack Compose 布局捕获为紧凑的序列化格式。你可以把它想象成对 UI 进行“截图”，只不过你捕获的不是像素，而是实际的绘图指令。这个捕获的文档包含了重建 UI 所需的一切：形状、颜色、文本、图像、动画，甚至还有交互式触摸区域。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// On the server or creation side</span>
</span><span class='line'><span class="k">val</span> <span class="py">document</span> <span class="p">=</span> <span class="n">captureRemoteDocument</span><span class="p">(</span>
</span><span class='line'>    <span class="n">context</span> <span class="p">=</span> <span class="n">context</span><span class="p">,</span>
</span><span class='line'>    <span class="n">creationDisplayInfo</span> <span class="p">=</span> <span class="n">displayInfo</span><span class="p">,</span>
</span><span class='line'>    <span class="n">profile</span> <span class="p">=</span> <span class="n">profile</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">RemoteColumn</span><span class="p">(</span><span class="n">modifier</span> <span class="p">=</span> <span class="n">RemoteModifier</span><span class="p">.</span><span class="n">fillMaxSize</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">RemoteText</span><span class="p">(</span><span class="s">&quot;Dynamic Content&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">RemoteButton</span><span class="p">(</span><span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span> <span class="cm">/* action */</span> <span class="p">})</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">RemoteText</span><span class="p">(</span><span class="s">&quot;Click Me&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>结果如何？一个可以通过网络发送的字节数组。这种方法的关键在于，创建端编写的是标准的 Compose 代码。无需学习新的 DSL，无需维护 JSON 模式，也无需掌握模板语言。只要可以用 Compose 编写，就可以用 RemoteCompose 捕获。</p>

<p>你可以捕获一个普通的 Compose 代码，它会捕获绘制调用（这些调用非常静态）。更常见的情况是，你应该拥有镜像 Compose 的 Remote* 专用 API，这些 API 专为序列化和远程播放而设计，例如 <code>RemoteColumn</code>、<code>RemoteButton</code>、<code>RemoteText</code> 等。</p>

<p><strong>平台无关渲染</strong></p>

<p>平台无关渲染意味着捕获的文档可以通过网络传输，并在任何 Android 设备上渲染，而无需原始的 Compose 代码。客户端设备不需要你的可组合函数、视图模型或业务逻辑——它只需要文档字节和一个播放器。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// On the client or player side</span>
</span><span class='line'><span class="n">RemoteDocumentPlayer</span><span class="p">(</span>
</span><span class='line'>    <span class="n">document</span> <span class="p">=</span> <span class="n">remoteDocument</span><span class="p">.</span><span class="n">document</span><span class="p">,</span>
</span><span class='line'>    <span class="n">documentWidth</span> <span class="p">=</span> <span class="n">windowInfo</span><span class="p">.</span><span class="n">containerSize</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
</span><span class='line'>    <span class="n">documentHeight</span> <span class="p">=</span> <span class="n">windowInfo</span><span class="p">.</span><span class="n">containerSize</span><span class="p">.</span><span class="n">height</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onAction</span> <span class="p">=</span> <span class="p">{</span> <span class="n">actionId</span><span class="p">,</span> <span class="n">value</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="c1">// Handle user interactions</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>这些特性并非仅仅是为了方便；它们是架构约束，能够真正实现 UI 定义与部署的解耦。文档格式不仅包含静态布局，还包含状态、动画和交互，从而完整地呈现了 UI 体验。</p>

<p><strong>​​方法比较：为什么不选择 JSON 或 WebView？</strong></p>

<p>在深入探讨之前，我们有必要了解 RemoteCompose 为什么选择这种方法而不是其他方案。</p>

<p>基于 JSON 的服务器端 UI，例如 Airbnb 的 Epoxy 或 Shopify 的方法，需要定义一个映射到原生组件的模式。这种方法适用于结构化内容，但难以处理复杂的动画和过渡效果、自定义绘图和图形、带有内联样式的富文本以及渐变和阴影等视觉效果。</p>

<p>WebView 提供了全面的灵活性，但由于其独立的渲染过程，会带来性能开销；此外，Web 样式与原生设计在外观和体验上存在不一致；每个 WebView 都会占用大量资源，造成内存压力；触摸处理也较为复杂，容易出现手势冲突。</p>

<p>RemoteCompose 另辟蹊径：捕获 Compose 实际执行的绘制操作。这意味着，你可以使用 Compose 构建的任何 UI，包括自定义 Canvas 绘制、复杂动画和 Material Design 组件，都可以被捕获并以原生性能远程重放。</p>

<h3><strong>基于文档的架构：创建与回放</strong></h3>

<p>RemoteCompose 的架构围绕着两个阶段的清晰分离而构建：文档创建和文档回放。理解这种分离是理解框架强大功能的关键。</p>

<p><strong>文档创建：将 UI 作为数据捕获</strong></p>

<p>创建阶段将 Compose UI 代码转换为序列化文档。这是通过捕获机制实现的，该机制会在 Canvas 层（Android 渲染管线的最底层）拦截绘制操作。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="n">@Composable</span> <span class="n">Content</span>
</span><span class='line'>        <span class="err">↓</span>
</span><span class='line'><span class="n">RemoteComposeCreationState</span> <span class="p">(</span><span class="n">Tracks</span> <span class="n">state</span> <span class="n">and</span> <span class="n">modifiers</span><span class="p">)</span>
</span><span class='line'>        <span class="err">↓</span>
</span><span class='line'><span class="n">CaptureComposeView</span> <span class="p">(</span><span class="n">Virtual</span> <span class="n">Display</span> <span class="p">-</span> <span class="n">no</span> <span class="n">actual</span> <span class="n">screen</span> <span class="n">needed</span><span class="p">)</span>
</span><span class='line'>        <span class="err">↓</span>
</span><span class='line'><span class="n">RecordingCanvas</span> <span class="p">(</span><span class="n">Intercepts</span> <span class="n">every</span> <span class="n">draw</span> <span class="n">call</span><span class="p">)</span>
</span><span class='line'>        <span class="err">↓</span>
</span><span class='line'><span class="n">Operations</span> <span class="p">(</span><span class="m">93</span><span class="p">+</span> <span class="n">operation</span> <span class="n">types</span> <span class="n">covering</span> <span class="n">all</span> <span class="n">drawing</span> <span class="n">primitives</span><span class="p">)</span>
</span><span class='line'>        <span class="err">↓</span>
</span><span class='line'><span class="n">RemoteComposeBuffer</span> <span class="p">(</span><span class="n">Efficient</span> <span class="n">binary</span> <span class="n">serialization</span><span class="p">)</span>
</span><span class='line'>        <span class="err">↓</span>
</span><span class='line'><span class="n">ByteArray</span> <span class="p">(</span><span class="n">Network</span><span class="p">-</span><span class="n">ready</span><span class="p">,</span> <span class="n">typically</span> <span class="m">10</span><span class="p">-</span><span class="m">100</span><span class="n">KB</span> <span class="k">for</span> <span class="n">complex</span> <span class="n">UIs</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>创建端提供了一个完整的 Compose 集成层。你只需编写标准的 <code>@Composable</code> 函数，框架即可捕获所有内容：布局层级、修饰符、文本样式、图像、动画，甚至触摸处理程序。</p>

<p>其独特之处在于，捕获的文档是自包含的。它包含形状、颜色、渐变和阴影等视觉元素，以及带有字符串、字体、大小和样式的文本。图像可以嵌入为位图或 URL 以实现延迟加载。布局信息涵盖大小、位置、内边距和对齐方式。交互定义了触摸区域、点击处理程序和命名操作。状态变量可以在运行时更新，动画则通过基于时间的运动表达式来表达。</p>

<p>接收方无需访问你的代码库，只需访问文档字节即可。这与其他服务器驱动的 UI 方法有着本质区别，在其他方法中，客户端需要理解架构或拥有预构建的组件。</p>

<p><strong>文档播放：无需编译即可渲染</strong></p>

<p>播放阶段接收序列化的文档并将其渲染到屏幕上。播放器会遍历一系列操作，对 Canvas 执行每个操作。其概念类似于视频播放器解码帧的方式，只不过我们解码的是绘图指令而不是像素。</p>

<p>RemoteCompose 提供两种渲染后端以满足不同的架构需求。基于 Compose 的播放器推荐用于现代应用程序：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">DynamicScreen</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">CoreDocument</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">RemoteDocumentPlayer</span><span class="p">(</span>
</span><span class='line'>        <span class="n">document</span> <span class="p">=</span> <span class="n">document</span><span class="p">,</span>
</span><span class='line'>        <span class="n">documentWidth</span> <span class="p">=</span> <span class="n">screenWidth</span><span class="p">,</span>
</span><span class='line'>        <span class="n">documentHeight</span> <span class="p">=</span> <span class="n">screenHeight</span><span class="p">,</span>
</span><span class='line'>        <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">fillMaxSize</span><span class="p">(),</span>
</span><span class='line'>        <span class="n">onNamedAction</span> <span class="p">=</span> <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">stateUpdater</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="c1">// Handle named actions from the document</span>
</span><span class='line'>            <span class="k">when</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="s">&quot;addToCart&quot;</span> <span class="p">-&gt;</span> <span class="n">cartManager</span><span class="p">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'>                <span class="s">&quot;navigate&quot;</span> <span class="p">-&gt;</span> <span class="n">navController</span><span class="p">.</span><span class="n">navigate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'>                <span class="s">&quot;trackEvent&quot;</span> <span class="p">-&gt;</span> <span class="n">analytics</span><span class="p">.</span><span class="n">logEvent</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">},</span>
</span><span class='line'>        <span class="n">bitmapLoader</span> <span class="p">=</span> <span class="n">rememberBitmapLoader</span><span class="p">()</span>  <span class="c1">// For lazy image loading</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>基于 Compose 的播放器可以自然地与你现有的 Compose UI 集成。它是一个可组合的函数，你可以将其放置在组合层级结构中的任何位置，并像其他可组合函数一样对其应用修饰符和动画。</p>

<p>为了与现有的 View 层级结构兼容，我们还提供了一个基于 View 的播放器：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="k">class</span> <span class="nc">LegacyActivity</span> <span class="p">:</span> <span class="n">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">private</span> <span class="n">lateinit</span> <span class="k">var</span> <span class="py">player</span><span class="p">:</span> <span class="n">RemoteComposePlayer</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="n">Bundle</span><span class="p">?)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">super</span><span class="p">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
</span><span class='line'>        <span class="n">player</span> <span class="p">=</span> <span class="n">RemoteComposePlayer</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
</span><span class='line'>        <span class="n">setContentView</span><span class="p">(</span><span class="n">player</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Load document from network</span>
</span><span class='line'>        <span class="n">lifecycleScope</span><span class="p">.</span><span class="n">launch</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">val</span> <span class="py">bytes</span> <span class="p">=</span> <span class="n">api</span><span class="p">.</span><span class="n">fetchDocument</span><span class="p">(</span><span class="s">&quot;home-screen&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">player</span><span class="p">.</span><span class="n">setDocument</span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">player</span><span class="p">.</span><span class="n">onNamedAction</span> <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">stateUpdater</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="c1">// Handle actions</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>两种播放器提供相同的渲染保真度；选择哪种取决于你的应用程序架构。如果你完全使用 Compose，请使用可组合播放器。如果你是从 Views 迁移过来的，或者将其嵌入到 View 层级结构中，请使用基于 View 的播放器。</p>

<h3><strong>操作模型：一套全面的绘图词汇表</strong></h3>

<p>RemoteCompose 的优势在于其全面的操作模型。该框架定义了 93 种以上的不同操作，涵盖了 UI 渲染的方方面面。这并非随意设定的数字，而是表达任何 Canvas 绘图操作所需的完整词汇表。</p>

<p><strong>操作的重要性</strong></p>

<p>传统的服务器驱动型 UI 发送的是高级组件描述：“渲染一个带有文本‘提交’的按钮”。客户端必须解析这些描述并将其映射到原生组件。这导致服务器和客户端之间紧密耦合；双方必须就“按钮”的定义及其行为达成一致。</p>

<p>RemoteCompose 则在更底层运行：它不发送“渲染一个按钮”这样的描述，而是发送实际的绘图指令：“在这些坐标处绘制一个带有这种颜色的圆角矩形，然后在这个位置绘制带有这种字体的文本‘提交’”。客户端无需了解“按钮”的定义；它只需执行绘图操作即可。</p>

<p>这种底层方法意义深远。由于服务器和客户端无需就组件定义达成一致，因此无需进行模式同步。由于 Compose 中所有可能的视觉效果均可捕获，因此能够完整保留视觉保真度。由于新的视觉设计可在旧客户端上运行（它们只是不同的绘制操作），因此内置了向前兼容性。自定义组件无需注册即可自动运行。</p>

<p><strong>绘制操作</strong></p>

<p>绘制操作捕获 Canvas 绘制调用，这是 2D 图形的基本图元。这些图元包括：用于按钮、卡片和背景的矩形的 <code>DRAW_RECT</code>；用于带有圆角的 Material 曲面的 <code>DRAW_ROUND_RECT</code>；用于头像和指示器的 <code>DRAW_CIRCLE</code>；用于渲染带有完整样式的文本的 <code>DRAW_TEXT</code>；用于沿曲线绘制文本的 <code>DRAW_TEXT_ON_PATH</code>；以及用于图像的 <code>DRAW_BITMAP</code>。 <code>DRAW_TWEEN_PATH</code> 用于动画路径变形，等等。</p>

<p>每个操作都包含执行它所需的所有信息：坐标、颜色、绘制样式以及对文档中其他位置存储的数据（例如文本字符串或位图）的引用。</p>

<p><strong>布局操作</strong></p>

<p>布局操作定义组件层次结构和空间关系。<code>Component</code> 操作声明一个布局组件，而 <code>Container</code> 操作创建一个类似于 <code>Column</code> 或 <code>Row</code> 的容器，<code>ContainerEnd</code> 操作则关闭它。<code>LoopOperation</code> 操作用于循环列表内容。<code>Modifier</code> 包括用于背景颜色和可绘制对象的 <code>BackgroundModifier</code>、用于边框样式的 <code>BorderModifier</code>、用于内部间距的 <code>PaddingModifier</code> 以及用于触摸处理的 <code>ClickModifier</code>。</p>

<p>容器模型采用推送/弹出机制。当播放器遇到 <code>Container</code> 操作时，它会创建一个新的布局上下文。所有后续操作都将在该上下文中执行，直到 <code>ContainerEnd</code> 操作将其弹出。这与 Compose 的布局系统的工作方式类似。</p>

<p><strong>状态和表达式操作</strong></p>

<p>状态操作支持运行时可更改的动态值。<code>NamedVariable</code> 声明一个命名的状态变量。<code>ColorAttribute</code> 提供可自定义主题的颜色。<code>TimeAttribute</code> 引用动画时间。<code>FloatExpression</code> 和 <code>IntegerExpression</code> 每帧计算数学表达式。<code>ConditionalOp</code> 支持基于状态的条件渲染。</p>

<p>表达式系统功能强大。你可以嵌入公式，而不是静态值：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// These expressions are evaluated every frame</span>
</span><span class='line'><span class="k">val</span> <span class="py">opacity</span> <span class="p">=</span> <span class="n">FloatExpression</span><span class="p">(</span><span class="s">&quot;sin(time * 2) * 0.5 + 0.5&quot;</span><span class="p">)</span>  <span class="c1">// Pulsing effect</span>
</span><span class='line'><span class="k">val</span> <span class="py">rotation</span> <span class="p">=</span> <span class="n">FloatExpression</span><span class="p">(</span><span class="s">&quot;time * 90 % 360&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Continuous rotation</span>
</span><span class='line'><span class="k">val</span> <span class="py">position</span> <span class="p">=</span> <span class="n">FloatExpression</span><span class="p">(</span><span class="s">&quot;lerp(0, 100, time / 2)&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Linear interpolation</span>
</span></code></pre></td></tr></table></div></figure>


<p>这使得完全在文档中定义丰富的动画成为可能——无需客户端动画代码。
​​
<strong>交互操作</strong></p>

<p>交互操作处理用户输入。<code>TouchOperation</code> 定义触摸区域，而 <code>CLICK_AREA</code> 处理简单的点击操作。<code>ParticlesCreate</code> 初始化粒子系统，<code>ParticlesLoop</code> 驱动粒子动画。</p>

<p>触摸操作注册带有命名操作的矩形区域。当用户点击某个区域时，播放器会触发相应的操作，宿主应用程序会通过回调函数来处理这些操作。这种设计既保持了文档格式的简洁性，又实现了丰富的交互功能。</p>

<h3>动态屏幕设计的优势</h3>

<p>现在，让我们通过常见应用场景中的真实案例，来探讨 RemoteCompose 为动态屏幕设计带来的切实优势。</p>

<p><strong>服务器驱动 UI，性能毫不妥协</strong></p>

<p>传统的服务器驱动 UI 方法需要权衡取舍。基于 JSON 的布局表达能力有限，无法实现复杂的动画或自定义绘制。WebView 会带来性能开销、外观不一致以及更高的内存占用。自定义 DSL 则会增加维护负担、学习曲线，并且对预定义组件有所限制。</p>

<p>RemoteCompose 提供了第三条路径：从服务器定义的布局进行原生 Compose 渲染。你既能充分利用 Compose 渲染引擎的强大功能，又能享受服务器驱动内容的灵活性。</p>

<p>例如，一个电商应用需要频繁更新产品卡片、添加新的徽章样式、促销叠加层或季节性主题。借助 RemoteCompose，服务器端允许营销团队无需发布应用即可更新卡片设计：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Server-side: We can update card designs without app release</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">ProductCard</span><span class="p">(</span><span class="n">product</span><span class="p">:</span> <span class="n">Product</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Card</span><span class="p">(</span>
</span><span class='line'>        <span class="n">modifier</span> <span class="p">=</span> <span class="n">RemoteModifier</span>
</span><span class='line'>            <span class="p">.</span><span class="n">fillMaxWidth</span><span class="p">()</span>
</span><span class='line'>            <span class="p">.</span><span class="n">clickable</span> <span class="p">{</span> <span class="n">namedAction</span><span class="p">(</span><span class="s">&quot;viewProduct&quot;</span><span class="p">,</span> <span class="n">product</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Box</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// Product image with gradient overlay</span>
</span><span class='line'>            <span class="n">AsyncImage</span><span class="p">(</span>
</span><span class='line'>                <span class="n">url</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">imageUrl</span><span class="p">,</span>
</span><span class='line'>                <span class="n">modifier</span> <span class="p">=</span> <span class="n">RemoteModifier</span><span class="p">.</span><span class="n">fillMaxWidth</span><span class="p">().</span><span class="n">aspectRatio</span><span class="p">(</span><span class="m">1.5f</span><span class="p">)</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Promotional badge - can be A/B tested server-side</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="n">hasPromotion</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">PromotionalBadge</span><span class="p">(</span>
</span><span class='line'>                    <span class="n">text</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">promotionText</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">modifier</span> <span class="p">=</span> <span class="n">RemoteModifier</span><span class="p">.</span><span class="n">align</span><span class="p">(</span><span class="n">Alignment</span><span class="p">.</span><span class="n">TopEnd</span><span class="p">)</span>
</span><span class='line'>                <span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Price with sale styling</span>
</span><span class='line'>            <span class="n">PriceTag</span><span class="p">(</span>
</span><span class='line'>                <span class="n">originalPrice</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">originalPrice</span><span class="p">,</span>
</span><span class='line'>                <span class="n">salePrice</span> <span class="p">=</span> <span class="n">product</span><span class="p">.</span><span class="n">salePrice</span><span class="p">,</span>
</span><span class='line'>                <span class="n">modifier</span> <span class="p">=</span> <span class="n">RemoteModifier</span><span class="p">.</span><span class="n">align</span><span class="p">(</span><span class="n">Alignment</span><span class="p">.</span><span class="n">BottomStart</span><span class="p">)</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>客户端只需渲染服务器发送的内容：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Client-side: Just renders whatever the server sends</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">ProductGrid</span><span class="p">(</span><span class="n">viewModel</span><span class="p">:</span> <span class="n">ProductViewModel</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">documents</span> <span class="k">by</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">productDocuments</span><span class="p">.</span><span class="n">collectAsState</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">LazyVerticalGrid</span><span class="p">(</span><span class="n">columns</span> <span class="p">=</span> <span class="n">GridCells</span><span class="p">.</span><span class="n">Fixed</span><span class="p">(</span><span class="m">2</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">items</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span> <span class="p">{</span> <span class="n">document</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="n">RemoteDocumentPlayer</span><span class="p">(</span>
</span><span class='line'>                <span class="n">document</span> <span class="p">=</span> <span class="n">document</span><span class="p">,</span>
</span><span class='line'>                <span class="n">onNamedAction</span> <span class="p">=</span> <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">_</span> <span class="p">-&gt;</span>
</span><span class='line'>                    <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="p">==</span> <span class="s">&quot;viewProduct&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                        <span class="n">navController</span><span class="p">.</span><span class="n">navigate</span><span class="p">(</span><span class="s">&quot;product/$value&quot;</span><span class="p">)</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在，你的团队无需发布任何应用即可更新产品卡片设计，更改徽章颜色、添加动画和重新排列元素。由于它是原生应用，通过 Compose 的实际绘制管道渲染，因此 UI 的外观和体验与原生应用无异。</p>

<h3>大规模 A/B 测试</h3>

<p>传统的 A/B 测试 UI 变体需要在应用二进制文件中实现所有变体，为每个变体创建功能标志，发布包含所有变体的应用，然后等待用户采用后再衡量结果。从构思到获得数据，这个过程通常需要 2-4 周。</p>

<p>借助 RemoteCompose，你无需部署任何客户端即可测试 UI 变体。假设一个电商团队想要测试单页结账流程是否比多步骤向导转化率更高：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Server-side: Two completely different checkout experiences</span>
</span><span class='line'><span class="k">object</span> <span class="nc">CheckoutExperiments</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">getCheckoutDocument</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">User</span><span class="p">,</span> <span class="n">cart</span><span class="p">:</span> <span class="n">Cart</span><span class="p">):</span> <span class="n">ByteArray</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="py">variant</span> <span class="p">=</span> <span class="n">experimentService</span><span class="p">.</span><span class="n">getVariant</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="s">&quot;checkout-flow&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">variant</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&quot;single-page&quot;</span> <span class="p">-&gt;</span> <span class="n">captureSinglePageCheckout</span><span class="p">(</span><span class="n">cart</span><span class="p">)</span>
</span><span class='line'>            <span class="s">&quot;multi-step&quot;</span> <span class="p">-&gt;</span> <span class="n">captureMultiStepCheckout</span><span class="p">(</span><span class="n">cart</span><span class="p">)</span>
</span><span class='line'>            <span class="s">&quot;express&quot;</span> <span class="p">-&gt;</span> <span class="n">captureExpressCheckout</span><span class="p">(</span><span class="n">cart</span><span class="p">)</span>  <span class="c1">// New variant added without app update</span>
</span><span class='line'>            <span class="k">else</span> <span class="p">-&gt;</span> <span class="n">captureSinglePageCheckout</span><span class="p">(</span><span class="n">cart</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">captureSinglePageCheckout</span><span class="p">(</span><span class="n">cart</span><span class="p">:</span> <span class="n">Cart</span><span class="p">):</span> <span class="n">ByteArray</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">captureRemoteDocument</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">displayInfo</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">SinglePageCheckout</span><span class="p">(</span>
</span><span class='line'>                <span class="n">cart</span> <span class="p">=</span> <span class="n">cart</span><span class="p">,</span>
</span><span class='line'>                <span class="n">onPlaceOrder</span> <span class="p">=</span> <span class="p">{</span> <span class="n">namedAction</span><span class="p">(</span><span class="s">&quot;placeOrder&quot;</span><span class="p">,</span> <span class="n">cart</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="p">},</span>
</span><span class='line'>                <span class="n">onUpdateQuantity</span> <span class="p">=</span> <span class="p">{</span> <span class="n">itemId</span><span class="p">,</span> <span class="n">qty</span> <span class="p">-&gt;</span>
</span><span class='line'>                    <span class="n">namedAction</span><span class="p">(</span><span class="s">&quot;updateQuantity&quot;</span><span class="p">,</span> <span class="s">&quot;$itemId:$qty&quot;</span><span class="p">)</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">captureMultiStepCheckout</span><span class="p">(</span><span class="n">cart</span><span class="p">:</span> <span class="n">Cart</span><span class="p">):</span> <span class="n">ByteArray</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">captureRemoteDocument</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">displayInfo</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">MultiStepCheckout</span><span class="p">(</span>
</span><span class='line'>                <span class="n">cart</span> <span class="p">=</span> <span class="n">cart</span><span class="p">,</span>
</span><span class='line'>                <span class="n">steps</span> <span class="p">=</span> <span class="n">listOf</span><span class="p">(</span><span class="s">&quot;Shipping&quot;</span><span class="p">,</span> <span class="s">&quot;Payment&quot;</span><span class="p">,</span> <span class="s">&quot;Review&quot;</span><span class="p">),</span>
</span><span class='line'>                <span class="n">onComplete</span> <span class="p">=</span> <span class="p">{</span> <span class="n">namedAction</span><span class="p">(</span><span class="s">&quot;placeOrder&quot;</span><span class="p">,</span> <span class="n">cart</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>客户端完全不知道显示的是哪个版本：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Client-side: Completely agnostic to which variant is shown</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">CheckoutScreen</span><span class="p">(</span><span class="n">viewModel</span><span class="p">:</span> <span class="n">CheckoutViewModel</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">document</span> <span class="k">by</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">checkoutDocument</span><span class="p">.</span><span class="n">collectAsState</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">document</span><span class="o">?.</span><span class="n">let</span> <span class="p">{</span> <span class="n">doc</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="n">RemoteDocumentPlayer</span><span class="p">(</span>
</span><span class='line'>            <span class="n">document</span> <span class="p">=</span> <span class="n">doc</span><span class="p">,</span>
</span><span class='line'>            <span class="n">onNamedAction</span> <span class="p">=</span> <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">stateUpdater</span> <span class="p">-&gt;</span>
</span><span class='line'>                <span class="k">when</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="s">&quot;placeOrder&quot;</span> <span class="p">-&gt;</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">placeOrder</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'>                    <span class="s">&quot;updateQuantity&quot;</span> <span class="p">-&gt;</span> <span class="p">{</span>
</span><span class='line'>                        <span class="k">val</span> <span class="err">(</span><span class="py">itemId</span><span class="p">,</span> <span class="n">qty</span><span class="p">)</span> <span class="p">=</span> <span class="n">value</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
</span><span class='line'>                        <span class="n">viewModel</span><span class="p">.</span><span class="n">updateQuantity</span><span class="p">(</span><span class="n">itemId</span><span class="p">,</span> <span class="n">qty</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>结果即时且实时，这意味着无需等待应用商店审核或用户反馈。你甚至可以添加全新的版本，例如“快速结账”，而无需对客户端进行任何更改。实验会持续运行，直到获得统计学意义上的显著性，然后将获胜版本推广到所有用户，同样无需发布新应用。</p>

<h3>实时内容更新</h3>

<p>内容密集型应用常常需要在原生性能和内容新鲜度之间寻求平衡。以新闻应用为例：文章需要丰富的格式、嵌入式媒体和交互元素，但同时也需要随着新闻事件的进展实时更新。</p>

<p>一家报道重大事件的新闻机构需要实时更新文章布局。编辑团队可以根据新闻事件的进展调整布局：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Server-side: Editorial team can update layout as story develops</span>
</span><span class='line'><span class="k">class</span> <span class="nc">ArticleLayoutService</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">getArticleDocument</span><span class="p">(</span><span class="n">article</span><span class="p">:</span> <span class="n">Article</span><span class="p">):</span> <span class="n">ByteArray</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">captureRemoteDocument</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">displayInfo</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">ArticleLayout</span><span class="p">(</span><span class="n">article</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">@Composable</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">ArticleLayout</span><span class="p">(</span><span class="n">article</span><span class="p">:</span> <span class="n">Article</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Column</span><span class="p">(</span><span class="n">modifier</span> <span class="p">=</span> <span class="n">RemoteModifier</span><span class="p">.</span><span class="n">fillMaxSize</span><span class="p">().</span><span class="n">padding</span><span class="p">(</span><span class="m">16.</span><span class="n">dp</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// Breaking news banner - can be added/removed instantly</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="n">isBreaking</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">BreakingNewsBanner</span><span class="p">(</span>
</span><span class='line'>                    <span class="n">modifier</span> <span class="p">=</span> <span class="n">RemoteModifier</span><span class="p">.</span><span class="n">fillMaxWidth</span><span class="p">()</span>
</span><span class='line'>                <span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Headline with dynamic styling</span>
</span><span class='line'>            <span class="n">Text</span><span class="p">(</span>
</span><span class='line'>                <span class="n">text</span> <span class="p">=</span> <span class="n">article</span><span class="p">.</span><span class="n">headline</span><span class="p">,</span>
</span><span class='line'>                <span class="n">style</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="n">isBreaking</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="n">HeadlineStyle</span><span class="p">.</span><span class="n">Breaking</span>
</span><span class='line'>                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                    <span class="n">HeadlineStyle</span><span class="p">.</span><span class="n">Standard</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Live updates indicator</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">article</span><span class="p">.</span><span class="n">hasLiveUpdates</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">LiveUpdatesIndicator</span><span class="p">(</span>
</span><span class='line'>                    <span class="n">lastUpdate</span> <span class="p">=</span> <span class="n">article</span><span class="p">.</span><span class="n">lastUpdate</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">modifier</span> <span class="p">=</span> <span class="n">RemoteModifier</span><span class="p">.</span><span class="n">clickable</span> <span class="p">{</span>
</span><span class='line'>                        <span class="n">namedAction</span><span class="p">(</span><span class="s">&quot;refreshArticle&quot;</span><span class="p">,</span> <span class="n">article</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Rich content blocks - can include any Compose UI</span>
</span><span class='line'>            <span class="n">article</span><span class="p">.</span><span class="n">contentBlocks</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">block</span> <span class="p">-&gt;</span>
</span><span class='line'>                <span class="k">when</span> <span class="p">(</span><span class="n">block</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="k">is</span> <span class="n">TextBlock</span> <span class="p">-&gt;</span> <span class="n">ArticleText</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>                    <span class="k">is</span> <span class="n">ImageBlock</span> <span class="p">-&gt;</span> <span class="n">ArticleImage</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>                    <span class="k">is</span> <span class="n">VideoBlock</span> <span class="p">-&gt;</span> <span class="n">VideoEmbed</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>                    <span class="k">is</span> <span class="n">LiveBlogBlock</span> <span class="p">-&gt;</span> <span class="n">LiveBlogTimeline</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>                    <span class="k">is</span> <span class="n">InteractiveChartBlock</span> <span class="p">-&gt;</span> <span class="n">DataVisualization</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>                    <span class="k">is</span> <span class="n">PullQuoteBlock</span> <span class="p">-&gt;</span> <span class="n">PullQuote</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Related articles - layout can be A/B tested</span>
</span><span class='line'>            <span class="n">RelatedArticles</span><span class="p">(</span>
</span><span class='line'>                <span class="n">articles</span> <span class="p">=</span> <span class="n">article</span><span class="p">.</span><span class="n">relatedArticles</span><span class="p">,</span>
</span><span class='line'>                <span class="n">onArticleClick</span> <span class="p">=</span> <span class="p">{</span> <span class="n">namedAction</span><span class="p">(</span><span class="s">&quot;openArticle&quot;</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>客户端只需渲染服务器提供的任何布局：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Client-side: Renders whatever layout the server sends</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">ArticleScreen</span><span class="p">(</span><span class="n">articleId</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">viewModel</span><span class="p">:</span> <span class="n">ArticleViewModel</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">document</span> <span class="k">by</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">articleDocument</span><span class="p">.</span><span class="n">collectAsState</span><span class="p">()</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">refreshing</span> <span class="k">by</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">isRefreshing</span><span class="p">.</span><span class="n">collectAsState</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">SwipeRefresh</span><span class="p">(</span>
</span><span class='line'>        <span class="n">state</span> <span class="p">=</span> <span class="n">rememberSwipeRefreshState</span><span class="p">(</span><span class="n">refreshing</span><span class="p">),</span>
</span><span class='line'>        <span class="n">onRefresh</span> <span class="p">=</span> <span class="p">{</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">refresh</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">document</span><span class="o">?.</span><span class="n">let</span> <span class="p">{</span> <span class="n">doc</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="n">RemoteDocumentPlayer</span><span class="p">(</span>
</span><span class='line'>                <span class="n">document</span> <span class="p">=</span> <span class="n">doc</span><span class="p">,</span>
</span><span class='line'>                <span class="n">onNamedAction</span> <span class="p">=</span> <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">_</span> <span class="p">-&gt;</span>
</span><span class='line'>                    <span class="k">when</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                        <span class="s">&quot;openArticle&quot;</span> <span class="p">-&gt;</span> <span class="n">navController</span><span class="p">.</span><span class="n">navigate</span><span class="p">(</span><span class="s">&quot;article/$value&quot;</span><span class="p">)</span>
</span><span class='line'>                        <span class="s">&quot;refreshArticle&quot;</span> <span class="p">-&gt;</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">refresh</span><span class="p">()</span>
</span><span class='line'>                        <span class="s">&quot;playVideo&quot;</span> <span class="p">-&gt;</span> <span class="n">videoPlayer</span><span class="p">.</span><span class="n">play</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>你的团队无需修改应用即可更新文章布局，添加实时博客时间线、嵌入交互式图表和更改字体。当新闻事件有进展时，他们可以立即在所有相关文章上添加“突发新闻”横幅。</p>

<h3>避免代码膨胀的功能标志</h3>

<p>传统的功能标志需要将所有变体都包含在二进制文件中：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Traditional approach - all code ships, even unused variations</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">HomeScreen</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">when</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">featureFlags</span><span class="p">.</span><span class="n">newHomeV3</span> <span class="p">-&gt;</span> <span class="n">NewHomeLayoutV3</span><span class="p">()</span>  <span class="c1">// Ships always</span>
</span><span class='line'>        <span class="n">featureFlags</span><span class="p">.</span><span class="n">newHomeV2</span> <span class="p">-&gt;</span> <span class="n">NewHomeLayoutV2</span><span class="p">()</span>  <span class="c1">// Ships always</span>
</span><span class='line'>        <span class="k">else</span> <span class="p">-&gt;</span> <span class="n">OldHomeLayout</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Ships always</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这会带来几个问题。二进制文件会因为包含所有变体而增加应用程序的大小。即使未使用，也会包含无用代码。当功能标志配置错误时，可能会暴露未发布的功能，从而带来安全风险。随着时间的推移，旧的变体不断累积，导致技术债务不断增加。</p>

<p>使用 RemoteCompose，只会传输当前激活的变体：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Server-side: Only the active variation exists on the server</span>
</span><span class='line'><span class="k">class</span> <span class="nc">HomeScreenService</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">getHomeDocument</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">User</span><span class="p">):</span> <span class="n">ByteArray</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">featureFlags</span><span class="p">.</span><span class="n">getHomeVariant</span><span class="p">(</span><span class="n">user</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&quot;v3&quot;</span> <span class="p">-&gt;</span> <span class="n">captureHomeV3</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'>            <span class="s">&quot;v2&quot;</span> <span class="p">-&gt;</span> <span class="n">captureHomeV2</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'>            <span class="k">else</span> <span class="p">-&gt;</span> <span class="n">captureHomeDefault</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Client-side: No conditional code, no dead code</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">HomeScreen</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">CoreDocument</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">RemoteDocumentPlayer</span><span class="p">(</span><span class="n">document</span> <span class="p">=</span> <span class="n">document</span><span class="p">)</span>
</span><span class='line'>    <span class="c1">// That&#39;s it. No feature flags, no conditionals.</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这消除了二进制文件膨胀，因为不会传输旧的变体；由于只存在服务器端代码，因此消除了无用代码；并且由于配置错误只会显示不同的 UI 而不是未发布的代码，因此降低了安全风险。</p>

<p>设想一个社交媒体应用正在逐步重新设计其信息流：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Server-side: Complete control over who sees what</span>
</span><span class='line'><span class="k">class</span> <span class="nc">FeedLayoutService</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">getFeedDocument</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">User</span><span class="p">,</span> <span class="n">posts</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;):</span> <span class="n">ByteArray</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="py">variant</span> <span class="p">=</span> <span class="n">rolloutService</span><span class="p">.</span><span class="n">getFeedVariant</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">captureRemoteDocument</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">displayInfo</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">when</span> <span class="p">(</span><span class="n">variant</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">FeedVariant</span><span class="p">.</span><span class="n">NEW_DESIGN</span> <span class="p">-&gt;</span> <span class="n">NewFeedLayout</span><span class="p">(</span><span class="n">posts</span><span class="p">)</span>
</span><span class='line'>                <span class="n">FeedVariant</span><span class="p">.</span><span class="n">NEW_DESIGN_COMPACT</span> <span class="p">-&gt;</span> <span class="n">NewFeedCompactLayout</span><span class="p">(</span><span class="n">posts</span><span class="p">)</span>
</span><span class='line'>                <span class="n">FeedVariant</span><span class="p">.</span><span class="n">CLASSIC</span> <span class="p">-&gt;</span> <span class="n">ClassicFeedLayout</span><span class="p">(</span><span class="n">posts</span><span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Rollout service controls the percentage</span>
</span><span class='line'><span class="k">class</span> <span class="nc">RolloutService</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">getFeedVariant</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">User</span><span class="p">):</span> <span class="n">FeedVariant</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// 5% get new design, 5% get compact variant, 90% get classic</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">when</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">user</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">hashCode</span><span class="p">()</span> <span class="p">%</span> <span class="m">100</span> <span class="p">&lt;</span> <span class="m">5</span> <span class="p">-&gt;</span> <span class="n">FeedVariant</span><span class="p">.</span><span class="n">NEW_DESIGN</span>
</span><span class='line'>            <span class="n">user</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">hashCode</span><span class="p">()</span> <span class="p">%</span> <span class="m">100</span> <span class="p">&lt;</span> <span class="m">10</span> <span class="p">-&gt;</span> <span class="n">FeedVariant</span><span class="p">.</span><span class="n">NEW_DESIGN_COMPACT</span>
</span><span class='line'>            <span class="k">else</span> <span class="p">-&gt;</span> <span class="n">FeedVariant</span><span class="p">.</span><span class="n">CLASSIC</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Instant rollback if issues are detected</span>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">emergencyRollback</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// All users immediately get classic layout</span>
</span><span class='line'>        <span class="c1">// No app update needed</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果新设计导致问题（例如崩溃、用户互动度下降或用户投诉），可以立即回滚。只需更改服务器配置即可。无需紧急发布应用。</p>

<h3>跨平台一致性</h3>

<p>RemoteCompose 的文档格式与平台无关。同一文档可以在手机、平板电脑、折叠屏设备和 Wear OS 设备上渲染，并由相应的平台播放器负责渲染。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Creation <span class="o">(</span>Server/Backend<span class="o">)</span>
</span><span class='line'>    ↓
</span><span class='line'>RemoteComposeBuffer <span class="o">(</span>Platform-independent binary format<span class="o">)</span>
</span><span class='line'>    ↓
</span><span class='line'>┌─────────────────────────────────────────────────────────┐
</span><span class='line'>│
</span><span class='line'>
</span><span class='line'>│
</span><span class='line'>↓
</span><span class='line'>
</span><span class='line'>↓
</span><span class='line'>
</span><span class='line'>↓
</span><span class='line'>
</span><span class='line'>↓
</span><span class='line'>Android Phone
</span><span class='line'>
</span><span class='line'>Android Tablet
</span><span class='line'>
</span><span class='line'>Foldable Device
</span><span class='line'>
</span><span class='line'>Wear OS
</span><span class='line'><span class="o">(</span>Compose Player<span class="o">)</span> <span class="o">(</span>Compose Player<span class="o">)</span>  <span class="o">(</span>Compose Player<span class="o">)</span>   <span class="o">(</span>Wear Player<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>假设一款健身应用在手机和手表应用上都显示锻炼总结。相同的数据会针对不同的设备尺寸进行优化，呈现不同的内容：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Server-side: Same data, different presentations</span>
</span><span class='line'><span class="k">class</span> <span class="nc">WorkoutSummaryService</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">getPhoneDocument</span><span class="p">(</span><span class="n">workout</span><span class="p">:</span> <span class="n">Workout</span><span class="p">):</span> <span class="n">ByteArray</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">captureRemoteDocument</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">phoneDisplayInfo</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">PhoneWorkoutSummary</span><span class="p">(</span><span class="n">workout</span><span class="p">)</span>  <span class="c1">// Full detailed view</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">getWatchDocument</span><span class="p">(</span><span class="n">workout</span><span class="p">:</span> <span class="n">Workout</span><span class="p">):</span> <span class="n">ByteArray</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">captureRemoteDocument</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">watchDisplayInfo</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">WatchWorkoutSummary</span><span class="p">(</span><span class="n">workout</span><span class="p">)</span>  <span class="c1">// Glanceable summary</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">@Composable</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">PhoneWorkoutSummary</span><span class="p">(</span><span class="n">workout</span><span class="p">:</span> <span class="n">Workout</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Column</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">WorkoutHeader</span><span class="p">(</span><span class="n">workout</span><span class="p">)</span>
</span><span class='line'>            <span class="n">HeartRateChart</span><span class="p">(</span><span class="n">workout</span><span class="p">.</span><span class="n">heartRateData</span><span class="p">)</span>
</span><span class='line'>            <span class="n">PaceChart</span><span class="p">(</span><span class="n">workout</span><span class="p">.</span><span class="n">paceData</span><span class="p">)</span>
</span><span class='line'>            <span class="n">SplitsTable</span><span class="p">(</span><span class="n">workout</span><span class="p">.</span><span class="n">splits</span><span class="p">)</span>
</span><span class='line'>            <span class="n">MapView</span><span class="p">(</span><span class="n">workout</span><span class="p">.</span><span class="n">route</span><span class="p">)</span>
</span><span class='line'>            <span class="n">ShareButton</span> <span class="p">{</span> <span class="n">namedAction</span><span class="p">(</span><span class="s">&quot;share&quot;</span><span class="p">,</span> <span class="n">workout</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">@Composable</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">WatchWorkoutSummary</span><span class="p">(</span><span class="n">workout</span><span class="p">:</span> <span class="n">Workout</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Optimized for small screen</span>
</span><span class='line'>        <span class="n">Column</span><span class="p">(</span><span class="n">modifier</span> <span class="p">=</span> <span class="n">RemoteModifier</span><span class="p">.</span><span class="n">fillMaxSize</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">Text</span><span class="p">(</span><span class="n">workout</span><span class="p">.</span><span class="k">type</span><span class="p">,</span> <span class="n">style</span> <span class="p">=</span> <span class="n">WatchTypography</span><span class="p">.</span><span class="n">Title</span><span class="p">)</span>
</span><span class='line'>            <span class="n">Row</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">StatBox</span><span class="p">(</span><span class="s">&quot;Duration&quot;</span><span class="p">,</span> <span class="n">workout</span><span class="p">.</span><span class="n">duration</span><span class="p">)</span>
</span><span class='line'>                <span class="n">StatBox</span><span class="p">(</span><span class="s">&quot;Distance&quot;</span><span class="p">,</span> <span class="n">workout</span><span class="p">.</span><span class="n">distance</span><span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">MiniHeartRateIndicator</span><span class="p">(</span><span class="n">workout</span><span class="p">.</span><span class="n">avgHeartRate</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>两款设备都显示锻炼数据，但布局针对各自的设备尺寸进行了优化。任一布局的更新都会立即生效，无需在任一平台上更新应用。</p>

<h3>缩短发布周期</h3>

<p>最显著的优势在于运营层面：UI 更改不再需要发布应用。考虑一下简单 UI 调整的开发周期。</p>

<p>传统方法大约需要两到四周。第一天和第二天是开发人员实现。第三天和第四天用于代码审查和修改。第五天到第七天用于质量保证测试。第八天和第九天处理发布准备和应用商店提交。第十天到第十四天：等待应用商店审核。第十五天到第三十天用户逐步采用，通常两周内会有 50% 到 70% 的用户更新。大多数用户在两到四周内不会看到变化。</p>

<p>RemoteCompose 方法只需一到两天即可完成。第一天和第二天是开发人员在服务器端实现。部署只需几分钟。所有用户都能立即看到变化。</p>

<p>这种速度优势对于节假日促销活动至关重要，你可以根据需要在当天部署季节性主题；对于服务中断的紧急消息，你可以即时更新 UI；对于快速迭代，你可以快速测试想法并快速失败；对于竞争响应，你可以以小时而不是几周的时间对市场变化做出反应。</p>

<p>以一个准备迎接黑色星期五的电商应用为例：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Traditional approach: Ship all variations weeks in advance</span>
</span><span class='line'><span class="c1">// Problem: All promotional code ships weeks early</span>
</span><span class='line'><span class="c1">// Risk: Date logic bugs could show promotions early</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">HomeScreen</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">today</span> <span class="p">=</span> <span class="n">LocalDate</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
</span><span class='line'>    <span class="k">when</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">today</span> <span class="p">==</span> <span class="n">BlackFriday</span> <span class="p">-&gt;</span> <span class="n">BlackFridayHome</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Must ship by Oct 15</span>
</span><span class='line'>        <span class="n">today</span> <span class="k">in</span> <span class="n">BlackFridayWeek</span> <span class="p">-&gt;</span> <span class="n">BlackFridayWeekHome</span><span class="p">()</span>   <span class="c1">// Must ship by Oct 15</span>
</span><span class='line'>        <span class="n">today</span> <span class="p">==</span> <span class="n">CyberMonday</span> <span class="p">-&gt;</span> <span class="n">CyberMondayHome</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Must ship by Oct 15</span>
</span><span class='line'>        <span class="k">else</span> <span class="p">-&gt;</span> <span class="n">RegularHome</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Remote approach: Deploy each promotion on the exact day</span>
</span><span class='line'><span class="c1">// Benefit: Each promotion deploys on the exact minute needed</span>
</span><span class='line'><span class="c1">// Flexibility: Can react to competitor moves in real-time</span>
</span><span class='line'><span class="k">class</span> <span class="nc">HomeScreenService</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">getHomeDocument</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="n">User</span><span class="p">):</span> <span class="n">ByteArray</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="py">promotion</span> <span class="p">=</span> <span class="n">promotionService</span><span class="p">.</span><span class="n">getCurrentPromotion</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">captureRemoteDocument</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">displayInfo</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">when</span> <span class="p">(</span><span class="n">promotion</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">is</span> <span class="n">BlackFridayPromotion</span> <span class="p">-&gt;</span> <span class="n">BlackFridayHome</span><span class="p">(</span><span class="n">promotion</span><span class="p">)</span>
</span><span class='line'>                <span class="k">is</span> <span class="n">CyberMondayPromotion</span> <span class="p">-&gt;</span> <span class="n">CyberMondayHome</span><span class="p">(</span><span class="n">promotion</span><span class="p">)</span>
</span><span class='line'>                <span class="k">is</span> <span class="n">FlashSale</span> <span class="p">-&gt;</span> <span class="n">FlashSaleHome</span><span class="p">(</span><span class="n">promotion</span><span class="p">)</span>  <span class="c1">// Can add new types anytime</span>
</span><span class='line'>                <span class="k">else</span> <span class="p">-&gt;</span> <span class="n">RegularHome</span><span class="p">()</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>状态管理：超越静态布局</h3>

<p>RemoteCompose 不仅限于静态布局。该框架包含一个状态管理系统，可以实现交互式、动态的 UI。</p>

<p><strong>远程状态变量</strong></p>

<p>状态可以嵌入文档中，并由客户端更新。这使得表单、计数器、切换开关和其他交互元素成为可能：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Creation side: Define interactive widget</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">QuantitySelector</span><span class="p">(</span><span class="n">initialQuantity</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">var</span> <span class="py">quantity</span> <span class="k">by</span> <span class="n">rememberRemoteState</span><span class="p">(</span><span class="s">&quot;quantity&quot;</span><span class="p">,</span> <span class="n">initialQuantity</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Row</span><span class="p">(</span>
</span><span class='line'>        <span class="n">modifier</span> <span class="p">=</span> <span class="n">RemoteModifier</span><span class="p">.</span><span class="n">fillMaxWidth</span><span class="p">(),</span>
</span><span class='line'>        <span class="n">horizontalArrangement</span> <span class="p">=</span> <span class="n">Arrangement</span><span class="p">.</span><span class="n">SpaceBetween</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">IconButton</span><span class="p">(</span>
</span><span class='line'>            <span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="n">quantity</span> <span class="p">&gt;</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="n">quantity</span><span class="p">--</span>
</span><span class='line'>                    <span class="n">namedAction</span><span class="p">(</span><span class="s">&quot;quantityChanged&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="p">.</span><span class="n">toString</span><span class="p">())</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">Icon</span><span class="p">(</span><span class="n">Icons</span><span class="p">.</span><span class="n">Minus</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Text</span><span class="p">(</span>
</span><span class='line'>            <span class="n">text</span> <span class="p">=</span> <span class="n">quantity</span><span class="p">.</span><span class="n">toString</span><span class="p">(),</span>
</span><span class='line'>            <span class="n">style</span> <span class="p">=</span> <span class="n">MaterialTheme</span><span class="p">.</span><span class="n">typography</span><span class="p">.</span><span class="n">headlineMedium</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">IconButton</span><span class="p">(</span>
</span><span class='line'>            <span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">quantity</span><span class="p">++</span>
</span><span class='line'>                <span class="n">namedAction</span><span class="p">(</span><span class="s">&quot;quantityChanged&quot;</span><span class="p">,</span> <span class="n">quantity</span><span class="p">.</span><span class="n">toString</span><span class="p">())</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">Icon</span><span class="p">(</span><span class="n">Icons</span><span class="p">.</span><span class="n">Plus</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>播放器端通过操作回调处理状态更新：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Player side: Handle state updates</span>
</span><span class='line'><span class="n">RemoteDocumentPlayer</span><span class="p">(</span>
</span><span class='line'>    <span class="n">document</span> <span class="p">=</span> <span class="n">document</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onNamedAction</span> <span class="p">=</span> <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">stateUpdater</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="k">when</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&quot;quantityChanged&quot;</span> <span class="p">-&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1">// Update cart</span>
</span><span class='line'>                <span class="n">cartManager</span><span class="p">.</span><span class="n">setQuantity</span><span class="p">(</span><span class="n">itemId</span><span class="p">,</span> <span class="n">value</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span>
</span><span class='line'>
</span><span class='line'>                <span class="c1">// Optionally update remote state directly</span>
</span><span class='line'>                <span class="n">stateUpdater</span><span class="p">.</span><span class="n">updateState</span> <span class="p">{</span> <span class="n">state</span> <span class="p">-&gt;</span>
</span><span class='line'>                    <span class="n">state</span><span class="p">[</span><span class="s">&quot;quantity&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">RcInt</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>动画时间跟踪</strong></p>

<p>播放器跟踪动画时间并将其传递给文档，从而无需任何客户端动画代码即可实现基于时间的动画：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Server side: Define animated elements</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">PulsingNotificationBadge</span><span class="p">(</span><span class="n">count</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Scale pulses between 0.9 and 1.1 over 1 second</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">scale</span> <span class="p">=</span> <span class="n">FloatExpression</span><span class="p">(</span><span class="s">&quot;0.9 + 0.2 * sin(time * 6.28)&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Opacity pulses between 0.7 and 1.0</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">opacity</span> <span class="p">=</span> <span class="n">FloatExpression</span><span class="p">(</span><span class="s">&quot;0.7 + 0.3 * sin(time * 6.28)&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Box</span><span class="p">(</span>
</span><span class='line'>        <span class="n">modifier</span> <span class="p">=</span> <span class="n">RemoteModifier</span>
</span><span class='line'>            <span class="p">.</span><span class="n">scale</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
</span><span class='line'>            <span class="p">.</span><span class="n">alpha</span><span class="p">(</span><span class="n">opacity</span><span class="p">)</span>
</span><span class='line'>            <span class="p">.</span><span class="n">background</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Red</span><span class="p">,</span> <span class="n">CircleShape</span><span class="p">)</span>
</span><span class='line'>            <span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="m">24.</span><span class="n">dp</span><span class="p">)</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Text</span><span class="p">(</span>
</span><span class='line'>            <span class="n">text</span> <span class="p">=</span> <span class="n">count</span><span class="p">.</span><span class="n">toString</span><span class="p">(),</span>
</span><span class='line'>            <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">White</span><span class="p">,</span>
</span><span class='line'>            <span class="n">modifier</span> <span class="p">=</span> <span class="n">RemoteModifier</span><span class="p">.</span><span class="n">align</span><span class="p">(</span><span class="n">Alignment</span><span class="p">.</span><span class="n">Center</span><span class="p">)</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// The player automatically:</span>
</span><span class='line'><span class="c1">// 1. Tracks elapsed time since document load</span>
</span><span class='line'><span class="c1">// 2. Evaluates expressions each frame</span>
</span><span class='line'><span class="c1">// 3. Updates visual properties</span>
</span><span class='line'><span class="c1">// No client animation code needed</span>
</span></code></pre></td></tr></table></div></figure>


<p>这使得完全在文档格式中定义的流畅、高性能动画成为可能。表达式支持诸如 <code>sin</code>、<code>cos</code>、<code>lerp</code> 和 <code>clamp</code> 之类的数学函数，以及算术运算符和变量引用。</p>

<p><strong>双向通信</strong></p>

<p>操作系统支持文档与宿主应用之间的双向通信：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Document triggers actions for various purposes</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">ProductDetailPage</span><span class="p">(</span><span class="n">product</span><span class="p">:</span> <span class="n">Product</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Column</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Analytics tracking</span>
</span><span class='line'>        <span class="n">LaunchedEffect</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">namedAction</span><span class="p">(</span><span class="s">&quot;analytics&quot;</span><span class="p">,</span> <span class="s">&quot;product_viewed:${product.id}&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">ProductImage</span><span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="n">imageUrl</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Navigation action</span>
</span><span class='line'>        <span class="n">TextButton</span><span class="p">(</span><span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span> <span class="n">namedAction</span><span class="p">(</span><span class="s">&quot;navigate&quot;</span><span class="p">,</span> <span class="s">&quot;/reviews/${product.id}&quot;</span><span class="p">)</span> <span class="p">})</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">Text</span><span class="p">(</span><span class="s">&quot;See all reviews&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Cart action with data</span>
</span><span class='line'>        <span class="n">Button</span><span class="p">(</span><span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span> <span class="n">namedAction</span><span class="p">(</span><span class="s">&quot;addToCart&quot;</span><span class="p">,</span> <span class="n">product</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="p">})</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">Text</span><span class="p">(</span><span class="s">&quot;Add to Cart&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// State update action</span>
</span><span class='line'>        <span class="k">var</span> <span class="py">isFavorite</span> <span class="k">by</span> <span class="n">rememberRemoteState</span><span class="p">(</span><span class="s">&quot;favorite&quot;</span><span class="p">,</span> <span class="n">product</span><span class="p">.</span><span class="n">isFavorite</span><span class="p">)</span>
</span><span class='line'>        <span class="n">IconButton</span><span class="p">(</span>
</span><span class='line'>            <span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">isFavorite</span> <span class="p">=</span> <span class="p">!</span><span class="n">isFavorite</span>
</span><span class='line'>                <span class="n">namedAction</span><span class="p">(</span><span class="s">&quot;toggleFavorite&quot;</span><span class="p">,</span> <span class="s">&quot;${product.id}:$isFavorite&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">Icon</span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="n">isFavorite</span><span class="p">)</span> <span class="n">Icons</span><span class="p">.</span><span class="n">Filled</span><span class="p">.</span><span class="n">Favorite</span> <span class="k">else</span> <span class="n">Icons</span><span class="p">.</span><span class="n">Outlined</span><span class="p">.</span><span class="n">Favorite</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>宿主应用统一处理所有操作：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Host app handles all actions uniformly</span>
</span><span class='line'><span class="n">RemoteDocumentPlayer</span><span class="p">(</span>
</span><span class='line'>    <span class="n">document</span> <span class="p">=</span> <span class="n">document</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onNamedAction</span> <span class="p">=</span> <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">stateUpdater</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="k">when</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&quot;analytics&quot;</span> <span class="p">-&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">val</span> <span class="err">(</span><span class="py">event</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span> <span class="p">=</span> <span class="n">value</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
</span><span class='line'>                <span class="n">analytics</span><span class="p">.</span><span class="n">logEvent</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">mapOf</span><span class="p">(</span><span class="s">&quot;productId&quot;</span> <span class="n">to</span> <span class="n">id</span><span class="p">))</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="s">&quot;navigate&quot;</span> <span class="p">-&gt;</span> <span class="n">navController</span><span class="p">.</span><span class="n">navigate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'>            <span class="s">&quot;addToCart&quot;</span> <span class="p">-&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">cartManager</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'>                <span class="c1">// Update UI to show confirmation</span>
</span><span class='line'>                <span class="n">stateUpdater</span><span class="p">.</span><span class="n">updateState</span> <span class="p">{</span> <span class="n">state</span> <span class="p">-&gt;</span>
</span><span class='line'>                    <span class="n">state</span><span class="p">[</span><span class="s">&quot;cartCount&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="n">RcInt</span><span class="p">((</span><span class="n">state</span><span class="p">[</span><span class="s">&quot;cartCount&quot;</span><span class="p">]</span> <span class="k">as</span><span class="p">?</span> <span class="n">RcInt</span><span class="p">)</span><span class="o">?.</span><span class="n">value</span><span class="o">?.</span><span class="n">plus</span><span class="p">(</span><span class="m">1</span><span class="p">)</span> <span class="o">?:</span> <span class="m">1</span><span class="p">)</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="s">&quot;toggleFavorite&quot;</span> <span class="p">-&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">val</span> <span class="err">(</span><span class="py">id</span><span class="p">,</span> <span class="n">isFavorite</span><span class="p">)</span> <span class="p">=</span> <span class="n">value</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span>
</span><span class='line'>                <span class="n">favoritesManager</span><span class="p">.</span><span class="n">setFavorite</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">isFavorite</span><span class="p">.</span><span class="n">toBoolean</span><span class="p">())</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>这种双向通信意味着远程文档可以完全集成到你应用的导航、分析、状态管理和业务逻辑中，而文档本身无需了解你的具体实现。</p>

<h3><strong>实际应用架构模式</strong></h3>

<p>让我们来探讨一下 RemoteCompose 如何融入实际应用架构。</p>

<p><strong>模式 1：混合架构（推荐）</strong></p>

<p>大多数应用都能从混合架构中获益：关键页面使用本地 Compose 代码构建，而动态内容区域则使用 RemoteCompose。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">// Navigation: Local Compose (fast, reliable)</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">AppNavigation</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">NavHost</span><span class="p">(</span><span class="n">navController</span><span class="p">,</span> <span class="n">startDestination</span> <span class="p">=</span> <span class="s">&quot;home&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">composable</span><span class="p">(</span><span class="s">&quot;home&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">HomeScreen</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>        <span class="n">composable</span><span class="p">(</span><span class="s">&quot;product/{id}&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">ProductScreen</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">arguments</span><span class="o">?.</span><span class="n">getString</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">))</span> <span class="p">}</span>
</span><span class='line'>        <span class="n">composable</span><span class="p">(</span><span class="s">&quot;cart&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">CartScreen</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>        <span class="n">composable</span><span class="p">(</span><span class="s">&quot;checkout&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">CheckoutScreen</span><span class="p">()</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Home screen: Remote (marketing can update freely)</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">HomeScreen</span><span class="p">(</span><span class="n">viewModel</span><span class="p">:</span> <span class="n">HomeViewModel</span> <span class="p">=</span> <span class="n">hiltViewModel</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">document</span> <span class="k">by</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">homeDocument</span><span class="p">.</span><span class="n">collectAsState</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">when</span> <span class="p">(</span><span class="k">val</span> <span class="py">state</span> <span class="p">=</span> <span class="n">document</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">is</span> <span class="n">Loading</span> <span class="p">-&gt;</span> <span class="n">LoadingIndicator</span><span class="p">()</span>
</span><span class='line'>        <span class="k">is</span> <span class="n">Success</span> <span class="p">-&gt;</span> <span class="n">RemoteDocumentPlayer</span><span class="p">(</span>
</span><span class='line'>            <span class="n">document</span> <span class="p">=</span> <span class="n">state</span><span class="p">.</span><span class="n">document</span><span class="p">,</span>
</span><span class='line'>            <span class="n">onNamedAction</span> <span class="p">=</span> <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">_</span> <span class="p">-&gt;</span> <span class="n">handleAction</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>        <span class="k">is</span> <span class="n">Error</span> <span class="p">-&gt;</span> <span class="n">LocalFallbackHome</span><span class="p">()</span>  <span class="c1">// Graceful degradation</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Product screen: Hybrid (shell is local, content is remote)</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">ProductScreen</span><span class="p">(</span><span class="n">productId</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">viewModel</span><span class="p">:</span> <span class="n">ProductViewModel</span> <span class="p">=</span> <span class="n">hiltViewModel</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">product</span> <span class="k">by</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">product</span><span class="p">.</span><span class="n">collectAsState</span><span class="p">()</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">contentDocument</span> <span class="k">by</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">contentDocument</span><span class="p">.</span><span class="n">collectAsState</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Scaffold</span><span class="p">(</span>
</span><span class='line'>        <span class="n">topBar</span> <span class="p">=</span> <span class="p">{</span> <span class="n">ProductTopBar</span><span class="p">(</span><span class="n">product</span><span class="p">)</span> <span class="p">},</span>  <span class="c1">// Local: consistent navigation</span>
</span><span class='line'>        <span class="n">bottomBar</span> <span class="p">=</span> <span class="p">{</span> <span class="n">AddToCartBar</span><span class="p">(</span><span class="n">product</span><span class="p">)</span> <span class="p">}</span> <span class="c1">// Local: critical purchase flow</span>
</span><span class='line'>    <span class="p">)</span> <span class="p">{</span> <span class="n">padding</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="c1">// Remote: Rich product content, can be A/B tested</span>
</span><span class='line'>        <span class="n">contentDocument</span><span class="o">?.</span><span class="n">let</span> <span class="p">{</span> <span class="n">doc</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="n">RemoteDocumentPlayer</span><span class="p">(</span>
</span><span class='line'>                <span class="n">document</span> <span class="p">=</span> <span class="n">doc</span><span class="p">,</span>
</span><span class='line'>                <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="n">padding</span><span class="p">)</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>模式 2：文档缓存以实现离线支持</strong></p>

<p>远程文档可以缓存以供离线访问：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="k">class</span> <span class="nc">DocumentRepository</span> <span class="n">@Inject</span> <span class="n">constructor</span><span class="p">(</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">val</span> <span class="py">api</span><span class="p">:</span> <span class="n">DocumentApi</span><span class="p">,</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">val</span> <span class="py">cache</span><span class="p">:</span> <span class="n">DocumentCache</span><span class="p">,</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">val</span> <span class="py">connectivity</span><span class="p">:</span> <span class="n">ConnectivityManager</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">suspend</span> <span class="k">fun</span> <span class="nf">getDocument</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">CoreDocument</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// Try cache first</span>
</span><span class='line'>        <span class="n">cache</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">?.</span><span class="n">let</span> <span class="p">{</span> <span class="n">cached</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="c1">// Return cached immediately, refresh in background</span>
</span><span class='line'>            <span class="n">refreshInBackground</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">cached</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// No cache, must fetch</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="n">connectivity</span><span class="p">.</span><span class="n">isConnected</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">fetchAndCache</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">throw</span> <span class="n">OfflineException</span><span class="p">(</span><span class="s">&quot;No cached document and no connectivity&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="n">suspend</span> <span class="k">fun</span> <span class="nf">fetchAndCache</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">CoreDocument</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="py">bytes</span> <span class="p">=</span> <span class="n">api</span><span class="p">.</span><span class="n">fetchDocument</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>        <span class="k">val</span> <span class="py">document</span> <span class="p">=</span> <span class="n">RemoteComposeBuffer</span><span class="p">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span>
</span><span class='line'>        <span class="n">cache</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">document</span><span class="p">,</span> <span class="n">ttl</span> <span class="p">=</span> <span class="m">1.</span><span class="n">hours</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">document</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">refreshInBackground</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">scope</span><span class="p">.</span><span class="n">launch</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">fetchAndCache</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">Exception</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1">// Silent failure, cached version is still valid</span>
</span><span class='line'>                <span class="n">Log</span><span class="p">.</span><span class="n">w</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s">&quot;Background refresh failed&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>模式 3：文档预加载以实现流畅导航</strong></p>

<p>预加载用户可能访问的页面的文档：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="k">class</span> <span class="nc">DocumentPreloader</span> <span class="n">@Inject</span> <span class="n">constructor</span><span class="p">(</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">val</span> <span class="py">repository</span><span class="p">:</span> <span class="n">DocumentRepository</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Preload when user enters a screen</span>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">preloadForScreen</span><span class="p">(</span><span class="n">screen</span><span class="p">:</span> <span class="n">Screen</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="py">keysToPreload</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">screen</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">is</span> <span class="n">HomeScreen</span> <span class="p">-&gt;</span> <span class="n">listOf</span><span class="p">(</span><span class="s">&quot;featured&quot;</span><span class="p">,</span> <span class="s">&quot;categories&quot;</span><span class="p">,</span> <span class="s">&quot;promotions&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="k">is</span> <span class="n">CategoryScreen</span> <span class="p">-&gt;</span> <span class="n">screen</span><span class="p">.</span><span class="n">subcategories</span><span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="s">&quot;category_${it.id}&quot;</span> <span class="p">}</span>
</span><span class='line'>            <span class="k">is</span> <span class="n">ProductScreen</span> <span class="p">-&gt;</span> <span class="n">listOf</span><span class="p">(</span><span class="s">&quot;reviews_${screen.productId}&quot;</span><span class="p">,</span> <span class="s">&quot;related_${screen.productId}&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="k">else</span> <span class="p">-&gt;</span> <span class="n">emptyList</span><span class="p">()</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">keysToPreload</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">key</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="n">scope</span><span class="p">.</span><span class="n">launch</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>                    <span class="n">repository</span><span class="p">.</span><span class="n">getDocument</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>  <span class="c1">// Caches for later</span>
</span><span class='line'>                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">Exception</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                    <span class="c1">// Preload failure is not critical</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Usage in navigation</span>
</span><span class='line'><span class="n">navController</span><span class="p">.</span><span class="n">addOnDestinationChangedListener</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">arguments</span> <span class="p">-&gt;</span>
</span><span class='line'>    <span class="n">preloader</span><span class="p">.</span><span class="n">preloadForScreen</span><span class="p">(</span><span class="n">destination</span><span class="p">.</span><span class="n">toScreen</span><span class="p">(</span><span class="n">arguments</span><span class="p">))</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3><strong>结论</strong></h3>

<p>RemoteCompose 代表了我们对 Android UI 开发思维方式的一次范式转变。通过将 Compose 布局转换为可移植文档格式，RemoteCompose 实现了服务器驱动的 UI、即时 A/B 测试、实时内容更新和跨平台一致性，同时保持了原生渲染性能。</p>

<p>该框架拥有包含 93 种以上操作的全面操作模型，充分展现了 Compose 的表达能力，包括动画、状态和交互。创建和播放的分离使得部署架构更加灵活：在后端生成具有完整 Compose 表达能力的文档，通过现有基础架构分发，并在任何 Android 设备上进行原生渲染。</p>

<p>关键在于找到合适的平衡点：对于动态、频繁变化的内容区域，使用 RemoteCompose；同时将关键流程保留在本地 Compose 代码中。这种混合方法在需要灵活性的地方提供服务器驱动 UI 的优势，在需要可靠性的地方提供编译代码的优势。</p>

<p>无论你是构建需要频繁更新布局的内容密集型应用、需要快速 A/B 测试的电子商务平台，还是需要快速迭代的企业级工具，RemoteCompose 都能为真正动态的 UI 提供架构基础。该框架处理了序列化、传输和渲染的复杂性，因此你可以专注于设计卓越的用户体验。</p>

<p>你可以观看他们最近关于<a href="https://speakerdeck.com/camaelon/introducing-remotecompose-break-your-ui-out-of-the-app-sandbox">RemoteCompose 简介：将你的 UI 从应用程序沙盒中解放出来</a>的演讲。</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Alex Hilton</span></span>

      




<time class='entry-date' datetime='2025-12-11'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2025</span></span> <span class='time'>12:00 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/compose/'>compose</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
  
    <!-- JiaThis Button BEGIN -->
<div class="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2025/12/05/real-diff-between-withcontext-and-launch/" title="Previous Post: 深入理解withContext和launch的真正区别">&laquo; 深入理解withContext和launch的真正区别</a>
      
      
        <a class="basic-alignment right" href="/blog/2025/12/18/compose-december-2025/" title="Next Post: Jetpack Compose 2025年12月版本新增功能">Jetpack Compose 2025年12月版本新增功能 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="comments"></div>
    <!-- Duoshuo COMMENT BEGIN -->
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
    var clientId = 'bc66a01ef24d14fc282b'
    var clientSecret = 'c7fd5e55db1776204fe201fe20c050b140982884'
    var gitment = new Gitment({
      id: 'toughcoder.net',
      owner: 'alexhilton',
      repo: 'alexhilton.github.io',
      oauth: {
        client_id: clientId,
        client_secret: clientSecret,
      },
    })

    gitment.render('comments')
</script>
<!-- Duoshuo COMMENT END -->

  </section>

</div>

<aside class="sidebar">
  
    <section>
    <div class="
        col-lg-2 col-lg-offset-0
        visible-lg-block
        sidebar-container
        catalog-container">
        <div class="side-catalog">
            <hr class="hidden-sm hidden-xs">
            <h3>
                <a class="catalog-toggle" href="#">CATALOG</a>
            </h3>
            <ul class="catalog-body"></ul>
        </div>
    </div>
</section>
<!-- Back to top and Scroll to bottom -->
<a href="#" class="cd-top"></a>
<a href="#" class="cd-bottom"></a>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2026 - Alex Hilton -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  









<script type="text/javascript">
    //async load function 
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }

    function generateCatalog (selector) {
        var P = $('article'),a,n,t,l,i,c, id;
        a = P.find('h2,h3,h4,h5,h6');
        var index = 0;
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            id = $(this).prop('id');
            if (!id) {
                var nid = 'catalog-section-' + index;
                $(this).attr('id', nid);
                i = '#' + nid;
            } else {
                i = '#' + id;
            }
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
            index++;
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/javascripts/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });

// Navigation Scripts to Show Header on Scroll-Up
jQuery(document).ready(function($) {
    var MQL = 1170;

    //primary navigation slide-in effect
    if ($(window).width() > MQL) {
        // We do not have the sticky nav bar so, first can be zero
        var headerHeight = 0;
        $('nav').each(function() {
            var h = $(this).outerHeight(true);
            headerHeight += h;
        });
        $('header').each(function() {
            var h = $(this).outerHeight(true);
            headerHeight += h;
        });
        $(window).on('scroll', {
                previousTop: 0
            },
            function() {
                var currentTop = $(window).scrollTop(),
                    $catalog = $('.side-catalog');

                this.previousTop = currentTop;

                //adjust the appearance of side-catalog
                $catalog.show()
                if (currentTop > (headerHeight + 42)) {
                    $catalog.addClass('fixed')
                } else {
                    $catalog.removeClass('fixed')
                }
            });
    }
});
</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?3fab3b1bae08e6d4a5e638d9e8c6f40a";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


</body>
</html>
