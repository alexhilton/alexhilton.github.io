
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>å­¦ä¼šç”¨æœ€ä¼˜é›…çš„å§¿å¼åœ¨Composeä¸­æ˜¾ç¤ºå¯Œæ–‡æœ¬ - ç¨€æœ‰çŒ¿è¯‰</title>
  <meta name="author" content="Alex Hilton">

  
  <meta name="description" content="å¯Œæ–‡æœ¬æ˜¯UIä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªå…ƒç´ ï¼Œä½†å®˜æ–¹APIå¾€å¾€éå¸¸ç¹çã€‚æœ¬æ–‡å°†æ•™ä¼šä½ å°è£…ä¸€ä¸ªå¾®å‹APIï¼Œè®©ä½ ç”¨æœ€ä¼˜é›…çš„å§¿å¼æ˜¾ç¤ºå¯Œæ–‡æœ¬ã€‚">
  <meta name="keywords" content="Jetpack Compose, Compose, Android">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://alexhilton.github.io/blog/2025/07/30/styledstring-in-jetpack-compose">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="ç¨€æœ‰çŒ¿è¯‰" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script src="/javascripts/toolbar.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.lug.ustc.edu.cn/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.lug.ustc.edu.cn/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<!-- for Gitment -->
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">

<!-- for favicon -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">ç¨€æœ‰çŒ¿è¯‰</a></h1>
  
    <h2>åå¹´ç£¨ä¸€å‰‘ï¼Œå†ç‚¼å‡ºé”‹èŠ’ï¼Œè¯´è¯åƒç™¾å¥ï¼Œä¸å¦‚ç äºŒè¡Œã€‚</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com.hk/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:alexhilton.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/donation">Donation</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">å­¦ä¼šç”¨æœ€ä¼˜é›…çš„å§¿å¼åœ¨Composeä¸­æ˜¾ç¤ºå¯Œæ–‡æœ¬</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2025-07-30T22:50:40+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2025</span></span> <span class='time'>10:50 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><blockquote><p>æœ¬æ–‡è¯‘è‡ªã€ŒStyledString: A Better Pattern for Rich Text in Jetpack Composeã€ï¼ŒåŸæ–‡é“¾æ¥<a href="https://proandroiddev.com/styledstring-a-better-pattern-for-rich-text-in-jetpack-compose-5930bde981b1">https://proandroiddev.com/styledstring-a-better-pattern-for-rich-text-in-jetpack-compose-5930bde981b1</a>ï¼Œç”±Eury PÃ©rez BeltrÃ©å‘å¸ƒäº2025å¹´7æœˆ14æ—¥ã€‚</p></blockquote>

<p><a href="/blog/2025/07/30/styledstring-in-jetpack-compose/"><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NS_T-i72tS5eOs5F0f_Tnw.png" title="auto auto" ></a></p>

<!-- more -->


<p>åœ¨ Jetpack Compose ä¸­è®¾ç½®æ–‡æœ¬æ ·å¼çœ‹ä¼¼ç®€å•â€¦â€¦ä½†å…¶å®ä¸ç„¶ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ AnnotatedString çš„å±€é™æ€§ï¼Œä»¥åŠ StyledString å¦‚ä½•è®©å¯Œæ–‡æœ¬æ›´æ˜“äºç®¡ç†ã€‚è®©æˆ‘ä»¬æ¥è¯¦ç»†åˆ†æä¸€ä¸‹ã€‚ğŸ‘‡</p>

<h2>ğŸ“š ç›®å½•</h2>

<ol>
<li>å¼•è¨€ï¼šä¸€ä¸ªç²—ä½“å­—ã€ä¸€ä¸ªé“¾æ¥ï¼Œä»¥åŠä¸€å¤§å †éº»çƒ¦</li>
<li>AnnotatedStringï¼šæ ·å¼è¿‡å¤šï¼Œç®€æ´æ€§ä¸è¶³</li>
<li>StyledString ç®€ä»‹ï¼šä¸€ä¸ª API å³å¯è®¾ç½®æ‰€æœ‰æ ·å¼</li>
<li>StyledString åº•å±‚åŸç†ï¼šAPI èƒŒåçš„å¼•æ“</li>
<li>ç»“è¯­</li>
</ol>


<h2>å¼•è¨€ï¼šä¸€ä¸ªåŠ ç²—çš„å•è¯ã€ä¸€ä¸ªé“¾æ¥ï¼Œä»¥åŠä¸€å¤§å †éº»çƒ¦</h2>

<p>ä¸€å¼€å§‹ï¼Œä½ æ‹¥æœ‰äº† AnnotatedString å’Œä¸€ä¸ª SpanStyle ï¼Œä¸€åˆ‡çœ‹èµ·æ¥éƒ½å¾ˆé¡ºç•…ã€‚ä½ æƒ³åŠ ç²—ä¸€ä¸ªå•è¯ï¼Ÿå¾ˆç®€å•âœ…ã€‚ç»™æŸä¸ªä¸œè¥¿åŠ ä¸‹åˆ’çº¿ï¼Ÿæ²¡é—®é¢˜ã€‚è¿™ç”šè‡³æ„Ÿè§‰æœ‰ç‚¹æœ‰è¶£ï¼Œå°¤å…¶æ˜¯åœ¨ä½ åƒ<a href="https://developer.android.com/develop/ui/compose/text/style-text#multiple-styles">å®˜æ–¹æ–‡æ¡£</a>ä¸­é‚£æ ·æ‰‹åŠ¨æ„å»ºæ•´ä¸ªå­—ç¬¦ä¸²çš„æ—¶å€™ã€‚</p>

<p>ä½†é—®é¢˜æ˜¯ï¼šğŸ§ </p>

<p>å½“ä½ å®Œå…¨æ§åˆ¶å­—ç¬¦ä¸²æ—¶ï¼Œè¿™ç§æ–¹æ³•éå¸¸æœ‰æ•ˆã€‚ä½†å½“ä½ å¤„ç†å®é™…å†…å®¹ï¼šåŠ¨æ€å‰¯æœ¬ã€æœ¬åœ°åŒ–æ–‡æœ¬ã€ä»å…¶ä»–åœ°æ–¹ä¼ å…¥çš„æ®µè½ï¼Œè€Œä½ åªéœ€è¦è®¾ç½®å…¶ä¸­ä¸€éƒ¨åˆ†çš„æ ·å¼æ—¶ï¼Ÿ</p>

<p>äº‹æƒ…å¾ˆå¿«å°±å˜å¾—å¾ˆç³Ÿç³•ã€‚</p>

<p>çªç„¶é—´ï¼Œä½ éœ€è¦è·Ÿè¸ªå­å­—ç¬¦ä¸²ã€è®¡ç®—ç´¢å¼•ã€åº”ç”¨æ ·å¼ï¼Œå¹¶è¿æ¥ç‚¹å‡»ç›‘å¬å™¨ã€‚åªéœ€å¯¹æ–‡æœ¬è¿›è¡Œä¸€æ¬¡æ›´æ”¹ï¼Œä½ çš„é€»è¾‘å°±ä¼šåƒçº¸ç‰Œå±‹ä¸€æ ·å´©æºƒã€‚ğŸƒ</p>

<p>ä½ åŸæœ¬æƒ³è¦çš„åªæ˜¯åŠ ç²—ä¸€ä¸ªå•è¯å¹¶è®©é“¾æ¥å¯ç‚¹å‡»ã€‚ç°åœ¨ä½ æ·±é™·äºæ ·æ¿ä»£ç ä¸­ï¼Œç¥ˆç¥·ä¸€åˆ‡éƒ½ä¸ä¼šæ”¹å˜ã€‚</p>

<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†è§£é‡Šä¸ºä»€ä¹ˆ AnnotatedString åœ¨å®é™… UI ä¸­æ— æ³•å¾ˆå¥½åœ°æ‰©å±•ï¼Œå¹¶ä»‹ç»ä¸€ä¸ªæˆ‘ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œæ„å»ºçš„å¾®å‹æŠ½è±¡ã€‚å®ƒå«åš StyledStringï¼Œå®ƒçš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼šğŸ’¡ å®ƒç¡®å®åšåˆ°äº†ï¼š</p>

<p><strong>è®©Compose ä¸­çš„æ–‡æœ¬æ ·å¼å†æ¬¡å˜å¾—ç®€å•ã€‚</strong></p>

<h2>AnnotatedStringï¼šæ ·å¼å¤ªå¤šï¼Œç®€æ´æ€§ä¸è¶³</h2>

<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç§°èµä¸€ä¸‹ AnnotatedStringã€‚å®ƒæ˜¯ä¸€æ¬¾å¼ºå¤§çš„å·¥å…·ğŸ’ª.</p>

<p>ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª Text å¯ç»„åˆé¡¹æ¥åˆ›å»ºå¸¦æ ·å¼ã€å¯ç‚¹å‡»ã€å¯äº¤äº’çš„æ–‡æœ¬ã€‚æƒ³è¦è®©ä¸€ä¸ªå•è¯åŠ ç²—ï¼Œå¦ä¸€ä¸ªå•è¯åƒé“¾æ¥ä¸€æ ·æ˜¾ç¤ºï¼Ÿå®Œå…¨å¯ä»¥ã€‚è¯¥ API çµæ´»ã€åº•å±‚ï¼Œå¹¶ä¸”ç”± Compose æœ¬èº«çš„å¯Œæ–‡æœ¬å¼•æ“æ”¯æŒã€‚</p>

<p>é—®é¢˜æ˜¯ï¼Œå®ƒåªæœ‰<strong>åœ¨æ‰‹åŠ¨</strong>æ„å»ºæ•´ä¸ªå­—ç¬¦ä¸²æ—¶æ‰èƒ½å‘æŒ¥æœ€ä½³æ•ˆæœã€‚</p>

<p>æ–‡æ¡£ä¸­çš„å¤§å¤šæ•°ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">buildAnnotatedString</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">append</span><span class="p">(</span><span class="s">&quot;Hello &quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">withStyle</span><span class="p">(</span><span class="n">style</span> <span class="p">=</span> <span class="n">SpanStyle</span><span class="p">(</span><span class="n">fontWeight</span> <span class="p">=</span> <span class="n">FontWeight</span><span class="p">.</span><span class="n">Bold</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">append</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>çœ‹èµ·æ¥ä¸é”™ï¼Œå¯¹å§ï¼Ÿä½†æ£˜æ‰‹çš„åœ°æ–¹å°±åœ¨è¿™é‡Œã€‚ğŸ‘€</p>

<p>å¦‚æœä½ æœ‰ä¸€æ•´æ®µåŠ¨æ€æ–‡æœ¬ï¼Œæ¯”å¦‚ä¸€æ®µæœ¬åœ°åŒ–çš„å­—ç¬¦ä¸²æˆ–ä¸€ä¸ªä»å…¶ä»–åœ°æ–¹æ‹‰å–çš„å¥å­ï¼Œè€Œä½ åªæƒ³ä¸ºå…¶ä¸­çš„éƒ¨åˆ†å†…å®¹æ·»åŠ æ ·å¼ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</p>

<p>ç°åœ¨ä½ éœ€è¦å¤„ç†ï¼š</p>

<ul>
<li>æŸ¥æ‰¾è¦æ·»åŠ æ ·å¼çš„å­å­—ç¬¦ä¸²</li>
<li>è®¡ç®—èµ·å§‹å’Œç»“æŸç´¢å¼•</li>
<li>æ‰‹åŠ¨æ·»åŠ æ ·å¼æˆ–æ³¨é‡Š</li>
<li>å¸Œæœ›æ–‡æœ¬æ°¸è¿œä¸å˜ï¼Œå¦åˆ™ä¸€åˆ‡éƒ½ä¼šå´©æºƒã€‚</li>
</ul>


<p>å¦‚æœä½ éœ€è¦å¤šç§æ ·å¼ï¼Œæ¯”å¦‚ç²—ä½“å•è¯ã€å¯ç‚¹å‡»çš„ç”µå­é‚®ä»¶å’Œå¸¦ä¸‹åˆ’çº¿çš„ URLï¼ŒåŠ¨æ€åœ°ï¼Œäº‹æƒ…å¾ˆå¿«å°±ä¼šå˜å¾—æ··ä¹±ã€‚ğŸ”¥
è¿™æ—¶ï¼ŒbuildAnnotatedString å°±ä¼šå˜æˆä¸€å †è„†å¼±çš„ç´¢å¼•æ•°å­¦è¿ç®—ã€é‡å¤çš„é€»è¾‘å’Œæ ·æ¿ä»£ç ï¼Œéš¾ä»¥é˜…è¯»ï¼Œæ›´éš¾ä»¥ç»´æŠ¤ã€‚</p>

<p>å½“ç„¶ï¼ŒAnnotatedString åŠŸèƒ½å¼ºå¤§ã€‚ä½†å½“ä½ çš„æ–‡æœ¬æ˜¯åŠ¨æ€çš„ï¼Œè€Œä½ åªæƒ³ä¸ºå…¶ä¸­çš„éƒ¨åˆ†å†…å®¹æ·»åŠ æ ·å¼æ—¶ï¼Ÿå®ƒå¾ˆå¿«å°±ä¼šå˜å¾—ç´¢ç„¶æ— å‘³ã€‚</p>

<h2>StyledString éš†é‡å‡ºåœºï¼šä¸€ä¸ª API å³å¯å®ç°æ‰€æœ‰æ ·å¼</h2>

<p>åœ¨ä¸ AnnotatedString çº ç»“äº†æ— æ•°æ¬¡ä¹‹åï¼Œæˆ‘å†³å®šæ„å»ºä¸€ä¸ªæ›´å¥½çš„ä¸œè¥¿ã€‚å®ƒå¹¶éä¸€ä¸ªåºå¤§çš„åº“ï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ ·å¼æ¡†æ¶ã€‚è€Œæ˜¯ä¸€ä¸ªç®€å•ã€å…¼å®¹ Compose çš„æŠ½è±¡ï¼Œç”¨äºè§£å†³ä¸€ä¸ªéå¸¸å…·ä½“çš„é—®é¢˜ã€‚</p>

<p><strong>StyledString æ¥å•¦ï¼ğŸ‘‹</strong></p>

<p>å®ƒçš„ç›®æ ‡å¾ˆç®€å•ï¼šè®©ä½ å®šä¹‰å­—ç¬¦ä¸²çš„å“ªäº›éƒ¨åˆ†åº”è¯¥è¢«è®¾ç½®æ ·å¼æˆ–å¯ç‚¹å‡»ï¼Œè€Œæ— éœ€æ‹…å¿ƒ indexOf ã€ addStyle æˆ– AnnotatedString.Builder ã€‚ä½ åªéœ€ç¼–å†™æ–‡æœ¬ï¼Œå‘Šè¯‰å®ƒéœ€è¦è®¾ç½®å“ªäº›å•è¯çš„æ ·å¼ï¼Œä»¥åŠç‚¹å‡»åè¯¥æ‰§è¡Œçš„æ“ä½œã€‚</p>

<p>å®ƒçš„å®é™…æ•ˆæœå¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// This list can be built in the ViewModel</span>
</span><span class='line'><span class="k">val</span> <span class="py">styledStrings</span> <span class="p">=</span> <span class="n">persistentListOf</span><span class="p">(</span>
</span><span class='line'>    <span class="n">StyledString</span><span class="p">.</span><span class="n">ClickableEmail</span><span class="p">(</span>
</span><span class='line'>        <span class="n">highlightedText</span> <span class="p">=</span> <span class="s">&quot;support@example.com&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="n">email</span> <span class="p">=</span> <span class="s">&quot;support@example.com&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="n">style</span> <span class="p">=</span> <span class="n">SpanStyle</span><span class="p">(</span>
</span><span class='line'>            <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">Blue</span><span class="p">,</span>
</span><span class='line'>            <span class="n">textDecoration</span> <span class="p">=</span> <span class="n">TextDecoration</span><span class="p">.</span><span class="n">Underline</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>    <span class="p">),</span>
</span><span class='line'>    <span class="n">StyledString</span><span class="p">.</span><span class="n">ClickableUrl</span><span class="p">(</span>
</span><span class='line'>        <span class="n">highlightedText</span> <span class="p">=</span> <span class="s">&quot;website&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="n">url</span> <span class="p">=</span> <span class="s">&quot;https://euryperez.dev&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="n">style</span> <span class="p">=</span> <span class="n">SpanStyle</span><span class="p">(</span>
</span><span class='line'>            <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">Blue</span><span class="p">,</span>
</span><span class='line'>            <span class="n">textDecoration</span> <span class="p">=</span> <span class="n">TextDecoration</span><span class="p">.</span><span class="n">Underline</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// In your Compose Screen</span>
</span><span class='line'><span class="n">StyledText</span><span class="p">(</span>
</span><span class='line'>    <span class="n">fullText</span> <span class="p">=</span> <span class="s">&quot;Contact us at support@example.com or visit our website&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="n">styledStrings</span> <span class="p">=</span> <span class="n">styledStrings</span><span class="p">,</span>
</span><span class='line'>    <span class="n">style</span> <span class="p">=</span> <span class="n">MaterialTheme</span><span class="p">.</span><span class="n">typography</span><span class="p">.</span><span class="n">label</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span> <span class="n">styled</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="k">when</span> <span class="p">(</span><span class="n">styled</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">is</span> <span class="n">ClickableEmail</span> <span class="p">-&gt;</span> <span class="n">openEmailClient</span><span class="p">(</span><span class="n">styled</span><span class="p">.</span><span class="n">email</span><span class="p">)</span>
</span><span class='line'>            <span class="k">is</span> <span class="n">ClickableUrl</span> <span class="p">-&gt;</span> <span class="n">openUrl</span><span class="p">(</span><span class="n">styled</span><span class="p">.</span><span class="n">url</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>å°±æ˜¯è¿™æ ·ã€‚æ— éœ€æ‰‹åŠ¨æ„å»ºæ–‡æœ¬ï¼Œæ— éœ€ç´¢å¼•è®¡ç®—ï¼Œæ— éœ€æ ·æ¿ä»£ç ã€‚åªéœ€ç®€æ´ã€æ˜“è¯»ã€å£°æ˜å¼çš„æ ·å¼ï¼Œå³å¯ä¸çœŸå®æ–‡æœ¬å…¼å®¹ã€‚</p>

<p>ç”±äº StyledString æ”¯æŒ Simple ã€ ClickableEmail å’Œ ClickableUrl ç­‰ç±»å‹ï¼Œå› æ­¤å®ƒæ˜“äºåœ¨ä½ çš„åº”ç”¨ä¸­æ‰©å±•å’Œå¤ç”¨ã€‚ä½ å¯ä»¥è·å¾—å¯ç‚¹å‡»çš„ã€å¸¦æ ·å¼çš„æ–‡æœ¬ï¼Œè€Œæ— éœ€ç‰ºç‰²å…¶åˆç†æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ğŸ™</p>

<h2>StyledString çš„åº•å±‚ï¼šAPI èƒŒåçš„å¼•æ“</h2>

<p>è®©æˆ‘ä»¬æ­å¼€å®ƒçš„é¢çº±ï¼Œé€æ­¥äº†è§£ StyledString çš„å·¥ä½œåŸç†ã€‚ğŸª„</p>

<p>å½“ä½ åœ¨ UI ä¸­ä½¿ç”¨ StyledText æ—¶ï¼ŒğŸ§ å®ƒå¯èƒ½æ„Ÿè§‰åƒé­”æ³•ä¸€æ ·ç¥å¥‡ï¼Œä½†åœ¨å¹•åï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç®€æ´ã€æ˜“äºç»„åˆçš„æ¶æ„ï¼Œæ—¨åœ¨å‡å°‘æ ·å¼è®¾è®¡çš„ç—›è‹¦ï¼Œè€Œä¸ä¼šå¢åŠ ä¸å¿…è¦çš„å¤æ‚æ€§ã€‚</p>

<p>æœ¬èŠ‚æ¶µç›–äº† StyledString ç³»ç»Ÿçš„æ¯ä¸ªéƒ¨åˆ†ï¼Œä»æ ·å¼çš„æè¿°æ–¹å¼ï¼Œåˆ°æ ·å¼çš„æŸ¥æ‰¾ã€åº”ç”¨å’Œåœ¨å±å¹•ä¸Šæ¸²æŸ“ã€‚</p>

<h3>ğŸ§± 1. æ•°æ®æ¨¡å‹ï¼šStyledString å’Œ ClickableStyleString</h3>

<p>æ•´ä¸ªå®ç”¨ç¨‹åºçš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªåä¸º StyledString çš„å¯†å°æ¥å£ã€‚æˆ‘ä»¬é€šè¿‡å®ƒæ¥å¯¹éœ€è¦ä»¥æŸç§æ–¹å¼è®¾ç½®æ ·å¼çš„æ–‡æœ¬ç‰‡æ®µè¿›è¡Œå»ºæ¨¡ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Immutable</span>
</span><span class='line'><span class="n">sealed</span> <span class="n">interface</span> <span class="n">StyledString</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">highlightedText</span><span class="p">:</span> <span class="n">String</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">style</span><span class="p">:</span> <span class="n">SpanStyle</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Add `Simple` type</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Add `ClickableEmail` type</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Add `ClickableUrl` type</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¯ä¸ª StyledString éƒ½éœ€è¦ä¸¤æ¡ä¿¡æ¯ï¼š</p>

<ul>
<li>highlightedTextï¼šéœ€è¦è®¾ç½®æ ·å¼çš„æ–‡æœ¬çš„ç¡®åˆ‡éƒ¨åˆ†</li>
<li>styleï¼šå®šä¹‰å…¶å¤–è§‚çš„ SpanStyleï¼ˆé¢œè‰²ã€ä¸‹åˆ’çº¿ã€å­—ä½“ç²—ç»†ç­‰ï¼‰ã€‚</li>
</ul>


<p>ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰ä¸€äº›å®ç°æ­¤æ¥å£çš„ç‰¹å®šç±»å‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Immutable</span>
</span><span class='line'><span class="n">data</span> <span class="k">class</span> <span class="nc">Simple</span><span class="p">(</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="py">highlightedText</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="py">style</span><span class="p">:</span> <span class="n">SpanStyle</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span> <span class="p">:</span> <span class="n">StyledString</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ä¸ªæ˜¯çº¯è§†è§‰æ•ˆæœçš„ï¼Œå®ƒä¼šæ”¹å˜æ–‡æœ¬çš„å¤–è§‚ï¼Œä½†ä¸å“åº”ç‚¹å‡»ã€‚</p>

<p>ç„¶åæˆ‘ä»¬ä»‹ç»äº¤äº’ç±»å‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Immutable</span>
</span><span class='line'><span class="n">data</span> <span class="k">class</span> <span class="nc">ClickableEmail</span><span class="p">(</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="py">highlightedText</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">email</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="py">style</span><span class="p">:</span> <span class="n">SpanStyle</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span> <span class="p">:</span> <span class="n">StyledString</span><span class="p">,</span> <span class="n">ClickableStyleString</span>
</span><span class='line'>
</span><span class='line'><span class="n">@Immutable</span>
</span><span class='line'><span class="n">data</span> <span class="k">class</span> <span class="nc">ClickableUrl</span><span class="p">(</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="py">highlightedText</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">url</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
</span><span class='line'>    <span class="k">override</span> <span class="k">val</span> <span class="py">style</span><span class="p">:</span> <span class="n">SpanStyle</span>
</span><span class='line'><span class="p">)</span> <span class="p">:</span> <span class="n">StyledString</span><span class="p">,</span> <span class="n">ClickableStyleString</span>
</span></code></pre></td></tr></table></div></figure>


<p>å®ƒä»¬æ‰§è¡Œç›¸åŒçš„æ ·å¼è®¾ç½®å·¥ä½œï¼Œä½†è¿˜æºå¸¦é¢å¤–çš„æ•°æ®ï¼ˆä¾‹å¦‚ç‚¹å‡»æ—¶åº”æ‰“å¼€çš„ URL æˆ–ç”µå­é‚®ä»¶ï¼‰ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒä»¬å®ç°äº†ç¬¬äºŒä¸ªæ¥å£ï¼šClickableStyleStringã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">sealed</span> <span class="n">interface</span> <span class="n">ClickableStyleString</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ä¸ªå°æ¥å£æ„ä¹‰é‡å¤§ï¼Œå®ƒè®©æˆ‘ä»¬èƒ½å¤ŸåŒºåˆ†çº¯è§†è§‰æ ·å¼å’Œåº”è¯¥å“åº”ç‚¹å‡»çš„æ ·å¼ã€‚è¿™ä½¿å¾—æˆ‘ä»¬çš„ç‚¹å‡»å¤„ç†é€»è¾‘ç®€æ´ä¸”ç±»å‹å®‰å…¨ã€‚ğŸ’¡</p>

<p>ä½ å¯ä»¥è½»æ¾æ·»åŠ æ›´å¤šå˜ä½“ï¼Œä¾‹å¦‚ @mentionsã€#hashtags æˆ–ç”µè¯å·ç ï¼Œåªéœ€åˆ›å»ºå¦ä¸€ä¸ªæ•°æ®ç±»å¹¶é€‰æ‹©æ€§åœ°å®ç°ClickableStyleString å³å¯ã€‚</p>

<h3>ğŸ¯ 2. æ ·å¼å’Œé“¾æ¥ï¼šapplyStyle</h3>

<p>ä¸€æ—¦æˆ‘ä»¬çŸ¥é“äº†å“ªäº›æ–‡æœ¬éœ€è¦æ ·å¼ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ç§å°†è¿™äº›æ ·å¼åº”ç”¨äºå®é™…çš„ AnnotatedString çš„æ–¹æ³•ã€‚è¿™å°±æ˜¯ applyStyle() çš„ä½œç”¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•çš„æ‰©å±•å‡½æ•°ï¼Œå®ƒæ ¹æ® StyledString çš„ç±»å‹åº”ç”¨æ ·å¼ï¼ˆå’Œç‚¹å‡»ç›‘å¬å™¨ï¼‰ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">private</span> <span class="k">fun</span> <span class="nf">AnnotatedString</span><span class="p">.</span><span class="n">Builder</span><span class="p">.</span><span class="n">applyStyle</span><span class="p">(</span>
</span><span class='line'>    <span class="n">styledString</span><span class="p">:</span> <span class="n">StyledString</span><span class="p">,</span>
</span><span class='line'>    <span class="n">startIndex</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
</span><span class='line'>    <span class="n">endIndex</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onClick</span><span class="p">:</span> <span class="p">(</span><span class="n">ClickableStyleString</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Unit</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">when</span> <span class="p">(</span><span class="n">styledString</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">is</span> <span class="n">StyledString</span><span class="p">.</span><span class="n">ClickableUrl</span> <span class="p">-&gt;</span> <span class="n">TODO</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">is</span> <span class="n">StyledString</span><span class="p">.</span><span class="n">ClickableEmail</span> <span class="p">-&gt;</span> <span class="n">TODO</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">is</span> <span class="n">StyledString</span><span class="p">.</span><span class="n">Simple</span> <span class="p">-&gt;</span> <span class="n">TODO</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ¯æ¬¡åŒ¹é…æ¯ä¸ª StyledString æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨ä¸€æ¬¡æ­¤å‡½æ•°ã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å®ƒåšäº†ä»€ä¹ˆï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">is</span> <span class="n">StyledString</span><span class="p">.</span><span class="n">ClickableUrl</span> <span class="p">-&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">linkAnnotation</span> <span class="p">=</span> <span class="n">LinkAnnotation</span><span class="p">.</span><span class="n">Url</span><span class="p">(</span>
</span><span class='line'>        <span class="n">url</span> <span class="p">=</span> <span class="n">styledString</span><span class="p">.</span><span class="n">url</span><span class="p">,</span>
</span><span class='line'>        <span class="n">styles</span> <span class="p">=</span> <span class="n">TextLinkStyles</span><span class="p">(</span><span class="n">style</span> <span class="p">=</span> <span class="n">styledString</span><span class="p">.</span><span class="n">style</span><span class="p">),</span>
</span><span class='line'>        <span class="n">linkInteractionListener</span> <span class="p">=</span> <span class="p">{</span> <span class="n">onClick</span><span class="p">(</span><span class="n">styledString</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="n">addLink</span><span class="p">(</span><span class="n">linkAnnotation</span><span class="p">,</span> <span class="n">startIndex</span><span class="p">,</span> <span class="n">endIndex</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœæ˜¯ URLï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ª LinkAnnotation.Url å¯¹è±¡ï¼Œé™„åŠ æ ·å¼ï¼Œå¹¶ä¸ºå…¶æ·»åŠ ä¸€ä¸ªç‚¹å‡»ç›‘å¬å™¨ã€‚addLink è´Ÿè´£å°†å…¶é™„åŠ åˆ°æ­£ç¡®çš„æ–‡æœ¬èŒƒå›´ã€‚</p>

<p>æˆ‘ä»¬æ‰§è¡Œçš„æ“ä½œç±»ä¼¼ï¼Œä½†é’ˆå¯¹ç”µå­é‚®ä»¶ä½¿ç”¨çš„æ˜¯ LinkAnnotation.Clickable ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">is</span> <span class="n">StyledString</span><span class="p">.</span><span class="n">ClickableEmail</span> <span class="p">-&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">linkAnnotation</span> <span class="p">=</span> <span class="n">LinkAnnotation</span><span class="p">.</span><span class="n">Clickable</span><span class="p">(</span>
</span><span class='line'>        <span class="n">tag</span> <span class="p">=</span> <span class="n">styledString</span><span class="p">.</span><span class="n">highlightedText</span><span class="p">,</span>
</span><span class='line'>        <span class="n">styles</span> <span class="p">=</span> <span class="n">TextLinkStyles</span><span class="p">(</span><span class="n">style</span> <span class="p">=</span> <span class="n">styledString</span><span class="p">.</span><span class="n">style</span><span class="p">),</span>
</span><span class='line'>        <span class="n">linkInteractionListener</span> <span class="p">=</span> <span class="p">{</span> <span class="n">onClick</span><span class="p">(</span><span class="n">styledString</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>    <span class="n">addLink</span><span class="p">(</span><span class="n">linkAnnotation</span><span class="p">,</span> <span class="n">startIndex</span><span class="p">,</span> <span class="n">endIndex</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æœæ ·å¼åªæ˜¯è§†è§‰ä¸Šçš„ï¼ˆä¸å¯ç‚¹å‡»ï¼‰ï¼Œæˆ‘ä»¬ä¼šåº”ç”¨å¸¸è§„è·¨åº¦ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">is</span> <span class="n">StyledString</span><span class="p">.</span><span class="n">Simple</span> <span class="p">-&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">addStyle</span><span class="p">(</span>
</span><span class='line'>        <span class="n">style</span> <span class="p">=</span> <span class="n">styledString</span><span class="p">.</span><span class="n">style</span><span class="p">,</span>
</span><span class='line'>        <span class="n">start</span> <span class="p">=</span> <span class="n">startIndex</span><span class="p">,</span>
</span><span class='line'>        <span class="n">end</span> <span class="p">=</span> <span class="n">endIndex</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ç§åˆ†ç¦»å°†æ‰€æœ‰æ ·å¼åº”ç”¨é€»è¾‘é›†ä¸­åœ¨ä¸€å¤„ã€‚å¦‚æœä½ æƒ³è¦æ”¯æŒæ–°çš„é“¾æ¥ç±»å‹æˆ–è¡Œä¸ºï¼Œåªéœ€æ›´æ–°æ­¤å‡½æ•°å³å¯ã€‚</p>

<h3>ğŸ” 3. åŒ¹é…æ–‡æœ¬ï¼šfindAllOccurrences</h3>

<p>åœ¨åº”ç”¨æ ·å¼ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ–‡æœ¬ä¸­æ‰€æœ‰å‡ºç°æŒ‡å®šhighlightedText çš„ä½ç½®ã€‚è¿™å°±æ˜¯æ­¤å‡½æ•°çš„ç”¨é€”ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Find all occurrences of a substring in a string, optionally ignoring case.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * @param substring The substring to search for.</span>
</span><span class='line'><span class="cm"> * @param ignoreCase Whether to perform a case-insensitive search.</span>
</span><span class='line'><span class="cm"> * @return A list of indices where the substring was found.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="k">private</span> <span class="k">fun</span> <span class="nf">String</span><span class="p">.</span><span class="n">findAllOccurrences</span><span class="p">(</span>
</span><span class='line'>    <span class="n">substring</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
</span><span class='line'>    <span class="n">ignoreCase</span><span class="p">:</span> <span class="n">Boolean</span> <span class="p">=</span> <span class="k">false</span>
</span><span class='line'><span class="p">):</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™å°†è·å–å…¨æ–‡ï¼Œå¹¶è¿”å›ç»™å®šå­å­—ç¬¦ä¸²çš„æ¯ä¸ªåŒ¹é…é¡¹çš„èµ·å§‹ç´¢å¼•åˆ—è¡¨ã€‚</p>

<p>å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">substring</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">())</span> <span class="k">return</span> <span class="n">emptyList</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¯¹äºç©ºå­å­—ç¬¦ä¸²ï¼Œå¿«é€Ÿæå‰é€€å‡ºã€‚é¿å…å¥‡æ€ªçš„è¾¹ç¼˜æƒ…å†µã€‚ç„¶åï¼Œæˆ‘ä»¬å‡†å¤‡è¿›è¡Œä¸åŒºåˆ†å¤§å°å†™çš„æœç´¢ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">val</span> <span class="py">indices</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;()</span>
</span><span class='line'><span class="k">val</span> <span class="py">searchString</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">ignoreCase</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="n">lowercase</span><span class="p">()</span> <span class="k">else</span> <span class="k">this</span>
</span><span class='line'><span class="k">val</span> <span class="py">searchSubstring</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">ignoreCase</span><span class="p">)</span> <span class="n">substring</span><span class="p">.</span><span class="n">lowercase</span><span class="p">()</span> <span class="k">else</span> <span class="n">substring</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç°åœ¨æˆ‘ä»¬éå†å­—ç¬¦ä¸²ï¼Œæ‰¾åˆ°æ‰€æœ‰åŒ¹é…é¡¹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">var</span> <span class="py">startIndex</span> <span class="p">=</span> <span class="m">0</span>
</span><span class='line'><span class="k">val</span> <span class="py">maxStartIndex</span> <span class="p">=</span> <span class="n">length</span> <span class="p">-</span> <span class="n">substring</span><span class="p">.</span><span class="n">length</span>
</span><span class='line'>
</span><span class='line'><span class="k">while</span> <span class="p">(</span><span class="n">startIndex</span> <span class="p">&lt;=</span> <span class="n">maxStartIndex</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">index</span> <span class="p">=</span> <span class="n">searchString</span><span class="p">.</span><span class="n">indexOf</span><span class="p">(</span><span class="n">searchSubstring</span><span class="p">,</span> <span class="n">startIndex</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="p">==</span> <span class="p">-</span><span class="m">1</span><span class="p">)</span> <span class="k">break</span>
</span><span class='line'>    <span class="n">indices</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span class='line'>    <span class="n">startIndex</span> <span class="p">=</span> <span class="n">index</span> <span class="p">+</span> <span class="m">1</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬æœ€ç»ˆè¿”å›ç»“æœï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">return</span> <span class="n">indices</span><span class="p">.</span><span class="n">toList</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ä½¿å¾—æˆ‘ä»¬çš„æ ·å¼é€»è¾‘ä¿æŒçµæ´»æ€§å’Œå¼¹æ€§ï¼Œæ— è®ºæˆ‘ä»¬è®¾è®¡çš„å•è¯å‡ºç°ä¸€æ¬¡è¿˜æ˜¯åå‡ æ¬¡ã€‚</p>

<h3>ğŸ§  4. æ„å»º AnnotatedStringï¼šrememberStyledAnnotationString</h3>

<p>ä»¥ä¸‹å‡½æ•°å°†æ‰€æœ‰å†…å®¹æ•´åˆåœ¨ä¸€èµ·ã€‚å®ƒæ¥æ”¶å®Œæ•´æ–‡æœ¬å’Œä½ çš„StyledString åˆ—è¡¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªåº”ç”¨äº†æ‰€æœ‰æ ·å¼çš„ AnnotatedStringã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">rememberStyledAnnotationString</span><span class="p">(</span>
</span><span class='line'>    <span class="n">fullText</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
</span><span class='line'>    <span class="n">styledStrings</span><span class="p">:</span> <span class="n">ImmutableList</span><span class="p">&lt;</span><span class="n">StyledString</span><span class="p">&gt;,</span>
</span><span class='line'>    <span class="n">ignoreCase</span><span class="p">:</span> <span class="n">Boolean</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onClick</span><span class="p">:</span> <span class="p">(</span><span class="n">ClickableStyleString</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Unit</span>
</span><span class='line'><span class="p">):</span> <span class="n">AnnotatedString</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬ç¡®ä¿ä½¿ç”¨ rememberUpdatedState() æ¥ä¿æŒç‚¹å‡»ç›‘å¬å™¨çš„æœ€æ–°çŠ¶æ€ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">val</span> <span class="py">currentOnClick</span> <span class="k">by</span> <span class="n">rememberUpdatedState</span><span class="p">(</span><span class="n">onClick</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç„¶åæˆ‘ä»¬ä½¿ç”¨è®°ä½æ¥ç¼“å­˜å·¥ä½œï¼Œé™¤éè¾“å…¥å‘ç”Ÿå˜åŒ–ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">return</span> <span class="n">remember</span><span class="p">(</span><span class="n">fullText</span><span class="p">,</span> <span class="n">styledStrings</span><span class="p">,</span> <span class="n">ignoreCase</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// TODO: build annotated string</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬é¦–å…ˆé™„åŠ å®Œæ•´çš„æœªæ ·å¼åŒ–çš„æ–‡æœ¬ã€‚ç„¶åï¼Œå¯¹äºæ¯ä¸ª StyledString ï¼Œæˆ‘ä»¬æ‰¾åˆ°æ‰€æœ‰åŒ¹é…çš„ä½ç½®å¹¶åº”ç”¨æ ·å¼ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">buildAnnotatedString</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">append</span><span class="p">(</span><span class="n">fullText</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">styledStrings</span><span class="p">.</span><span class="n">fastForEach</span> <span class="p">{</span> <span class="n">styledStringInfo</span> <span class="p">-&gt;</span>
</span><span class='line'>        <span class="k">val</span> <span class="py">indices</span> <span class="p">=</span>
</span><span class='line'>            <span class="n">fullText</span><span class="p">.</span><span class="n">findAllOccurrences</span><span class="p">(</span><span class="n">styledStringInfo</span><span class="p">.</span><span class="n">highlightedText</span><span class="p">,</span> <span class="n">ignoreCase</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">indices</span><span class="p">.</span><span class="n">fastForEach</span> <span class="p">{</span> <span class="n">startIndex</span> <span class="p">-&gt;</span>
</span><span class='line'>            <span class="k">val</span> <span class="py">endIndex</span> <span class="p">=</span> <span class="n">startIndex</span> <span class="p">+</span> <span class="n">styledStringInfo</span><span class="p">.</span><span class="n">highlightedText</span><span class="p">.</span><span class="n">length</span>
</span><span class='line'>            <span class="n">applyStyle</span><span class="p">(</span><span class="n">styledStringInfo</span><span class="p">,</span> <span class="n">startIndex</span><span class="p">,</span> <span class="n">endIndex</span><span class="p">,</span> <span class="n">currentOnClick</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ä¸ªå¾ªç¯ä½¿å¾—æ ·å¼è®¾ç½®èƒ½å¤ŸåŠ¨æ€ä¸”å¤šç›®æ ‡åŒ–ã€‚ä½ å¯ä»¥å°†ä»»ä½•æœ¬åœ°åŒ–æˆ–è¿è¡Œæ—¶ç”Ÿæˆçš„å­—ç¬¦ä¸²ä½œä¸º fullText ä¼ é€’ï¼Œå®ƒä»ç„¶èƒ½å¤Ÿæ­£ç¡®åº”ç”¨æ ·å¼ã€‚</p>

<h3>ğŸ§© 5. å¯ç»„åˆé¡¹ï¼šStyledText</h3>

<p>æœ€åï¼ŒStyledText å¯ç»„åˆé¡¹å°†æ‰€æœ‰å†…å®¹è¿æ¥åœ¨ä¸€èµ·ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">fun</span> <span class="nf">StyledText</span><span class="p">(</span>
</span><span class='line'>    <span class="n">fullText</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
</span><span class='line'>    <span class="n">styledStrings</span><span class="p">:</span> <span class="n">ImmutableList</span><span class="p">&lt;</span><span class="n">StyledString</span><span class="p">&gt;,</span>
</span><span class='line'>    <span class="n">style</span><span class="p">:</span> <span class="n">TextStyle</span><span class="p">,</span>
</span><span class='line'>    <span class="n">modifier</span><span class="p">:</span> <span class="n">Modifier</span> <span class="p">=</span> <span class="n">Modifier</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onClick</span><span class="p">:</span> <span class="p">(</span><span class="n">ClickableStyleString</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Unit</span> <span class="p">=</span> <span class="p">{},</span>
</span><span class='line'>    <span class="n">ignoreCase</span><span class="p">:</span> <span class="n">Boolean</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
</span><span class='line'><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// TODO: Implementation</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½ ä¼ å…¥å…¨æ–‡ã€æ ·å¼ä»¥åŠå¯é€‰çš„ç‚¹å‡»å¤„ç†ç¨‹åºã€‚å®ƒçš„å†…éƒ¨åŠŸèƒ½å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">val</span> <span class="py">annotatedString</span> <span class="p">=</span> <span class="n">rememberStyledAnnotationString</span><span class="p">(</span>
</span><span class='line'>    <span class="n">fullText</span> <span class="p">=</span> <span class="n">fullText</span><span class="p">,</span>
</span><span class='line'>    <span class="n">styledStrings</span> <span class="p">=</span> <span class="n">styledStrings</span><span class="p">,</span>
</span><span class='line'>    <span class="n">ignoreCase</span> <span class="p">=</span> <span class="n">ignoreCase</span><span class="p">,</span>
</span><span class='line'>    <span class="n">onClick</span> <span class="p">=</span> <span class="n">onClick</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™è°ƒç”¨äº†æˆ‘ä»¬åˆšåˆšè®²è¿‡çš„é€»è¾‘ã€‚å®ƒè¿”å›ä¸€ä¸ªå¸¦æ ·å¼çš„ AnnotatedString ã€‚ç„¶åæˆ‘ä»¬æ¸²æŸ“å®ƒï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">Text</span><span class="p">(</span>
</span><span class='line'>    <span class="n">modifier</span> <span class="p">=</span> <span class="n">modifier</span><span class="p">,</span>
</span><span class='line'>    <span class="n">text</span> <span class="p">=</span> <span class="n">annotatedString</span><span class="p">,</span>
</span><span class='line'>    <span class="n">style</span> <span class="p">=</span> <span class="n">style</span>
</span><span class='line'><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>å®ƒåªæ˜¯ä¸€ä¸ªæ™®é€šçš„ Compose Text ã€‚ä½†æ‰€æœ‰æ ·å¼é€»è¾‘éƒ½å·²é¢„å…ˆçƒ˜ç„™ã€‚ç°åœ¨ï¼Œä½ çš„ UI ä»£ç ä¿æŒç®€æ´ä¸”å£°æ˜å¼ã€‚ğŸŒš</p>

<h3>âš¡ï¸ 6. StyledText å®è·µ</h3>

<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ StyledText çš„å®è·µï¼Œä¸ºæ­¤ï¼Œæˆ‘æ•´ç†äº†ä¸€ä¸ªé¢„è§ˆï¼Œä½ å¯ä»¥è‡ªå·±æµ‹è¯•ä¸€ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="n">@PreviewLightDark</span>
</span><span class='line'><span class="n">@Composable</span>
</span><span class='line'><span class="k">private</span> <span class="k">fun</span> <span class="nf">StyledTextPreview</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">MyTheme</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">Box</span><span class="p">(</span>
</span><span class='line'>            <span class="n">modifier</span> <span class="p">=</span> <span class="n">Modifier</span>
</span><span class='line'>                <span class="p">.</span><span class="n">background</span><span class="p">(</span><span class="n">color</span> <span class="p">=</span> <span class="n">MaterialTheme</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">background</span><span class="p">)</span>
</span><span class='line'>                <span class="p">.</span><span class="n">padding</span><span class="p">(</span><span class="m">16.</span><span class="n">dp</span><span class="p">)</span>
</span><span class='line'>        <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// This list can be built in the ViewModel</span>
</span><span class='line'>            <span class="k">val</span> <span class="py">styledStrings</span> <span class="p">=</span> <span class="n">persistentListOf</span><span class="p">(</span>
</span><span class='line'>                <span class="n">StyledString</span><span class="p">.</span><span class="n">ClickableEmail</span><span class="p">(</span>
</span><span class='line'>                    <span class="n">highlightedText</span> <span class="p">=</span> <span class="s">&quot;support@example.com&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">email</span> <span class="p">=</span> <span class="s">&quot;support@example.com&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">style</span> <span class="p">=</span> <span class="n">SpanStyle</span><span class="p">(</span>
</span><span class='line'>                        <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">Gray</span><span class="p">,</span>
</span><span class='line'>                        <span class="n">textDecoration</span> <span class="p">=</span> <span class="n">TextDecoration</span><span class="p">.</span><span class="n">Underline</span>
</span><span class='line'>                    <span class="p">)</span>
</span><span class='line'>                <span class="p">),</span>
</span><span class='line'>                <span class="n">StyledString</span><span class="p">.</span><span class="n">ClickableUrl</span><span class="p">(</span>
</span><span class='line'>                    <span class="n">highlightedText</span> <span class="p">=</span> <span class="s">&quot;website&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">url</span> <span class="p">=</span> <span class="s">&quot;https://euryperez.dev&quot;</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">style</span> <span class="p">=</span> <span class="n">SpanStyle</span><span class="p">(</span>
</span><span class='line'>                        <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">Gray</span><span class="p">,</span>
</span><span class='line'>                        <span class="n">textDecoration</span> <span class="p">=</span> <span class="n">TextDecoration</span><span class="p">.</span><span class="n">Underline</span>
</span><span class='line'>                    <span class="p">)</span>
</span><span class='line'>                <span class="p">)</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// In your Compose Screen</span>
</span><span class='line'>            <span class="n">StyledText</span><span class="p">(</span>
</span><span class='line'>                <span class="n">fullText</span> <span class="p">=</span> <span class="s">&quot;Contact us at support@example.com or visit our website&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="n">styledStrings</span> <span class="p">=</span> <span class="n">styledStrings</span><span class="p">,</span>
</span><span class='line'>                <span class="n">style</span> <span class="p">=</span> <span class="n">MaterialTheme</span><span class="p">.</span><span class="n">typography</span><span class="p">.</span><span class="n">body2</span><span class="p">,</span>
</span><span class='line'>                <span class="n">color</span> <span class="p">=</span> <span class="n">MaterialTheme</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">onBackground</span><span class="p">,</span>
</span><span class='line'>                <span class="n">onClick</span> <span class="p">=</span> <span class="p">{</span> <span class="n">styled</span> <span class="p">-&gt;</span>
</span><span class='line'>                    <span class="k">when</span> <span class="p">(</span><span class="n">styled</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                        <span class="k">is</span> <span class="n">StyledString</span><span class="p">.</span><span class="n">ClickableEmail</span> <span class="p">-&gt;</span> <span class="n">TODO</span><span class="p">()</span>
</span><span class='line'>                        <span class="k">is</span> <span class="n">StyledString</span><span class="p">.</span><span class="n">ClickableUrl</span> <span class="p">-&gt;</span> <span class="n">TODO</span><span class="p">()</span>
</span><span class='line'>                    <span class="p">}</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>            <span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½ å°†åœ¨é¢„è§ˆä¸­çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š
<img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Tc22BNoUfij54fBGQ7YCg.png" alt="StyledTextPreview" /></p>

<h3>âœ… æ€»ç»“ï¼šä¸€ä¸ªè¾“å‡ºç®€æ´çš„ç®€å•å¼•æ“</h3>

<p>æ€»è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªå®Œå…¨å¯å¤ç”¨çš„ Compose å®ç”¨ç¨‹åºï¼Œå®ƒï¼š</p>

<ul>
<li>ä½¿ç”¨ StyledString ä»¥å£°æ˜å¼æ–¹å¼æè¿°æ ·å¼</li>
<li>å®‰å…¨åœ°åŒºåˆ†å¯è§†æ ·å¼å’Œå¯ç‚¹å‡»æ ·å¼</li>
<li>ä½¿ç”¨ applyStyle åº”ç”¨ span å’Œ link</li>
<li>ä½¿ç”¨ findAllOccurrences æŸ¥æ‰¾å¤šä¸ªåŒ¹é…é¡¹</li>
<li>ä»¥ Compose ç¨³å®šçš„æ–¹å¼ç»„è£…æ‰€æœ‰å†…å®¹</li>
<li>å°è£…åœ¨ä¸€ä¸ªç®€æ´çš„ API ä¸­ï¼šStyledText</li>
</ul>


<p>æ— éœ€ indexOf ï¼Œæ— éœ€å¤æ‚çš„èŒƒå›´é€»è¾‘ï¼Œä¹Ÿæ— éœ€å¤åˆ¶ç²˜è´´ buildAnnotatedStringæ ·æ¿ä»£ç ã€‚</p>

<p><a href="https://gist.github.com/euri16/614a460fe6a690ce57cd23cc41164b5a">ç‚¹å‡»æ­¤å¤„</a>ï¼ˆé“¾æ¥ï¼š<a href="https://gist.github.com/euri16/614a460fe6a690ce57cd23cc41164b5a%EF%BC%89%E8%8E%B7%E5%8F%96%E5%AE%8C%E6%95%B4%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E3%80%82">https://gist.github.com/euri16/614a460fe6a690ce57cd23cc41164b5a%EF%BC%89%E8%8E%B7%E5%8F%96%E5%AE%8C%E6%95%B4%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E3%80%82</a></p>

<h2>ç»“è¯­ğŸ¯</h2>

<p>Jetpack Compose èµ‹äºˆæˆ‘ä»¬å¼ºå¤§çš„åŠŸèƒ½ï¼Œä½†å¹¶éæ€»æ˜¯æœ€ç¬¦åˆäººä½“å·¥ç¨‹å­¦çš„å¼€ç®±å³ç”¨å·¥å…·ã€‚AnnotatedString å¯¹äºä¸€æ¬¡æ€§éœ€æ±‚æ¥è¯´éå¸¸æ£’ï¼Œä½†ä¸€æ—¦ä½ çš„ UI éœ€è¦å¤šç§æ ·å¼ã€å¤ç”¨æ¨¡å¼æˆ–åŠ¨æ€ç‚¹å‡»å¤„ç†ï¼Œå®ƒå°±ä¼šå¾ˆå¿«å˜å¾—å†—é•¿ã€‚</p>

<p>è¿™å°±æ˜¯ StyledString çš„ç”¨æ­¦ä¹‹åœ°ã€‚</p>

<p>å®ƒå¹¶éå–ä»£ AnnotatedStringï¼Œè€Œæ˜¯å¯¹å…¶è¿›è¡ŒåŒ…è£…ï¼Œä¸ºä½ æä¾›ä¸€ç§æ›´å®‰å…¨ã€æ›´æ¸…æ™°çš„æ–¹å¼æ¥æè¿°æ„å›¾ï¼š</p>

<ul>
<li>â†’ â€œå°†æ­¤å•è¯åŠ ç²—â€</li>
<li>â†’ â€œå°†æ­¤çŸ­è¯­è®¾ä¸ºé“¾æ¥â€</li>
<li>â†’ â€œä¸ºè¯¥å­—ç¬¦ä¸²çš„æ¯ä¸ªå®ä¾‹è®¾ç½®æ ·å¼â€</li>
</ul>


<p>ä½ æ— éœ€å†è€ƒè™‘æ–‡æœ¬åç§»é‡å’Œè·¨åº¦èŒƒå›´ï¼Œè€Œæ˜¯å¼€å§‹æ€è€ƒå«ä¹‰ã€‚ç»“æœï¼šä»£ç æ›´ç®€æ´ã€æ ·æ¿æ›´å°‘ï¼Œå¼€å‘è€…ä½“éªŒæ›´ä½³ğŸ’†</p>

<h3>ğŸ§© æ˜“äºé‡‡ç”¨</h3>

<p>ä½ æ— éœ€é‡æ„æ•´ä¸ªåº”ç”¨å³å¯ä½¿ç”¨ StyledString ã€‚</p>

<p>åªéœ€å°†ä¸€ä¸¤ä¸ª Text() å…ƒç´ æ›¿æ¢ä¸º StyledText() å³å¯ã€‚å°†å†…è”çš„ buildAnnotatedString { &hellip; } å—æ›¿æ¢ä¸º StyledString.Simple æˆ– ClickableUrl çš„ç®€å•åˆ—è¡¨å³å¯ã€‚</p>

<p>å°±è¿™æ ·ï¼Œä½ å°±æˆåŠŸäº†ã€‚âœ¨</p>

<h3>ğŸ› ï¸ æ˜“äºæ‰©å±•</h3>

<p>è¿˜æœ‰å…¶ä»–ç”¨ä¾‹å—ï¼Ÿ</p>

<ul>
<li>ä¸º #hashtags è®¾ç½®æ ·å¼ï¼Ÿ</li>
<li>å¤„ç† @mentionsï¼Ÿ</li>
<li>è‡ªåŠ¨æ£€æµ‹ç”µè¯å·ç ï¼Ÿ</li>
<li>æ·»åŠ å›¾æ ‡æˆ–èƒŒæ™¯é«˜äº®ï¼Ÿ</li>
</ul>


<p>åªéœ€åˆ›å»ºä¸€ä¸ªå®ç° StyledString çš„æ–°æ•°æ®ç±»ï¼Œå¹¶åœ¨ applyStyle() ä¸­å¤„ç†å®ƒå³å¯ã€‚ç³»ç»Ÿçš„å…¶ä½™éƒ¨åˆ†ä¿æŒä¸å˜ã€‚</p>

<p>è¿™ç§åˆ†ç¦»ä½¿ä½ çš„æ–‡æœ¬é€»è¾‘æ¨¡å—åŒ–ã€å¯æµ‹è¯•ï¼Œå¹¶èƒ½å¤Ÿé€‚åº”æœªæ¥çš„è®¾è®¡æˆ–ä¸šåŠ¡éœ€æ±‚ã€‚</p>

<p>å¦‚æœä½ æœ‰ä»€ä¹ˆæœ‰è¶£çš„æƒ³æ³•ï¼Œåˆ«å¿˜äº†åœ¨è¯„è®ºåŒºåˆ†äº«ã€‚ğŸ˜‰</p>

<h3>ğŸ«± è½®åˆ°ä½ äº†</h3>

<p>ç°åœ¨ä½ å·²ç»äº†è§£äº†å®ƒçš„å·¥ä½œåŸç†ï¼ˆä»¥åŠå®ƒå®é™…éœ€è¦çš„ä»£ç é‡æœ‰å¤šå°ï¼‰ï¼Œé‚£å°±åœ¨ä¸‹ä¸€ä¸ª Compose å±å¹•ä¸­å°è¯•ä¸€ä¸‹å§ã€‚ä¸å†éœ€è¦ç¹ççš„ AnnotatedString.Builder ä»£ç ã€‚ä¸å†éœ€è¦é‡å¤çš„ span é€»è¾‘ã€‚åªéœ€æè¿°ä½ æƒ³è¦çš„å†…å®¹ï¼Œå‰©ä¸‹çš„äº¤ç»™ StyledText å¤„ç†ã€‚</p>

<p><strong>è®© Compose ä¸­çš„æ–‡æœ¬æ ·å¼å†æ¬¡å˜å¾—ç®€å•ã€‚ğŸ˜</strong></p>

<h3>ğŸ¤ æ„Ÿè°¢é˜…è¯»</h3>

<p>å¦‚æœä½ æœ€ç»ˆåœ¨é¡¹ç›®ä¸­ä½¿ç”¨äº† StyledStringï¼Œè¯·å‘Šè¯‰æˆ‘ï¼çœ‹åˆ°è¿™äº›å¾®å‹æ¨¡å¼åœ¨ç°å®ä¸–ç•Œä¸­è½åœ°æ€»æ˜¯å¾ˆé…·ã€‚ğŸ‘€</p>

<p>æ„Ÿè°¢é˜…è¯»ï¼å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰ç”¨ï¼Œè¯·è€ƒè™‘åˆ†äº«ç»™å…¶ä»–å¼€å‘è€…ï¼Œç‚¹èµæˆ–ç•™è¨€ã€‚è¿™å¾ˆæœ‰å¸®åŠ©ã€‚âœŒï¸</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Alex Hilton</span></span>

      




<time class='entry-date' datetime='2025-07-30T22:50:40+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>30</span><span class='date-suffix'>th</span>, <span class='date-year'>2025</span></span> <span class='time'>10:50 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/compose/'>compose</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
  
    <!-- JiaThis Button BEGIN -->
<div class="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2025/07/24/exploring-pausablecomposition/" title="Previous Post: æ­å¯†Jetpack Composeä¸­çš„PausableComposition">&laquo; æ­å¯†Jetpack Composeä¸­çš„PausableComposition</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="comments"></div>
    <!-- Duoshuo COMMENT BEGIN -->
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
    var clientId = 'bc66a01ef24d14fc282b'
    var clientSecret = 'c7fd5e55db1776204fe201fe20c050b140982884'
    var gitment = new Gitment({
      id: 'toughcoder.net',
      owner: 'alexhilton',
      repo: 'alexhilton.github.io',
      oauth: {
        client_id: clientId,
        client_secret: clientSecret,
      },
    })

    gitment.render('comments')
</script>
<!-- Duoshuo COMMENT END -->

  </section>

</div>

<aside class="sidebar">
  
    <section>
    <div class="
        col-lg-2 col-lg-offset-0
        visible-lg-block
        sidebar-container
        catalog-container">
        <div class="side-catalog">
            <hr class="hidden-sm hidden-xs">
            <h3>
                <a class="catalog-toggle" href="#">CATALOG</a>
            </h3>
            <ul class="catalog-body"></ul>
        </div>
    </div>
</section>
<!-- Back to top and Scroll to bottom -->
<a href="#" class="cd-top"></a>
<a href="#" class="cd-bottom"></a>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2025 - Alex Hilton -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  









<script type="text/javascript">
    //async load function 
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }

    function generateCatalog (selector) {
        var P = $('article'),a,n,t,l,i,c, id;
        a = P.find('h2,h3,h4,h5,h6');
        var index = 0;
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            id = $(this).prop('id');
            if (!id) {
                var nid = 'catalog-section-' + index;
                $(this).attr('id', nid);
                i = '#' + nid;
            } else {
                i = '#' + id;
            }
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
            index++;
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/javascripts/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });

// Navigation Scripts to Show Header on Scroll-Up
jQuery(document).ready(function($) {
    var MQL = 1170;

    //primary navigation slide-in effect
    if ($(window).width() > MQL) {
        // We do not have the sticky nav bar so, first can be zero
        var headerHeight = 0;
        $('nav').each(function() {
            var h = $(this).outerHeight(true);
            headerHeight += h;
        });
        $('header').each(function() {
            var h = $(this).outerHeight(true);
            headerHeight += h;
        });
        $(window).on('scroll', {
                previousTop: 0
            },
            function() {
                var currentTop = $(window).scrollTop(),
                    $catalog = $('.side-catalog');

                this.previousTop = currentTop;

                //adjust the appearance of side-catalog
                $catalog.show()
                if (currentTop > (headerHeight + 42)) {
                    $catalog.addClass('fixed')
                } else {
                    $catalog.removeClass('fixed')
                }
            });
    }
});
</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?3fab3b1bae08e6d4a5e638d9e8c6f40a";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


</body>
</html>
