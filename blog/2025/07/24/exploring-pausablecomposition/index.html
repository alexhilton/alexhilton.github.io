
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>æ­å¯†Jetpack Composeä¸­çš„PausableComposition - ç¨€æœ‰çŒ¿è¯‰</title>
  <meta name="author" content="Alex Hilton">

  
  <meta name="description" content="è¿™ç¯‡æ–‡ç« å°†æ·±å…¥æµ…å‡ºåœ°å¸¦ä½ åˆ†æCompose Runtimeå¼•å…¥çš„æ€§èƒ½æå‡åˆ©å™¨PausableCompositionï¼Œå¹¶ç†è§£å®ƒæ˜¯å¦‚ä½•æå‡æ— é™åˆ—è¡¨çš„æ€§èƒ½ã€‚">
  <meta name="keywords" content="Compose, Jetpack Compose, Composable, Android">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="https://alexhilton.github.io/blog/2025/07/24/exploring-pausablecomposition">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="ç¨€æœ‰çŒ¿è¯‰" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script src="/javascripts/toolbar.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.lug.ustc.edu.cn/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.lug.ustc.edu.cn/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<!-- for Gitment -->
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">

<!-- for favicon -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">ç¨€æœ‰çŒ¿è¯‰</a></h1>
  
    <h2>åå¹´ç£¨ä¸€å‰‘ï¼Œå†ç‚¼å‡ºé”‹èŠ’ï¼Œè¯´è¯åƒç™¾å¥ï¼Œä¸å¦‚ç äºŒè¡Œã€‚</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com.hk/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:alexhilton.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/donation">Donation</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">æ­å¯†Jetpack Composeä¸­çš„PausableComposition</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2025-07-24T19:55:51+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2025</span></span> <span class='time'>7:55 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><blockquote><p>æœ¬æ–‡è¯‘è‡ªã€ŒExploring PausableComposition internals in Jetpack Composeã€ï¼ŒåŸæ–‡é“¾æ¥<a href="https://blog.shreyaspatil.dev/exploring-pausablecomposition-internals-in-jetpack-compose">https://blog.shreyaspatil.dev/exploring-pausablecomposition-internals-in-jetpack-compose</a>ï¼Œç”±Shreyas Patilå‘å¸ƒäº2025å¹´7æœˆ14æ—¥ã€‚</p></blockquote>

<p><a href="/blog/2025/07/24/exploring-pausablecomposition/"><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1751791091096/4e5b36e3-485c-4079-88be-987082e7d67e.png?w=1600&h=840&fit=crop&crop=entropy&auto=compress,format&format=webp" title="auto auto" ></a></p>

<!-- more -->


<p>å—¨ï¼ŒComposers ä»¬ğŸ‘‹ï¼Œåœ¨æœ€è¿‘çš„ Compose 1.9.X ç‰ˆæœ¬ä¸­ï¼ŒCompose-runtime å¼•å…¥äº†ä¸€ä¸ªåä¸º PausableComposition çš„æ–°å†…éƒ¨ APIï¼Œæ®ç§°å®ƒå¯ä»¥è§£å†³æ€§èƒ½é—®é¢˜ã€‚å®ƒå¬èµ·æ¥åƒé­”æ³•ï¼Œä½†åœ¨åº•å±‚ï¼Œè¿™ä¸€åˆ‡éƒ½å½’åŠŸäºä¸€äº›éå¸¸å·§å¦™çš„å·¥ç¨‹è®¾è®¡ã€‚åœ¨æ·±å…¥ç ”ç©¶ Compose è¿è¡Œæ—¶ä»¥æ›´å¥½åœ°ç†è§£è¿™ä¸€ç‚¹æ—¶ï¼Œæˆ‘å¶ç„¶å‘ç°äº†ä¸€ä¸ªå¼ºå¤§çš„å†…éƒ¨å·¥å…·ï¼Œå®ƒä½¿è¿™ä¸€åˆ‡æˆä¸ºå¯èƒ½ã€‚</p>

<p>è¿™ç¯‡æ–‡ç« å°†æ·±å…¥åˆ†æè¿™ä¸€æœºåˆ¶ï¼šPausableCompositionã€‚è¿™æ˜¯ Compose çš„å†…éƒ¨ APIï¼Œå¼€å‘è€…æ— éœ€äº†è§£å®ƒã€‚ä½†äº†è§£å®ƒçš„åº•å±‚å·¥ä½œåŸç†æ€»æ˜¯æœ‰ç›Šçš„ã€‚å¯¹äºæƒ³è¦æ·±å…¥äº†è§£ Compose å¦‚ä½•å®ç°å…¶æƒŠäººæ€§èƒ½çš„ Jetpack Compose å¼€å‘è€…æ¥è¯´ï¼Œè¿™ç¯‡æ¢ç´¢æ–‡ç« å°†ä¸ºä½ æä¾›æ›´æ¸…æ™°çš„è§†è§’ã€‚æˆ‘ä»¬å°†æ·±å…¥è¿è¡Œæ—¶æºä»£ç ï¼Œäº†è§£å®ƒçš„å·¥ä½œåŸç†ã€å®ƒå¯¹æ€§èƒ½å¦‚æ­¤é‡è¦çš„åŸå› ï¼Œä»¥åŠå¦‚ä½•åè°ƒæ‰€æœ‰ç»„ä»¶ä»¥ä½¿æˆ‘ä»¬çš„ UI æ„Ÿè§‰å¦‚æ­¤æµç•…ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼</p>

<h2>ç¼˜èµ·</h2>

<p>ä¸ºäº†å®ç°æµç•…çš„ 60 å¸§/ç§’ (fps)ï¼Œæˆ‘ä»¬çš„åº”ç”¨éœ€è¦åœ¨ 16.7 æ¯«ç§’å†…ç»˜åˆ¶æ¯ä¸€å¸§ã€‚å½“ç”¨æˆ·æ»šåŠ¨æµè§ˆ LazyColumn æ—¶ï¼Œå¿…é¡»åœ¨è¿™ä¸ªå¾®å°çš„çª—å£å†…åˆ›å»ºã€æµ‹é‡å’Œç»˜åˆ¶æ–°çš„é¡¹ç›®ã€‚</p>

<p>å¦‚æœä¸€ä¸ªé¡¹ç›®å¾ˆå¤æ‚ï¼ŒåŒ…å«åµŒå¥—å¸ƒå±€ã€å›¾ç‰‡å’Œå¤§é‡é€»è¾‘ï¼Œé‚£ä¹ˆç»„åˆå®ƒæ‰€éœ€çš„å·¥ä½œå¾ˆå®¹æ˜“è¶…è¿‡ 16 æ¯«ç§’ã€‚å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œä¸»çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œå¸§ä¼šä¸¢å¤±ï¼Œç”¨æˆ·ä¼šåœ¨æ»šåŠ¨è¿‡ç¨‹ä¸­çœ‹åˆ°â€œå¡é¡¿â€æˆ–å¡é¡¿ã€‚ğŸ˜©</p>

<p>è¿™æ­£æ˜¯ PausableComposition çš„åˆè¡·ã€‚</p>

<h2>â€œåšä»€ä¹ˆâ€ï¼šæ›´æ™ºèƒ½çš„ Compose æ–¹å¼</h2>

<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ˜¯ä¸€ä½å¨å¸ˆï¼Œæ­£åœ¨ä¸ºä¸€åœºæ´»åŠ¨å‡†å¤‡ä¸€é¡¿å¤§é¤ã€‚ğŸ‘¨â€ğŸ³ ä¸å…¶åœ¨ç¬¬ä¸€ä½å®¢äººåˆ°æ¥æ—¶æ…Œä¹±åœ°ä»å¤´å¼€å§‹çƒ¹é¥ªæ‰€æœ‰é£Ÿæï¼Œä¸å¦‚æå‰å‡ ä¸ªå°æ—¶åšå¥½å‡†å¤‡å·¥ä½œã€‚åˆ‡èœã€è°ƒé…±ã€çƒ¤ç”œç‚¹ã€‚ç­‰åˆ°ä¸Šæ¡Œæ—¶ï¼Œæœ€åçš„çƒ¹é¥ªå’Œç»„è£…é€Ÿåº¦ä¼šå¿«å¾—ä»¤äººéš¾ä»¥ç½®ä¿¡ã€‚</p>

<p>PausableComposition å°†è¿™ç§â€œå‡†å¤‡å·¥ä½œâ€çš„ç†å¿µå¸¦åˆ°äº† Compose ä¸­ã€‚å®ƒå…è®¸è¿è¡Œæ—¶ï¼š</p>

<ol>
<li>å¢é‡å¼ Composeï¼šå°†å¤§å‹ UI å…ƒç´ çš„åˆæˆåˆ†è§£æˆæ›´å°ã€æ›´æ˜“äºç®¡ç†çš„éƒ¨åˆ†ã€‚</li>
<li>å¼‚æ­¥å‡†å¤‡ï¼šåœ¨ UI çœŸæ­£éœ€è¦æ˜¾ç¤ºåœ¨å±å¹•ä¸Šä¹‹å‰è¿›è¡Œåˆæˆå·¥ä½œï¼Œé€šå¸¸åˆ©ç”¨å¸§é—´çš„ç©ºé—²æ—¶é—´ã€‚</li>
</ol>


<p>è¿™ç§å¯ç»„åˆé¡¹çš„é¢„çƒ­æ„å‘³ç€ï¼Œå½“æŸä¸ªé¡¹ç›®æœ€ç»ˆæ»šåŠ¨åˆ°è§†å›¾ä¸­æ—¶ï¼Œå¤§éƒ¨åˆ†ç¹é‡çš„å·¥ä½œå·²ç»å®Œæˆï¼Œä½¿å…¶å‡ ä¹å¯ä»¥ç«‹å³æ˜¾ç¤ºã€‚</p>

<p>ä¸ºäº†ç›´è§‚åœ°ç†è§£è¿™ä¸€æ¦‚å¿µï¼Œè¯·è§‚çœ‹ä»¥ä¸‹åŠ¨ç”»ï¼š</p>

<p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1751997214840/f9f7308a-7b83-4a3d-9d38-e3ce6aa8d9a9.gif?auto=format,compress&amp;gif-q=60&amp;format=webm" alt="æ»šåŠ¨å¸§æ—¶é—´çº¿" /></p>

<p>æ»šåŠ¨å‘ç”Ÿæ—¶ï¼Œå‡è®¾é¡¹ç›® Aã€Bã€Cã€D å’Œ E å·²åœ¨å±å¹•ä¸Šå¯è§ï¼Œä¸‹ä¸€ä¸ªé¡¹ç›®æ˜¯ Fã€‚å¦‚æœé¡¹ç›® F çš„å¸ƒå±€æˆ–ç»“æ„å¤æ‚ï¼Œéœ€è¦æ›´å¤šæ—¶é—´è¿›è¡Œå¸ƒå±€è®¡ç®—æˆ–å…¶ä»–é¢„å¤„ç†æ‰èƒ½åœ¨ UI ä¸Šæ¸²æŸ“ï¼Œåˆ™æ­¤é¢„å¤„ç†å°†åœ¨å¸§æ—¶é—´è½´å†…åˆ†å—è¿›è¡Œï¼ˆä¾‹å¦‚ 16 æ¯«ç§’ï¼‰ã€‚å› æ­¤ï¼Œå¦‚æœå®ƒéœ€è¦ 2 å¸§ï¼Œåˆ™ F æ‰€éœ€çš„é¢„å¤„ç†ä¼šåœ¨ 2 å¸§çš„ç©ºé—²æ—¶é—´å†…å®Œæˆï¼Œä¸ä¼šé€ æˆä»»ä½•å¸§å¡é¡¿ã€‚æœ€åï¼Œå½“éœ€è¦æ˜¾ç¤ºæ—¶ï¼Œå®ƒä¼šè¢«ç»˜åˆ¶åˆ° UI ä¸Šã€‚é¡¹ç›® G å’Œ H ä¹Ÿé‡‡ç”¨ç›¸åŒçš„æµç¨‹ã€‚</p>

<h2>å·¥ä½œåŸç†ï¼šæ ¸å¿ƒç»„ä»¶</h2>

<p>é€šè¿‡æŸ¥çœ‹è¿è¡Œæ—¶æºä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒæ˜¯å¦‚ä½•é€šè¿‡ä¸€äº›å…³é”®æ¥å£å’Œç±»æ¥å¤„ç†çš„ã€‚è™½ç„¶ä½ ä¸ä¼šç›´æ¥ä½¿ç”¨è¿™äº› APIï¼Œä½†ç†è§£å®ƒä»¬å¯ä»¥æ­ç¤º LazyColumn çš„æ€§èƒ½æå‡ã€‚ğŸ•µï¸â€â™‚ï¸</p>

<h3>ç”Ÿå‘½å‘¨æœŸï¼šPausableComposition åŠå…¶æ§åˆ¶å™¨</h3>

<p>æ—…ç¨‹ä» PausableComposition æ¥å£å¼€å§‹ï¼Œè¯¥æ¥å£æ‰©å±•äº† ReusableComposition å¹¶æ·»åŠ äº†æš‚åœåŠŸèƒ½ã€‚</p>

<blockquote><p>å…³äº ReusableComposition çš„ç®€è¦è¯´æ˜ï¼š</p>

<p>åœ¨è®¨è®ºæš‚åœä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ ReusableCompositionï¼Ÿå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„ç»„åˆï¼Œä¸“ä¸ºéœ€è¦é«˜æ•ˆå›æ”¶ UI å†…å®¹çš„é«˜æ€§èƒ½åœºæ™¯è€Œè®¾è®¡ã€‚æƒ³è±¡ä¸€ä¸‹ LazyColumn ä¸­çš„é¡¹ç›®ã€‚ReusableComposition ä¸ä¼šé”€æ¯æ»šåŠ¨åˆ°å±å¹•å¤–çš„é¡¹ç›®çš„æ•´ä¸ªç»„åˆï¼Œè€Œæ˜¯å…è®¸è¿è¡Œæ—¶åœç”¨å®ƒã€‚è¿™ä¼šä¿ç•™åº•å±‚ UI èŠ‚ç‚¹ï¼Œä½†ä¼šæ¸…é™¤å·²è®°ä½çš„çŠ¶æ€ã€‚ç„¶åï¼Œè¿™ä¸ªåœç”¨çš„ç»„åˆå¯ä»¥å¿«é€Ÿåœ°ç”¨æ–°å†…å®¹â€œé‡æ–°å¡«å……â€ï¼Œä»è€ŒèŠ‚çœäº†ä»å¤´åˆ›å»ºèŠ‚ç‚¹çš„æˆæœ¬ã€‚PausableComposition ç›´æ¥æ„å»ºäºè¿™ä¸ªå¼ºå¤§çš„å›æ”¶åŸºç¡€ä¹‹ä¸Šã€‚</p></blockquote>

<p>PausableComposition çš„å¤–è§‚å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// https://cs.android.com/androidx/platform/frameworks/support/+/8d08d42d60f7cc7ec0034d0b7ff6fd953516d96a:compose/runtime/runtime/src/commonMain/kotlin/androidx/compose/runtime/PausableComposition.kt;l=66</span>
</span><span class='line'><span class="n">sealed</span> <span class="n">interface</span> <span class="n">PausableComposition</span> <span class="p">:</span> <span class="n">ReusableComposition</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">setPausableContent</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="n">@Composable</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">):</span> <span class="n">PausedComposition</span>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">setPausableContentWithReuse</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="n">@Composable</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">):</span> <span class="n">PausedComposition</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ï¼ˆæ³¨æ„ï¼šè¯¥æ¥å£æ˜¯å¯†å°çš„ï¼Œå› ä¸ºå®ƒä»…åœ¨ Compose è¿è¡Œæ—¶å†…éƒ¨å…·æœ‰ä¸€ç»„å°é—­ä¸”æœ‰é™çš„å®ç°ã€‚è¿™ä¸ºç¼–è¯‘å™¨æä¾›äº†æ›´å¤šä¿¡æ¯æ¥è¿›è¡Œä¼˜åŒ–ã€‚ï¼‰</p>

<p>è°ƒç”¨ setPausableContent ä¸ä¼šç«‹å³ç»„åˆç•Œé¢ã€‚ç›¸åï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª PausedComposition å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å……å½“é€æ­¥è¿‡ç¨‹çš„æ§åˆ¶å™¨ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// https://cs.android.com/androidx/platform/frameworks/support/+/8d08d42d60f7cc7ec0034d0b7ff6fd953516d96a:compose/runtime/runtime/src/commonMain/kotlin/androidx/compose/runtime/PausableComposition.kt;l=112</span>
</span><span class='line'><span class="n">sealed</span> <span class="n">interface</span> <span class="n">PausedComposition</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">isComplete</span><span class="p">:</span> <span class="n">Boolean</span>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">resume</span><span class="p">(</span><span class="n">shouldPause</span><span class="p">:</span> <span class="n">ShouldPauseCallback</span><span class="p">):</span> <span class="n">Boolean</span>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">apply</span><span class="p">()</span>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">cancel</span><span class="p">()</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ä¸ªç”Ÿå‘½å‘¨æœŸæœ€å¥½ä»¥çŠ¶æ€æœºçš„å½¢å¼æ¥è¡¨ç¤ºï¼š</p>

<p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1751864148018/27512893-f186-47e7-9bdc-26036460aed7.png?auto=compress,format&amp;format=webp" alt="PausableCompositionç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾" /></p>

<ul>
<li>resume(shouldPause: ShouldPauseCallback)ï¼šè¿™æ˜¯å¼•æ“ã€‚é¢„å–ç³»ç»Ÿï¼ˆæ­¤å¤„æŒ‡ LazyColumn ä¸Šä¸‹æ–‡ï¼‰ä¼šåå¤è°ƒç”¨ resume() æ¥æ‰§è¡Œå¤§é‡çš„ç»„åˆå·¥ä½œã€‚ç¥å¥‡ä¹‹å¤„åœ¨äº shouldPause å›è°ƒã€‚Compose è¿è¡Œæ—¶ä¼šåœ¨ç»„åˆè¿‡ç¨‹ä¸­é¢‘ç¹è°ƒç”¨æ­¤ lambdaã€‚å¦‚æœå®ƒè¿”å› trueï¼ˆä¾‹å¦‚ï¼Œç”±äºå¸§æˆªæ­¢æ—¶é—´å·²è¿‘ï¼‰ï¼Œåˆ™ç»„åˆè¿‡ç¨‹å°†åœæ­¢ï¼Œå¹¶å°†ä¸»çº¿ç¨‹äº¤è¿˜ç»™æ›´é‡è¦çš„å·¥ä½œï¼Œä¾‹å¦‚ç»˜åˆ¶å½“å‰å¸§ã€‚</li>
<li>apply()ï¼šä¸€æ—¦ resume() è¿”å› trueï¼Œå³è¡¨ç¤ºæ“ä½œå®Œæˆï¼Œå°±ä¼šè°ƒç”¨ apply()ã€‚è¿™ä¼šè·å–æ‰€æœ‰è®¡ç®—å‡ºçš„ç•Œé¢æ›´æ”¹ï¼Œå¹¶å°†å…¶æäº¤åˆ°å®é™…çš„ç•Œé¢æ ‘ä¸­ã€‚</li>
<li>cancel()ï¼šå¦‚æœç”¨æˆ·æ»šåŠ¨ç¦»å¼€ï¼Œå¹¶ä¸”ä¸å†éœ€è¦é¢„å…ˆç»„åˆçš„é¡¹ç›®ï¼Œåˆ™ä¼šè°ƒç”¨ cancellation() æ¥ä¸¢å¼ƒå·¥ä½œå¹¶é‡Šæ”¾èµ„æºã€‚</li>
</ul>


<h3>å†…éƒ¨ç»“æ„æ¦‚è§ˆï¼šPausedCompositionImpl</h3>

<p>ä¸Šè¿°çŠ¶æ€æœºç”±å†…éƒ¨çš„ PausedCompositionImpl ç±»ç®¡ç†ã€‚è¯¥ç±»ä¿å­˜çŠ¶æ€å¹¶è¿æ¥æ‰€æœ‰éƒ¨åˆ†ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// https://cs.android.com/androidx/platform/frameworks/support/+/8d08d42d60f7cc7ec0034d0b7ff6fd953516d96a:compose/runtime/runtime/src/commonMain/kotlin/androidx/compose/runtime/PausableComposition.kt;l=202</span>
</span><span class='line'><span class="k">internal</span> <span class="k">class</span> <span class="nc">PausedCompositionImpl</span><span class="p">(...)</span> <span class="p">:</span> <span class="n">PausedComposition</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">private</span> <span class="k">var</span> <span class="py">state</span> <span class="p">=</span> <span class="n">PausedCompositionState</span><span class="p">.</span><span class="n">InitialPending</span>
</span><span class='line'>    <span class="k">internal</span> <span class="k">val</span> <span class="py">pausableApplier</span> <span class="p">=</span> <span class="n">RecordingApplier</span><span class="p">(</span><span class="n">applier</span><span class="p">.</span><span class="n">current</span><span class="p">)</span>
</span><span class='line'>    <span class="c1">// ...</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">override</span> <span class="k">fun</span> <span class="nf">resume</span><span class="p">(</span><span class="n">shouldPause</span><span class="p">:</span> <span class="n">ShouldPauseCallback</span><span class="p">):</span> <span class="n">Boolean</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">when</span> <span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">PausedCompositionState</span><span class="p">.</span><span class="n">InitialPending</span> <span class="p">-&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1">// This is the first time resume() is called.</span>
</span><span class='line'>                <span class="c1">// It starts the initial composition of the content.</span>
</span><span class='line'>                <span class="n">invalidScopes</span> <span class="p">=</span>
</span><span class='line'>                    <span class="n">context</span><span class="p">.</span><span class="n">composeInitialPaused</span><span class="p">(</span><span class="n">composition</span><span class="p">,</span> <span class="n">shouldPause</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
</span><span class='line'>                <span class="n">state</span> <span class="p">=</span> <span class="n">PausedCompositionState</span><span class="p">.</span><span class="n">RecomposePending</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="n">invalidScopes</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">())</span> <span class="n">markComplete</span><span class="p">()</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="n">PausedCompositionState</span><span class="p">.</span><span class="n">RecomposePending</span> <span class="p">-&gt;</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1">// This is for subsequent calls to resume().</span>
</span><span class='line'>                <span class="n">state</span> <span class="p">=</span> <span class="n">PausedCompositionState</span><span class="p">.</span><span class="n">Recomposing</span>
</span><span class='line'>                <span class="c1">// It tells the Composer to continue where it left off,</span>
</span><span class='line'>                <span class="c1">// processing any pending invalidations.</span>
</span><span class='line'>                <span class="n">invalidScopes</span> <span class="p">=</span>
</span><span class='line'>                    <span class="n">context</span><span class="p">.</span><span class="n">recomposePaused</span><span class="p">(</span><span class="n">composition</span><span class="p">,</span> <span class="n">shouldPause</span><span class="p">,</span> <span class="n">invalidScopes</span><span class="p">)</span>
</span><span class='line'>                <span class="n">state</span> <span class="p">=</span> <span class="n">PausedCompositionState</span><span class="p">.</span><span class="n">RecomposePending</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="n">invalidScopes</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">())</span> <span class="n">markComplete</span><span class="p">()</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="c1">// ... other states like Recomposing, Applied, Cancelled are handled here ...</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">isComplete</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">override</span> <span class="k">fun</span> <span class="nf">apply</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// ... other state checks ...</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="p">==</span> <span class="n">PausedCompositionState</span><span class="p">.</span><span class="n">ApplyPending</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">applyChanges</span><span class="p">()</span> <span class="c1">// The call site</span>
</span><span class='line'>            <span class="n">state</span> <span class="p">=</span> <span class="n">PausedCompositionState</span><span class="p">.</span><span class="n">Applied</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">// ...</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">applyChanges</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// ...</span>
</span><span class='line'>        <span class="n">pausableApplier</span><span class="p">.</span><span class="n">playTo</span><span class="p">(</span><span class="n">applier</span><span class="p">,</span> <span class="n">rememberManager</span><span class="p">)</span>
</span><span class='line'>        <span class="n">rememberManager</span><span class="p">.</span><span class="n">dispatchRememberObservers</span><span class="p">()</span>
</span><span class='line'>        <span class="n">rememberManager</span><span class="p">.</span><span class="n">dispatchSideEffects</span><span class="p">()</span>
</span><span class='line'>        <span class="c1">// ...</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è°ƒç”¨ resume() æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥å…¶å†…éƒ¨çŠ¶æ€å¹¶é‡‡å–ç›¸åº”çš„æªæ–½ï¼š</p>

<ul>
<li>InitialPendingï¼šé¦–æ¬¡è°ƒç”¨æ—¶ï¼Œå®ƒä¼šé€šè¿‡è°ƒç”¨ context.composeInitialPaused å¯åŠ¨åˆæˆè¿‡ç¨‹ã€‚è¿™ä¼šå‘ŠçŸ¥æ ¸å¿ƒ ComposerImpl å¼€å§‹æ‰§è¡Œ @Composable å†…å®¹ï¼Œå¹¶æ‰§è¡Œ shouldPause å›è°ƒã€‚</li>
<li>RecomposePendingï¼šåç»­è°ƒç”¨æ—¶ï¼Œå®ƒä¼šé€šè¿‡è°ƒç”¨ context.recomposePaused ç»§ç»­å·¥ä½œã€‚æ­¤æ–¹æ³•ç”¨äºå¤„ç†åˆæˆä¸­ä»»ä½•å› çŠ¶æ€å˜åŒ–è€Œå¤±æ•ˆçš„éƒ¨åˆ†ï¼Œæˆ–ç»§ç»­ä¹‹å‰æš‚åœçš„å·¥ä½œã€‚</li>
<li>Applierï¼šåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼ŒComposerImpl å°†æ‰€æœ‰ UI æ›´æ”¹æ“ä½œè½¬å‘ç»™ pausableApplierï¼ˆå³ RecordingApplierï¼‰ï¼Œè¯¥æ“ä½œä¼šè¿›è¡Œç¼“å†²ï¼Œè€Œä¸æ˜¯ç«‹å³åº”ç”¨ã€‚</li>
<li>æ­¤è¿‡ç¨‹æŒç»­è¿›è¡Œï¼Œç›´åˆ°å·¥ä½œå®Œæˆæˆ– shouldPause å›è°ƒè¿”å› trueã€‚</li>
</ul>


<h3>RecordingApplierï¼šæ¨è¿Ÿæœ€åçš„æ¶¦è‰²</h3>

<p>ä¸€ä¸ªå…³é”®çš„æ€§èƒ½æŠ€å·§æ˜¯ RecordingApplierã€‚è°ƒç”¨ resume() æ—¶ï¼ŒComposer ä¸ä¼šç›´æ¥æ›´æ”¹å®æ—¶ UI æ ‘ã€‚å¦‚æœåˆ†å°æ­¥æ‰§è¡Œï¼Œå¯èƒ½ä¼šå¾ˆæ…¢ï¼Œå¹¶å¯¼è‡´ UI æ›´æ–°ä¸å®Œæ•´ï¼Œæ˜¾å¾—æ€ªå¼‚ã€‚</p>

<p>PausableComposition ä½¿ç”¨çš„æ˜¯ RecordingApplierã€‚è¿™ä¸ªç‰¹æ®Šçš„ Applier ä¼šå°†å…¶åº”è¯¥æ‰§è¡Œçš„æ‰€æœ‰ UI æ“ä½œï¼ˆä¾‹å¦‚â€œåˆ›å»º Text èŠ‚ç‚¹â€ã€â€œè®¾ç½®å…¶æ–‡æœ¬å±æ€§â€æˆ–â€œæ·»åŠ å­å›¾åƒâ€ï¼‰è®°å½•åˆ°ä¸€ä¸ªå†…éƒ¨åˆ—è¡¨ä¸­ã€‚</p>

<p>åªæœ‰è°ƒç”¨ PausedComposition.apply() æ—¶ï¼ŒRecordingApplier æ‰ä¼šå°†å…¶è®°å½•çš„æ“ä½œåˆ—è¡¨â€œå›æ”¾â€åˆ°å®é™…çš„ Applier ä¸Šï¼Œä»è€Œé«˜æ•ˆåœ°å•æ­¥æ›´æ–° UI æ ‘ã€‚PausedComposition çš„å…¬å…± apply() æ–¹æ³•æ˜¯ä¸€ä¸ªç®€å•çš„çŠ¶æ€æœºå®ˆå«ã€‚çœŸæ­£çš„å·¥ä½œå‘ç”Ÿåœ¨å†…éƒ¨çš„ applyChanges() æ–¹æ³•ä¸­ï¼ˆå¦‚ä¸Šé¢çš„ä»£ç ç‰‡æ®µæ‰€ç¤ºï¼‰ã€‚</p>

<p>å½“è°ƒç”¨ applyChanges æ—¶ï¼Œå®ƒä¼šæŒ‰é¡ºåºæ‰§è¡Œä¸‰é¡¹å…³é”®æ“ä½œï¼š</p>

<ul>
<li>å®ƒä¼šå‘Šè¯‰ RecordingApplier å°†å…¶æ‰€æœ‰ç¼“å†²çš„å‘½ä»¤æ’­æ”¾åˆ°å®é™…çš„ applier ä¸Šã€‚è¿™æ‰æ˜¯ UI çœŸæ­£å‡ºç°åœ¨å±å¹•ä¸Šçš„å…³é”®ã€‚</li>
<li>å®ƒä¼šä¸ºæ‰€æœ‰å·²åˆ›å»ºçš„ RememberObserversï¼ˆä¾‹å¦‚ DisposableEffectï¼‰è°ƒåº¦æ‰€æœ‰ onRemembered ç”Ÿå‘½å‘¨æœŸå›è°ƒã€‚</li>
<li>æœ€åï¼Œå®ƒä¼šè¿è¡Œåœ¨åˆæˆè¿‡ç¨‹ä¸­æ’é˜Ÿçš„æ‰€æœ‰ SideEffectã€‚</li>
</ul>


<p>è¿™ç§æœ‰åºçš„æ‰¹å¤„ç†è¿‡ç¨‹ç¡®ä¿ UI é«˜æ•ˆæ›´æ–°ï¼Œå¹¶ä¸”æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸäº‹ä»¶éƒ½åœ¨æ­£ç¡®çš„æ—¶é—´å‘ç”Ÿã€‚</p>

<p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1751794209046/49f5c1c7-b424-4c7d-a017-8ba65bb7b2d3.png?auto=compress,format&amp;format=webp" alt="PausableCompositionæ—¶åºå›¾" /></p>

<h2>ä½¿ç”¨äº† PausableComposition çš„ LazyList</h2>

<p>LazyList å·²ç»å¼€å§‹ä½¿ç”¨ PausableComposition APIäº†ã€‚åœ¨ LazyList ä¸­ï¼ŒPausableComposition å¹¶éç‹¬ç«‹å·¥ä½œï¼Œè€Œæ˜¯ååŒå·¥ä½œçš„ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚</p>

<ul>
<li>æŒ‡æŒ¥å™¨ (Recomposer)ï¼šä¸» Recomposer è´Ÿè´£æ§åˆ¶èŠ‚å¥ï¼Œé©±åŠ¨å¯è§ UI çš„é€å¸§æ›´æ–°ã€‚</li>
<li>è§„åˆ’å™¨ (LazyLayoutPrefetchState)ï¼šå½“ç”¨æˆ·æ»šåŠ¨æ—¶ï¼Œæ­¤ç»„ä»¶ä¼šé¢„æµ‹å“ªäº›é¡¹ç›®å³å°†æ˜¾ç¤ºã€‚</li>
<li>èˆå°ç®¡ç†å™¨ (SubcomposeLayout)ï¼šè¿™ä¸ªå¼ºå¤§çš„ SubcomposeLayout æ˜¯ LazyList çš„åŸºç¡€ã€‚å®ƒçš„ SubcomposeLayoutState å¯ä»¥åœ¨éœ€è¦æ—¶ä¸ºå„ä¸ªé¡¹ç›®åˆ›å»ºå’Œç®¡ç†åˆæˆã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå®ƒæä¾›äº† createPausedPrecomposition() APIã€‚</li>
<li>èˆå°è°ƒåº¦å™¨ (PrefetchScheduler)ï¼šæ­¤è°ƒåº¦å™¨ä¼šåœ¨å¸§ä¹‹é—´å¯»æ‰¾ç©ºé—²æ—¶é—´æ¥æ‰§è¡Œè§„åˆ’å™¨è¯·æ±‚çš„é¢„åˆæˆå·¥ä½œã€‚</li>
</ul>


<p>äº†è§£æ­¤åŠŸèƒ½çš„å¼€å‘è¿‡ç¨‹ä¹Ÿå¾ˆæœ‰è¶£ã€‚åœ¨ LazyLayoutPrefetchState æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ°æ§åˆ¶å®ƒçš„åŠŸèƒ½æ ‡å¿—ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// A simplified look inside LazyLayoutPrefetchState.kt: https://cs.android.com/androidx/platform/frameworks/support/+/8d08d42d60f7cc7ec0034d0b7ff6fd953516d96a:compose/foundation/foundation/src/commonMain/kotlin/androidx/compose/foundation/lazy/layout/LazyLayoutPrefetchState.kt;l=647</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">ComposeFoundationFlags</span><span class="p">.</span><span class="n">isPausableCompositionInPrefetchEnabled</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// This is the future, modern path.</span>
</span><span class='line'>    <span class="n">performPausableComposition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">contentType</span><span class="p">,</span> <span class="n">average</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// This is the older, non-pausable fallback.</span>
</span><span class='line'>    <span class="n">performFullComposition</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">contentType</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>isPausableCompositionInPrefetchEnabled è¿™ä¸ªæ ‡å¿—å……å½“äº†ç»ˆæ­¢å¼€å…³çš„ä½œç”¨ã€‚è™½ç„¶å®ƒåœ¨æºä»£ç ä¸­çš„é»˜è®¤å€¼ä¸º falseã€‚å¦‚æœä½ æƒ³åœ¨æƒ°æ€§å¸ƒå±€ï¼ˆLazyColumnã€LazyRow ç­‰ï¼‰ä¸­å¯ç”¨å¯æš‚åœç»„åˆè¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°æŒ‰å¦‚ä¸‹æ–¹å¼å¯ç”¨å®ƒï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="k">class</span> <span class="nc">MyApplication</span> <span class="p">:</span> <span class="n">Application</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">ComposeFoundationFlags</span><span class="p">.</span><span class="n">isPausableCompositionInPrefetchEnabled</span> <span class="p">=</span> <span class="k">true</span>
</span><span class='line'>        <span class="k">super</span><span class="p">.</span><span class="n">onCreate</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>è§„åˆ’å™¨ï¼šLazyLayoutPrefetchState è¯¦è§£</h3>

<p>LazyLayoutPrefetchState æ˜¯é¢„å–æ“ä½œçš„æ ¸å¿ƒã€‚å®ƒçš„ä½œç”¨æ˜¯è·å–æ¥è‡ª LazyLayout çš„é¢„æµ‹ï¼ˆä¾‹å¦‚ï¼Œâ€œç¬¬ 25 é¡¹å³å°†ä¸Šçº¿â€ï¼‰ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå®é™…çš„é¢„ç»„åˆä»»åŠ¡ã€‚</p>

<p>å®ƒé€šè¿‡ PrefetchHandleProvider å®ç°æ­¤æ“ä½œï¼Œè¯¥æä¾›è€…ä¼šåˆ›å»ºä¸€ä¸ª PrefetchRequestã€‚æ­¤è¯·æ±‚æ˜¯ PrefetchScheduler å¯ä»¥æ‰§è¡Œçš„å·¥ä½œå•å…ƒã€‚åœ¨è¿™ä¸ªè¯·æ±‚ä¸­ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†æš‚åœé€»è¾‘çš„æ ¸å¿ƒã€‚</p>

<p>å½“ PrefetchScheduler æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œå®ƒä¼šè¿›å…¥ä¸€ä¸ªå¾ªç¯ï¼Œåœ¨ PausableComposition ä¸Šè°ƒç”¨ resume()ã€‚ä¼ é€’ç»™ resume çš„ lambda è¡¨è¾¾å¼å†³å®šæ˜¯å¦æš‚åœã€‚</p>

<p>å› æ­¤ï¼Œå¦‚æœå¯ç”¨äº†ä¸Šè¿°åŠŸèƒ½æ ‡è®°ï¼Œå®ƒå°†é€šè¿‡ Pausable Composition API æ‰§è¡Œè¯·æ±‚ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// https://cs.android.com/androidx/platform/frameworks/support/+/8d08d42d60f7cc7ec0034d0b7ff6fd953516d96a:compose/foundation/foundation/src/commonMain/kotlin/androidx/compose/foundation/lazy/layout/LazyLayoutPrefetchState.kt;l=754</span>
</span><span class='line'><span class="c1">// Simplified from HandleAndRequestImpl inside LazyLayoutPrefetchState</span>
</span><span class='line'><span class="k">private</span> <span class="k">fun</span> <span class="nf">PrefetchRequestScope</span><span class="p">.</span><span class="n">performPausableComposition</span><span class="p">(...)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">composition</span> <span class="p">=</span> <span class="c1">// get the composition for the item of the LazyLayout </span>
</span><span class='line'>    <span class="n">pauseRequested</span> <span class="p">=</span> <span class="k">false</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">while</span> <span class="p">(!</span><span class="n">composition</span><span class="p">.</span><span class="n">isComplete</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">pauseRequested</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">composition</span><span class="p">.</span><span class="n">resume</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(!</span><span class="n">pauseRequested</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1">// 1. Update how much time is left in this frame&#39;s idle window.</span>
</span><span class='line'>                <span class="n">updateElapsedAndAvailableTime</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>                <span class="c1">// 2. Save how long this work chunk took, to improve future estimates.</span>
</span><span class='line'>                <span class="n">averages</span><span class="p">.</span><span class="n">saveResumeTimeNanos</span><span class="p">(</span><span class="n">elapsedTimeNanos</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>                <span class="c1">// 3. The Core Decision: Is there enough time left to do another</span>
</span><span class='line'>                <span class="c1">//    chunk of work without risking a frame drop?</span>
</span><span class='line'>                <span class="n">pauseRequested</span> <span class="p">=</span> <span class="p">!</span><span class="n">shouldExecute</span><span class="p">(</span>
</span><span class='line'>                    <span class="n">availableTimeNanos</span><span class="p">,</span>
</span><span class='line'>                    <span class="n">averages</span><span class="p">.</span><span class="n">resumeTimeNanos</span> <span class="p">+</span> <span class="n">averages</span><span class="p">.</span><span class="n">pauseTimeNanos</span><span class="p">,</span>
</span><span class='line'>                <span class="p">)</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="c1">// 4. Return the decision to the composition engine.</span>
</span><span class='line'>            <span class="n">pauseRequested</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">updateElapsedAndAvailableTime</span><span class="p">()</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">pauseRequested</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// If we decided to pause, record how long the final pause check took.</span>
</span><span class='line'>        <span class="n">averages</span><span class="p">.</span><span class="n">savePauseTimeNanos</span><span class="p">(</span><span class="n">elapsedTimeNanos</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// If we finished without pausing, record the time for the final resume chunk.</span>
</span><span class='line'>        <span class="n">averages</span><span class="p">.</span><span class="n">saveResumeTimeNanos</span><span class="p">(</span><span class="n">elapsedTimeNanos</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è®©æˆ‘ä»¬åˆ†è§£ä¸€ä¸‹è¿™ä¸ªé€»è¾‘ï¼š</p>

<ol>
<li>updateElapsedAndAvailableTime()ï¼šåœ¨æ¢å¤ lambda å‡½æ•°å†…éƒ¨ï¼Œç³»ç»Ÿä¼šä¸æ–­æ£€æŸ¥è·ç¦»ä¸‹ä¸€å¸§éœ€è¦ç»˜åˆ¶è¿˜å‰©å¤šå°‘æ—¶é—´ã€‚</li>
<li>averages.saveResumeTimeNanos(&hellip;)ï¼šå®ƒä¼šè®°å½•æ¯ä¸ªå°å—åˆæˆå·¥ä½œæ‰€éœ€çš„æ—¶é—´ã€‚è¿™æœ‰åŠ©äºå®ƒæ„å»ºä¸€ä¸ªå¹³å‡å€¼ (averages) æ¥é¢„æµ‹æœªæ¥å·¥ä½œçš„æˆæœ¬ã€‚</li>
<li>!shouldExecute(&hellip;)ï¼šè¿™æ˜¯æ ¸å¿ƒå†³ç­–ã€‚å®ƒä¼šå°† availableTimeNanos ä¸é¢„ç®—è¿›è¡Œæ¯”è¾ƒã€‚è¿™ä¸ªé¢„ç®—æ˜¯ä¸€ä¸ªæ™ºèƒ½ä¼°ç®—ï¼šå®Œæˆå¦ä¸€å—å·¥ä½œæ‰€éœ€çš„å¹³å‡æ—¶é—´åŠ ä¸Šæš‚åœæ‰€éœ€çš„å¹³å‡æ—¶é—´ã€‚å¦‚æœæ—¶é—´ä¸è¶³ï¼ŒpauseRequested ä¼šå˜ä¸º trueã€‚</li>
<li>æœ€ç»ˆè®¡æ—¶ï¼šåœ¨æœ¬æ¬¡å¾ªç¯é€€å‡ºåï¼ˆå› ä¸ºå·¥ä½œå®Œæˆæˆ–è¯·æ±‚æš‚åœï¼‰ï¼Œä¼šè°ƒç”¨æœ€åä¸€æ¬¡ updateElapsedAndAvailableTime()ã€‚è¿™ä¼šæ•è·æœ€åä¸€ä¸ªæ“ä½œçš„æ—¶é—´ã€‚</li>
<li>ä¿å­˜å¹³å‡å€¼ï¼šç„¶åç³»ç»Ÿä¼šä¿å­˜è¿™ä¸ªæœ€ç»ˆè®¡æ—¶ã€‚å¦‚æœè¯·æ±‚äº†æš‚åœï¼Œåˆ™å®ƒä¼šå½±å“ pauseTimeNanosã€‚å¦‚æœå¾ªç¯è‡ªç„¶å®Œæˆï¼Œåˆ™å®ƒä¼šå½±å“ resumeTimeNanosã€‚è¿™ç¡®ä¿äº†ç”¨äºæœªæ¥é¢„æµ‹çš„å†å²æ•°æ®å§‹ç»ˆå‡†ç¡®ã€‚</li>
</ol>


<p>è¿™ç§è‡ªæˆ‘è°ƒèŠ‚çš„åé¦ˆå¾ªç¯å…è®¸é¢„å–å™¨åœ¨ç³»ç»Ÿç©ºé—²æ—¶ä¿æŒç§¯æä¸»åŠ¨ï¼Œä½†åœ¨éœ€è¦æ¸²æŸ“ UI æ—¶åˆèƒ½ä¿æŒç¤¼è²Œï¼Œå°Šé‡ä¸»çº¿ç¨‹ã€‚</p>

<h3>æœ€åä¸€æ­¥ï¼šåº”ç”¨é¢„ç»„åˆ UI</h3>

<p>é‚£ä¹ˆï¼Œå½“å±å¹•ä¸ŠçœŸæ­£éœ€è¦é¢„ç»„åˆçš„é¡¹ç›®æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿè¿™æ—¶ SubcomposeLayout å°±å æ®äº†ä¸­å¿ƒä½ç½®ã€‚åœ¨æ­£å¸¸çš„æµ‹é‡è¿‡ç¨‹ä¸­ï¼Œå®ƒä¼šä¸ºç°åœ¨å¯è§çš„é¡¹ç›®è°ƒç”¨å…¶ subcompose å‡½æ•°ã€‚åœ¨å†…éƒ¨ï¼Œè¿™ä¼šè§¦å‘æœ€åä¸€æ­¥ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='Kotlin'><span class='line'><span class="c1">// https://cs.android.com/androidx/platform/frameworks/support/+/8d08d42d60f7cc7ec0034d0b7ff6fd953516d96a:compose/ui/ui/src/commonMain/kotlin/androidx/compose/ui/layout/SubcomposeLayout.kt;l=1186</span>
</span><span class='line'><span class="c1">// Simplified from LayoutNodeSubcompositionsState inside SubcomposeLayout.kt</span>
</span><span class='line'><span class="k">private</span> <span class="k">fun</span> <span class="nf">NodeState</span><span class="p">.</span><span class="n">applyPausedPrecomposition</span><span class="p">(</span><span class="n">shouldComplete</span><span class="p">:</span> <span class="n">Boolean</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="py">pausedComposition</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">pausedComposition</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">pausedComposition</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">// 1. If the work must be completed now...</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">shouldComplete</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// ...force the composition to finish by looping `resume`</span>
</span><span class='line'>            <span class="c1">// and always passing `false` to the `shouldPause` callback.</span>
</span><span class='line'>            <span class="k">while</span> <span class="p">(!</span><span class="n">pausedComposition</span><span class="p">.</span><span class="n">isComplete</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">pausedComposition</span><span class="p">.</span><span class="n">resume</span> <span class="p">{</span> <span class="k">false</span> <span class="p">}</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="c1">// 2. Apply the changes to the real UI tree.</span>
</span><span class='line'>        <span class="n">pausedComposition</span><span class="p">.</span><span class="n">apply</span><span class="p">()</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="n">pausedComposition</span> <span class="p">=</span> <span class="k">null</span> <span class="c1">// Clear the handle.</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å½“æŸä¸ªé¡¹ç›®å¯è§æ—¶ï¼Œå…¶ç»„åˆä¸å†æ˜¯ä½ä¼˜å…ˆçº§çš„åå°ä»»åŠ¡ï¼Œè€Œæ˜¯é«˜ä¼˜å…ˆçº§çš„åŒæ­¥ä»»åŠ¡ã€‚shouldComplete = true å‚æ•°ç¡®ä¿æ‰€æœ‰å‰©ä½™çš„ç»„åˆå·¥ä½œç«‹å³å®Œæˆï¼Œæ— éœ€æš‚åœã€‚ç„¶åï¼Œapply() è¢«è°ƒç”¨ï¼Œå®Œæ•´çš„ UI ä¼šç«‹å³æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚</p>

<p>å®ƒä»¬å¦‚ä½•ååŒå·¥ä½œï¼š</p>

<p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1751799217100/82837ef0-e97e-49c7-bee6-cd68ab1804ba.png?auto=compress,format&amp;format=webp" alt="LazyListæ»šåŠ¨æ—¶åºå›¾" /></p>

<h2>ç»“è®º</h2>

<p>æ·±å…¥ç ”ç©¶ Compose è¿è¡Œæ—¶åï¼ŒPausableComposition çš„è®¾è®¡å ªç§°æ€§èƒ½å·¥ç¨‹çš„æ°ä½œã€‚</p>

<ul>
<li>å®ƒå¹¶éé­”æ³•ï¼Œè€Œæ˜¯å»¶è¿Ÿï¼šå…¶æ ¸å¿ƒç†å¿µæ˜¯åœ¨ç´§æ€¥ä»»åŠ¡ä¹‹å‰å®Œæˆã€‚é€šè¿‡åœ¨ç©ºé—²æ—¶é—´åˆæˆé¡¹ç›®ï¼Œå¿«é€Ÿæ»šåŠ¨æ—¶ä¸»çº¿ç¨‹æ‰€éœ€çš„å·¥ä½œé‡ä¼šå¤§å¤§å‡å°‘ã€‚</li>
<li>åä½œå¼å’Œéé˜»å¡å¼ï¼šshouldPause å›è°ƒæ˜¯å¤„ç†å¤šä»»åŠ¡çš„ç»ä½³æ–¹å¼ã€‚å®ƒå¯ä»¥è®©é•¿æ—¶é—´è¿è¡Œçš„åˆæˆä»»åŠ¡ä¼˜é›…åœ°è®©ä½äºæ›´ç´§æ€¥çš„å½“å‰å¸§æ¸²æŸ“ä»»åŠ¡ï¼Œä»è€Œç›´æ¥é˜²æ­¢å¡é¡¿ã€‚</li>
<li>é€šè¿‡æ‰¹å¤„ç†æé«˜æ•ˆç‡ï¼šRecordingApplier é€šè¿‡å°† UI æ ‘ä¸­çš„è®¸å¤šå°çš„ç‹¬ç«‹æ›´æ”¹åˆ†ç»„ä¸ºå•ä¸ªé«˜æ•ˆçš„æ›´æ–°ï¼Œé¿å…äº†è¿™äº›æ›´æ”¹å¸¦æ¥çš„å¼€é”€ã€‚</li>
</ul>


<p>è™½ç„¶ PausableComposition æ˜¯ä¸€ä¸ªä½ å¯èƒ½æ°¸è¿œä¸ä¼šç›´æ¥ä½¿ç”¨çš„å†…éƒ¨åŠŸèƒ½ï¼Œä½†äº†è§£å®ƒçš„å­˜åœ¨å’Œè¿ä½œæ–¹å¼ï¼Œå¯ä»¥è®©ä½ çœŸæ­£ä½“ä¼šåˆ° Jetpack Compose å¦‚æ­¤é«˜æ€§èƒ½çš„æ˜æ™ºå†³ç­–ã€‚ä¸‹æ¬¡ä½ è½»æ¾æµç•…åœ°æ»šåŠ¨æµè§ˆå¤æ‚çš„ LazyColumn æ—¶ï¼Œä½ å°±ä¼šä½“ä¼šåˆ°è¿™å·§å¦™ä¸”ç²¾å¿ƒç¼–æ’çš„â€œèˆè¹ˆâ€æ˜¯å¦‚ä½•åœ¨è¡¨é¢ä¹‹ä¸‹è¿›è¡Œçš„ã€‚âœ… è¿™ç§æ¶æ„ä¸ä»…è§£å†³äº†å½“å‰çš„æ€§èƒ½æŒ‘æˆ˜ï¼Œè¿˜ä¸º Compose æœªæ¥æ›´å…ˆè¿›çš„æ¸²æŸ“ç­–ç•¥é“ºå¹³äº†é“è·¯ã€‚</p>

<p>å¸Œæœ›ä½ å·²ç»äº†è§£äº†è¿™ä¸ªæ–° API åœ¨ Jetpack Compose ä¸­çš„å·¥ä½œåŸç†ã€‚</p>

<p>å¤ªæ£’äº†ï¼å¸Œæœ›ä½ ä»ä¸­è·å¾—äº†ä¸€äº›å®è´µçš„è§è§£ã€‚å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·åˆ†äº« ğŸ˜‰ï¼Œå› ä¸ºâ€¦â€¦</p>

<p>â€œåˆ†äº«å³å…³çˆ±â€</p>

<p>è°¢è°¢ï¼ğŸ˜„</p>

<p>è®©æˆ‘ä»¬ä¸€èµ·å›é¡¾ X ï¼ˆé“¾æ¥ï¼š<a href="https://twitter.com/imShreyasPatil%EF%BC%89%E7%9A%84%E6%9C%80%E6%96%B0%E5%8A%A8%E6%80%81%EF%BC%8C%E6%88%96%E8%80%85%E8%AE%BF%E9%97%AE%E6%88%91%E7%9A%84%E7%BD%91%E7%AB%99%EF%BC%88%E9%93%BE%E6%8E%A5%EF%BC%9Ahttps://shreyaspatil.dev/%EF%BC%89%E4%BA%86%E8%A7%A3%E6%9B%B4%E5%A4%9A%E5%85%B3%E4%BA%8E%E6%88%91%E7%9A%84%E4%BF%A1%E6%81%AF">https://twitter.com/imShreyasPatil%EF%BC%89%E7%9A%84%E6%9C%80%E6%96%B0%E5%8A%A8%E6%80%81%EF%BC%8C%E6%88%96%E8%80%85%E8%AE%BF%E9%97%AE%E6%88%91%E7%9A%84%E7%BD%91%E7%AB%99%EF%BC%88%E9%93%BE%E6%8E%A5%EF%BC%9Ahttps://shreyaspatil.dev/%EF%BC%89%E4%BA%86%E8%A7%A3%E6%9B%B4%E5%A4%9A%E5%85%B3%E4%BA%8E%E6%88%91%E7%9A%84%E4%BF%A1%E6%81%AF</a> ğŸ˜ã€‚</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Alex Hilton</span></span>

      




<time class='entry-date' datetime='2025-07-24T19:55:51+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2025</span></span> <span class='time'>7:55 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/compose/'>compose</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
  
    <!-- JiaThis Button BEGIN -->
<div class="jiathis_style_32x32">
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_renren"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2025/07/16/snapshotflow-or-collectasstate/" title="Previous Post: SnapshotFlowè¿˜æ˜¯collectAsStateï¼Ÿå¯¹äºJetpack Composeæ¥è¯´å“ªä¸ªæ›´é¦™ï¼Ÿ">&laquo; SnapshotFlowè¿˜æ˜¯collectAsStateï¼Ÿå¯¹äºJetpack Composeæ¥è¯´å“ªä¸ªæ›´é¦™ï¼Ÿ</a>
      
      
        <a class="basic-alignment right" href="/blog/2025/07/30/styledstring-in-jetpack-compose/" title="Next Post: å­¦ä¼šç”¨æœ€ä¼˜é›…çš„å§¿å¼åœ¨Composeä¸­æ˜¾ç¤ºå¯Œæ–‡æœ¬">å­¦ä¼šç”¨æœ€ä¼˜é›…çš„å§¿å¼åœ¨Composeä¸­æ˜¾ç¤ºå¯Œæ–‡æœ¬ &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="comments"></div>
    <!-- Duoshuo COMMENT BEGIN -->
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
    var clientId = 'bc66a01ef24d14fc282b'
    var clientSecret = 'c7fd5e55db1776204fe201fe20c050b140982884'
    var gitment = new Gitment({
      id: 'toughcoder.net',
      owner: 'alexhilton',
      repo: 'alexhilton.github.io',
      oauth: {
        client_id: clientId,
        client_secret: clientSecret,
      },
    })

    gitment.render('comments')
</script>
<!-- Duoshuo COMMENT END -->

  </section>

</div>

<aside class="sidebar">
  
    <section>
    <div class="
        col-lg-2 col-lg-offset-0
        visible-lg-block
        sidebar-container
        catalog-container">
        <div class="side-catalog">
            <hr class="hidden-sm hidden-xs">
            <h3>
                <a class="catalog-toggle" href="#">CATALOG</a>
            </h3>
            <ul class="catalog-body"></ul>
        </div>
    </div>
</section>
<!-- Back to top and Scroll to bottom -->
<a href="#" class="cd-top"></a>
<a href="#" class="cd-bottom"></a>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2025 - Alex Hilton -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  









<script type="text/javascript">
    //async load function 
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }

    function generateCatalog (selector) {
        var P = $('article'),a,n,t,l,i,c, id;
        a = P.find('h2,h3,h4,h5,h6');
        var index = 0;
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            id = $(this).prop('id');
            if (!id) {
                var nid = 'catalog-section-' + index;
                $(this).attr('id', nid);
                i = '#' + nid;
            } else {
                i = '#' + id;
            }
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
            index++;
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/javascripts/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });

// Navigation Scripts to Show Header on Scroll-Up
jQuery(document).ready(function($) {
    var MQL = 1170;

    //primary navigation slide-in effect
    if ($(window).width() > MQL) {
        // We do not have the sticky nav bar so, first can be zero
        var headerHeight = 0;
        $('nav').each(function() {
            var h = $(this).outerHeight(true);
            headerHeight += h;
        });
        $('header').each(function() {
            var h = $(this).outerHeight(true);
            headerHeight += h;
        });
        $(window).on('scroll', {
                previousTop: 0
            },
            function() {
                var currentTop = $(window).scrollTop(),
                    $catalog = $('.side-catalog');

                this.previousTop = currentTop;

                //adjust the appearance of side-catalog
                $catalog.show()
                if (currentTop > (headerHeight + 42)) {
                    $catalog.addClass('fixed')
                } else {
                    $catalog.removeClass('fixed')
                }
            });
    }
});
</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?3fab3b1bae08e6d4a5e638d9e8c6f40a";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


</body>
</html>
