<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Effectiveandroid | ç¨€æœ‰çŒ¿è¯‰]]></title>
  <link href="https://alexhilton.github.io/blog/categories/effectiveandroid/atom.xml" rel="self"/>
  <link href="https://alexhilton.github.io/"/>
  <updated>2025-05-01T11:40:35+08:00</updated>
  <id>https://alexhilton.github.io/</id>
  <author>
    <name><![CDATA[Alex Hilton]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ç†è§£Jetpack Composeä¸­å‰¯ä½œç”¨å‡½æ•°çš„å†…éƒ¨åŸç†]]></title>
    <link href="https://alexhilton.github.io/blog/2025/05/01/understanding-side-effect-handlers/"/>
    <updated>2025-05-01T11:05:24+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/05/01/understanding-side-effect-handlers</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ªã€ŒUnderstanding the Internals of Side-Effect Handlers in Jetpack Composeã€ï¼ŒåŸæ–‡é“¾æ¥<a href="https://proandroiddev.com/understanding-the-internals-of-side-effect-handlers-in-jetpack-compose-d55fbf914fde">https://proandroiddev.com/understanding-the-internals-of-side-effect-handlers-in-jetpack-compose-d55fbf914fde</a>ï¼Œç”±Jaewoong Eumå‘å¸ƒäº2025å¹´4æœˆ10æ—¥ã€‚</p></blockquote>

<p><a href=""><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GNgL_XzYpw16hn6BxocOww.jpeg" title="auto auto" ></a></p>

<!-- more -->


<p>è¿‘å¹´æ¥ï¼ŒJetpack Composeç”Ÿæ€å‘ˆæŒ‡æ•°çº§å¢é•¿ï¼Œç°å·²è¢«å¹¿æ³›ç”¨äºæ„å»º Android åº”ç”¨çš„äº§å“çº§UIã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è¯´ Jetpack Compose ä»£è¡¨äº† Android UI å¼€å‘çš„æœªæ¥ã€‚</p>

<p>Compose æœ€å¤§çš„ä¼˜åŠ¿ä¹‹ä¸€æ˜¯å…¶å£°æ˜å¼ï¼ˆdeclarativeï¼‰æ–¹æ³•â€”â€”å®ƒå…è®¸å¼€å‘è€…æè¿° UI åº”è¯¥æ˜¾ç¤ºçš„å†…å®¹ï¼Œè€Œæ¡†æ¶åˆ™è´Ÿè´£å¤„ç† UI åœ¨åº•å±‚çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶åº”å¦‚ä½•æ›´æ–°ã€‚è¿™ç§æ¨¡å‹å°†ç„¦ç‚¹ä»å‘½ä»¤å¼ï¼ˆimperativeï¼‰UI è½¬ç§»åˆ°æ›´ç›´è§‚ã€æ›´å…·å“åº”å¼çš„æ€ç»´æ–¹å¼ã€‚</p>

<p>ç„¶è€Œï¼Œå°½ç®¡å£°æ˜å¼ UIæœ‰å¾ˆå¤šä¼˜åŠ¿ï¼Œä½†å¦¥å–„ç®¡ç†å‰¯ä½œç”¨ä¹Ÿè‡³å…³é‡è¦ã€‚å¯ç»„åˆå‡½æ•°å¯èƒ½ä¼šå› å„ç§åŸå› ï¼ˆä¾‹å¦‚çŠ¶æ€æˆ–å‚æ•°çš„å˜åŒ–ï¼‰è€Œè¢«é‡ç»„ï¼Œå¦‚æœå‰¯ä½œç”¨å¤„ç†ä¸å½“ï¼Œåº”ç”¨çš„è¡Œä¸ºå¯èƒ½ä¼šå˜å¾—ä¸å¯é¢„æµ‹ã€‚</p>

<p>åœ¨æœ¬æ–‡ä¸­ï¼Œä½ å°†æ¢ç´¢ Jetpack Compose é»˜è®¤æä¾›çš„å‰¯ä½œç”¨å¤„ç† APIã€‚ä½ è¿˜å°†ç ”ç©¶å®ƒä»¬çš„å†…éƒ¨å·¥ä½œæµç¨‹ï¼Œä»¥æ›´å¥½åœ°äº†è§£ Compose å¦‚ä½•åœ¨åº•å±‚ç®¡ç†è¿™äº›æ“ä½œã€‚</p>

<h2>å‰¯ä½œç”¨ï¼ˆSide Effectï¼‰æ˜¯å•¥ï¼Ÿ</h2>

<p>å‰¯ä½œç”¨ï¼ˆSide Effectï¼‰æ˜¯æŒ‡å‘ç”Ÿåœ¨å¯ç»„åˆå‡½æ•°ä½œç”¨åŸŸä¹‹å¤–çš„åº”ç”¨çŠ¶æ€å˜åŒ–ã€‚åœ¨ Jetpack Compose ä¸­ï¼Œç”±äºçŠ¶æ€å˜åŒ–ã€å‚æ•°æ›´æ–°æˆ–å…¶ä»–äº‹ä»¶è§¦å‘çš„é‡ç»„ï¼Œå¯ç»„åˆå‡½æ•°å¯èƒ½ä¼šé¢‘ç¹ä¸”ä¸å¯é¢„æµ‹åœ°é‡æ–°æ‰§è¡Œï¼ˆè¯‘æ³¨ï¼šä¹Ÿå°±æ˜¯è¯´Composeçš„é‡ç»„æ˜¯ä¸å—å¼€å‘è€…æ§åˆ¶çš„ï¼‰ã€‚å› æ­¤ï¼Œä½ ä¸èƒ½å‡è®¾ä¸€ä¸ªå¯ç»„åˆå‡½æ•°åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</p>

<p>æ¢å¥è¯è¯´ï¼Œåœ¨å¯ç»„åˆå‡½æ•°å†…éƒ¨ç›´æ¥è°ƒç”¨ä¸šåŠ¡é€»è¾‘ï¼ˆä¾‹å¦‚ä»ç½‘ç»œè·å–æ•°æ®æˆ–æŸ¥è¯¢æ•°æ®åº“ï¼‰æ˜¯æœ‰é£é™©çš„ã€‚ç”±äºæ½œåœ¨çš„é‡ç»„ï¼Œè¿™äº›æ“ä½œå¯èƒ½ä¼šæ— æ„ä¸­è¿è¡Œå¤šæ¬¡ï¼Œä»è€Œå¯¼è‡´é”™è¯¯æˆ–æ€§èƒ½é—®é¢˜ã€‚</p>

<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJetpack Compose æä¾›äº†ä¸€ç»„ä¸“é—¨ç”¨äºä»¥å®‰å…¨å¯æ§çš„æ–¹å¼ç®¡ç†å‰¯ä½œç”¨çš„APIã€‚è¿™äº› APIåŒ…æ‹¬ LaunchedEffect ã€ DisposableEffect ã€ SideEffect ã€ rememberCoroutineScope ç­‰ç­‰ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œä½ å°†é‡ç‚¹ä»‹ç»ä¸‰ä¸ªæœ€å¸¸ç”¨çš„å¤„ç†ç¨‹åºâ€”â€” LaunchedEffect ã€ DisposableEffect å’Œ SideEffect â€”â€”å¹¶ä»”ç»†ç ”ç©¶å®ƒä»¬çš„å†…éƒ¨å®ç°ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£å®ƒä»¬çš„åº•å±‚å·¥ä½œåŸç†ã€‚</p>

<h2>LaunchedEffect</h2>

<p>LaunchedEffectæ˜¯Jetpack Composeä¸­æœ€å¸¸ç”¨çš„å‰¯ä½œç”¨å¤„ç† APIä¹‹ä¸€ã€‚å®ƒå…è®¸ä½ ä»¥å¯ç»„åˆç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„æ–¹å¼ï¼ˆè€Œé Android ç”Ÿå‘½å‘¨æœŸï¼‰å¯åŠ¨åç¨‹ï¼Œå¹¶ç¡®ä¿é™¤éæŒ‡å®šçš„å…³é”®å‚æ•°ï¼ˆkeysï¼‰ä¹‹ä¸€å‘ç”Ÿå˜åŒ–ï¼Œå¦åˆ™ä¸ä¼šé‡æ–°æ‰§è¡Œæä¾›çš„ä»£ç å—ã€‚è¿™ç§è¡Œä¸ºä½¿å¾— LaunchedEffect ç‰¹åˆ«é€‚åˆæ‰§è¡Œä¸ç‰¹å®šçŠ¶æ€ç›¸å…³çš„ä¸€æ¬¡æ€§äº‹ä»¶ï¼Œä¾‹å¦‚æ˜¾ç¤º Toastæˆ–Snackbarã€è®°å½•äº‹ä»¶æˆ–è§¦å‘ä¸šåŠ¡é€»è¾‘ï¼Œæ­£å¦‚ä½ åœ¨ Now in Android é¡¹ç›®ä¸­çš„ç¤ºä¾‹ä»£ç ä¸­æ‰€è§ï¼š</p>

<pre><code class="Kotlin">val snackbarHostState = remember { SnackbarHostState() }
val isOffline by appState.isOffline.collectAsStateWithLifecycle()

// å¦‚æœç”¨æˆ·æœªè¿æ¥åˆ°äº’è”ç½‘ï¼Œåˆ™æ˜¾ç¤ºä¸€ä¸ªSnackbaræ¥é€šçŸ¥ä»–ä»¬ã€‚
val notConnectedMessage = stringResource(R.string.not_connected)
LaunchedEffect(isOffline) {
    if (isOffline) {
        snackbarHostState.showSnackbar(
            message = notConnectedMessage,
            duration = Indefinite,
        )
    }
  }
</code></pre>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒLaunchedEffect ä¼šåœ¨åº•å±‚åˆ›å»ºä¸€ä¸ªæ–°çš„åç¨‹ä½œç”¨åŸŸã€‚è¿™æ„å‘³ç€å®ƒä¸»è¦ç”¨äºåœ¨å¯ç»„åˆå‡½æ•°ä½œç”¨åŸŸå†…æ‰§è¡ŒåŸºäºåç¨‹çš„ä»»åŠ¡ï¼Œå¹¶åœ¨å¯ç»„åˆå‡½æ•°ç¦»å¼€ç»„åˆæ—¶è‡ªåŠ¨å–æ¶ˆå…¶åç¨‹ã€‚å› æ­¤ï¼ŒLaunchedEffect æœ€é€‚åˆç”¨äºä¸åç¨‹ç›¸å…³çš„æ“ä½œï¼Œä¾‹å¦‚æ•°æ®è·å–ã€å»¶è¿Ÿæ•ˆæœæˆ–äº‹ä»¶å¤„ç†ï¼Œè€Œä¸æ˜¯ç®€å•åœ°æ‰§è¡Œéæš‚åœå‡½æ•°ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥æ¢ç©¶ä¸€ä¸‹ï¼Œä»¥æ›´å¥½åœ°ç†è§£ LaunchedEffect çš„å†…éƒ¨å·¥ä½œåŸç†ã€‚</p>

<pre><code class="Kotlin">@Composable
fun LaunchedEffect(
    key1: Any?,
    block: suspend CoroutineScope.() -&gt; Unit
) {
    val applyContext = currentComposer.applyCoroutineContext
    remember(key1) { LaunchedEffectImpl(applyContext, block) }
}

internal class LaunchedEffectImpl(
    parentCoroutineContext: CoroutineContext,
    private val task: suspend CoroutineScope.() -&gt; Unit
) : RememberObserver {
    private val scope = CoroutineScope(parentCoroutineContext)
    private var job: Job? = null

    override fun onRemembered() {
        // è¿™ä¸åº”è¯¥å‘ç”Ÿï¼Œä½†ä¸ºäº†å®‰å…¨èµ·è§ç•™åœ¨è¿™é‡Œ
        job?.cancel("Old job was still running!")
        job = scope.launch(block = task)
    }

    override fun onForgotten() {
        job?.cancel(LeftCompositionCancellationException())
        job = null
    }

    override fun onAbandoned() {
        job?.cancel(LeftCompositionCancellationException())
        job = null
    }
}
</code></pre>

<p>æ­£å¦‚ä½ åœ¨LaunchedEffectçš„å†…éƒ¨å®ç°ä¸­æ‰€çœ‹åˆ°çš„ï¼Œå®ƒä¼šåˆ›å»ºLaunchedEffectImplå¹¶å°†å…¶å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¹¶å°†ç»™å®šçš„é”®å€¼ä½œä¸ºå‚æ•°ï¼Œä»¥ä¾¿åœ¨é”®å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°åˆ›å»º LaunchedEffectImpl å®ä¾‹ã€‚</p>

<p>å¦‚æœä½ æŸ¥çœ‹å†…éƒ¨ LaunchedEffectImpl ç±»ï¼Œä½ ä¼šå‘ç°å®ƒå®ç°äº†RememberObserveræ¥å£ï¼Œå¹¶é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„ CoroutineScopeã€‚ç„¶åï¼Œå½“å¯ç»„åˆé¡¹è¿›å…¥ç»„åˆé˜¶æ®µæ—¶ï¼Œæä¾›çš„ lambda ä¼šåœ¨æ­¤èŒƒå›´å†…å¯åŠ¨ã€‚å½“å¯ç»„åˆé¡¹ç¦»å¼€ç»„åˆé˜¶æ®µæ—¶ï¼Œåç¨‹èŒƒå›´ä¼šè‡ªåŠ¨å–æ¶ˆï¼Œä»è€Œç¡®ä¿èµ„æºå¾—åˆ°æ­£ç¡®æ¸…ç†ï¼Œå¹¶é¿å…æ½œåœ¨çš„å†…å­˜æ³„æ¼æˆ–æ€§èƒ½é—®é¢˜ã€‚</p>

<p>è¯è™½å¦‚æ­¤ï¼Œå¦‚æœä½ çš„ä»»åŠ¡ä¸æ¶‰åŠä»»ä½•ä¸åç¨‹ç›¸å…³çš„æ“ä½œï¼Œè€Œåªæ˜¯éœ€è¦åœ¨é”®å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°æ‰§è¡Œï¼Œé‚£ä¹ˆä½¿ç”¨ LaunchedEffect å¯èƒ½ç•¥æ˜¾å¤šä½™ã€‚è™½ç„¶åˆ›å»ºåç¨‹ä½œç”¨åŸŸçš„å¼€é”€é€šå¸¸å¾ˆå°ï¼Œä½†åœ¨å®é™…ä¸ä½¿ç”¨åç¨‹çš„æƒ…å†µä¸‹ï¼Œå®ƒä»ç„¶æ˜¯ä¸å¿…è¦çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨æ›´è½»é‡çº§çš„å‰¯ä½œç”¨å¤„ç†library (<a href="https://github.com/skydoves/compose-effects?tab=readme-ov-file#rememberedeffect">RememberedEffect</a>)ï¼Œå®ƒæ›´é€‚åˆéæŒ‚èµ·ï¼ˆnon-suspendingï¼‰ä»»åŠ¡ã€‚</p>

<p>å¦ä¸€ä¸ªå¸¸è§çš„è¯¯è§£æ˜¯LaunchedEffectèƒ½å¤Ÿæ„ŸçŸ¥ Androidç”Ÿå‘½å‘¨æœŸâ€”â€”ä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚ä»å†…éƒ¨å®ç°å¯ä»¥çœ‹å‡ºï¼ŒLaunchedEffectçš„ä½œç”¨åŸŸå®Œå…¨é™å®šäºJetpack Composeç»„åˆç”Ÿå‘½å‘¨æœŸï¼Œä¸ Androidç»„ä»¶ï¼ˆActivityå’ŒFragmentï¼‰çš„ç”Ÿå‘½å‘¨æœŸæ²¡æœ‰ç›´æ¥å…³è”ã€‚</p>

<p>æ¢å¥è¯è¯´ï¼Œå®ƒæœ¬èº«å¹¶ä¸äº†è§£ä»»ä½•æœ‰å…³ Activityã€Fragment æˆ– onStop()æˆ– onDestroy()ç­‰ç”Ÿå‘½å‘¨æœŸäº‹ä»¶çš„ä¿¡æ¯ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ åœ¨ LaunchedEffect ä¸­å¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œå¹¶ä¸” Android ç»„ä»¶ï¼ˆä¾‹å¦‚ Activityï¼‰åœ¨å¯ç»„åˆé¡¹æœªç¦»å¼€ç»„åˆçš„æƒ…å†µä¸‹è¢«åœæ­¢æˆ–é”€æ¯ï¼Œåˆ™è¯¥åç¨‹å¯èƒ½ä¼šç»§ç»­è¿è¡Œï¼Œé™¤éå®ƒæ˜ç¡®ä¸Androidç»„ä»¶ç”Ÿå‘½å‘¨æœŸç»‘å®šã€‚</p>

<h2>DisposableEffect</h2>

<p>DisposableEffectæ˜¯Jetpack Compose è¿è¡Œæ—¶æä¾›çš„å¦ä¸€ä¸ªå‰¯ä½œç”¨å¤„ç†APIã€‚å®ƒå…è®¸ä½ ä¸å¯ç»„åˆé¡¹çš„ç”Ÿå‘½å‘¨æœŸåŒæ­¥æ‰§è¡Œè®¾ç½®å’Œæ¸…ç†é€»è¾‘ã€‚ä¸LaunchedEffectä¸åŒï¼Œå®ƒæä¾›äº†ä¸€ä¸ª DisposableEffectScope ä½œä¸ºæ¥æ”¶å™¨ï¼ˆreceiverï¼‰ï¼Œä½¿ä½ èƒ½å¤Ÿå®šä¹‰ä¸€ä¸ªæ¸…ç†ä»£ç å—ï¼ˆclean-up code blockï¼‰ï¼Œè¯¥ä»£ç å—åœ¨å¯ç»„åˆé¡¹ç¦»å¼€ç»„åˆæ—¶è‡ªåŠ¨è¿è¡Œã€‚è¿™ä½¿å¾—å®ƒéå¸¸é€‚åˆç®¡ç†éœ€è¦æ˜¾å¼å¸è½½çš„å¤–éƒ¨èµ„æºï¼Œä¾‹å¦‚ç›‘å¬å™¨ã€å›è°ƒæˆ–å¹¿æ’­æ¥æ”¶å™¨ã€‚</p>

<pre><code class="Kotlin">val lifecycleOwner = LocalLifecycleOwner.current

// å¦‚æœ `lifecycleOwner` å‘ç”Ÿå˜åŒ–ï¼Œåˆ™é‡Šæ”¾å¹¶é‡ç½®æ•ˆæœ
DisposableEffect(lifecycleOwner) {
  // åˆ›å»ºä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œè§¦å‘æˆ‘ä»¬è®°ä½çš„å›è°ƒä»¥å‘é€åˆ†æäº‹ä»¶
  val observer = LifecycleEventObserver { _, event -&gt;
    if (event == Lifecycle.Event.ON_RESUME) {
      // do something
    } else if (event == Lifecycle.Event.ON_PAUSE || event == Lifecycle.Event.ON_STOP) {
      // do something
    }
  }

  // Add the observer to the lifecycle
  lifecycleOwner.lifecycle.addObserver(observer)

  // å½“æ•ˆæœç¦»å¼€ Composition æ—¶ï¼Œç§»é™¤è§‚å¯Ÿè€…
  onDispose {
    lifecycleOwner.lifecycle.removeObserver(observer)
  }
</code></pre>

<p>ä¸Šé¢çš„ç¤ºä¾‹ä½¿ç”¨ DisposableEffect å°† LifecycleEventObserveræ³¨å†Œåˆ°lifecycleOwnerï¼Œä½¿å…¶èƒ½å¤Ÿè§‚å¯Ÿç”Ÿå‘½å‘¨æœŸå˜åŒ–å¹¶æ ¹æ®å½“å‰çŠ¶æ€æ‰§è¡Œç‰¹å®šé€»è¾‘ã€‚è§‚å¯Ÿè€…ä¼šåœ¨onDisposeå—å†…è¢«å®‰å…¨åœ°ç§»é™¤ï¼Œç¡®ä¿åœ¨å¯ç»„åˆé¡¹ç¦»å¼€ç»„åˆæ—¶è¿›è¡Œé€‚å½“çš„æ¸…ç†ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥äº†è§£DisposableEffectçš„å†…éƒ¨å·¥ä½œåŸç†ã€‚</p>

<pre><code class="Kotlin">@Composable
fun DisposableEffect(
    key1: Any?,
    effect: DisposableEffectScope.() -&gt; DisposableEffectResult
) {
    remember(key1) { DisposableEffectImpl(effect) }
}

private class DisposableEffectImpl(
    private val effect: DisposableEffectScope.() -&gt; DisposableEffectResult
) : RememberObserver {
    private var onDispose: DisposableEffectResult? = null

    override fun onRemembered() {
        onDispose = InternalDisposableEffectScope.effect()
    }

    override fun onForgotten() {
        onDispose?.dispose()
        onDispose = null
    }

    override fun onAbandoned() {
        // ç”±äºæœªè°ƒç”¨ [onRemembered]ï¼Œå› æ­¤æ— éœ€æ‰§è¡Œä»»ä½•æ“ä½œã€‚
    }
}

class DisposableEffectScope {
    inline fun onDispose(
        crossinline onDisposeEffect: () -&gt; Unit
    ): DisposableEffectResult = object : DisposableEffectResult {
        override fun dispose() {
            onDisposeEffect()
        }
    }
}
</code></pre>

<p>å¦‚ DisposableEffect çš„å†…éƒ¨å®ç°æ‰€ç¤ºï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ª DisposableEffectImpl å®ä¾‹ï¼Œå¹¶ä½¿ç”¨æä¾›çš„é”®å°†å…¶å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚
æ¯å½“é”®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„DisposableEffectImpl å®ä¾‹ï¼Œä»¥ä¾¿ç›¸åº”åœ°é‡æ–°æ‰§è¡Œè¯¥æ•ˆæœã€‚</p>

<p>DisposableEffectImplç±»å®ç°äº† RememberObserver æ¥å£ï¼Œå¹¶åˆå§‹åˆ›å»ºä¸€ä¸ª DisposableEffectResultã€‚å½“å¯ç»„åˆé¡¹è¿›å…¥ç»„åˆé˜¶æ®µæ—¶ï¼Œæ•ˆæœ lambda ä¼šåœ¨ DisposableEffectScope ä¸­å¯åŠ¨ã€‚é€€å‡ºç»„åˆæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ DisposableEffectResultçš„onDispose å‡½æ•°ï¼Œä»¥ç¡®ä¿åœ¨å¯ç»„åˆé¡¹å®Œå…¨ä»ç»„åˆä¸­ç§»é™¤ä¹‹å‰æ­£ç¡®æ¸…ç†èµ„æºå¹¶é˜²æ­¢å†…å­˜æ³„æ¼æˆ–æ€§èƒ½é—®é¢˜ã€‚</p>

<h2>SideEffect</h2>

<p>Jetpack Composeä¸­çš„SideEffect API ç”¨äºå®‰å…¨åœ°å°†å¯ç»„åˆé¡¹å†…å‘ç”Ÿçš„çŠ¶æ€å˜åŒ–é€šçŸ¥ç»™å¤–éƒ¨é Compose ç®¡ç†çš„å¯¹è±¡ã€‚å®ƒç¡®ä¿æ•ˆæœåœ¨é‡ç»„æˆåŠŸåè¿è¡Œï¼Œä½¿å…¶æˆä¸ºè§¦å‘ä¾èµ–äºç•Œé¢æœ€ç»ˆç¨³å®šçŠ¶æ€çš„å‰¯ä½œç”¨çš„ç†æƒ³é€‰æ‹©ã€‚</p>

<p>ä½¿ç”¨ SideEffectå¯ä»¥é¿å…åœ¨é‡ç»„é˜¶æ®µæ‰§è¡Œçš„æ“ä½œå¯èƒ½ä¼šè¢«ä¸¢å¼ƒçš„é£é™©ï¼Œå¦‚æœä½ åœ¨æœªé‡‡å–æ­¤ä¿æŠ¤æªæ–½çš„æƒ…å†µä¸‹ç›´æ¥åœ¨å¯ç»„åˆé¡¹ä¸­ç¼–å†™æ•ˆæœï¼Œåˆ™å¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚å› æ­¤ï¼Œå½“ä½ éœ€è¦å°† Compose çŠ¶æ€ä¸å¤–éƒ¨ç³»ç»Ÿï¼ˆä¾‹å¦‚æ—¥å¿—è®°å½•å·¥å…·ã€åˆ†æå·¥å…·æˆ–å‘½ä»¤å¼ç•Œé¢ç»„ä»¶ï¼‰åŒæ­¥æ—¶ï¼ŒSideEffect è‡³å…³é‡è¦ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>

<pre><code class="Kotlin">@Composable
fun rememberFirebaseAnalytics(user: User): FirebaseAnalytics {
    val analytics: FirebaseAnalytics = remember {
        FirebaseAnalytics()
    }

    // æ¯æ¬¡æˆåŠŸç»„åˆåï¼Œä½¿ç”¨å½“å‰ç”¨æˆ·çš„ç”¨æˆ·ç±»å‹æ›´æ–° FirebaseAnalyticsï¼Œ
    // ç¡®ä¿å°†æ¥çš„åˆ†æäº‹ä»¶å·²é™„åŠ æ­¤å…ƒæ•°æ®
    SideEffect {
        analytics.setUserProperty("userType", user.userType)
    }
    return analytics
}
</code></pre>

<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¢ç´¢ä¸€ä¸‹ SideEffect API çš„åº•å±‚å·¥ä½œåŸç†ã€‚</p>

<pre><code class="Kotlin">@Composable
fun SideEffect(
    effect: () -&gt; Unit
) {
    currentComposer.recordSideEffect(effect)
}

/** å½“æˆ‘ä»¬åº”ç”¨ç»„åˆå˜åŒ–æ—¶å®‰æ’è¿è¡Œå‰¯ä½œç”¨ã€‚ */
override fun recordSideEffect(effect: () -&gt; Unit) {
    changeListWriter.sideEffect(effect)
}
</code></pre>

<p>ä¹ä¸€çœ‹ï¼Œä¸Šé¢çš„ä»£ç å¯èƒ½çœ‹ä¼¼ç®€å•ï¼Œä½†å®é™…ä¸Šå´éš¾ä»¥å®Œå…¨ç†è§£ï¼Œè¿™å¾ˆæ­£å¸¸ã€‚è¿™æ˜¯å› ä¸º SideEffect APIä¸ Composeè¿è¡Œæ—¶åº•å±‚å†…éƒ¨æœºåˆ¶ç´§å¯†ç›¸å…³ï¼Œå°¤å…¶æ˜¯ ChangeListï¼Œå®ƒç”¨äºè·Ÿè¸ªå’Œç®¡ç†ç”¨äºæ›´æ–°æ¸²æŸ“UIçš„çŠ¶æ€é©±åŠ¨å˜æ›´åˆ—è¡¨ã€‚</p>

<p>æ ¹æ® Composeæºä»£ç ä¸­çš„å†…éƒ¨æ³¨é‡Šï¼ŒSideEffect APIçš„è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>

<blockquote><p>å®‰æ’æ•ˆæœåœ¨å½“å‰åˆæˆæˆåŠŸå®Œæˆå¹¶åº”ç”¨æ›´æ”¹æ—¶è¿è¡Œã€‚SideEffect å¯ç”¨äºå°†å‰¯ä½œç”¨åº”ç”¨äºåˆæˆç®¡ç†çš„ã€æœªå—å¿«ç…§æ”¯æŒçš„å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨å½“å‰åˆæˆæ“ä½œå¤±è´¥æ—¶é¿å…è¿™äº›å¯¹è±¡å¤„äºä¸ä¸€è‡´çš„çŠ¶æ€ã€‚</p>

<p>å‰¯ä½œç”¨å°†å§‹ç»ˆåœ¨åˆæˆçš„åº”ç”¨è°ƒåº¦ç¨‹åºä¸Šè¿è¡Œï¼Œå¹¶ä¸”åº”ç”¨å™¨æ°¸è¿œä¸ä¼šä¸è‡ªèº«ã€å½¼æ­¤å¹¶å‘è¿è¡Œï¼Œä¹Ÿä¸ä¼šå°†æ›´æ”¹åº”ç”¨äºåˆæˆæ ‘æˆ–è¿è¡Œ RememberObserver äº‹ä»¶å›è°ƒã€‚SideEffect å§‹ç»ˆåœ¨ RememberObserver äº‹ä»¶å›è°ƒä¹‹åè¿è¡Œã€‚</p></blockquote>

<p>å› æ­¤ï¼ŒSideEffect API ä¼šåœ¨æ¯æ¬¡æˆåŠŸé‡ç»„åè¿è¡Œã€‚</p>

<h2>ç»“è®º</h2>

<p>åœ¨æœ¬æ–‡ä¸­ï¼Œä½ æ¢ç´¢äº† Jetpack Compose ä¸­å¸¸ç”¨çš„ä¸‰ä¸ªä¸»è¦å‰¯ä½œç”¨å¤„ç†APIã€‚ç”±äºå£°æ˜å¼UIï¼ˆdeclarative UIï¼‰çš„ç‰¹æ€§ï¼ŒçŠ¶æ€ä¼šå½±å“è¿è¡Œæ—¶è¡Œä¸ºçš„è¯¸å¤šæ–¹é¢ï¼Œå› æ­¤æ­£ç¡®åœ°ä½¿ç”¨å‰¯ä½œç”¨å‡½æ•°å¯¹äºç¡®ä¿ä»»åŠ¡æ‰§è¡Œçš„æ­£ç¡®æ€§å’Œå¯é¢„æµ‹æ€§è‡³å…³é‡è¦ã€‚</p>

<p>æœ¬ä¸»é¢˜æœ€åˆåœ¨<a href="https://github.com/doveletter/">Dove Letter</a>ï¼ˆè¯‘æ³¨ï¼šé“¾æ¥æ˜¯<a href="https://github.com/doveletter/%EF%BC%89%E4%B8%AD%E4%BB%8B%E7%BB%8D%EF%BC%8C%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E7%A7%81%E4%BA%BA%E4%BB%A3%E7%A0%81%E5%BA%93%EF%BC%8C%E6%8F%90%E4%BE%9B%E6%9C%89%E5%85%B3">https://github.com/doveletter/%EF%BC%89%E4%B8%AD%E4%BB%8B%E7%BB%8D%EF%BC%8C%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E7%A7%81%E4%BA%BA%E4%BB%A3%E7%A0%81%E5%BA%93%EF%BC%8C%E6%8F%90%E4%BE%9B%E6%9C%89%E5%85%B3</a> Android å’Œ Kotlin çš„æ¯æ—¥è§è§£ï¼Œæ¶µç›– Composeã€æ¶æ„ã€è¡Œä¸šé¢è¯•é—®é¢˜å’Œå®ç”¨ä»£ç æŠ€å·§ç­‰ä¸»é¢˜ã€‚è‡ªä¸Šçº¿ä»¥æ¥çš„çŸ­çŸ­ 37 å‘¨å†…ï¼ŒDove Letter å·²æ‹¥æœ‰è¶…è¿‡ 700 åä¸ªäººè®¢é˜…è€…å’Œ 20 åä¼ä¸š/ç»ˆèº«è®¢é˜…è€…ã€‚å¦‚æœä½ æ¸´æœ›æ·±å…¥äº†è§£ Androidã€Kotlin å’Œ Composeï¼Œè¯·åŠ¡å¿…æŸ¥çœ‹<a href="https://medium.com/@skydoves/learn-kotlin-and-android-with-dove-letter-26265da11903">â€œé€šè¿‡ Dove Letter å­¦ä¹  Kotlin å’Œ Androidâ€</a>ï¼ˆè¯‘æ³¨ï¼šé“¾æ¥æ˜¯<a href="https://medium.com/@skydoves/learn-kotlin-and-android-with-dove-letter-26265da11903%EF%BC%89%E3%80%82">https://medium.com/@skydoves/learn-kotlin-and-android-with-dove-letter-26265da11903%EF%BC%89%E3%80%82</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æ·±å…¥ç†è§£Jetpack Composeä¸­çš„å‡½æ•°çš„æ‰§è¡Œé¡ºåº]]></title>
    <link href="https://alexhilton.github.io/blog/2025/04/26/understanding-execution-order-in-jetpack-compose/"/>
    <updated>2025-04-26T21:21:31+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/04/26/understanding-execution-order-in-jetpack-compose</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ªã€ŒUnderstanding Execution Order in Jetpack Compose: DisposableEffect, LaunchedEffect, and Composablesã€ï¼ŒåŸæ–‡é“¾æ¥<a href="https://proandroiddev.com/understanding-execution-order-in-jetpack-compose-disposableeffect-launchedeffect-and-composables-d2d0b75b7ec8">https://proandroiddev.com/understanding-execution-order-in-jetpack-compose-disposableeffect-launchedeffect-and-composables-d2d0b75b7ec8</a>ï¼Œç”±Sahil Thakarå‘å¸ƒäº2025å¹´4æœˆ13æ—¥ã€‚</p></blockquote>

<p><a href=""><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*44_HTD27S8k-mxkIc_A9zg.png" title="auto auto" ></a></p>

<!-- more -->


<p>å¤§å®¶å¥½ï¼Œä»Šå¤©æˆ‘ä»¬åˆæ¥èŠèŠJetpack-Composeçš„å°è¯é¢˜ã€‚æ— è®ºå¯¹äºæ–°æ‰‹è¿˜æ˜¯ç»éªŒä¸°å¯Œçš„å¼€å‘è€…æ¥è¯´ï¼Œè¿™éƒ½æ˜¯ä¸€ä¸ªå°è¯é¢˜ï¼Œä½†å´æ˜¯å¾ˆå…³é”®çš„ã€‚æˆ‘ä»¬å°†è®¨è®ºä¸€ä¸‹Jetpack Composeä¸­å‰¯ä½œç”¨å’Œå¯ç»„åˆé¡¹ï¼ˆcomposablesï¼‰çš„æ‰§è¡Œé¡ºåºï¼Œç‰¹åˆ«æ˜¯ DisposableEffectã€LaunchedEffect å’Œå¯ç»„åˆå‡½æ•°çš„æ‰§è¡Œé¡ºåºä»¥åŠå…¶ç”Ÿå‘½å‘¨æœŸäº¤äº’è¿‡ç¨‹ã€‚</p>

<p>æˆ‘ä»¬å°†ä»”ç»†æ¢ç©¶ DisposableEffect å’Œ LaunchedEffect åœ¨å¯ç»„åˆé¡¹ä¹‹é—´å¯¼èˆªåˆ‡æ¢æ—¶æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Œç‰¹åˆ«å…³æ³¨å®ƒä»¬åœ¨è¿”å›ä¹‹å‰è®¿é—®è¿‡çš„é¡µé¢æ—¶çš„è¡Œä¸ºã€‚ï¼ˆè®¸å¤šç»éªŒä¸°å¯Œçš„å¼€å‘è€…ä¼šå‘Šè¯‰æˆ‘æˆ‘çŸ¥é“è¿™ä¸€ç‚¹ï¼Œä½†æˆ‘æ•¢æ‰“èµŒï¼Œä½ ä»¬ä¸­çš„å¾ˆå¤šäººå¹¶ä¸çŸ¥é“ï¼‰ã€‚</p>

<p>é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚</p>

<pre><code class="Kotlin">@Composable
fun MyComposable(cartId: String) {
    val lifecycleOwner = LocalLifecycleOwner.current

    // DisposableEffect observes the lifecycleOwner
    DisposableEffect(lifecycleOwner) {
        Log.e("Init", "DisposableEffect")

        onDispose {
            Log.e("Init", "DisposableEffect - onDispose")
        }
    }

    // LaunchedEffect triggers when cartId changes
    LaunchedEffect(key1 = cartId) {
        Log.e("Init", "LaunchedEffect")
    }

    // Scaffold is the UI container
    Column {
        Log.e("Init", "Column")
        // You can add your screen content here
    }
}

Output:-

E/Init: Column
E/Init: DisposableEffect
E/Init: LaunchedEffect
</code></pre>

<h2>æ‰§è¡Œé¡ºåºè¿·é¢˜ï¼šä¸ºä»€ä¹ˆColumnå…ˆæ‰§è¡Œï¼Ÿ</h2>

<p>ç­”æ¡ˆåœ¨äºè¿™äº›å‰¯ä½œç”¨ APIï¼ˆDisposableEffectã€LaunchedEffectï¼‰ç›¸å¯¹äºç»„åˆ(Composition)çš„å®é™…æ‰§è¡Œæ—¶é—´ã€‚</p>

<h3>1. ç»„åˆé˜¶æ®µä¼˜å…ˆ</h3>

<ul>
<li>Jetpack Compose é¦–å…ˆåœ¨ç»„åˆæœŸé—´æ„å»ºUIæ ‘ã€‚</li>
<li>æ­¤æ—¶ï¼ŒColumn æ˜¯ä¸€ä¸ªå¯ç»„åˆå‡½æ•°ã€‚å®ƒä¼šåœ¨ç»„åˆé˜¶æ®µç«‹å³æ‰§è¡Œï¼Œä»¥æ„å»º UIã€‚</li>
<li>å› æ­¤ï¼šColumn() é¦–å…ˆè¿è¡Œ â†’ æ‰“å‡ºæ—¥å¿— â€œColumnâ€ã€‚</li>
</ul>


<h3>2. å‰¯ä½œç”¨åœ¨ç»„åˆæœŸé—´æ³¨å†Œï¼Œä½†åœ¨ç»„åˆå®Œæˆåæ‰§è¡Œ</h3>

<ul>
<li>DisposableEffect å’Œ LaunchedEffect åœ¨ç»„åˆæœŸé—´æ³¨å†Œå…¶å·¥ä½œï¼Œ
ä½†å®ƒä»¬çš„å®é™…æ‰§è¡Œå‘ç”Ÿåœ¨ç»„åˆå®Œæˆåã€‚</li>
<li>Compose ä½¿ç”¨å†…éƒ¨è°ƒåº¦ç¨‹åºï¼ˆé€šè¿‡ Recomposerï¼‰åœ¨æäº¤å¸§åè¿è¡Œå‰¯ä½œç”¨ã€‚</li>
</ul>


<p>å› æ­¤ï¼Œå®é™…æ—¶é—´çº¿å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre><code class="Bash">ç»„åˆï¼ˆCompositionï¼‰ å¼€å§‹
   â†’ Column() è¿è¡Œ â†’ æ‰“å°æ—¥å¿— "Column"
   â†’ æ³¨å†Œ DisposableEffect ä»£ç å—
   â†’ æ³¨å†Œ LaunchedEffect ä»£ç å—
ç»„åˆ ç»“æŸ
â†’ å‰¯ä½œç”¨å‡½æ•°å¼€å§‹æ‰§è¡Œ
   â†’ DisposableEffect æ‰§è¡Œ â†’ æ‰“å°æ—¥å¿— "DisposableEffect"
   â†’ LaunchedEffect å¯åŠ¨åç¨‹ â†’ æ‰“å°æ—¥å¿— "LaunchedEffect"
</code></pre>

<p>è¿™é‡Œæˆ‘ä»¬è®¨è®ºäº†composableså’Œå‰¯ä½œç”¨ä¹‹é—´çš„æ‰§è¡Œé¡ºåºã€‚
é‚£ä¹ˆåœ¨ LaunchedEffectå’Œ DisposableEffectå‰¯ä½œç”¨å‡½æ•°ä¹‹é—´ï¼Œè°åˆå°†å…ˆæ‰§è¡Œå‘¢ï¼Ÿ</p>

<p>è®©æˆ‘ä»¬æ¥ä»”ç»†çœ‹çœ‹ã€‚</p>

<p><strong>å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œé¡ºåºï¼ˆç»„åˆå®Œæˆåï¼‰ï¼š</strong></p>

<ol>
<li>DisposableEffect â†’ é¦–å…ˆè¿è¡Œ</li>
<li>LaunchedEffect â†’ éšåè¿è¡Œ</li>
</ol>


<p>ä¸ºå•¥å­å‘¢ï¼Ÿ</p>

<p>æ­¤é¡ºåºç”±Composeè¿è¡Œæ—¶å®šä¹‰çš„ï¼š</p>

<ul>
<li>DisposableEffect æ˜¯åŒæ­¥çš„ï¼Œç”¨äºåœ¨ç»„åˆåç«‹å³å¤„ç†è®¾ç½®/æ¸…ç†ã€‚</li>
<li>LaunchedEffect ä¼šå¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œè€Œåç¨‹çš„å¯åŠ¨æ˜¯å¼‚æ­¥çš„ï¼Œè®¡åˆ’åœ¨å…¶ä»–åŒæ­¥æ•ˆæœï¼ˆä¾‹å¦‚ DisposableEffectï¼‰ä¹‹åè¿è¡Œã€‚</li>
</ul>


<p>å†…éƒ¨æœºåˆ¶ï¼šJetpack Compose ç»´æŠ¤äº†æ˜ç¡®å®šä¹‰çš„æ•ˆæœåº”ç”¨é¡ºåºã€‚</p>

<ol>
<li>DisposableEffectã€SideEffectã€SnapshotFlow ç­‰å‰¯ä½œç”¨ä¼šåœ¨ç»„åˆåç«‹å³è§¦å‘ï¼ˆåŒæ­¥ï¼‰ã€‚</li>
<li>ç„¶åï¼ŒåŸºäºåç¨‹çš„æ•ˆæœï¼ˆä¾‹å¦‚ LaunchedEffectï¼‰ä¼šè¢«è°ƒåº¦åˆ°ä¸‹ä¸€ä¸ªè¿è¡Œï¼ˆå¼‚æ­¥ï¼Œé€šè¿‡ Recomposerï¼‰ã€‚</li>
</ol>


<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹åœ¨å¯ç»„åˆé¡¹ä¹‹é—´å¯¼èˆªåˆ‡æ¢æ—¶ DisposableEffect å’Œ LaunchedEffect æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Œå°¤å…¶å…³æ³¨å®ƒä»¬åœ¨è¿”å›ä¹‹å‰è®¿é—®è¿‡çš„å±å¹•æ—¶çš„è¡Œä¸ºã€‚</p>

<p>è¾“å‡ºç»“æœä¼šè®©ä½ å¤§åƒä¸€æƒŠã€‚</p>

<pre><code class="Kotlin">@Composable
fun MyApp() {
    val navController = rememberNavController()

    NavHost(navController = navController, startDestination = "screenA") {
        composable("screenA") {
            ScreenA(
                cartId = "123",
                onNavigateToB = { navController.navigate("screenB") }
            )
        }
        composable("screenB") {
            ScreenB(
                cartId = "456",
                onNavigateBack = { navController.popBackStack() }
            )
        }
    }
}

@Composable
fun ScreenA(cartId: String, onNavigateToB: () -&gt; Unit) {
    DisposableEffect(Unit) {
        println("ğŸ˜‡ ScreenA -&gt; DisposableEffect")
        onDispose {
            println("ğŸ˜‡ ScreenA -&gt; DisposableEffect - onDispose")
        }
    }

    LaunchedEffect(cartId) {
        println("ğŸ˜‡ScreenA -&gt; LaunchedEffect")
    }

    Column(modifier = Modifier.padding(top = 100.dp)) {
        Button(onClick = onNavigateToB) {
            Text(text = "Navigate To ScreenB")
        }
    }

}

@Composable
fun ScreenB(cartId: String, onNavigateBack: () -&gt; Unit) {
    val lifecycleOwner = LocalLifecycleOwner.current

    DisposableEffect(lifecycleOwner) {
        println("ğŸ˜‡ ScreenB -&gt; DisposableEffect")
        onDispose {
            println("ğŸ˜‡ ScreenB -&gt; DisposableEffect - onDispose")
        }
    }

    LaunchedEffect(cartId) {
        println("ğŸ˜‡ ScreenB -&gt; LaunchedEffect")
    }

    Column{
        Column(modifier = Modifier) {
            Button(onClick = onNavigateBack) {
                Text("Back to Screen A")
            }
        }
    }
}

Output:- 

when ScreenA init
ğŸ˜‡ ScreenA -&gt; DisposableEffect
ğŸ˜‡ ScreenA -&gt; LaunchedEffect

Navigate To ScreenA -&gt; ScreenB
ğŸ˜‡ ScreenB -&gt; DisposableEffect
ğŸ˜‡ ScreenB -&gt; LaunchedEffect
ğŸ˜‡ ScreenA -&gt; DisposableEffect - onDispose

Navigate back to ScreenB -&gt; ScreenA
ğŸ˜‡ ScreenA -&gt; DisposableEffect
ğŸ˜‡ ScreenA -&gt; LaunchedEffect
ğŸ˜‡ ScreenB -&gt; DisposableEffect - onDispose
</code></pre>

<h2>å®ƒï¼ˆJetpack Composeå¯¼èˆªï¼‰å†…éƒ¨å®é™…å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h2>

<p>Compose Navigationåœ¨ NavHostä¸­å›´ç»•å¯ç»„åˆé¡¹çš„è¡Œä¸ºéµå¾ªä»¥ä¸‹é€»è¾‘ï¼š</p>

<ol>
<li>é¦–å…ˆè¿›è¡Œæ–°ç›®çš„åœ°ï¼ˆæ­¤å¤„ä¸º ScreenAï¼‰çš„ç»„åˆã€‚

<ul>
<li>å¯¼èˆªåˆ‡æ¢æ—¶ï¼ŒComposeä¼šç«‹å³ä¸ºæ–°å±å¹•åˆ›å»ºUIã€‚</li>
<li>æ–°é¡µé¢ï¼ˆæ­¤å¤„ä¸º ScreenAï¼‰çš„ DisposableEffect å’Œ LaunchedEffect ä¼šåœ¨æ–°é¡µé¢ç»„åˆæœŸé—´æˆ–ä¹‹åç«‹å³æ‰§è¡Œã€‚</li>
</ul>
</li>
<li>åœ¨æ–°ç›®çš„åœ°æˆåŠŸç»„åˆå¹¶æäº¤åˆ° UI å±‚æ¬¡ç»“æ„åï¼Œä¼šå¤„ç†ä¸Šä¸€ä¸ªé¡µé¢çš„å¯ç»„åˆé¡¹ï¼ˆæ­¤å¤„ä¸º ScreenBï¼‰ã€‚

<ul>
<li>Compose ä¼šä¿æŒä¸Šä¸€ä¸ªå¯ç»„åˆé¡¹ï¼ˆæ­¤å¤„ä¸º ScreenBï¼‰çŸ­æš‚å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œç›´åˆ°æ–°å¯ç»„åˆé¡¹ï¼ˆæ­¤å¤„ä¸º ScreenAï¼‰ç¨³å®šï¼Œä»¥ç¡®ä¿å¯¼èˆªé¡ºç•…ã€‚</li>
<li>åªæœ‰åœ¨æ–°çš„å¯ç»„åˆé¡¹ï¼ˆæ­¤å¤„ä¸º ScreenAï¼‰å®Œå…¨ç»„åˆåï¼ŒCompose æ‰ä¼šæ¸…ç†å¹¶ç§»é™¤ï¼ˆdisposeï¼‰ä¸Šä¸€ä¸ªå¯ç»„åˆé¡¹ï¼ˆæ­¤å¤„ä¸º ScreenBï¼‰ã€‚</li>
</ul>
</li>
</ol>


<p>å› æ­¤ï¼Œå¯¼èˆªæœŸé—´çš„å®é™…ç”Ÿå‘½å‘¨æœŸæµç¨‹æ˜¯é…±å©¶å„¿çš„ï¼š</p>

<pre><code class="Bash">å¯¼èˆªè¿”å› (ScreenB â†’ ScreenA)
â”‚
â”œâ”€â”€ 1ï¸âƒ£ Compose ç«‹å³åˆ›å»º ScreenA
â”‚      â”œâ”€ ScreenA DisposableEffect executes instantly.
â”‚      â””â”€ ScreenA LaunchedEffect coroutine launched.
â”‚
â””â”€â”€ 2ï¸âƒ£ åœ¨ScreenAæˆåŠŸè¿è¡Œä¹‹å:
       â””â”€ ScreenB DisposableEffect onDispose runs.
</code></pre>

<h2>ä¸ºå•¥Composeè¦é…±ç´« æï¼Ÿ</h2>

<p>Compose Navigation ä¼šè°¨æ…å¤„ç†é¡µé¢çš„ç»„åˆï¼Œä»¥ç¡®ä¿ä¸æ»‘ï¼ˆseamlessï¼‰çš„ç”¨æˆ·ä½“éªŒå’Œç¨³å®šæ€§ï¼š</p>

<ul>
<li>å®ƒä¸ä¼šåœ¨ç¡®ä¿ç›®æ ‡é¡µé¢ (ScreenA) å·²ç»„åˆå¹¶å‡†å¤‡å°±ç»ªä¹‹å‰è¿‡æ—©åœ°å¤„ç†ä¸Šä¸€ä¸ªå¯ç»„åˆé¡¹ (ScreenB)ã€‚</li>
<li>è¿™å¯ä»¥é¿å…åœ¨å¯¼èˆªåˆ‡æ¢è¿‡ç¨‹ä¸­å‡ºç°è§†è§‰æ•…éšœæˆ–ç©ºç™½å±å¹•ã€‚</li>
<li>åªæœ‰åœ¨ç¡®ä¿æ–°é¡µé¢å®‰å…¨åˆ°ä½åï¼ŒCompose æ‰ä¼šè§¦å‘å¤„ç†ä¸Šä¸€ä¸ªå±å¹•çš„æ“ä½œã€‚</li>
</ul>


<h2>Jetpack Compose NavHostå†…éƒ¨æœºåˆ¶ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰ï¼š</h2>

<p>åœ¨è°ƒç”¨ popBackStack() æˆ– navigate() æ—¶ï¼ŒCompose çš„ NavHost å†…éƒ¨çš„å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼š</p>

<ul>
<li>æ–°çš„è·¯ç”±ç»„åˆå¼€å§‹ï¼ˆå¯ç»„åˆé¡¹åˆ›å»ºï¼‰ã€‚</li>
<li>æˆåŠŸç»„åˆå¹¶æäº¤å¸§åï¼Œä¸å†ä½äº NavHost åæ ˆä¸­çš„æ—§å¯ç»„åˆé¡¹èŠ‚ç‚¹å°†è¢«æ ‡è®°ä¸ºå¾…å¤„ç†ã€‚</li>
<li>ç„¶åï¼ŒCompose ä¼šåœ¨ä¸‹ä¸€å¸§ä¸­è¿è¡Œè¿™äº›å·²ç§»é™¤å¯ç»„åˆé¡¹çš„å¤„ç½®é€»è¾‘ (onDispose)ã€‚</li>
</ul>


<p>å› æ­¤ï¼Œå³ä½¿ä½ åœ¨è§†è§‰ä¸Šç«‹å³å¯¼èˆªå›åŸç‚¹ï¼Œé”€æ¯å¼çš„æ“ä½œï¼ˆå¦‚onDisposeï¼‰ä¹Ÿä¼šç•¥å¾®å»¶è¿Ÿæ‰§è¡Œï¼Œä»¥ä¿è¯ç•Œé¢çš„æ•´ä½“ç¨³å®šæ€§ã€‚</p>

<p>å¦‚æœä½ æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·ç•™è¨€ï¼Œæˆ‘ä¼šå°½å¿«å›å¤ä½ ã€‚ğŸ’¬âœ¨
æˆ‘ä»¬å¾ˆå¿«ä¼šæ·±å…¥æ¢è®¨Jetpack Composeï¼Œæ•¬è¯·æœŸå¾…ï¼ğŸš€
åœ¨æ­¤ä¹‹å‰ï¼Œç¥ä½ codingæ„‰å¿«ï¼ğŸ‰ğŸ‘¨â€ğŸ’»</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Jetpack Composeçš„æ€§èƒ½ä¼˜åŒ–å»ºè®®]]></title>
    <link href="https://alexhilton.github.io/blog/2025/04/22/performance-optimization-in-jetpack-compose/"/>
    <updated>2025-04-22T22:34:25+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/04/22/performance-optimization-in-jetpack-compose</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ªã€ŒPerformance Optimization in Jetpack Composeã€ï¼ŒåŸæ–‡é“¾æ¥<a href="https://carrion.dev/en/posts/performance-optimization-compose/">https://carrion.dev/en/posts/performance-optimization-compose/</a>ï¼Œç”±Ignacio CarriÃ³nï¼Œå‘å¸ƒäº2025å¹´4æœˆ8æ—¥ã€‚</p></blockquote>

<p><a href=""><img src="https://www.itmob.cn/upload/2023/01/banner-jetpack-compose-a452c3e8f1ad489a8560a4f0a9f88e07.jpg" title="auto auto" ></a></p>

<!-- more -->


<p><strong>è¯‘è€…æŒ‰ï¼š</strong> Jetpack Composeæ˜¯ä¸€ä¸ªä¼˜ç§€çš„å£°æ˜å¼UIæ¡†æ¶ï¼Œå¯¹å¼€å‘è€…éå¸¸å‹å¥½ï¼Œå¯ä»¥é«˜æ•ˆç‡çš„æ’¸å„ç§UIé¡µé¢å’ŒUIå…ƒç´ ã€‚ä½†å®ƒä»ç„¶å¹¶ä¸æ˜¯å¾ˆæˆç†Ÿï¼Œæœ‰äº›äº‹æƒ…è¿˜åšä¸äº†ï¼Œè€Œä¸”æ¸²æŸ“æ€§èƒ½ä¹Ÿç•¥è¾“äºåŸç”Ÿçš„Viewæ–¹å¼ï¼Œæ¯•ç«Ÿå®ƒæ¯”åŸç”Ÿçš„Viewå¤šäº†ä¸€å±‚ç»„åˆæ ‘å’Œæ¸²æŸ“æ ‘ã€‚å› æ­¤ï¼Œåœ¨äº«å—å£°æ˜å¼UIå¸¦æ¥çš„ä¾¿æ·çš„åŒæ—¶ï¼Œå°±éœ€è¦æ·±å…¥åœ°äº†è§£å…¶å†…éƒ¨çš„å·¥ä½œæœºåˆ¶ï¼Œå’Œå­¦ä¹ ä¸€äº›é«˜çº§æŠ€å·§ï¼Œä»¥æå‡è¿è¡Œæ—¶çš„æ¸²æŸ“æ€§èƒ½ã€‚å¦å¤–ï¼Œéœ€è¦ æ³¨æ„è™½ç„¶è¿™ç¯‡æ–‡ç« æ˜¯é’ˆå¯¹for Androidçš„Jetpack Composeï¼Œä½†å¤§éƒ¨åˆ†ä¹Ÿé€‚ç”¨äºCompose Multiplatformã€‚</p>

<p>æ€§èƒ½ä¼˜åŒ–å¯¹äºåœ¨Jetpack Composeåº”ç”¨ä¸­æä¾›æµç•…çš„ç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ã€‚æœ¬æ–‡æ¢è®¨äº†å…³é”®æŠ€æœ¯å’Œæœ€ä½³å®è·µï¼Œä»¥ç¡®ä¿ä½ çš„å¯ç»„åˆå‡½æ•°é«˜æ•ˆä¸”æ€§èƒ½å“è¶Šã€‚</p>

<h2>ç†è§£ç»„åˆï¼ˆCompositionï¼‰å’Œé‡ç»„ï¼ˆReCompositionï¼‰</h2>

<p><strong>è¯‘æ³¨ï¼š</strong> ç»„åˆä¸é‡ç»„æ˜¯Composeä¸­éå¸¸é‡è¦ çš„æ¦‚å¿µï¼Œå¦‚æœä¸ç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥å¤ä¹ ä¸€ä¸‹ä¹‹å‰çš„æ–‡ç« <a href="https://juejin.cn/post/7379437165486112805">é™Composeåå…«æŒä¹‹ã€æ½œé¾™å‹¿ç”¨ã€| Thinking in Compose</a>å’Œ<a href="https://juejin.cn/post/7401358349877346338">é™Composeåå…«æŒä¹‹ã€æŸåˆ™æœ‰å­šã€| Lifecycle</a>ã€‚</p>

<p>Compose æ€§èƒ½çš„ä¸€ä¸ªåŸºæœ¬æ–¹é¢æ˜¯äº†è§£åˆæˆå’Œé‡ç»„çš„å·¥ä½œåŸç†ï¼š</p>

<h3>æ™ºèƒ½é‡ç»„ï¼ˆSmart Recompositionï¼‰</h3>

<p>Compose ä½¿ç”¨æ™ºèƒ½é‡ç»„åŠŸèƒ½ï¼Œä»…æ›´æ–°ç•Œé¢ä¸­éœ€è¦æ›´æ”¹çš„éƒ¨åˆ†ã€‚äº†è§£è§¦å‘é‡ç»„çš„åŸå› ä»¥åŠå¦‚ä½•æœ€å°åŒ–é‡ç»„çš„å½±å“èŒƒå›´å¯¹äºæ€§èƒ½ä¼˜åŒ–è‡³å…³é‡è¦ã€‚</p>

<pre><code class="Kotlin">@Composable
fun ExpensiveCalculation(numbers: List&lt;Int&gt;) {
    // ä¸å¥½ï¼šæ¯æ¬¡é‡ç»„éƒ½ä¼šæ‰§è¡Œæ˜‚è´µçš„æ“ä½œ
    val average = numbers.takeIf { it.isNotEmpty() }
        ?.average()
        ?: 0.0

    // ä¼˜ç‚¹ï¼šæ˜‚è´µçš„æ“ä½œè¢«ç¼“å­˜ï¼Œå¹¶ä¸”ä»…åœ¨è¾“å…¥å‘ç”Ÿå˜åŒ–æ—¶é‡æ–°è®¡ç®—
    val cachedAverage = remember(numbers) {
        numbers.takeIf { it.isNotEmpty() }
            ?.average()
            ?: 0.0
    }

    Column {
        // æ¯æ¬¡é‡ç»„æ—¶éƒ½ä¼šé‡æ–°è®¡ç®—
        Text("Current Average: ${"%.2f".format(average)}")

        // è¿™å°†ä½¿ç”¨ç¼“å­˜ä½çš„å€¼
        Text("Cached Average: ${"%.2f".format(cachedAverage)}")
    }
}
</code></pre>

<h3>ç¨³å®šç±»å‹ï¼ˆStable typesï¼‰å’Œä¸å¯å˜æ€§ï¼ˆImmutabilityï¼‰</h3>

<p>ç¨³å®šçš„ç±»å‹å¯¹äºComposeçš„æ™ºèƒ½é‡ç»„ç³»ç»Ÿè‡³å…³é‡è¦ã€‚å½“Composeèƒ½å¤Ÿä¿è¯å…¶ equals() æ–¹æ³•ä¸å…¶å±æ€§ä¸€è‡´ï¼Œå¹¶ä¸”å±æ€§æœ¬èº«ä¸ä¼šåœ¨ä¸è§¦å‘é‡ç»„çš„æƒ…å†µä¸‹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¯¥ç±»å‹å³è¢«è§†ä¸ºç¨³å®šç±»å‹ã€‚</p>

<pre><code class="Kotlin">// ä¸å¥½ï¼šç±»å‹ä¸ç¨³å®š - å¯å˜å±æ€§å¯èƒ½ä¼šåœ¨ä¸é€šçŸ¥Composeçš„æƒ…å†µä¸‹å‘ç”Ÿå˜åŒ–
data class UserState(
    var name: String, // å¯å˜å±æ€§å¯ä»¥å·å·åœ°æ”¹å˜
    var age: Int      // è€Œä¸”æ›´æ”¹ä¸ä¼šè§¦å‘é‡ç»„
)

// ä¼˜ç‚¹ï¼šç¨³å®šç±»å‹ - ä¸å¯å˜å±æ€§å’Œæ˜¾å¼ç¨³å®šæ€§
@Stable  // å‘Šè¯‰Composeæ­¤ç±»å‹å…·æœ‰å¯é¢„æµ‹çš„ç›¸ç­‰æ€§
data class UserState(
    val name: String,  // ä¸å¯å˜å±æ€§
    val age: Int      // å¦‚è¦æ›´æ”¹éœ€è¦åˆ›å»ºæ–°å®ä¾‹
)
</code></pre>

<p>ä½¿ç”¨ç¨³å®šç±»å‹æœ‰ä»¥ä¸‹å‡ ä¸ªå¥½å¤„ï¼š</p>

<ol>
<li>æ›´é«˜æ•ˆçš„é‡ç»„ - å½“Composeç¡®å®šæ•°æ®æœªå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå¯ä»¥è·³è¿‡é‡ç»„éƒ¨åˆ†UIï¼Œæ¢å¥è¯è¯´å¯ä»¥å‡å°‘å¾ˆå¤šä¸å¿…è¦çš„é‡ç»„ï¼Œè¿›è€Œæé«˜æ€§èƒ½</li>
<li>å¯é¢„æµ‹çš„è¡Œä¸º - æ•°æ®æ›´æ”¹å§‹ç»ˆä¼šè§¦å‘æ­£ç¡®çš„UIæ›´æ–°</li>
<li>çº¿ç¨‹å®‰å…¨ï¼ˆThread safetyï¼‰ - ä¸å¯å˜æ•°æ®å¯ä»¥å®‰å…¨åœ°åœ¨åç¨‹ä¹‹é—´å…±äº«</li>
</ol>


<p><strong>è¯‘æ³¨ï¼š</strong> è¿™é‡Œè¯´çš„åº”è¯¥æ˜¯å¯ä»¥åœ¨çº¿ç¨‹ä¹‹é—´å®‰å…¨åœ°å…±äº«ï¼Œåç¨‹å¦‚æœæ²¡æœ‰çº¿ç¨‹åˆ‡æ¢æ˜¯ä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜çš„ã€‚</p>

<h2>æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ç‚¹</h2>

<h3>1. åˆç†åœ°ä½¿ç”¨ remember å’Œ derivedStateOf è¿›è¡ŒçŠ¶æ€ï¼ˆStateï¼‰ç®¡ç†</h3>

<p>remember å’Œ derivedStateOf å‡½æ•°åœ¨çŠ¶æ€ç®¡ç†ä¸­èµ·åˆ°ä¸åŒçš„ä½œç”¨ï¼š</p>

<pre><code class="Kotlin">@Composable
fun UserProfile(user: User, items: List&lt;Item&gt;) {
    // ç¼ºç‚¹ï¼šæ¯æ¬¡é‡æ–°ç»„åˆæ—¶éƒ½é‡æ–°è®¡ç®—
    val filteredItems = items.filter { it.userId == user.id }

    // å¥½ï¼šä½¿ç”¨è®°å¿†ç¼“å­˜è®¡ç®—
    val cachedItems = remember(items, user.id) {
        items.filter { it.userId == user.id }
    }

    // æ›´å¥½çš„æ–¹å¼ï¼šä½¿ç”¨ derivedStateOf è¿›è¡Œååº”å¼è®¡ç®—
    val reactiveItems by remember(items) {
        derivedStateOf {
            items.filter { it.userId == user.id }
        }
    }

    // å½“ items å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒreactiveItems ä¼šè‡ªåŠ¨æ›´æ–°
    // å¹¶ä¸”ä»…åœ¨è¿‡æ»¤ç»“æœå‘ç”Ÿå˜åŒ–æ—¶è§¦å‘é‡ç»„
    LazyColumn {
        itemsIndexed(
            items = reactiveItems,
            key = { _: Int, item: Item -&gt; item.id }
        ) { _: Int, item: Item -&gt;
            ItemRow(item)
        }
    }
}
</code></pre>

<p><strong>è¯‘æ³¨ï¼š</strong> å¯¹äºçŠ¶æ€çš„ç®¡ç†ï¼Œå¯ä»¥å¤ä¹ ä¸€ä¸‹ä¹‹å‰ä¸“é—¨è®²è§£å‰¯ä½œç”¨(Side effects)çš„æ–‡ç« <a href="https://juejin.cn/post/7405158681078104127">é™Composeåå…«æŒä¹‹ã€é¾™æˆ˜äºé‡ã€| Side Effects</a>ã€‚</p>

<h3>2. åˆç†åœ°ä½¿ç”¨CompositionLocal</h3>

<p><strong>è¯‘æ³¨ï¼š</strong> å…³äºCompositionLocalçš„ä½¿ç”¨å¯ä»¥çœ‹å‰é¢å†™è¿‡çš„æ–‡ç« <a href="https://juejin.cn/post/7434543407636267071">ç”¨Composeä¸­çš„CompositionLocalæ¥æš—æ¸¡é™ˆä»“</a>ï¼Œä¸‹é¢çš„ç¤ºä¾‹æ˜¯æƒ³è¦è¯´æ˜ï¼Œåº”è¯¥åœ¨åˆç†çš„åœ°æ–¹è®¿é—®CompositionLocalé‡Œé¢çš„æ•°æ®ï¼Œå› æ•°å¯¹CompositionLocalçš„è®¿é—®åœ°æ–¹ä¼šè¢«è§¦å‘é‡ç»„ï¼ˆ<a href="https://juejin.cn/post/7401358349877346338">ä¹‹å‰çš„æ–‡ç« æœ‰è®²è¿‡</a>é‡ç»„çš„è§¦å‘æ˜¯çŠ¶æ€ä½¿ç”¨çš„åœ°æ–¹ï¼Œè€Œä¸æ˜¯å®šä¹‰çš„åœ°æ–¹ï¼‰ï¼Œå¦‚æœåœ¨æ‰€æœ‰çš„åœ°æ–¹éƒ½ ç›´æ¥è®¿é—®CompositionLocalï¼Œç‰¹åˆ«æ˜¯åµŒå¥—è¾ƒæ·±çš„åœ°æ–¹ä¹Ÿéƒ½ ç›´æ¥è®¿é—®ï¼Œé‚£éƒ½ä¼šè§¦å‘é‡ç»„ï¼Œä½†å¤§éƒ¨åˆ†å…¶å®æ˜¯ä¸å¿…è¦çš„ã€‚åƒä¸‹æ ·ç¤ºä¾‹å±•ç¤ºçš„é‚£æ ·ï¼Œåœ¨ä¸€å®šçš„çº§åˆ«ä¸­è®¿é—®CompositionLocalï¼Œç„¶åå®ƒçš„å†…éƒ¨åµŒå¥—è°ƒç”¨ç›´æ¥å¤ç”¨æ•°å€¼ï¼Œå¯ä»¥é¿å…è¿‡åº¦é‡ç»„ã€‚</p>

<pre><code class="Kotlin">// ä¸å¥½ï¼šæ¯ä¸ªå­ç»„ä»¶éƒ½è®¿é—® CompositionLocal
@Composable
fun DeepNestedContent() {
    val theme = LocalTheme.current  // ç›´æ¥è®¿é—®
    val strings = LocalStrings.current  // å¤šä¸ª CompositionLocal è®¿é—®
    val dimensions = LocalDimensions.current

    Column {
        Text(
            text = strings.title,
            style = theme.textStyle,
            modifier = Modifier.padding(dimensions.padding)
        )
        // å…·æœ‰é‡å¤ CompositionLocal è®¿é—®çš„æ›´å¤šåµŒå¥—å†…å®¹
    }
}

// å¥½ï¼šæå‡ CompositionLocalçš„å€¼ä»¥æœ€å°åŒ–æŸ¥æ‰¾
@Composable
fun ParentContent() {
    // å•ç‹¬è®¿é—® CompositionLocal å€¼
    val theme = LocalTheme.current
    val strings = LocalStrings.current
    val dimensions = LocalDimensions.current

    DeepNestedContent(
        theme = theme,
        strings = strings,
        dimensions = dimensions
    )
}

@Composable
fun DeepNestedContent(
    theme: Theme,
    strings: Strings,
    dimensions: Dimensions
) {
    // ä½¿ç”¨ä¼ é€’çš„å‚æ•°è€Œä¸æ˜¯æŸ¥æ‰¾ CompositionLocal å€¼
    Column {
        Text(
            text = strings.title,
            style = theme.textStyle,
            modifier = Modifier.padding(dimensions.padding)
        )
        // ä½¿ç”¨ä¼ é€’çš„å‚æ•°è¿›è¡Œæ›´å¤šåµŒå¥—å†…å®¹
    }
}
</code></pre>

<h3>3. LazyList ä¼˜åŒ–æŠ€å·§</h3>

<p>é«˜æ•ˆçš„åˆ—è¡¨æ¸²æŸ“å¯¹äºæµç•…çš„æ»šåŠ¨æ€§èƒ½è‡³å…³é‡è¦ã€‚ä»¥ä¸‹æ˜¯é’ˆå¯¹ LazyList ç»„ä»¶çš„å…³é”®ä¼˜åŒ–ï¼š</p>

<pre><code class="Kotlin">@Composable
fun &lt;T : Any&gt; OptimizedList(items: List&lt;T&gt;) {
    LazyColumn {
        itemsIndexed(
            items = items,
            // ç¨³å®šçš„keyæœ‰åŠ©äºComposeåœ¨æ›´æ–°è¿‡ç¨‹ä¸­è·Ÿè¸ªé¡¹ç›®
            key = { _: Int, item: T -&gt; item.hashCode() }
        ) { _: Int, item: T -&gt;
            // æ¯ä¸ªitemçš„å†…å®¹
        }
    }
}
</code></pre>

<p>LazyList çš„å…³é”®ä¼˜åŒ–ç‚¹ï¼š</p>

<ol>
<li>æä¾›ç¨³å®šçš„é”®ï¼Œå¸®åŠ©Composeåœ¨æ›´æ–°è¿‡ç¨‹ä¸­è·Ÿè¸ªé¡¹ç›®</li>
<li>å°½å¯èƒ½ä½¿ç”¨å›ºå®šå¤§å°ä»¥é¿å…é‡æ–°æµ‹é‡</li>
<li>ä¿æŒé¡¹ç›®å¯ç»„åˆé¡¹çš„è½»é‡çº§</li>
<li>é¿å…åœ¨é¡¹ç›®å†…å®¹ä¸­è¿›è¡Œä¸å¿…è¦çš„åˆ†é…</li>
<li>è®°ä½è¦ä¸ºæ¯ä¸ªé¡¹ç›®ç¼“å­˜æ˜‚è´µçš„è®¡ç®—</li>
</ol>


<h2>æµ‹é‡å’Œç›‘æ§æ€§èƒ½</h2>

<h3>Layout Inspectorå’ŒComposition Traces</h3>

<p>Android Studio ä¸­çš„å¸ƒå±€æ£€æŸ¥å™¨æ˜¯ä¸€æ¬¾å¼ºå¤§çš„Composeç•Œé¢æ€§èƒ½è°ƒè¯•å·¥å…·ã€‚å®ƒèƒ½å¤Ÿå¸®åŠ©ä½ æ·±å…¥äº†è§£åº”ç”¨çš„è§†å›¾å±‚æ¬¡ç»“æ„ã€é‡ç»„è®¡æ•°ä»¥åŠåº”ç”¨äºæ¯ä¸ªå¯ç»„åˆé¡¹çš„ä¿®é¥°ç¬¦ã€‚</p>

<p>è¦å°†å¸ƒå±€æ£€æŸ¥å™¨ä¸Composeç»“åˆä½¿ç”¨ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>

<ol>
<li>åœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¿è¡Œä½ çš„åº”ç”¨</li>
<li>åœ¨â€œæ­£åœ¨è¿è¡Œçš„è®¾å¤‡â€çª—å£ä¸­ï¼Œä½ å°†çœ‹åˆ°ä¸€ä¸ªç”¨äºåˆ‡æ¢å¸ƒå±€æ£€æŸ¥å™¨çš„æŒ‰é’®</li>
<li>æ£€æŸ¥Composeå±‚æ¬¡ç»“æ„ï¼š

<ul>
<li>æŸ¥çœ‹ç»„ä»¶æ ‘</li>
<li>æ£€æŸ¥é‡ç»„è®¡æ•°</li>
<li>åˆ†æä¿®é¥°ç¬¦é“¾</li>
<li>æ£€æŸ¥å¯ç»„åˆé¡¹å‚æ•°</li>
</ul>
</li>
</ol>


<p><img src="https://carrion.dev/images/kotlin/layout-inspector.png" alt="Layout Inspector" /></p>

<p>å¸ƒå±€æ£€æŸ¥å™¨ä¸­éœ€è¦ç›‘æ§çš„å…³é”®æŒ‡æ ‡ï¼š</p>

<ol>
<li>é‡ç»„è®¡æ•° - æ•°å€¼è¾ƒé«˜è¡¨ç¤ºå­˜åœ¨æ½œåœ¨çš„ä¼˜åŒ–æœºä¼š</li>
<li>è·³è¿‡è®¡æ•° - æ£€æŸ¥å¯ç»„åˆé¡¹æ˜¯å¦åœ¨åº”è¯¥è·³è¿‡é‡ç»„æ—¶è·³è¿‡</li>
<li>ä¿®é¥°ç¬¦é“¾å¤æ‚åº¦ - è¾ƒé•¿çš„ä¿®é¥°ç¬¦é“¾å¯èƒ½ä¼šå½±å“æµ‹é‡/å¸ƒå±€æ€§èƒ½</li>
</ol>


<h3>æ€§èƒ½æµ‹è¯•</h3>

<pre><code class="Kotlin">@Test
fun performanceTest() {
    benchmarkRule.measureRepeated(
        packageName = "com.example.app",
        metrics = listOf(FrameTimingMetric()),
        iterations = 5
    ) {
        composeTestRule.setContent {
            YourComposable()
        }
    }
}
</code></pre>

<h2>æœ€ä½³å®è·µæ€»ç»“</h2>

<ol>
<li>ä½¿ç”¨ç¨³å®šç±»å‹(Stable types)å’Œä¸å¯å˜æ•°æ®ç»“æ„(Immutable data structures)</li>
<li>ä½¿ç”¨rememberæå‡é«˜å¼€é”€è®¡ç®—</li>
<li>åœ¨æƒ°æ€§åˆ—è¡¨(lazy list)ä¸­å®ç°åˆé€‚çš„é”®(key)</li>
<li>æœ€å°åŒ–é‡ç»„èŒƒå›´</li>
<li>å®šæœŸåˆ†æå’Œæµ‹é‡æ€§èƒ½</li>
</ol>


<p>éµå¾ªè¿™äº›ä¼˜åŒ–æŠ€å·§å°†æœ‰åŠ©äºç¡®ä¿ä½ çš„Compose UIä¿æŒå“åº”è¿…é€Ÿä¸”é«˜æ•ˆï¼Œä»è€Œä¸ºä½ çš„åº”ç”¨æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Compose Multiplatformæ”¯æŒçƒ­é‡è½½(Hot Reload)äº†]]></title>
    <link href="https://alexhilton.github.io/blog/2025/04/12/compose-hot-reload/"/>
    <updated>2025-04-12T17:11:47+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/04/12/compose-hot-reload</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ªCompose Hot Reload is Now Availableï¼ŒåŸæ–‡é“¾æ¥<a href="https://medium.com/@wisemuji/compose-hot-reload-is-now-available-3a9aee58b0fe">Compose Hot Reload is Now Available</a>ï¼Œç”±<a href="https://medium.com/@wisemuji">Suhyeon Kim</a>ï¼Œå‘å¸ƒäº2025å¹´3æœˆ19æ—¥ã€‚</p></blockquote>

<p><a href=""><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FMBFWn5vJOuaM41zKE6aTg.jpeg" title="auto auto" ></a></p>

<!-- more -->


<p><strong>è¯‘æ³¨ï¼š</strong>  éœ€è¦æ³¨æ„çš„æ˜¯Googleé€šè¿‡Android Studio(after Giraffe)é‡Œé¢çš„<a href="https://developer.android.com/develop/ui/compose/tooling/iterative-development">Live Editç‰¹æ€§</a>æä¾›äº†å¯¹Androidä¸Šé¢çš„Jetpack Composeçš„å®æ—¶æ›´æ–°æ”¯æŒã€‚ä½†å®ƒä»…æ”¯æŒJetpack Compose (for Adnroid)ï¼Œå¹¶ä¸æ”¯æŒCMPï¼Œä¹Ÿå³ä¸æ”¯æŒJetBrainsçš„Composeã€‚ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤JetBrainsæ‰ä¼šå¼€å‘é¢å‘CMPçš„Hot Reloadã€‚</p>

<p>åœ¨Compose UIå¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ æ˜¯å¦ç»å¸¸éœ€è¦æ„å»ºè¿è¡Œï¼ŸCompose çƒ­é‡è½½ç°å·²åœ¨Maven Centralä¸­æ¨å‡ºï¼Œå¯ä¸ºComposeå¤šå¹³å°ï¼ˆæ¡Œé¢ï¼‰åº”ç”¨ä¸­çš„UIä»£ç æä¾›å®æ—¶æ›´æ–°ã€‚æˆ‘ä»¬æ— éœ€é‡å¯åº”ç”¨å³å¯ç«‹å³æŸ¥çœ‹UIä»£ç çš„æ›´æ”¹ã€‚</p>

<p>è®©æˆ‘ä»¬æ¥ä¸€æ¢ç©¶ç«Ÿï¼</p>

<h2>çƒ­é‡è½½(Hot Reload)æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ</h2>

<p>è®¸å¤šå£°æ˜å¼UIæ¡†æ¶éƒ½æä¾›äº†ç±»ä¼¼æ¦‚å¿µï¼Œçƒ­é‡è½½ï¼Œå³å¯ä»¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­æä¾›å¯¹UIæ›´æ”¹çš„è¿‘ä¹å³æ—¶çš„åé¦ˆï¼ˆå°½ç®¡å®ƒä»¬çš„åç§°ä¸åŒï¼ï¼‰ã€‚</p>

<p>ä¾‹å¦‚éš”å£çš„ä¸¤å®¶ï¼š</p>

<ul>
<li>Flutterçƒ­åŠ è½½ï¼š<a href="https://docs.flutter.dev/tools/hot-reload">https://docs.flutter.dev/tools/hot-reload</a></li>
<li>React Nativeå¿«é€Ÿåˆ·æ–°ï¼š<a href="https://reactnative.dev/docs/fast-refresh">https://reactnative.dev/docs/fast-refresh</a></li>
</ul>


<p>çƒ­é‡è½½å…è®¸å¼€å‘è€…å®æ—¶æŸ¥çœ‹ä»£ç æ›´æ”¹ï¼Œæ— éœ€é‡å¯åº”ç”¨æˆ–é‡æ–°ç¼–è¯‘æ•´ä¸ªé¡¹ç›®ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œçƒ­é‡è½½ä¼šä¿ç•™åº”ç”¨çš„çŠ¶æ€ï¼Œå› æ­¤å¼€å‘è€…å¯ä»¥ç»§ç»­ä¸åº”ç”¨äº¤äº’ï¼Œè€Œä¸ä¼šä¸¢å¤±è¿›åº¦æˆ–ä¸Šä¸‹æ–‡ã€‚è¿™å¯ä»¥å¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ¼”ç¤ºä»£ç æ›´æ”¹å¯¹UIçš„å½±å“ï¼Œä»è€Œæé«˜å·¥ä½œæ•ˆç‡ï¼Œè€Œæ— éœ€ç­‰å¾…æ¼«é•¿çš„æ„å»ºã€‚</p>

<h2>Composeçš„çƒ­é‡è½½</h2>

<p>çœ‹ä¸€ä¸‹å®˜æ–¹çš„ä»‹ç»<a href="https://github.com/JetBrains/compose-hot-reload">https://github.com/JetBrains/compose-hot-reload</a>ï¼š</p>

<blockquote><p>åœ¨Composeå¤šå¹³å°åº”ç”¨ä¸­æ›´æ”¹ä½ çš„UIä»£ç ï¼Œå¹¶å®æ—¶æŸ¥çœ‹ç»“æœã€‚
æ— éœ€é‡å¯åº”ç”¨ã€‚</p></blockquote>

<p>ç›®å‰ï¼ŒCompose Hot Reload é€‚ç”¨äºé’ˆå¯¹æ¡Œé¢ JVM çš„å¤šå¹³å°é¡¹ç›®ï¼ˆæœªæ¥æ˜¯å¦æœ‰å¯èƒ½æ‰©å±•ï¼Ÿæˆ‘ä¸ç¡®å®šã€‚:Dï¼‰ã€‚Compose Hot Reload çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ v1.0.0-alpha02ï¼Œäºæ˜¨å¤©ï¼ˆ2025 å¹´ 3 æœˆ 17 æ—¥ï¼‰å‘å¸ƒã€‚ç°åœ¨ï¼Œå¼€å‘è€…å¯ä»¥åœ¨Composeå¤šå¹³å°åº”ç”¨ä¸­æŸ¥çœ‹å…¶UIä»£ç çš„æ›´æ”¹ï¼Œè€Œæ— éœ€é‡å¯åº”ç”¨ã€‚è¿™æ„å‘³ç€å¼€å‘è€…å¯ä»¥ç«‹å³é¢„è§ˆæ›´æ”¹ï¼Œè€Œæ— éœ€ç¼“æ…¢çš„æ„å»ºå’Œé‡å¯ã€‚</p>

<p><strong>è¯‘æ³¨ï¼š</strong> ç°åœ¨ï¼ˆ2025å¹´4æœˆ9æ—¥ï¼‰æœ€æ–°ç‰ˆæœ¬æ˜¯ v1.0.0-alpha04ï¼Œä¸»è¦æ˜¯Bugfixï¼Œç›®å‰å¼€å‘ä¸­çš„ç‰ˆæœ¬æ˜¯ v1.0.0-alpha05 ã€‚</p>

<h2>å¦‚ä½•ä¸Šæ‰‹</h2>

<p>è¦å¼€å§‹ä½¿ç”¨Compose Hot Reloadï¼Œè¯·æŸ¥çœ‹<a href="https://github.com/JetBrains/compose-hot-reload">Compose Hot Reload</a>çš„ GitHub ä»£ç åº“ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong> ä»¥ä¸‹å†…å®¹åŸºäº v1.0.0-alpha02 ç¼–å†™ã€‚</p>

<h3>ä¾èµ–è¦æ±‚</h3>

<ul>
<li>ä¸€ä¸ªä»¥æ¡Œé¢ä¸ºç›®æ ‡çš„Compose Multiplatform é¡¹ç›®ï¼ˆå‚è§<a href="https://github.com/JetBrains/compose-hot-reload#faq">å…¶FAQ</a>ï¼‰</li>
<li>Kotlin 2.1.20-Beta2 æˆ–æ›´é«˜ç‰ˆæœ¬</li>
</ul>


<p>å¯¹äº Android åº”ç”¨ï¼Œæœ‰ä¸€ä¸ªå°çš„è§£å†³æ–¹æ³•ï¼š
é¦–å…ˆï¼Œä½ éœ€è¦ä»Jetpack Composeæ’ä»¶åˆ‡æ¢åˆ°Compose Multiplatform æ’ä»¶ï¼Œ
ç„¶åæ·»åŠ ä¸€ä¸ªå•ç‹¬çš„ Gradle æ¨¡å—å¹¶é…ç½®æ¡Œé¢ç›®æ ‡ã€‚</p>

<h3>å°† Gradle æ’ä»¶åº”ç”¨åˆ°ä½ çš„é¡¹ç›®ä¸­</h3>

<p>å°† org.jetbrains.compose.hot-reload Gradle æ’ä»¶æ·»åŠ åˆ°ä½ çš„æ„å»ºè„šæœ¬ï¼š</p>

<pre><code class="Kotlin">plugins {
    kotlin("multiplatform") version "2.1.20-RC" // &lt;- Use Kotlin 2.1.20-RC or higher!
    kotlin("plugin.compose") version "2.1.20-RC" // &lt;- Use Compose Compiler Plugin 2.1.20-RC or higher!
    id("org.jetbrains.compose")
    id("org.jetbrains.compose.hot-reload") version "1.0.0-alpha02" // &lt;- add this additionally
}
</code></pre>

<h3>å¯ç”¨â€œOptimizeNonSkippingGroupsâ€ï¼š</h3>

<p>å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°ä½ çš„ build.gradle.kts ï¼š</p>

<pre><code class="Kotlin">import org.jetbrains.kotlin.compose.compiler.gradle.ComposeFeatureFlag
// ...
composeCompiler {
    featureFlags.add(ComposeFeatureFlag.OptimizeNonSkippingGroups)
}
</code></pre>

<h3>ä¸ºUIçƒ­é‡è½½æä¾›å…¥å£ç‚¹</h3>

<p>åœ¨é¡¹ç›®çš„æ¡Œé¢æºä»£ç é›†ä¸­ï¼Œä½¿ç”¨ DevelopmentEntryPoint åŒ…è£…çª—å£å†…å®¹ã€‚</p>

<pre><code class="Kotlin">import org.jetbrains.compose.reload.DevelopmentEntryPoint
// ...
fun main() {
    singleWindowApplication(...) {
        DevelopmentEntryPoint { // add this line
            App()
        }
    }
}
</code></pre>

<p>è¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦æŠ˜è…¾çš„å…¨éƒ¨å†…å®¹ã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>

<h2>Demoæ¼”ç¤º</h2>

<p>è¦äº†è§£Compose çƒ­é‡è½½çš„å®é™…æ•ˆæœï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘çš„ç¤ºä¾‹é¡¹ç›®<a href="https://github.com/wisemuji/compose-would-you-rather-game">â€œWould You Rather Gameâ€</a>ã€‚è¿™ä¸ªé¡¹ç›®æ˜¯ä¸€ä¸ªç®€å•çš„ Compose å¤šå¹³å°æ¡Œé¢åº”ç”¨ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­å›ç­”æœ‰è¶£çš„â€œWould You Ratherâ€é—®é¢˜ã€‚Compose çƒ­é‡è½½æ’ä»¶æœ€è¿‘å·²å®ç°ã€‚</p>

<p>ä½ å¯ä»¥å‚è€ƒ Compose çƒ­é‡è½½çš„setupæäº¤ï¼š<a href="https://github.com/wisemuji/compose-would-you-rather-game/commit/937375cea9010733ee751dc2d464a0df21318cee">setupæäº¤</a>ã€‚</p>

<p>å¦‚æœä½ åœ¨é¡¹ç›®ä¸Šè¿è¡ŒdesktopRunï¼Œä½ ä¼šæ³¨æ„åˆ°æ¡Œé¢åº”ç”¨ç¨‹åºæ—è¾¹ä¼šå‡ºç°ä¸€ä¸ªå°çš„Composeå›¾æ ‡ã€‚</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*TXn4jUzxwcSh5IfqRqFNkA.png" alt="HotReload Icon" /></p>

<p>è¿™å°†è§¦å‘ Compose Hot Reload Tooling æ¨¡å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*37gLudPijGvh3A-rKdK_kw.png" alt="HotReload Demo" /></p>

<h3>UIæ›´æ”¹ç¤ºä¾‹</h3>

<p>å‡è®¾æˆ‘ä»¬æƒ³è¦æ›´æ”¹<a href="https://github.com/wisemuji/compose-would-you-rather-game/blob/4e9bfc7172c7145f95190fd383169bbcdc25856f/composeApp/src/commonMain/kotlin/ui/game/GameScreen.kt#L226">GameScreen.kt</a>ä¸­çš„åŠ¨ç”»ã€‚</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b4xJXpWH9oA5YohC1zsWng.gif" alt="Full Demo" /></p>

<p>çœ‹åˆ°æ²¡æœ‰ï¼ä¸€æ—¦æˆ‘ä»¬ä¿å­˜æ–‡ä»¶ï¼Œæ›´æ”¹å°±ä¼šç«‹å³æ˜¾ç¤ºåœ¨æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºä¸­ã€‚æ— éœ€é‡å¯åº”ç”¨ï¼</p>

<h2>çƒ­é‡è½½å½“å‰æ”¯æŒçš„åœºæ™¯</h2>

<p>ç›®å‰ï¼Œå‡ ä¹æ‰€æœ‰ä»£ç æ›´æ”¹éƒ½æ”¯æŒçƒ­é‡è½½ï¼ˆé™¤äº†ä»ç±»ä¸­åˆ é™¤è¶…ç±»å‹ï¼‰ã€‚</p>

<p><a href="https://hashnode.com/@sellmair">Sebastian Sellmair çš„è§†é¢‘å’Œåšå®¢æ–‡ç« </a>é€šè¿‡å¤šä¸ªæ¼”ç¤ºå±•ç¤ºäº†è¿™äº›åŠŸèƒ½ï¼Œå¹¶è¯¦ç»†è§£é‡Šäº†é‡è½½çš„åº•å±‚å·¥ä½œåŸç†ã€‚</p>

<h2>å±€é™æ€§</h2>

<p>ç”±äºå®ƒä»…æ”¯æŒåŸºäº JVM çš„æ¡Œé¢åº”ç”¨ï¼Œå› æ­¤ç›®å‰å°šä¸æ”¯æŒ Android å’Œå…¶ä»–å¹³å°ã€‚
æ­¤å¤–ï¼Œæ„å»ºæ€§èƒ½æ–¹é¢å¯èƒ½å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚åœ¨æˆ‘çš„æœ¬åœ°ç¯å¢ƒä¸­ï¼Œæ›´æ”¹å¤§çº¦éœ€è¦ 3 åˆ° 5 ç§’ï¼Œæ„Ÿè§‰æ¯”å…¶ä»–å£°æ˜å¼UIæ¡†æ¶ä¸­çš„çƒ­é‡è½½æ…¢ä¸å°‘ã€‚ä¼°è®¡å®ƒä¼šåœ¨åé¢å¾—åˆ°æ”¹å–„ã€‚</p>

<p>ç”±äºè¿™æ˜¯ä¸€ä¸ª Alpha ç‰ˆæœ¬ï¼Œå› æ­¤æ— æ³•ä¿è¯ç¨³å®šæ€§ã€‚å¼€å‘è€…åº”è¯¥é¢„æ–™åˆ°å¯èƒ½ä¼šå‡ºç°ä¸€äº›æ½œåœ¨çš„é”™è¯¯å’Œè¿ç§»æŒ‘æˆ˜ï¼Œæ­£å¦‚ JetBrains å›¢é˜Ÿæ‰€æŒ‡å‡ºçš„ï¼šâ€œAlpha ç‰ˆæœ¬æ„å‘³ç€ä½¿ç”¨é£é™©è‡ªè´Ÿï¼Œè¿ç§»é—®é¢˜ä¹Ÿéœ€è°¨æ…ã€‚æˆ‘ä»¬æ‰“ç®—å°†è¿™ä¸ªæƒ³æ³•äº§å“åŒ–ï¼Œä½†å°šæœªæœ€ç»ˆæˆå‹ã€‚â€ ç”±äºè¯¥åŠŸèƒ½ä»åœ¨ç§¯æå¼€å‘ä¸­ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­æŒç»­å…³æ³¨æ›´æ–°ã€‚</p>

<h2>æä¾›åé¦ˆ</h2>

<p>å¦‚æœä½ é‡åˆ°ä»»ä½•é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œä½ å¯ä»¥é€šè¿‡<a href="https://slack-chats.kotlinlang.org/t/27038699/with-compose-hot-reload-now-being-available-on-maven-central"> Kotlinlang Slack - Compose Hot Reload </a>åˆ†äº«ä½ çš„æƒ³æ³•ã€‚</p>

<blockquote><p>å°¤å…¶æ¬¢è¿æï¼š</p>

<ul>
<li>è®¾ç½®æ—¶é‡åˆ°çš„é—®é¢˜</li>
<li>é‡æ–°åŠ è½½ç‰¹å®šä»£ç æ®µæ—¶é‡åˆ°çš„é—®é¢˜</li>
<li>å…³äºå¦‚ä½•æ”¹è¿›/åŠŸèƒ½è¯·æ±‚çš„æƒ³æ³•</li>
</ul>


<p>ç›®å‰ä¸å¤ªæ„Ÿå…´è¶£çš„å†…å®¹ï¼š</p>

<ul>
<li>æ„å»ºæ€§èƒ½ï¼šç›®å‰ï¼Œâ€œGradle é‡ç¼–è¯‘å™¨â€çš„é€Ÿåº¦å°†ä¸ä½ çš„é¡¹ç›®é€Ÿåº¦ä¸€æ ·å¿«ã€‚å¼ºçƒˆå»ºè®®
å¯ç”¨ Gradles é…ç½®ç¼“å­˜ï¼Œå¹¶ä¿æŒé¡¹ç›®éå¸¸å¹²å‡€ã€‚å…¶ä»–â€œé‡ç¼–è¯‘å™¨â€ä¹Ÿä¼šæœ‰æ‰€å¸®åŠ©ï¼ï¼ˆIntelliJã€Amper ç­‰ï¼‰</li>
</ul>
</blockquote>

<h2>æ€»ç»“</h2>

<p>æˆ‘ç›¸ä¿¡ Compose ä¸­çš„ Hot Reload æ˜¯å¼€å‘ Compose UIçš„ä¸€å¤§å˜é©ã€‚
å®ƒå¯ä»¥è®©å¼€å‘äººå‘˜åœ¨æ— éœ€é‡å¯åº”ç”¨çš„æƒ…å†µä¸‹çœ‹åˆ°æ›´æ”¹ï¼Œä»è€ŒåŠ å¿«UIå¼€å‘é€Ÿåº¦ï¼Œä½†å®ƒä»å¤„äºå®éªŒé˜¶æ®µã€‚ç›®å‰ï¼Œå®ƒæœ€é€‚åˆä¸ªäººæˆ–æ—©æœŸé¡¹ç›®ï¼Œä½ å¯ä»¥ä½¿ç”¨ alpha ç‰ˆæœ¬è¿›è¡Œå¼€å‘ã€‚åœ¨ä½ è‡ªå·±çš„ Compose Multiplatform é¡¹ç›®ä¸­è¯•ç”¨å®ƒï¼Œä½“éªŒå³æ—¶UIåé¦ˆçš„å¥½å¤„ï¼</p>

<p>æˆ‘è¿«ä¸åŠå¾…åœ°æƒ³çœ‹åˆ°å³å°†åˆ°æ¥çš„æ›´æ–°ï¼XD</p>

<h2>å‚è€ƒèµ„æ–™</h2>

<ul>
<li><a href="https://github.com/JetBrains/compose-hot-reload">https://github.com/JetBrains/compose-hot-reload</a></li>
<li><a href="https://blog.sellmair.io/say-hello-to-compose-hot-reload-firework">https://blog.sellmair.io/say-hello-to-compose-hot-reload-firework</a></li>
<li><a href="https://www.youtube.com/watch?v=8Z-Vuo3wTd0">Firework: Introducing Compose Hot Reload</a></li>
<li><a href="https://www.youtube.com/watch?v=I_FMnPaEBEA">How â€˜Hot Reloadâ€™ is implemented for Compose</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å®æˆ˜ï¼šæ¢ç´¢Jetpack Composeä¸­çš„SearchBar]]></title>
    <link href="https://alexhilton.github.io/blog/2025/04/09/searchbar-in-jetpack-compose/"/>
    <updated>2025-04-09T22:40:46+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/04/09/searchbar-in-jetpack-compose</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ªExploring Jetpack Compose: SearchBarï¼ŒåŸæ–‡é“¾æ¥ï¼š<a href="https://joebirch.co/android/exploring-the-searchbar-composable/">https://joebirch.co/android/exploring-the-searchbar-composable/</a>ï¼Œä½œè€…æ˜¯Joe Birchã€‚</p></blockquote>

<p>åœ¨åº”ç”¨å†…æœç´¢å†…å®¹æ˜¯ä¸€é¡¹å¸¸è§åŠŸèƒ½ï¼Œäº‹å®ä¸Šï¼Œä½ å¯ä»¥åœ¨è®¾å¤‡ä¸Šçš„å¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸­å‘ç°æ­¤åŠŸèƒ½ã€‚åœ¨ Android ä¸Šï¼Œæˆ‘ä»¬çœ‹åˆ°çš„æ­¤åŠŸèƒ½çš„å¸¸è§ UI ç»„ä»¶æ˜¯æµ®åŠ¨æœç´¢æ ï¼Œæ”¾ç½®åœ¨å±å¹•çš„æ˜¾çœ¼ä½ç½®ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™è¿˜ä¼šå‘ç”¨æˆ·æä¾›æœç´¢å»ºè®®ï¼Œä»¥ç®€åŒ–æœç´¢è¿‡ç¨‹ã€‚Jetpack Compose Material3 è½¯ä»¶åŒ…æä¾›äº†å¯¹æä¾›æ­¤åŠŸèƒ½çš„ SearchBar å¯ç»„åˆé¡¹çš„è®¿é—®ï¼Œåœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åœ¨æˆ‘ä»¬è‡ªå·±çš„åº”ç”¨ä¸­ä½¿ç”¨å®ƒã€‚</p>

<p><a href=""><img src="https://joebirch.co/wp-content/uploads/2025/03/Group.png" title="auto auto" ></a></p>

<!-- more -->


<p>SearchBar å¯ç»„åˆé¡¹å…è®¸æˆ‘ä»¬æ˜¾ç¤ºä¸€ä¸ªæµ®åŠ¨çš„æœç´¢ç»„ä»¶ï¼Œè¯¥ç»„ä»¶å±•å¼€åä¼šæ˜¾ç¤ºå¯é€‰çš„æ¨èã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨è®¸å¤šåº”ç”¨ä¸­çœ‹åˆ°çš„å¸¸è§æ¨¡å¼ï¼Œæ­¤å¯ç»„åˆé¡¹æä¾›äº†å¼€ç®±å³ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚SearchBar å¯ç»„åˆé¡¹æä¾›äº†è¶³å¤Ÿçš„è‡ªå®šä¹‰åŠŸèƒ½æ¥æ§åˆ¶ç»„ä»¶çš„å¤–è§‚å’Œæ„Ÿè§‰ï¼ŒåŒæ—¶ä½¿ç”¨åŸºäºæ’æ§½(slot)çš„æ–¹æ³•è®©æˆ‘ä»¬æä¾›è¾“å…¥å­—æ®µä»¥ä¾›ä½¿ç”¨ã€‚</p>

<pre><code class="Kotlin">@Composable
fun SearchBar(
    inputField: @Composable () -&gt; Unit,
    expanded: Boolean,
    onExpandedChange: (Boolean) -&gt; Unit,
    modifier: Modifier = Modifier,
    shape: Shape = SearchBarDefaults.inputFieldShape,
    colors: SearchBarColors = SearchBarDefaults.colors(),
    tonalElevation: Dp = SearchBarDefaults.TonalElevation,
    shadowElevation: Dp = SearchBarDefaults.ShadowElevation,
    windowInsets: WindowInsets = SearchBarDefaults.windowInsets,
    content: @Composable ColumnScope.() -&gt; Unit,
)
</code></pre>

<p>è¯¥ç»„ä»¶ä¸ºæˆ‘ä»¬å¤„ç†äº†å¤§éƒ¨åˆ†å†…éƒ¨å·¥ä½œâ€”â€”å…¶ä¸­ä¸¤ä¸ªå…³é”®éƒ¨åˆ†éœ€è¦æˆ‘ä»¬è‡ªå·±æä¾›ã€‚</p>

<ul>
<li>inputField â€“ è¿™æ˜¯è¡¨ç¤ºå†…å®¹è¾“å…¥çš„æœç´¢å­—æ®µçš„è¾“å…¥å¯ç»„åˆé¡¹</li>
<li>content â€“ è¿™æ˜¯æœç´¢æ å±•å¼€æ—¶ç”¨äºæ˜¾ç¤ºæ¨èçš„å†…å®¹åŒºåŸŸ</li>
</ul>


<p>é™¤äº†è¿™äº›å­—æ®µä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç»„å…¶ä»–å±æ€§ç”¨äºç¡®å®š SearchBar çš„å½“å‰çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå½“æœç´¢æ å¤„äºå±•å¼€çŠ¶æ€æ—¶ï¼Œå¯ç»„åˆé¡¹çš„å†…å®¹å°†æ˜¾ç¤ºåœ¨è¾“å…¥å­—æ®µä¸‹æ–¹ã€‚ä¸ºäº†èƒ½å¤Ÿç®¡ç†è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºå¯ç»„åˆé¡¹æä¾›ä¸€äº›å‚æ•°ï¼Œç”¨äºç®¡ç†æ­¤çŠ¶æ€ã€‚é¦–å…ˆï¼Œexpanded å‚æ•°ç”¨äºæè¿° SearchBar æ˜¯å¦å¤„äºå±•å¼€çŠ¶æ€ï¼ˆè¿™å°†å†³å®šæ˜¯å¦æ˜¾ç¤ºå†…å®¹åŒºåŸŸï¼‰ï¼Œä»¥åŠ onExpandedChange å‚æ•°ï¼Œç”¨äºä¸ºå®ç°æä¾›å±•å¼€çŠ¶æ€çš„æ›´æ–°å€¼ï¼ˆç„¶åå¯ç”¨äºåæ˜ æˆ‘ä»¬è‡ªå·±çš„çŠ¶æ€å®ç°ï¼‰ã€‚</p>

<pre><code class="Kotlin">var expanded by remember { mutableStateOf(false) }

SearchBar(
    modifier = Modifier.fillMaxWidth(),
    expanded = expanded,
    onExpandedChange = {
        expanded = it
    }
)
</code></pre>

<p>é™¤äº†ç®¡ç†è¿™ç§å±•å¼€çŠ¶æ€å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æä¾›ç”¨äº SearchBar è¾“å…¥åŒºåŸŸçš„ inputFieldã€‚é™¤äº†éµå¾ªå¯ç»„åˆé¡¹çš„åŸºäºæ’æ§½çš„æ–¹æ³•ä¹‹å¤–ï¼Œè¿™è¿˜å…è®¸å¯ç»„åˆé¡¹éµå¾ªçŠ¶æ€æå‡çš„æ¦‚å¿µï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå®Œå…¨ç®¡ç† SearchBar è¾“å…¥å­—æ®µçš„çŠ¶æ€æ¦‚å¿µã€‚</p>

<pre><code class="Kotlin">var expanded by remember { mutableStateOf(false) }
var query by remember { mutableStateOf&lt;String?&gt;(null) }

SearchBar(
    modifier = Modifier.fillMaxWidth(),
    expanded = expanded,
    onExpandedChange = {
        expanded = it
    },
    inputField = {
        // ...
    }
)
</code></pre>

<p>ä¸ºäº†ç®€åŒ–æ­¤æ“ä½œï¼ŒSearchBarDefaults ç±»ä¸ºæˆ‘ä»¬æä¾›äº†å¯¹ InputField å¯ç»„åˆé¡¹çš„è®¿é—® - è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿè®¿é—®ä¸“é—¨ä¸º SearchBar å®ç°çš„å¯ç»„åˆé¡¹ã€‚ä¸éœ€è¦ä½¿ç”¨æ­¤ç‰¹å®šå¯ç»„åˆé¡¹ï¼Œä½†å®ƒæ˜¯ä¸“é—¨ä¸ºåŸºäºæœç´¢çš„è¾“å…¥å­—æ®µæä¾›çš„ä¾¿åˆ©å¯ç»„åˆé¡¹ã€‚æ­¤å¯ç»„åˆé¡¹é‡‡ç”¨ä¸€äº›å…³é”®å‚æ•°ï¼Œç”¨äºå°†å…¶é…ç½®ä¸ºåœ¨ SearchBar ä¸­ä½¿ç”¨ï¼š</p>

<ul>
<li>expanded å’Œ onExpandedChange - ç”¨äºç®¡ç†å­—æ®µçš„å±•å¼€çŠ¶æ€</li>
<li>query å’Œ onQueryChange - ç”¨äºç®¡ç†å­—æ®µä¸­æ˜¾ç¤ºçš„æŸ¥è¯¢çš„çŠ¶æ€</li>
</ul>


<p>é™¤äº†è¿™äº›æ ¸å¿ƒå±æ€§å¤–ï¼Œä½ è¿˜ä¼šæ³¨æ„åˆ°å¯¹æ ‡å‡†å­—æ®µå‚æ•°ï¼ˆå¦‚å ä½ç¬¦ã€leadingIcon å’Œ trailingIconï¼‰çš„æ”¯æŒã€‚é™¤äº†ç”¨äºæä¾›ä¿¡æ¯ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­çœ‹åˆ°æˆ‘å¦‚ä½•ä½¿ç”¨ trailingIcon å…è®¸ SearchBar åœ¨å•å‡»å–æ¶ˆæŒ‰é’®æ—¶æ¢å¤åˆ°æŠ˜å çŠ¶æ€ã€‚</p>

<pre><code class="Kotlin">SearchBarDefaults.InputField(
    onSearch = { expanded = false },
    expanded = expanded,
    onExpandedChange = { expanded = it },
    placeholder = { Text("What are you looking for?") },
    leadingIcon = { Icon(Icons.Default.Search, contentDescription = null) },
    trailingIcon = {
        if (expanded) {
            IconButton(onClick = {
                expanded = false
            }) {
                Icon(Icons.Default.Close, contentDescription = null)
            }
        }
    },
    query = query ?: "",
    onQueryChange = {
        query = it
    }
)
</code></pre>

<p>ç„¶åå¯ä»¥å°†æ­¤ InputField å¯ç»„åˆé¡¹çš„å®ç°æ’å…¥åˆ° SearchBar å¯ç»„åˆé¡¹çš„ inputField å‚æ•°ä¸­ã€‚</p>

<pre><code class="Kotlin">var expanded by remember { mutableStateOf(false) }
var query by remember { mutableStateOf&lt;String?&gt;(null) }

SearchBar(
    modifier = Modifier.fillMaxWidth(),
    expanded = expanded,
    onExpandedChange = {
        expanded = it
    },
    inputField = {
        SearchBarDefaults.InputField(
            onSearch = { expanded = false },
            expanded = expanded,
            onExpandedChange = { expanded = it },
            placeholder = { Text("What are you looking for?") },
            leadingIcon = { Icon(Icons.Default.Search, contentDescription = null) },
            trailingIcon = {
                if (expanded) {
                    IconButton(onClick = {
                        expanded = false
                    }) {
                        Icon(Icons.Default.Close, contentDescription = null)
                    }
                }
            },
            query = query ?: "",
            onQueryChange = {
                query = it
            }
        )
    }
)
</code></pre>

<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿç»„åˆ SearchBar å¹¶çœ‹åˆ°åœ¨æˆ‘ä»¬çš„ UI ä¸­æ˜¾ç¤ºçš„æµ®åŠ¨ç»„ä»¶ã€‚</p>

<p><img src="https://joebirch.co/wp-content/uploads/2025/03/sea.png" alt="SearchBar" /></p>

<p>æ­¤æ—¶æˆ‘ä»¬å‰©ä¸‹è¦å®ç°çš„å°±æ˜¯ SearchBar çš„å†…å®¹ï¼Œè¿™æ˜¯ SearchBar å¤„äºå±•å¼€çŠ¶æ€æ—¶æ˜¾ç¤ºçš„å†…å®¹ã€‚æ­¤å‚æ•°åˆ©ç”¨äº† ColumnScopeï¼Œå› æ­¤æ­¤å¤„æä¾›çš„ä»»ä½•å¯ç»„åˆé¡¹éƒ½å°†å‚ç›´å †å ã€‚æ­¤å†…å®¹åŒºåŸŸçš„é¢„æœŸå½¢å¼æ˜¯ç”¨æˆ·å¯ä»¥é€‰æ‹©çš„æ¨èåˆ—è¡¨ï¼Œå› æ­¤æˆ‘ä»¬å°†ç»§ç»­ç¼–å†™å‡ ä¸ª ListItem å¯ç»„åˆé¡¹ï¼Œæ¯ä¸ªå¯ç»„åˆé¡¹éƒ½ç”¨äºå‘ç”¨æˆ·æ˜¾ç¤ºæœç´¢æ¨èã€‚å½“ç‚¹å‡»å…¶ä¸­ä»»ä½•ä¸€é¡¹æ—¶ï¼ŒæŸ¥è¯¢å°†æ›´æ–°ä¸ºé€‰å®šå€¼ï¼Œå¹¶ä¸” SearchBar çš„å±•å¼€çŠ¶æ€å°†é‡ç½®ã€‚</p>

<pre><code class="Kotlin">var expanded by remember { mutableStateOf(false) }
var query by remember { mutableStateOf&lt;String?&gt;(null) }

SearchBar(
    ...
) {
    listOf("Result 1", "Result 2", "Result 3", "Result 4").forEach { text -&gt;
        ListItem(
            headlineContent = { Text(text) },
            colors = ListItemDefaults.colors(containerColor = Color.Transparent),
            modifier = Modifier.clickable {
                query = text
                expanded = false
            }.fillMaxWidth().padding(horizontal = 16.dp, vertical = 8.dp)
        )
    }
}
</code></pre>

<p>æœ‰äº†æ­¤åŠŸèƒ½ï¼Œæˆ‘ä»¬ç°åœ¨å°±èƒ½å¤Ÿçœ‹åˆ°åœ¨æµ®åŠ¨æœç´¢æ ä¸‹æ–¹æ˜¾ç¤ºçš„æ¨èã€‚</p>

<p><img src="https://joebirch.co/wp-content/uploads/2025/03/recs.png" alt="Recommendations" /></p>

<p>æœ‰äº†ä¸Šè¿°å†…å®¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°ä¸€ä¸ªæµ®åŠ¨æœç´¢æ ï¼Œå‘ç”¨æˆ·æ˜¾ç¤ºæœç´¢å»ºè®®ã€‚ä½¿ç”¨ Material3 SearchBar å¯ç»„åˆé¡¹ï¼Œå®ç°åœ¨è¿™ä¸¤ç§ä¸åŒçŠ¶æ€ä¹‹é—´è½¬æ¢çš„å¯ç»„åˆé¡¹éå¸¸å®¹æ˜“ã€‚ä¹Ÿè®¸ä½ å·²ç»åœ¨åº”ç”¨ä¸­ä½¿ç”¨äº† SearchBarï¼Œæˆ–è€…ä¸€ç›´åœ¨å¯»æ‰¾ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†æ— è®ºå¦‚ä½•ï¼Œæˆ‘æœŸå¾…çœ‹åˆ°æ›´å¤šåº”ç”¨é€šè¿‡ Jetpack Compose ä¸­æ›´å¹¿æ³›çš„ç»„ä»¶æ”¯æŒæ¥èŠ‚çœæ—¶é—´ï¼</p>
]]></content>
  </entry>
  
</feed>
