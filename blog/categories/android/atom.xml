<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Android | 稀有猿诉]]></title>
  <link href="http://toughcoder.net/blog/categories/android/atom.xml" rel="self"/>
  <link href="http://toughcoder.net/"/>
  <updated>2015-05-04T23:39:42+08:00</updated>
  <id>http://toughcoder.net/</id>
  <author>
    <name><![CDATA[Alex Hilton]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[在安卓设备与PC之间传递文件]]></title>
    <link href="http://toughcoder.net/blog/2015/04/21/transfer-files-between-android-phone-and-pc/"/>
    <updated>2015-04-21T23:01:11+08:00</updated>
    <id>http://toughcoder.net/blog/2015/04/21/transfer-files-between-android-phone-and-pc</id>
    <content type="html"><![CDATA[<p>现在智能手机（这里的手机是广义的，包括手机，平板电脑等移动智能设备）在生活中的角色越来越重要，人们使用手机的时间远远大于电脑，由于手机的便携性，所以很多时候我们会需要用手机来携带数据或文件，或者用于娱乐。比如乘坐火车或者汽车时，用手机来看个电影还是相当不错的，现在的手机屏幕也够大，存储空间充足，完全不成问题。虽然移动端也有足够多的客户端可以下载视频等，但是远没有PC资源多，也没有PC下载方便。但是下载后如何把视频弄到手机上面，以及当需要把其他一些文件弄到手机上面时，也是一个技术问题，今天就来探讨一下。</p>

<p><a href=""><img src="http://image.pavtube.com/img/guide/2013/2013-02/android-file-transfer.jpg" title="auto auto" ></a></p>

<!-- more -->


<h2>用第三方的软件</h2>

<p>比如说QQ之类的，它都有一个功能就是在不同设备之间传递文件特别是PC端与移动端，只要在PC上面和移动设备上面都安装了QQ较新版本的客户端，就可以用其传递文件。孤没有亲测，但估计效果还是可以的，但是对于像高清电影这样的G级别的大文件不知道效果如何了。</p>

<h3>优点</h3>

<p>  使用简单方便，不需要任何技术基础或折腾技术相关的东西</p>

<h2>直接把手机当成U盘（2.3及以下版本适用）</h2>

<p>以前的安卓版本当手机连接上电脑以后，是直接可以把连接的存储方式设置成为大容量存储，这样手机就直接相当于一个U盘。具体的操作方法就是手机连上电脑后，通知栏会有一个通知是存储相关的，点击后就可以把手机挂载成为一个U盘，再次点击之后会关闭。绝大多数手机只有当插入有SD扩展卡时才能如此做。</p>

<h3>优点</h3>

<p>   使用简单方便</p>

<h3>缺点</h3>

<p>   Android 2.3及以下版本才可以</p>

<h2>使用ADB命令</h2>

<p>我相信大多数Android用户对于adb命令并不会陌生，即使没有开发经验或者不懂技术，如何折腾过刷机或者Root的同学应该至少对adb命令有一个印象。对于有开发经验的同学就更不用说了，如果连adb都不知道那你的安卓开发肯定是体育老师教的。
ADB的使用是比较折腾的，非技术的同学可能会有些困难：</p>

<ol>
<li>. 下载Android SDK</li>
<li>. 对于Windows要安装设备的驱动，Linux和Mac则不用</li>
<li>. 对于Linux要配置udev权限，可参考官方文档</li>
<li>. 手机要激活USB调试：设置->开发者选项->USB调试</li>
</ol>


<h3>优点</h3>

<p>   其实没什么优点，对于开发者同学们来说这只是没有额外的事情折腾，传递一些小文件来说ADB命令还是非常方便的</p>

<h3>缺点</h3>

<ol>
<li>. 非常的折腾，特别是针对不是安卓开发者同学来说</li>
<li>. 对于百兆以上的大文件 来说，速度非常慢</li>
<li>. 需要对手机的存储机制在所了解，因为adb push是需要指定手机上目标文件夹</li>
</ol>


<h2>使用MTP协议传输</h2>

<p>这是本文的重点。
Android 4.0及以上的版本当连接到PC时，通知栏也会有一个与存储机制相关的通知可以选择是以相机方式还是MTP方式挂载手机的存储：如果是相机模式，那么可以直接访问手机里的相册；MTP则用于传递文件。
<a href="http://en.wikipedia.org/wiki/Media_Transfer_Protocol">MTP</a>是媒体传输协议(Media Transfer Protocol)的简称，它是一种在设备之间传输媒体文件的协议，这是一种标准的公开的协议，理论上讲能与任何支持MTP协议的设备进行传输。当安卓设备连接到电脑时，选择MTP方式后，即可以使用MTP协议来传送文件。</p>

<h3>Windows和Mac</h3>

<p>对于Windows和Mac，Google有专门的客户端，可以到<a href="http://www.android.com/filetransfer/index.html">官网</a>了解详情，使用不难，安装客户端，连接手机选择MTP模式即可。</p>

<h3>Linux</h3>

<p>Linux（这里以Ubuntu为例，其他发行版本类似）稍微折腾一点，因为没有官方的客户端，所以需要安装第三方的工具：</p>

<ol>
<li>. 安装工具：sudo apt-get install mtp-tools mtpfs</li>
<li><p>. 配置</p>

<pre><code>    sudo service udev start
    sudo mkdir /media/nexus
    sudo chmod a+xrw /media/nexus
    sudo adduser $USER fuse
</code></pre>

<p>  sudo vim /etc/fuse.conf并把最后一行&#8217;user_allow_other&#8217;打开注释（删除行首的‘#’）</p></li>
<li><p>. 创建命令别名
  vim ~/.bashrc在其中添加：</p>

<pre><code>   alias android-connect='mtpfs -o allow_other /media/nexus'
   alias android-disconnect='fusermount -u /media/nexus'
</code></pre></li>
<li><p>. 重启电脑</p></li>
<li>. 连接手机，运行android-connect后，/media/nexus/即是手机的存储，可以自由的传递文件了</li>
</ol>


<p>使用MTP方式对于大文件或者多文件的文件夹都是毫无压力的，速度略逊于U盘。</p>

<h2>参考</h2>

<ul>
<li> <a href="http://askubuntu.com/questions/207569/how-do-i-connect-a-nexus-7-to-transfer-files">How do I connect a Nexus 7 to transfer files?</a></li>
<li> <a href="http://en.wikipedia.org/wiki/Media_Transfer_Protocol">Media Transfter Protocol</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[下载并编译CyanogenMod源代码]]></title>
    <link href="http://toughcoder.net/blog/2014/11/01/play-with-cyanogenmod/"/>
    <updated>2014-11-01T00:40:55+08:00</updated>
    <id>http://toughcoder.net/blog/2014/11/01/play-with-cyanogenmod</id>
    <content type="html"><![CDATA[<p>CyanogenMod是除了Android官方源码之外的最受欢迎的Android的一个分支，它是干净，几乎接近原生Android，且方便为设备进行定制，在编译和制作ROM上面较原生有很大改进，是开发者学习源码和自己制作ROM的最佳选择。</p>

<p>官方网站在<a href="http://www.cyanogenmod.com/">这里</a>.</p>

<p>repo在<a href="https://github.com/CyanogenMod/android/">这里</a>.</p>

<p>环境说明，本次所有操作都是在Ubuntu 12.04(Precise)里面进行的。另外需要说明的是，我的环境访问谷歌和谷歌相关的服务都是没有问题的，关于如何访问谷歌可以参考这位牛人写的<a href="http://strongme.github.io/2014-09-01-Add-Hosts-For-Google.html">博客</a></p>

<p><a href=""><img src="http://img.wonderhowto.com/img/30/47/63519976076208/0/install-cyanogenmod-htc-one-even-faster-now-without-rooting-unlocking-first.w654.jpg"></a></p>

<!-- more -->


<h2>下载源码</h2>

<p>下载源代码是第一步，这跟很多教程是不太一样的。因为我觉得，你源码都没有拿到，还搞个毛线啊！有了源码即使无法编译，也至少还可以看源码的，否则安装了toolschain又有啥用。
其实，源码的下载按道理讲是很简单的事情的，但是很多事情到了我大天朝就会变得很复杂，甚至搞不定，特别要从Google的服务器上搞点东西。因为CyanogenMode的源码是在<a href="http://github.com/">Github</a>上面，所以源码的下载还是很方便的，但是对于一些必要的工具，因为是要从Google取，所以就很蛋疼。</p>

<h3>下载repo</h3>

<p>因为Android的源码非常多，巨大的源码不可能放在一个git的repo里面，是每个模块都有自己单独的git仓库，但是为了成功编译，又需要所有的源码，但是不可能手动的一个一个的去clone啊，因此就有了repo这个工具，它就是一个Python实现的脚本，先从Server读出来一个所有仓库的配置信息XML文件，然后按这个文件一个一个的把git仓库clone下来。
这个文件是Android官方提供的，CyanogenMod也只是使用了它。所以它还要从官方来取。它就是一个脚本，所以谈不到安装，下载下来，改变文件属性就可以运行了。关键是下载啊！</p>

<pre><code class="bash">curl https://storage.googleapis.com/git-repo-downloads/repo &gt; ~/bin/repo
chmod a+x !$
</code></pre>

<p>因为Google的连接不稳定，甚至是无法连接，所以下载这个脚本就要八仙过海，各显神通了，为了方便后来的兄弟们，可以从<a href="http://pan.baidu.com/s/1mgytKYO">这里</a>下载。别高兴太早，这才刚开始。后面还会有一大把问题呢。</p>

<h3>初始化仓库和分支信息</h3>

<pre><code class="bash">mkdir -p /work/cyanogenmod
cd /work/cyanogenmod
repo init -u git://github.com/CyanogenMod/android.git -b stable/cm-11.0
</code></pre>

<p>注意，为了方便，最好把你的Github帐户配置好ssh，以方便直接以git方式clone。另外，<a href="http://www.cyanogenmode.com/">CyanogenMod</a>的仓库在<a href="http://github.com/CyanogenMod/android">这里</a>，你会发现，这里只有二个配置文件。如前面所说，这里只是列出其他仓库的配置文件，以文件抓取所有的源码。</p>

<p>另外，-b后面跟的是你要抓取的分支, cm-11.0是最新的分支，对应Android 4.4。查看其他的分支可以看<a href="https://github.com/CyanogenMod/android/branches">这里</a>。</p>

<p>如果没有任何错误，那么要恭喜你，但是通常都会遇到错误：</p>

<blockquote><p>repo init -u git://github.com/CyanogenMod/android.git -b stable/cm-11.0</p>

<p>gpg: key 920F5C65: &ldquo;Repo Maintainer <a href="&#x6d;&#x61;&#105;&#x6c;&#116;&#x6f;&#x3a;&#x72;&#101;&#112;&#111;&#x40;&#x61;&#110;&#100;&#114;&#111;&#105;&#x64;&#46;&#107;&#x65;&#114;&#x6e;&#101;&#108;&#46;&#x6f;&#x72;&#103;">&#114;&#101;&#x70;&#111;&#64;&#x61;&#x6e;&#x64;&#114;&#x6f;&#x69;&#x64;&#x2e;&#107;&#x65;&#x72;&#x6e;&#101;&#x6c;&#46;&#111;&#114;&#x67;</a>&rdquo; not changed</p>

<p>gpg: key 692B382C: public key &ldquo;Conley Owens <a href="&#109;&#x61;&#x69;&#108;&#x74;&#x6f;&#58;&#x63;&#x63;&#111;&#51;&#64;&#97;&#x6e;&#x64;&#x72;&#111;&#x69;&#100;&#x2e;&#99;&#x6f;&#109;">&#x63;&#99;&#111;&#51;&#64;&#97;&#110;&#100;&#x72;&#x6f;&#x69;&#x64;&#x2e;&#99;&#x6f;&#109;</a>&rdquo; imported</p>

<p>gpg: Total number processed: 2</p>

<p>gpg:               imported: 1  (RSA: 1)</p>

<p>gpg:              unchanged: 1</p>

<p>fatal: Cannot get <a href="https://gerrit.googlesource.com/git-repo/clone.bundle">https://gerrit.googlesource.com/git-repo/clone.bundle</a></p>

<p>fatal: error [Errno 101] Network is unreachable</p></blockquote>

<p>第一眼看上去貌似是网络连接问题，搜了一下，网站有各种版本，<a href="http://www.cnblogs.com/javawebsoa/p/3235315.html">有的</a>说要unset代理，变量，<a href="http://blog.csdn.net/jianguo_liao19840726/article/details/9774357">有的</a>说要登录<a href="https://android.googlesource.com/new-password">androidsource</a>然后把登录信息加入到.netrc中。但是这些对我的情况都不管用；还有<a href="http://blog.sina.com.cn/s/blog_a9c55dfd0101jcz6.html">这篇</a>。我的情况与最后一个类似，多试几次，然后就init成功了。看来真的是网络抽风。</p>

<h3>下载源码</h3>

<p>然后就可以下载源码了：</p>

<pre><code class="bash">repo sync
</code></pre>

<p>因为是在github上面，而github一向是比较给力的，所以只要等待就好了，一般都会成功下载的。这跟官方Android就不同了。记得以前下载官方源码时，经常出现网络问题，下载了几个晚上才搞定。</p>

<h2>安装编译所需要的toolschain</h2>

<p>CyanogenMod本质上也是Android，所以这个可以参考<a href="http://source.android.com/source/initializing.html">官方文档</a>，就可以了。</p>

<p>几个关键的点是：</p>

<ul>
<li>使用Oracle的Java SDK(JDK)，至于版本，最新的Android可以用Java 7，所以就装个Java 6吧，2.3到4.4都是使用Java 6</li>
<li>安装需要的软件包</li>
<li>配置ccache</li>
</ul>


<h2>编译</h2>

<h3>编译模拟器</h3>

<p>模拟器在学习和研究代码的时候还是比较有用的，如果你没有一个专门用作测试的手机的话。</p>

<pre><code class="bash">. build/envsetup.sh
lunch
</code></pre>

<p>这时会出现一个菜单，仔细寻找cm_goldfish-eng，输入前面的数字，这会对模拟器进行一些配置。这里有一个坑，不要用source build/envsetup.sh，而要用上面的命令，否则会没有goldfish相关的配置项出现在lunch的菜单里。</p>

<p>然后，再到vendor/cm/里面，执行./get-prebuilts，这会把一些需要的东西拉下来。然后就可以正式的编译了：</p>

<pre><code class="bash">make -j8
</code></pre>

<p>之后是漫长的等待。</p>

<h3>运行模拟器</h3>

<pre><code class="bash">emulator -system ./out/target/product/generic/system.img -data ./out/target/product/generic/userdata.img -ramdisk ./out/target/product/generic/ramdisk.img
</code></pre>

<p>还可以指定skin，skin可以到SDK里面去找。如果多次使用可以把上面的命令保存成Bash脚本。但是这个模拟器会奇慢无比。</p>

<h2>参考资料</h2>

<ul>
<li><a href="http://hualang.iteye.com/blog/1139269">Android ROM研究&mdash;CyanogenMod源代码下载及编译</a></li>
<li><a href="http://sunzeduo.blog.51cto.com/2758509/1538557">基于 cm-11 源码编译模拟器</a></li>
<li><a href="http://www.yinqisen.cn/blog-321.html">CyanogenMod 11.0模拟器goldfish的编译方法及下载地址</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
