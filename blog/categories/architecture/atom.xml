<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Architecture | ç¨€æœ‰çŒ¿è¯‰]]></title>
  <link href="https://alexhilton.github.io/blog/categories/architecture/atom.xml" rel="self"/>
  <link href="https://alexhilton.github.io/"/>
  <updated>2025-09-24T22:42:05+08:00</updated>
  <id>https://alexhilton.github.io/</id>
  <author>
    <name><![CDATA[Alex Hilton]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[é¢å‘å¼€å‘è€…çš„ç³»ç»Ÿè®¾è®¡ï¼šåƒå»ºç­‘å¸ˆä¸€æ ·æ€è€ƒ]]></title>
    <link href="https://alexhilton.github.io/blog/2025/09/24/system-design-for-developers/"/>
    <updated>2025-09-24T22:31:48+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/09/24/system-design-for-developers</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ªã€ŒSystem Design for Developers: Think Like an Architectã€ï¼ŒåŸæ–‡é“¾æ¥<a href="https://towardsdev.com/system-design-for-developers-think-like-an-architect-87f32882ca28">https://towardsdev.com/system-design-for-developers-think-like-an-architect-87f32882ca28</a>ï¼Œç”±Saurabh Singhå‘å¸ƒäº2025å¹´8æœˆ25æ—¥ã€‚</p></blockquote>

<p><a href=""><img src="https://miro.medium.com/v2/resize:fit:1400/1*b1eSMQdryXSteTJredbMtA.png" title="auto auto" ></a></p>

<!-- more -->


<blockquote><p>â€œå»ºç­‘æ˜¯ä¸€ç§ç¤¾ä¼šè¡Œä¸ºï¼Œä¹Ÿæ˜¯äººç±»æ´»åŠ¨çš„ç‰©è´¨èˆå°ã€‚â€â€”â€” Spiro Kostof</p></blockquote>

<p>æ­£å¦‚å»ºç­‘å¸ˆä¸ä¼šåœ¨æ²¡æœ‰è“å›¾çš„æƒ…å†µä¸‹å¼€å§‹å»ºé€ ä¸€æ ·ï¼Œå¼€å‘è€…ä¹Ÿä¸åº”è¯¥åœ¨æ²¡æœ‰ç³»ç»Ÿè®¾è®¡çš„æƒ…å†µä¸‹å¼€å§‹ç¼–ç ã€‚ç„¶è€Œï¼Œè®¸å¤šå¼€å‘è€…ç›´æ¥è¿›å…¥å®ç°é˜¶æ®µï¼Œå´å‘ç°è‡ªå·±é™·å…¥äº†æŠ€æœ¯å€ºåŠ¡ã€æ€§èƒ½ç“¶é¢ˆå’Œæ¶æ„å™©æ¢¦çš„è¿·å®«ä¹‹ä¸­ï¼Œè€Œè¿™äº›æœ¬å¯ä»¥é€šè¿‡é€‚å½“çš„è§„åˆ’æ¥é¿å…ã€‚</p>

<p>ç³»ç»Ÿè®¾è®¡æ˜¯ä¸€é—¨è‰ºæœ¯å’Œç§‘å­¦ï¼Œå®ƒå®šä¹‰ç³»ç»Ÿçš„æ¶æ„ã€ç»„ä»¶ã€æ¨¡å—ã€æ¥å£å’Œæ•°æ®ï¼Œä»¥æ»¡è¶³ç‰¹å®šéœ€æ±‚ã€‚å®ƒå°±åƒä¸€åº§å±¹ç«‹ç™¾å¹´çš„æˆ¿å±‹å’Œä¸€åº§å› è‡ªèº«é‡é‡è€Œå€’å¡Œçš„æˆ¿å±‹ä¹‹é—´çš„åŒºåˆ«ã€‚</p>

<h2>å»ºç­‘å¸ˆçš„æ€ç»´æ–¹å¼ï¼šåˆ†è§£å¤æ‚é—®é¢˜</h2>

<h2>åˆ†å±‚æ€è€ƒï¼Œè€Œéç›´çº¿æ€è€ƒ</h2>

<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨è®¾è®¡ä¸€åº§æ‘©å¤©å¤§æ¥¼ã€‚ä½ ä¸ä¼šå…ˆå†³å®šç¬¬ 47 å±‚çš„å¢™å£è¦åˆ·ä»€ä¹ˆé¢œè‰²ã€‚ä½ ä¼šå…ˆä»åœ°åŸºå¼€å§‹ï¼Œç„¶åæ˜¯ç»“æ„æ¡†æ¶ï¼Œæ¥ç€æ˜¯ç”µæ°”å’Œç®¡é“ç³»ç»Ÿï¼Œæœ€åæ˜¯å®¤å†…è®¾è®¡ã€‚</p>

<p>è½¯ä»¶ç³»ç»Ÿä¹Ÿéµå¾ªåŒæ ·çš„åŸåˆ™ã€‚æƒ³è±¡ä¸€ä¸‹<strong>å¯è§†åŒ–é¡µé¢æ„å»ºå™¨åº”ç”¨ç¨‹åº</strong>â€”â€”æƒ³æƒ³ Webflowã€Wix æˆ– Squarespace ç­‰å·¥å…·ï¼Œå®ƒä»¬å…è®¸ç”¨æˆ·é€šè¿‡æ‹–æ”¾ç•Œé¢åˆ›å»ºç½‘é¡µï¼Œè€Œæ— éœ€ç¼–å†™ä»£ç ã€‚è¿™äº›ç³»ç»Ÿéå¸¸å¤æ‚ï¼Œç”¨æˆ·å¯ä»¥ï¼š</p>

<ul>
<li>å°†ç»„ä»¶ï¼ˆæŒ‰é’®ã€å›¾ç‰‡ã€æ–‡æœ¬å—ï¼‰ä»åº“æ‹–æ”¾åˆ°ç”»å¸ƒä¸Š</li>
<li>é€šè¿‡å¯è§†åŒ–æ§ä»¶è‡ªå®šä¹‰å±æ€§ï¼ˆé¢œè‰²ã€å­—ä½“ã€å¤§å°ï¼‰</li>
<li>åœ¨æ„å»ºè¿‡ç¨‹ä¸­å®æ—¶é¢„è§ˆé¡µé¢</li>
<li>å°†ç½‘ç«™ç›´æ¥å‘å¸ƒåˆ° Web ä¸Š</li>
<li>ä¸å›¢é˜Ÿæˆå‘˜å®æ—¶åä½œ</li>
</ul>


<p>æ¶æ„å¸ˆæ— éœ€æ·±å…¥ç ”ç©¶æ‹–æ”¾åŠŸèƒ½çš„å®ç°ç»†èŠ‚ï¼Œè€Œæ˜¯é¦–å…ˆæ€è€ƒï¼š</p>

<p>åŸºç¡€å±‚ï¼šæ ¸å¿ƒå®ä½“æœ‰å“ªäº›ï¼Ÿ</p>

<p>é¡µé¢ã€ç»„ä»¶ã€æ¨¡æ¿ã€ç”¨æˆ·ã€é¡¹ç›®</p>

<p>ç»“æ„å±‚ï¼šè¿™äº›å®ä½“ä¹‹é—´å¦‚ä½•å…³è”ï¼Ÿ</p>

<p>ç”¨æˆ·åˆ›å»ºé¡¹ç›®
é¡¹ç›®åŒ…å«é¡µé¢
é¡µé¢ç”±ç»„ä»¶ç»„æˆ
ç»„ä»¶å¯ä»¥ä¿å­˜ä¸ºæ¨¡æ¿</p>

<p>ç³»ç»Ÿå±‚ï¼šå®ƒä»¬å¦‚ä½•é€šä¿¡ï¼Ÿ</p>

<ul>
<li>ç”¨äº CRUD æ“ä½œçš„ RESTful API</li>
<li>ç”¨äºå®æ—¶åä½œçš„ WebSocket è¿æ¥</li>
<li>ç”¨äºç»„ä»¶æ›´æ–°çš„äº‹ä»¶é©±åŠ¨æ¶æ„</li>
</ul>


<p><strong>ç•Œé¢å±‚</strong>ï¼šç”¨æˆ·å¦‚ä½•äº¤äº’ï¼Ÿ</p>

<ul>
<li>ç”¨äºé¡¹ç›®ç®¡ç†çš„ä»ªè¡¨ç›˜</li>
<li>ç”¨äºé¡µé¢ç¼–è¾‘çš„ç”»å¸ƒ</li>
<li>ç”¨äºé€‰æ‹©çš„ç»„ä»¶åº“</li>
<li>ç”¨äºæµ‹è¯•çš„é¢„è§ˆæ¨¡å¼</li>
</ul>


<p>æ­£å¦‚è½¯ä»¶å·¥ç¨‹å¸ˆ Grady Booch æ›¾ç»è¯´è¿‡çš„ï¼šâ€œä¼˜ç§€è½¯ä»¶çš„åŠŸèƒ½åœ¨äºåŒ–ç¹ä¸ºç®€ã€‚â€ è¿™ç§åˆ†å±‚æ–¹æ³•å°†æå…¶å¤æ‚çš„å†…å®¹è½¬åŒ–ä¸ºæ˜“äºç®¡ç†çš„æ¨¡å—ã€‚</p>

<h2>ğŸ“ äº’åŠ¨ç»ƒä¹ ï¼šåˆ†å±‚æ¶æ„</h2>

<p><strong>ç°åœ¨å°±æ‹¿èµ·çº¸ç¬”ï¼</strong>åœ¨ç»§ç»­é˜…è¯»ä¹‹å‰ï¼Œè¯·å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š</p>

<ol>
<li><strong>ç”»å››ä¸ªæ°´å¹³çŸ©å½¢</strong>ï¼Œå¹¶å°†å®ƒä»¬å æ”¾åœ¨ä¸€èµ·</li>
<li><strong>ä»ä¸Šåˆ°ä¸‹åˆ†åˆ«æ ‡æ³¨</strong>ï¼šç•Œé¢ã€ç³»ç»Ÿã€ç»“æ„ã€åŸºç¡€</li>
<li><strong>é€‰æ‹©ä½ æ—¥å¸¸ä½¿ç”¨çš„ä»»ä½•åº”ç”¨</strong>ï¼ˆNetflixã€Amazonã€WhatsAppï¼‰</li>
<li><strong>åœ¨æ¯ä¸€å±‚</strong>ä¸­å¡«å…¥ä½ è®¤ä¸ºåº”è¯¥å¡«å…¥çš„å†…å®¹</li>
</ol>


<p>Netflix ç¤ºä¾‹ï¼š_</p>

<ul>
<li>ç•Œé¢ï¼šæœç´¢æ ã€è§†é¢‘æ’­æ”¾å™¨ã€æ¨è</li>
<li>ç³»ç»Ÿï¼šæµåª’ä½“æœåŠ¡ã€æ¨èå¼•æ“ã€ç”¨æˆ·èº«ä»½éªŒè¯</li>
<li>ç»“æ„ï¼šç”¨æˆ·è§‚çœ‹ç”µå½±ï¼Œç”µå½±æœ‰è¯„åˆ†</li>
<li>åŸºç¡€ï¼šç”¨æˆ·ã€ç”µå½±ã€è¯„åˆ†ã€è®¢é˜…</li>
</ul>


<p><strong>ä¸ºä»€ä¹ˆè¦ç”»è¿™ä¸ªï¼Ÿ</strong>ä½ çš„å¤§è„‘å¯¹ä½ æ‰‹ç»˜å†…å®¹çš„è®°å¿†åŠ›æ¯”ä½ åˆšåˆšé˜…è¯»çš„å†…å®¹å¼º 6 å€ã€‚è¿™å¼ ç®€å•çš„è‰å›¾ä¼šè®©ä½ ç«‹åˆ»ç†è§£æ–‡ç« çš„å…¶ä½™éƒ¨åˆ†ã€‚</p>

<p><img src="https://miro.medium.com/v2/resize:fit:2000/1*k5g3kjh3ugcfUf5CWJjoFw.jpeg" alt="æˆ‘åœ¨é‡æ–°è®¾è®¡è§†é¢‘å¹³å°æ¶æ„æ—¶ç”»äº†è¿™å¼ è‰å›¾ã€‚äº§å“ç»ç†ç»ˆäºæ˜ç™½äº†ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½ç®€å•åœ°â€œæ·»åŠ ä¸€ä¸ªåŠŸèƒ½â€â€”â€”ä»–èƒ½çœ‹åˆ°å®ƒä¼šå½±å“åˆ°å“ªä¸ªå±‚çº§ã€‚è¿™å¼ å›¾é¿å…äº†3ä¸ªæœˆçš„æŠ€æœ¯å€ºåŠ¡ï¼" /></p>

<h2>åˆ†è§£ç­–ç•¥</h2>

<p>åˆ†è§£å¤æ‚é—®é¢˜å°±åƒè§£å‰–æ‰‹è¡¨ã€‚ä½ éœ€è¦äº†è§£æ¯ä¸ªé½¿è½®ã€å¼¹ç°§å’Œæœºæ¢°è£…ç½®ï¼Œç„¶åæ‰èƒ½æ„å»ºæˆ–ä¿®å¤æ•´ä¸ªé’Ÿè¡¨ã€‚</p>

<p><strong>åŠŸèƒ½åˆ†è§£ç¤ºä¾‹</strong>ï¼šå¯è§†åŒ–é¡µé¢æ„å»ºå™¨</p>

<pre><code class="python">Page Builder System
â”œâ”€â”€ Authentication &amp; Authorization
â”‚   â”œâ”€â”€ User registration/login
â”‚   â”œâ”€â”€ Role-based permissions
â”‚   â””â”€â”€ Session management
â”œâ”€â”€ Project Management
â”‚   â”œâ”€â”€ Project CRUD operations
â”‚   â”œâ”€â”€ Version control
â”‚   â””â”€â”€ Collaboration features
â”œâ”€â”€ Page Editor
â”‚   â”œâ”€â”€ Canvas rendering engine
â”‚   â”œâ”€â”€ Component management
â”‚   â”œâ”€â”€ Drag-and-drop interface
â”‚   â””â”€â”€ Real-time preview
â”œâ”€â”€ Component Library
â”‚   â”œâ”€â”€ Built-in components
â”‚   â”œâ”€â”€ Custom components
â”‚   â””â”€â”€ Template system
â””â”€â”€ Export &amp; Publishing
    â”œâ”€â”€ Static site generation
    â”œâ”€â”€ Hosting integration
    â””â”€â”€ SEO optimization
</code></pre>

<p>æ¯ä¸ªåˆ†æ”¯éƒ½å¯ä»¥ç‹¬ç«‹å¼€å‘ã€å•ç‹¬æµ‹è¯•ï¼Œå¹¶ç³»ç»Ÿåœ°é›†æˆã€‚è¿™ç§æ–¹æ³•éµå¾ª Unix å“²å­¦ï¼šâ€œä¸“å¿ƒåšå¥½ä¸€ä»¶äº‹ã€‚â€</p>

<h2>ğŸ“ äº’åŠ¨ç»ƒä¹ ï¼šç³»ç»Ÿåˆ†è§£æ ‘</h2>

<p><strong>åˆè¯¥ç”»è‰å›¾äº†ï¼</strong> è¿™ä¸ªç»ƒä¹ å¯ä»¥è®­ç»ƒä½ çš„â€œæ¶æ„å¸ˆå¤§è„‘â€ï¼š</p>

<ol>
<li><strong>ç”»ä¸€ä¸ªæ ‘å½¢ç»“æ„</strong>ï¼Œä»¥â€œé¡µé¢æ„å»ºå™¨â€ä¸ºæ ¹</li>
<li><strong>æ·»åŠ  5 ä¸ªä¸»è¦åˆ†æ”¯</strong>ï¼ˆæ€è€ƒï¼šå“ªäº›æ˜¯å¤§å—ï¼Ÿï¼‰</li>
<li><strong>åœ¨æ¯ä¸ªåˆ†æ”¯ä¸‹ï¼Œæ·»åŠ  2-3 ä¸ªå¶å­</strong>ï¼ˆè¾ƒå°çš„éƒ¨åˆ†ï¼‰</li>
<li><strong>ä½¿ç”¨ç®€å•çš„æ–¹æ¡†å’Œçº¿æ¡</strong>â€”â€”æ— éœ€å¤æ‚çš„å›¾è¡¨ï¼</li>
</ol>


<p><em>ä½ çš„ç»˜å›¾å¯èƒ½çœ‹èµ·æ¥åƒï¼š</em></p>

<pre><code class="gherkin">Page Builder
   /

   |

   |

   \
 Auth  Pages  Components  Export
  |

  |

  |

  |
Login  Create   Library   HTML
Signup Edit

Custom

PDF
</code></pre>

<p><strong>ç¥å¥‡æ—¶åˆ»</strong>ï¼šå½“ä½ æ— æ³•è¿›ä¸€æ­¥åˆ†è§£ä¸€ä¸ªæ–¹æ¡†æ—¶ï¼Œè¿™å¯èƒ½å°±æ˜¯ä¸€ä¸ªå¼€å‘äººå‘˜ä¸€å‘¨çš„å·¥ä½œã€‚å¦‚æœè§‰å¾—æ–¹æ¡†å¤ªå¤§ï¼Œå°±è¿›ä¸€æ­¥åˆ†è§£å®ƒï¼</p>

<h2>å¯æ‰©å±•æ€§ï¼šä»Šå¤©æ„å»ºï¼Œåº”å¯¹æœªæ¥çš„é—®é¢˜</h2>

<h2>æˆé•¿å‹æ€ç»´</h2>

<blockquote><p>â€œç§ä¸€æ£µæ ‘çš„æœ€ä½³æ—¶æœºæ˜¯20å¹´å‰ï¼Œå…¶æ¬¡æ˜¯ç°åœ¨ã€‚â€â€”â€”ä¸­å›½è°šè¯­</p></blockquote>

<p>å¯æ‰©å±•æ€§è§„åˆ’å°±åƒä¸ºæˆ¿å­é€‰æ‹©åœ°åŸºã€‚ä½ å¯èƒ½ä»ä¸€æ ‹å°å±‹å¼€å§‹ï¼Œä½†å¦‚æœä½ è®¡åˆ’æ‰©å»ºæˆä¸€åº§è±ªå®…ï¼Œä½ å°±éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿæ”¯æ’‘æœªæ¥å‘å±•çš„åœ°åŸºã€‚</p>

<p>è€ƒè™‘ä¸‰ä¸ªå¯æ‰©å±•æ€§ç»´åº¦ï¼š</p>

<p><strong>å‚ç›´æ‰©å±•ï¼ˆå‘ä¸Šæ‰©å±•ï¼‰</strong>ï¼šå°±åƒåœ¨å»ºç­‘ç‰©ä¸­å¢åŠ æ›´å¤šæ¥¼å±‚</p>

<ul>
<li>å¢åŠ ç°æœ‰æœåŠ¡å™¨ä¸Šçš„ CPUã€RAM æˆ–å­˜å‚¨ç©ºé—´</li>
<li>ç®€å•ä½†å­˜åœ¨ç‰©ç†é™åˆ¶</li>
<li>å•ç‚¹æ•…éšœ</li>
</ul>


<p><strong>æ°´å¹³æ‰©å±•ï¼ˆå‘å¤–æ‰©å±•ï¼‰</strong>ï¼šå°±åƒåœ¨ç»¼åˆä½“ä¸­å»ºé€ æ›´å¤šå»ºç­‘ç‰©</p>

<ul>
<li>æ·»åŠ æ›´å¤šæœåŠ¡å™¨ä»¥åˆ†æ•£è´Ÿè½½</li>
<li>æ›´å¤æ‚ä½†å‡ ä¹ä¸å—é™åˆ¶</li>
<li>æ›´å¥½çš„å®¹é”™èƒ½åŠ›</li>
</ul>


<p><strong>åŠŸèƒ½æ‰©å±•</strong>ï¼šå°±åƒä¸ºä¸åŒç”¨é€”å»ºé€ ä¸“ç”¨å»ºç­‘ç‰©</p>

<ul>
<li>å¾®æœåŠ¡æ¶æ„</li>
<li>æ¯ä¸ªæœåŠ¡å¤„ç†ç‰¹å®šåŠŸèƒ½</li>
<li>ç‹¬ç«‹æ‰©å±•å’Œéƒ¨ç½²</li>
</ul>


<h2>å¯æ‰©å±•æ€§çš„çº¢ç»¿ç¯ç³»ç»Ÿ</h2>

<p><strong>ğŸŸ¢ ç»¿ç¯å†³ç­–ï¼ˆç¬¬ä¸€å¤©ï¼‰</strong>ï¼š</p>

<ul>
<li>ç®€å•çš„å•ä½“æ¶æ„</li>
<li>å•ä¸€æ•°æ®åº“</li>
<li>ä½¿ç”¨ Redis è¿›è¡ŒåŸºæœ¬ç¼“å­˜</li>
<li>é™æ€èµ„æºçš„ CDN</li>
</ul>


<p><strong>ğŸŸ¡ é»„ç¯å†³ç­–ï¼ˆæµé‡å¢é•¿ï¼‰</strong>ï¼š</p>

<ul>
<li>æ•°æ®åº“åªè¯»å‰¯æœ¬</li>
<li>åº”ç”¨æœåŠ¡å™¨é›†ç¾¤</li>
<li>API é€Ÿç‡é™åˆ¶</li>
<li>ç›‘æ§å’ŒæŠ¥è­¦ç³»ç»Ÿ</li>
</ul>


<p><strong>ğŸ”´ çº¢ç¯å†³ç­–ï¼ˆé«˜æµé‡ï¼‰</strong>ï¼š</p>

<ul>
<li>å¾®æœåŠ¡æ¶æ„</li>
<li>æ•°æ®åº“åˆ†ç‰‡</li>
<li>ç”¨äºå¼‚æ­¥å¤„ç†çš„æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>è‡ªåŠ¨æ‰©å±•åŸºç¡€è®¾æ–½</li>
</ul>


<p>å¯¹äºæˆ‘ä»¬çš„é¡µé¢æ„å»ºå™¨ç¤ºä¾‹ï¼Œä½ å¯ä»¥ä»ä¸€ä¸ªç®€å•çš„ Python FastAPI æœåŠ¡å™¨å’Œ PostgreSQL æ•°æ®åº“å¼€å§‹ã€‚éšç€æµé‡çš„å¢é•¿ï¼Œä½ å°†å¼•å…¥ï¼š</p>

<ol>
<li><strong>ç¼“å­˜å±‚</strong>ï¼šç”¨äºä¼šè¯å­˜å‚¨å’Œé¢‘ç¹è®¿é—®çš„æ¨¡æ¿çš„ Redis</li>
<li><strong>CDN</strong>ï¼šç”¨äºæœåŠ¡ç»„ä»¶èµ„æºå’Œç”Ÿæˆé¡µé¢çš„ CloudFront</li>
<li><strong>æ•°æ®åº“ä¼˜åŒ–</strong>ï¼šç”¨äºåˆ†æçš„è¯»å–å‰¯æœ¬ï¼Œä¸ºä¸åŒåŸŸæä¾›ç‹¬ç«‹çš„æ•°æ®åº“</li>
<li><strong>æœåŠ¡åˆ†ç¦»</strong>ï¼šç”¨äºæ¸²æŸ“ã€æ–‡ä»¶ç®¡ç†å’Œç”¨æˆ·ç®¡ç†çš„ä¸“ç”¨å¾®æœåŠ¡</li>
</ol>


<p><img src="https://miro.medium.com/v2/resize:fit:1400/1*93OTsJ_L4-7WhICsL2EL4w.jpeg" alt="æˆ‘ç»˜åˆ¶äº§å“ç›®æ ‡çš„è‰å›¾" /></p>

<h2>ğŸ“ äº’åŠ¨ç»ƒä¹ ï¼šæ‰©å±•æ¼”è¿›</h2>

<p><strong>è¿™å¼ å›¾å°†æˆä¸ºä½ çš„æ‰©å±•è·¯çº¿å›¾ï¼</strong></p>

<ol>
<li>åœ¨ä½ çš„çº¸ä¸Š<strong>ç”»ä¸‰åˆ—</strong>ï¼Œåˆ†åˆ«æ ‡è®°ä¸ºï¼šâ€œç¬¬ 1 å¤©â€ã€â€œç¬¬ 6 ä¸ªæœˆâ€ã€â€œç¬¬ 2 å¹´â€</li>
<li><p><strong>åœ¨æ¯ä¸€åˆ—ä¸­ï¼Œç”»å‡ºä½ çš„æ¶æ„å›¾ï¼š</strong></p></li>
<li><p>ç¬¬ 1 å¤©ï¼šç”»ä¸¤ä¸ªæ–¹æ¡†ï¼ˆå‰ç«¯ã€APIï¼‰ï¼Œä¸‹æ–¹ç”»ä¸€ä¸ªåœ†æŸ±ä½“ï¼ˆæ•°æ®åº“ï¼‰</p></li>
<li>ç¬¬ 6 ä¸ªæœˆï¼šæ·»åŠ æ›´å¤šæ–¹æ¡†ï¼ˆRedis ç¼“å­˜ã€CDN äº‘ã€è´Ÿè½½å‡è¡¡å™¨ï¼‰</li>
<li>ç¬¬ 2 å¹´ï¼šå°† API æ–¹æ¡†æ‹†åˆ†æˆå¤šä¸ªå°æ–¹æ¡†ï¼ˆç”¨æˆ·æœåŠ¡ã€é¡¹ç›®æœåŠ¡ç­‰ï¼‰</li>
</ol>


<p><strong>3. åœ¨å„åˆ—ä¹‹é—´ç”»ç®­å¤´</strong>ï¼Œå±•ç¤ºæ¼”è¿›è¿‡ç¨‹</p>

<p><strong>4. åœ¨æ¯åˆ—ä¸Šæ–¹ç”»ä¸€äº›ç®€ç¬”ç”»</strong>ï¼Œå±•ç¤ºç”¨æˆ·æ•°é‡ï¼š100 â†’ 1 ä¸‡ â†’ 100 ä¸‡</p>

<p><strong>ä»ä½ çš„å›¾ä¸­å¾—å‡ºçš„å…³é”®æ´å¯Ÿï¼š</strong>æ³¨æ„å¤æ‚æ€§æ˜¯å¦‚ä½•é€æ¸å¢é•¿çš„ï¼Œè€Œä¸æ˜¯ä¸€ä¸‹å­å¢é•¿çš„ã€‚è¿™å°±æ˜¯çœŸå®ç³»ç»Ÿæ¼”è¿›çš„æ–¹å¼ï¼</p>

<h2>èŒè´£ä¸‰ä½ä¸€ä½“ï¼šæ•°æ®åº“ã€API å’Œå‰ç«¯</h2>

<h2>ä¸‰å±‚æ¶æ„ç†å¿µ</h2>

<p>å°† Web åº”ç”¨ç¨‹åºæƒ³è±¡æˆä¸€å®¶é¤å…ï¼š</p>

<p><strong>å‰ç«¯ï¼ˆé¤å…ï¼‰</strong>ï¼šå®¢æˆ·äº’åŠ¨çš„åœ°æ–¹</p>

<ul>
<li>ç”¨æˆ·ç•Œé¢å’Œä½“éªŒ</li>
<li>è¾“å…¥éªŒè¯å’Œæ ¼å¼åŒ–</li>
<li>çŠ¶æ€ç®¡ç†å’Œè·¯ç”±</li>
</ul>


<p><strong>APIï¼ˆå¨æˆ¿ï¼‰</strong>ï¼šé­”æ³•å‘ç”Ÿçš„åœ°æ–¹</p>

<ul>
<li>ä¸šåŠ¡é€»è¾‘å¤„ç†</li>
<li>æ•°æ®è½¬æ¢å’ŒéªŒè¯</li>
<li>ä¸å¤–éƒ¨æœåŠ¡é›†æˆ</li>
</ul>


<p><strong>æ•°æ®åº“ï¼ˆé£Ÿå“å‚¨è—å®¤ï¼‰</strong>ï¼šé£Ÿæå­˜å‚¨çš„åœ°æ–¹</p>

<ul>
<li>æ•°æ®æŒä¹…åŒ–å’Œæ£€ç´¢</li>
<li>æ•°æ®å®Œæ•´æ€§å’Œå…³ç³»</li>
<li>æ€§èƒ½ä¼˜åŒ–</li>
</ul>


<blockquote><p>â€œå¥½çš„æ¶æ„ä¸åœ¨äºç»“æ„æœ¬èº«ï¼Œè€Œåœ¨äºå®ƒæ‰€åˆ›é€ çš„ç©ºé—´ã€‚â€ â€” å®‰è—¤å¿ é›„</p></blockquote>

<h2>ğŸ“ äº’åŠ¨ç»ƒä¹ ï¼šé¤å…æ¶æ„</h2>

<p><strong>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç»˜ç”»ç»ƒä¹ æ¥å…·ä½“åŒ–è¿™ä¸€ç‚¹ï¼š</strong></p>

<ol>
<li><p><strong>ç»˜åˆ¶ä¸€ä¸ªç®€å•çš„é¤å…å¹³é¢å›¾</strong>ï¼Œå…¶ä¸­åŒ…å«ä¸‰ä¸ªåŒºåŸŸï¼š</p></li>
<li><p>é¤å…ï¼ˆé¡¾å®¢å°±åº§çš„åœ°æ–¹ï¼‰</p></li>
<li>å¨æˆ¿ï¼ˆå‡†å¤‡é£Ÿç‰©çš„åœ°æ–¹ï¼‰</li>
<li>å‚¨è—å®¤ï¼ˆå­˜æ”¾é£Ÿæçš„åœ°æ–¹ï¼‰</li>
</ol>


<p><strong>2. ç°åœ¨ç»˜åˆ¶ç®­å¤´è¡¨ç¤ºæ•°æ®æµå‘ï¼š</strong></p>

<ul>
<li>é¡¾å®¢ç‚¹é¤ â†’ å¨æˆ¿</li>
<li>å¨æˆ¿ç´¢å–é£Ÿæ â†’ å‚¨è—å®¤</li>
<li><p>å¨æˆ¿é€å‡ºå‡†å¤‡å¥½çš„é£Ÿç‰© â†’ é¤å…</p></li>
<li><p><strong>ä¸ºæ¯ä¸ªåŒºåŸŸæ ‡æ³¨ç›¸åº”çš„ Web å¯¹åº”é¡¹ï¼š</strong></p></li>
<li><p>é¤å… = å‰ç«¯</p></li>
<li>å¨æˆ¿ = API</li>
<li>å‚¨è—å®¤ = æ•°æ®åº“</li>
</ul>


<p><strong>ä¸ºä»€ä¹ˆè¿™æ ·åšæœ‰æ•ˆï¼š</strong>ç°åœ¨ä½ çš„å¤§è„‘å·²ç»å¯¹æŠ½è±¡çš„ç³»ç»Ÿæ¦‚å¿µæœ‰äº†ç‰©ç†éšå–»ã€‚æ¯æ¬¡è®¾è®¡ç³»ç»Ÿæ—¶ï¼Œæƒ³è±¡ä¸€ä¸‹è¿™å®¶é¤å…çš„åœºæ™¯ï¼</p>

<h2>èŒè´£è¾¹ç•Œ</h2>

<p><strong>æ•°æ®åº“èŒè´£</strong>ï¼š</p>

<pre><code class="python">-- âœ… Good: Database handles data integrity
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);
</code></pre>

<pre><code class="python">-- âœ… Good: Database enforces relationships
CREATE TABLE pages (
    id SERIAL PRIMARY KEY,
    project_id INTEGER REFERENCES projects(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL
);
</code></pre>

<p><strong>API èŒè´£</strong>ï¼ˆPython å’Œ FastAPIï¼‰ï¼š</p>

<pre><code class="python"># âœ… Good: API handles business logic
from fastapi import FastAPI, HTTPException, Depends
from pydantic import BaseModel
</code></pre>

<pre><code class="python">app = FastAPI()@app.post("/api/pages")
async def create_page(
    page_data: PageCreateModel,
    current_user: User = Depends(get_current_user)
):
    # Validate user permissions
    if not can_user_edit_project(current_user, page_data.project_id):
        raise HTTPException(status_code=403, detail="Unauthorized")

        # Apply business rules
    page = await create_page_with_defaults(page_data)

    # Return appropriate response
    return {"page": page, "message": "Page created successfully"}
</code></pre>

<p><strong>å‰ç«¯èŒè´£</strong>ï¼ˆAngularï¼‰ï¼š</p>

<pre><code class="javascript">// âœ… Good: Frontend handles user interaction
@Component({
  selector: 'app-page-editor',
  templateUrl: './page-editor.component.html'
})
export class PageEditorComponent {
  components: Component[] = [];
  isLoading = false;

  constructor(private apiService: ApiService) {}

  // Handle user interactions
  onComponentDrop(component: Component, position: Position): void {
    this.isLoading = true;

    this.apiService.addComponent(component, position)
      .subscribe({
        next: (result) =&gt; this.updateComponents(result),
        error: (error) =&gt; this.handleError(error),
        complete: () =&gt; this.isLoading = false
      });
  }
}
</code></pre>

<h2>æ¶æ„æ¨¡å¼ï¼šä¼Ÿå¤§ç³»ç»Ÿçš„åŸºçŸ³</h2>

<h2>æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ (MVC)ï¼šç»å…¸æ¨¡å¼</h2>

<p>MVC å°±åƒç»„ç»‡ä¸€åœºæˆå‰§æ¼”å‡ºï¼š</p>

<ul>
<li><strong>æ¨¡å‹</strong>ï¼šå‰§æœ¬å’Œæ•…äº‹ï¼ˆæ•°æ®å’Œä¸šåŠ¡é€»è¾‘ï¼‰</li>
<li><strong>è§†å›¾</strong>ï¼šèˆå°å’Œæ¼”å‘˜ï¼ˆç”¨æˆ·ç•Œé¢ï¼‰</li>
<li><strong>æ§åˆ¶å™¨</strong>ï¼šå¯¼æ¼”ï¼ˆæ¨¡å‹å’Œï¼ˆæŸ¥çœ‹ï¼‰</li>
</ul>


<pre><code class="coffeescript"># Model: Page data and operations
from sqlalchemy import Column, Integer, String, JSON
from sqlalchemy.ext.declarative import declarative_base
</code></pre>

<pre><code class="python">Base = declarative_base()class PageModel(Base):
    __tablename__ = "pages"

    id = Column(Integer, primary_key=True)
    title = Column(String(255), nullable=False)
    components = Column(JSON)
    project_id = Column(Integer, nullable=False)

    async def save(self, db_session):
        db_session.add(self)
        await db_session.commit()
        return self
</code></pre>

<pre><code class="coffeescript">// View: Page rendering (Angular Component)
@Component({
  selector: 'app-page-view',
  template: `
    &lt;div class="page"&gt;
      &lt;h1&gt;&lt;/h1&gt;
      &lt;app-component 
        *ngFor="let component of pageModel.components"
        [componentData]="component"&gt;
      &lt;/app-component&gt;
    &lt;/div&gt;
  `
})
export class PageViewComponent {
  @Input() pageModel: PageModel;
}
</code></pre>

<pre><code class="javascript">// Controller: Coordination logic (Angular Service)
@Injectable({
  providedIn: 'root'
})
export class PageController {
  constructor(private apiService: ApiService) {}

  async updateTitle(pageId: number, newTitle: string): Promise&lt;void&gt; {
    const updatedPage = await this.apiService.updatePage(pageId, { title: newTitle });
    // Emit event to refresh view
    this.pageUpdated.emit(updatedPage);
  }
}
</code></pre>

<h2>äº‹ä»¶é©±åŠ¨æ¶æ„ï¼šç¥ç»ç³»ç»Ÿ</h2>

<p>äº‹ä»¶é©±åŠ¨æ¶æ„å°±åƒäººç±»çš„ç¥ç»ç³»ç»Ÿâ€”â€”å½“æŸä¸ªéƒ¨åˆ†å‘ç”Ÿäº‹ä»¶æ—¶ï¼Œå…¶ä»–éƒ¨åˆ†ä¼šè‡ªåŠ¨åšå‡ºååº”ã€‚</p>

<pre><code class="python"># Event system for page builder
from typing import Dict, List, Callable
import asyncio
</code></pre>

<pre><code class="python">class EventBus:
    def __init__(self):
        self.listeners: Dict[str, List[Callable]] = {}

        def on(self, event: str, callback: Callable):
        if event not in self.listeners:
            self.listeners[event] = []
        self.listeners[event].append(callback)

        async def emit(self, event: str, data: dict):
        callbacks = self.listeners.get(event, [])
        await asyncio.gather(*[callback(data) for callback in callbacks])# Usage
event_bus = EventBus()# Auto-save feature
@event_bus.on('component:added')
async def auto_save_handler(data):
    await auto_save(data['page_id'])
    await show_save_indicator()# Analytics tracking
@event_bus.on('component:added')
async def analytics_handler(data):
    analytics.track('Component Added', {
        'component_type': data['component']['type'],
        'page_id': data['page_id']
    })
</code></pre>

<h2>å¾®æœåŠ¡ï¼šä¸“ä¸šå›¢é˜Ÿ</h2>

<p>å¾®æœåŠ¡å°±åƒä¸€ä¸ªçˆµå£«ä¹å›¢â€”â€”æ¯ä¸ªéŸ³ä¹å®¶ï¼ˆæœåŠ¡ï¼‰éƒ½æ˜¯å„è‡ªä¹å™¨çš„ä¸“å®¶ï¼Œä½†ä»–ä»¬å…±åŒåŠªåŠ›ï¼Œåˆ›é€ å‡ºç¾å¦™çš„éŸ³ä¹ã€‚</p>

<pre><code class="bash"># Docker Compose for Page Builder Microservices
version: '3.8'
services:
  user-service:
    image: pagebuilder/user-service:python
    environment:
      - DATABASE_URL=postgresql://users_db
      - REDIS_URL=redis://redis:6379
    ports:
      - "8001:8000"

      project-service:
    image: pagebuilder/project-service:python
    environment:
      - DATABASE_URL=postgresql://projects_db
    ports:
      - "8002:8000"

      rendering-service:
    image: pagebuilder/rendering-service:python
    environment:
      - REDIS_URL=redis://redis:6379
      - S3_BUCKET=pagebuilder-assets
    ports:
      - "8003:8000"

      frontend:
    image: pagebuilder/angular-frontend
    ports:
      - "4200:80"
    environment:
      - API_GATEWAY_URL=http://api-gateway:8080

      api-gateway:
    image: pagebuilder/api-gateway:python
    environment:
      - USER_SERVICE_URL=http://user-service:8000
      - PROJECT_SERVICE_URL=http://project-service:8000
      - RENDERING_SERVICE_URL=http://rendering-service:8000
    ports:
      - "8080:8000"
</code></pre>

<h2>ä½•æ—¶ä½¿ç”¨æ¯ç§æ¨¡å¼</h2>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/1*Kx0t7cKSgdtO0Q1PpRiLXg.jpeg" alt="è¿™æ˜¯æˆ‘åœ¨ä¸€æ¬¡æ¶æ„è¯„å®¡ä¼šä¸Šç”»çš„è‰å›¾ï¼Œå½“æ—¶å›¢é˜Ÿå°±å„ç§æ¨¡å¼äº‰è®ºäº†ä¸¤ä¸ªå°æ—¶ã€‚è¿™å¼ å›¾åœ¨5åˆ†é’Ÿå†…å°±ç»“æŸäº†è¿™åœºäº‰è®ºâ€”â€”æ¯ä¸ªäººéƒ½æ¸…æ¥šåœ°çœ‹åˆ°äº†ä»–ä»¬çš„é¡¹ç›®ä¸ä¸€ä¸ªæ¨¡å¼çš„å¯¹åº”å…³ç³»ã€‚ç°åœ¨ï¼Œæˆ‘æŠŠè¿™å¼ ç…§ç‰‡ä¿å­˜åœ¨æ‰‹æœºé‡Œï¼Œæ¯æ¬¡æ¶æ„è®¨è®ºæ—¶éƒ½ä¼šæ‹¿å‡ºæ¥ç”¨ã€‚" /></p>

<p><strong>åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä½¿ç”¨ MVC</strong>ï¼š</p>

<ul>
<li>æ„å»ºä¼ ç»Ÿ Web åº”ç”¨ç¨‹åº</li>
<li>å›¢é˜Ÿç†Ÿæ‚‰è¯¥æ¨¡å¼</li>
<li>éœ€è¦æ¸…æ™°çš„å…³æ³¨ç‚¹åˆ†ç¦»</li>
</ul>


<p><strong>åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä½¿ç”¨äº‹ä»¶é©±åŠ¨</strong>ï¼š</p>

<ul>
<li>å®æ—¶åŠŸèƒ½å¾ˆé‡è¦</li>
<li>éœ€è¦å¤šä¸ªç³»ç»Ÿå“åº”å˜åŒ–</li>
<li>éœ€è¦æ¾æ•£è€¦åˆ</li>
</ul>


<p><strong>åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä½¿ç”¨å¾®æœåŠ¡</strong>ï¼š</p>

<ul>
<li>å›¢é˜Ÿè§„æ¨¡ > 10 åå¼€å‘äººå‘˜</li>
<li>ä¸åŒéƒ¨åˆ†çš„æ‰©å±•èƒ½åŠ›ä¸åŒ</li>
<li>ç‹¬ç«‹éƒ¨ç½²è‡³å…³é‡è¦</li>
</ul>


<p>æ­£å¦‚ Martin Fowler æ‰€è¨€ï¼šâ€œå‚»ç“œä¹Ÿèƒ½å†™å‡ºè®¡ç®—æœºèƒ½ç†è§£çš„ä»£ç ã€‚ä¼˜ç§€çš„ç¨‹åºå‘˜å†™å‡ºäººç±»èƒ½ç†è§£çš„ä»£ç ã€‚â€</p>

<h2>ğŸ“ äº’åŠ¨ç»ƒä¹ ï¼šæ¶æ„æ¨¡å¼æ¯”è¾ƒ</h2>

<p><strong>åˆ›å»ºä½ çš„ä¸ªäººæ¶æ„æ¨¡å¼é€ŸæŸ¥è¡¨ï¼š</strong></p>

<ol>
<li>åœ¨ä½ çš„çº¸ä¸Š<strong>ç”»å‡ºä¸‰ä¸ªéƒ¨åˆ†</strong>ï¼šâ€œMVCâ€ã€â€œäº‹ä»¶é©±åŠ¨â€ã€â€œå¾®æœåŠ¡â€</li>
<li><p><strong>å¯¹äº MVCï¼š</strong>ç”»å‡ºä¸‰ä¸ªç›¸è¿çš„æ–¹æ¡†ï¼ˆæ¨¡å‹ â†” æ§åˆ¶å™¨ â†” è§†å›¾ï¼‰</p></li>
<li><p>åœ¨ä¸‹é¢å†™ä¸Šï¼šâ€œé€‚åˆï¼šä¼ ç»Ÿåº”ç”¨ï¼Œæ¸…æ™°çš„åˆ†ç¦»â€</p></li>
</ol>


<p><strong>3.å¯¹äºäº‹ä»¶é©±åŠ¨ï¼š</strong> ç”»ä¸€ä¸ªä¸­å¿ƒåœ†åœˆï¼Œæ ‡è®°ä¸ºâ€œäº‹ä»¶æ€»çº¿â€ï¼Œå¹¶ç”¨ç®­å¤´å‘å¤–è¾å°„åˆ°å¤šä¸ªæ–¹æ¡†ã€‚</p>

<ol>
<li>åœ¨ä¸‹é¢å†™ï¼šâ€œé€‚ç”¨äºï¼šå®æ—¶åŠŸèƒ½ï¼Œæ¾è€¦åˆâ€</li>
</ol>


<p><strong>5. å¯¹äºå¾®æœåŠ¡ï¼š</strong> ç”» 6-8 ä¸ªç‹¬ç«‹çš„å°æ–¹æ¡†ï¼Œå¹¶ç”¨è™šçº¿è¿æ¥å®ƒä»¬ã€‚</p>

<ul>
<li>åœ¨ä¸‹é¢å†™ï¼šâ€œé€‚ç”¨äºï¼šå¤§å‹å›¢é˜Ÿï¼Œç‹¬ç«‹æ‰©å±•â€</li>
</ul>


<p><strong>6. æ·»åŠ å†³ç­–æ ‘ï¼š</strong> ä»é—®é¢˜åˆ°æ¨¡å¼ç”»ç®­å¤´ï¼š</p>

<ul>
<li>â€œå›¢é˜Ÿå°‘äº 5 äººï¼Ÿâ€ â†’ MVC</li>
<li>â€œéœ€è¦å®æ—¶åŠŸèƒ½å—ï¼Ÿâ€ â†’ äº‹ä»¶é©±åŠ¨</li>
<li>â€œå¤šä¸ªå›¢é˜Ÿï¼Ÿâ€ â†’ å¾®æœåŠ¡</li>
</ul>


<p><strong> å°†æ­¤å›¾æ”¾åœ¨æ‰‹è¾¹ï¼</strong> è¿™æ˜¯ä½ æœªæ¥ä»»ä½•é¡¹ç›®çš„æ¶æ„å†³ç­–æµç¨‹å›¾ã€‚</p>

<h2>ç»˜åˆ¶çœŸæ­£æœ‰ç”¨çš„ç³»ç»Ÿå›¾</h2>

<h2>è§†è§‰ä¼ è¾¾çš„è‰ºæœ¯</h2>

<blockquote><p>â€œä¸€å›¾èƒœåƒè¨€ï¼Œä½†ä¸€å¼ å¥½çš„å›¾è¡¨èƒœè¿‡åƒæ¬¡ä¼šè®®ã€‚â€ â€” æœªçŸ¥</p></blockquote>

<p>ç³»ç»Ÿå›¾æ˜¯è½¯ä»¶æ¶æ„çš„è“å›¾ã€‚å®ƒä»¬åº”è¯¥è®²è¿°ä¸€ä¸ªæ•…äº‹ï¼Œè€Œä¸æ˜¯åˆ¶é€ æ··ä¹±ã€‚</p>

<h2>ğŸ“ äº’åŠ¨ç»ƒä¹ ï¼šå›¾è¡¨å±‚æ¬¡ç»“æ„</h2>

<p><strong>ç»ƒä¹ ä¸‰å±‚ç³»ç»Ÿå›¾ç»˜åˆ¶æ–¹æ³•ï¼š</strong></p>

<p><strong>ç¬¬ä¸€å±‚ - ä¸Šä¸‹æ–‡ï¼ˆ30 ç§’ç»˜åˆ¶ï¼‰ï¼š</strong></p>

<ol>
<li><strong>ç»˜åˆ¶ä¸‰ä¸ªå½¢çŠ¶</strong>ï¼šåœ†å½¢ï¼ˆç”¨æˆ·ï¼‰ã€çŸ©å½¢ï¼ˆä½ çš„ç³»ç»Ÿï¼‰ã€äº‘ï¼ˆå¤–éƒ¨æœåŠ¡ï¼‰</li>
<li><strong>ç”¨å¸¦æ ‡ç­¾çš„ç®­å¤´è¿æ¥</strong>ï¼šâ€œHTTP è¯·æ±‚â€ã€â€œAPI è°ƒç”¨â€ã€â€œæ•°æ®åŒæ­¥â€</li>
<li><strong>è¿™å›ç­”äº†</strong>â€œæˆ‘ä»¬çš„ç³»ç»Ÿè¿æ¥åˆ°ä»€ä¹ˆï¼Ÿâ€</li>
</ol>


<p><strong>ç¬¬äºŒå±‚ - å®¹å™¨ï¼ˆ2 åˆ†é’Ÿç»˜åˆ¶ï¼‰ï¼š</strong></p>

<ol>
<li><strong>å°†ç³»ç»ŸçŸ©å½¢åˆ†æˆå››ä¸ªéƒ¨åˆ†</strong>ï¼šå‰ç«¯ã€API ç½‘å…³ã€æœåŠ¡ã€æ•°æ®åº“</li>
<li><strong>ç”¨ç®­å¤´</strong>æ˜¾ç¤ºå®ƒä»¬ä¹‹é—´çš„æ•°æ®æµ**</li>
<li><strong>è¿™å›ç­”äº†</strong>â€œä¸»è¦éƒ¨åˆ†æ˜¯ä»€ä¹ˆï¼Ÿâ€</li>
</ol>


<p><strong>ç¬¬ä¸‰çº§â€”â€”ç»„ä»¶ï¼ˆ5 åˆ†é’Ÿç»˜åˆ¶ï¼‰ï¼š</strong></p>

<ol>
<li><strong>é€‰æ‹©ä¸€ä¸ªå®¹å™¨ï¼ˆä¾‹å¦‚å‰ç«¯ï¼‰å¹¶å°†å…¶åˆ†è§£</strong>ä¸ºæ¨¡å—</li>
<li><strong>å±•ç¤ºæ¨¡å—å¦‚ä½•åœ¨è¯¥å®¹å™¨å†…äº¤äº’</strong></li>
<li><strong>è¿™å°†å›ç­”</strong>â€œè¿™ä¸ªç»„ä»¶å†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿâ€</li>
</ol>


<p><strong>æœ¬ç»ƒä¹ çš„å¼ºå¤§ä¹‹å¤„ï¼š</strong>åªéœ€é€‰æ‹©è¦ç»˜åˆ¶çš„å›¾çº¸ï¼Œå³å¯åœ¨ä»»ä½•ç»†èŠ‚å±‚é¢è§£é‡Šä»»ä½•ç³»ç»Ÿï¼</p>

<h2>å›¾è¡¨çš„å±‚æ¬¡ç»“æ„</h2>

<p><strong>ä¸Šä¸‹æ–‡å›¾</strong>ï¼š30,000 è‹±å°ºçš„è§†è§’</p>

<pre><code class="inform7">[Users] --&gt; [Page Builder System] --&gt; [CDN]
           |
           v
      [Database]
</code></pre>

<p><strong>å®¹å™¨å›¾</strong>ï¼šæ„å»ºæ¨¡å—</p>

<pre><code class="inform7">[Web Browser] --&gt; [Load Balancer] --&gt; [Web Application]
                                         |
                                         v
[File Storage] &lt;-- [API Gateway] &lt;-- [Cache Layer]
                        |
                        v
                   [Database Cluster]
</code></pre>

<p><strong>ç»„ä»¶å›¾</strong>ï¼šå†…éƒ¨ç»“æ„</p>

<pre><code class="mathematica">Web Application:
â”œâ”€â”€ Authentication Module
â”œâ”€â”€ Project Management Module
â”œâ”€â”€ Page Editor Module
â”‚   â”œâ”€â”€ Canvas Component
â”‚   â”œâ”€â”€ Toolbar Component
â”‚   â””â”€â”€ Properties Panel
â”œâ”€â”€ Component Library Module
â””â”€â”€ Export Module
</code></pre>

<h2>æœ‰æ•ˆçš„å›¾è¡¨ç»˜åˆ¶åŸåˆ™</h2>

<ol>
<li><strong>ä»ç”¨æˆ·æ—…ç¨‹å¼€å§‹</strong>ï¼šæ¯ä¸ªå›¾è¡¨éƒ½åº”è¯¥å›ç­”â€œæ•°æ®å¦‚ä½•ä»ç”¨æˆ·æ“ä½œæµå‘ç»“æœï¼Ÿâ€</li>
<li><strong>ä½¿ç”¨ä¸€è‡´çš„ç¬¦å·</strong>ï¼šçŸ©å½¢è¡¨ç¤ºè¿›ç¨‹ï¼Œåœ†æŸ±ä½“è¡¨ç¤ºæ•°æ®å­˜å‚¨ï¼Œåœ†å½¢è¡¨ç¤ºå¤–éƒ¨å®ä½“</li>
<li><strong>æ¸…æ™°åœ°æ˜¾ç¤ºå…³ç³»</strong>ï¼šç®­å¤´åº”æŒ‡ç¤ºæ•°æ®æµæ–¹å‘å¹¶è¿›è¡Œæ ‡è®°</li>
<li><strong>åˆ†å±‚å›¾è¡¨</strong>ï¼šä»é«˜å±‚å¼€å§‹ï¼Œç„¶åæ”¾å¤§åˆ°ç‰¹å®šåŒºåŸŸ</li>
<li><strong>åŒ…å«ä¸æ„‰å¿«çš„è·¯å¾„</strong>ï¼šæ˜¾ç¤ºé”™è¯¯å¤„ç†å’Œæ•…éšœåœºæ™¯</li>
</ol>


<h2>æ•´åˆï¼šå¯è§†åŒ–é¡µé¢æ„å»ºå™¨æ¡ˆä¾‹ç ”ç©¶</h2>

<p>è®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„å¯è§†åŒ–é¡µé¢æ„å»ºå™¨è®¾è®¡ä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿæ¶æ„ï¼š</p>

<h2>é«˜å±‚æ¶æ„</h2>

<pre><code class="coq">Frontend (Angular)
â”œâ”€â”€ Editor Canvas Module
â”œâ”€â”€ Component Library Module  
â”œâ”€â”€ Project Dashboard Module
â””â”€â”€ Shared Services
</code></pre>

<pre><code class="scss">API Gateway (Python/FastAPI)
â”œâ”€â”€ Authentication Service
â”œâ”€â”€ Project Service
â”œâ”€â”€ Component Service
â””â”€â”€ Rendering ServiceData Layer
â”œâ”€â”€ PostgreSQL (structured data)
â”œâ”€â”€ Redis (caching)
â””â”€â”€ S3 (file storage)Infrastructure
â”œâ”€â”€ CDN (CloudFront)
â”œâ”€â”€ Load Balancer
â””â”€â”€ Auto-scaling Groups
</code></pre>

<h2>ç»„ä»¶æ·»åŠ çš„æ•°æ®æµ</h2>

<ol>
<li><strong>ç”¨æˆ·æ“ä½œ</strong>ï¼šå°†ç»„ä»¶ä»åº“æ‹–åˆ°ç”»å¸ƒ</li>
<li><strong>å‰ç«¯</strong>ï¼šéªŒè¯ä½ç½®ï¼Œå‘é€ API è¯·æ±‚</li>
<li><strong>API ç½‘å…³</strong>ï¼šéªŒè¯è¯·æ±‚ï¼Œè·¯ç”±åˆ°ç»„ä»¶æœåŠ¡</li>
<li><strong>ç»„ä»¶æœåŠ¡</strong>ï¼šéªŒè¯ä¸šåŠ¡è§„åˆ™ï¼Œæ›´æ–°æ•°æ®åº“</li>
<li><strong>äº‹ä»¶æ€»çº¿</strong>ï¼šå‘å‡ºâ€œcomponent_addedâ€äº‹ä»¶</li>
<li><strong>æ¸²æŸ“æœåŠ¡</strong>ï¼šç”Ÿæˆæ›´æ–°åçš„é¡µé¢é¢„è§ˆ</li>
<li><strong>WebSocket</strong>ï¼šé€šçŸ¥å…¶ä»–åä½œè€…</li>
<li><strong>å‰ç«¯</strong>ï¼šä½¿ç”¨æ–°ç»„ä»¶æ›´æ–° UI</li>
</ol>


<h2>ğŸ“ äº’åŠ¨ç»ƒä¹ ï¼šæ•°æ®æµæ˜ å°„</h2>

<p><strong>å°†è¿™ä¸ªæŠ½è±¡çš„æµç¨‹è½¬åŒ–ä¸ºä¸€ä¸ªå¯è§†åŒ–çš„æ•…äº‹ï¼š</strong></p>

<ol>
<li><strong>åœ¨ä¸€ä¸ªæµç¨‹ä¸­ç”»å‡º 8 ä¸ªæ–¹æ¡†</strong>ï¼ˆæ¯ä¸ªæ–¹æ¡†å¯¹åº”ä¸Šé¢çš„æ¯ä¸ªæ­¥éª¤ï¼‰</li>
<li><strong>ç”¨ç®­å¤´è¿æ¥å®ƒä»¬</strong>ä»¥æ˜¾ç¤ºé¡ºåº</li>
<li><strong>åœ¨æ¯ä¸ªæ–¹æ¡†ä¸Šæ–¹å†™å‡ºæ‰€éœ€æ—¶é—´</strong>ï¼šâ€œ50 æ¯«ç§’â€ã€â€œ200 æ¯«ç§’â€ã€â€œ100 æ¯«ç§’â€ç­‰ã€‚</li>
<li><strong>åœ¨æ¯ä¸ªæ–¹æ¡†ä¸‹æ–¹ï¼Œæ³¨æ˜å¯èƒ½å‡ºç°çš„é—®é¢˜</strong>ï¼šâ€œç½‘ç»œè¶…æ—¶â€ã€â€œèº«ä»½éªŒè¯å¤±è´¥â€ã€â€œæ•°æ®åº“å®•æœºâ€</li>
<li><p><strong>ç°åœ¨ç”»å‡ºç¬¬äºŒä¸ªç‰ˆæœ¬</strong>ï¼Œå±•ç¤ºæ­¥éª¤ 4 å¤±è´¥æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p></li>
<li><p>ç”¨çº¢è‰²è™šçº¿ç”»ä¸€æ¡â€œæ‚²ä¼¤çš„è·¯å¾„â€ç®­å¤´</p></li>
<li>æ˜¾ç¤ºè¿”å›ç»™ç”¨æˆ·çš„é”™è¯¯æ¶ˆæ¯</li>
<li>æ·»åŠ é‡è¯•é€»è¾‘å’Œå›é€€é€‰é¡¹</li>
</ol>


<p><strong>æœ¬ç»ƒä¹ å°†æ•™ä¼šä½ ï¼š</strong>æ¯ä¸ªç”¨æˆ·æ“ä½œå®é™…ä¸Šéƒ½æ˜¯ä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿç¼–æ’ã€‚ç»˜åˆ¶ç®­å¤´å¯ä»¥å¸®åŠ©ä½ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å‘ç”Ÿæ½œåœ¨æ•…éšœä¹‹å‰å‘ç°å®ƒä»¬ï¼</p>

<p><strong>é¢å¤–æç¤ºï¼š</strong> ä¸ºç®­å¤´æ·»åŠ é¢œè‰²ä»£ç â€”â€”ç»¿è‰²ä»£è¡¨æ­£å¸¸è·¯å¾„ï¼Œçº¢è‰²ä»£è¡¨é”™è¯¯ï¼Œè“è‰²ä»£è¡¨é‡è¯•ã€‚</p>

<h2>å¯æ‰©å±•æ€§è€ƒè™‘å› ç´ </h2>

<p><strong>æµé‡æ¨¡å¼</strong>ï¼š</p>

<ul>
<li>é«˜è¯»å–æ“ä½œï¼ˆæµè§ˆé¡µé¢ï¼‰</li>
<li>çªå‘å†™å…¥æ“ä½œï¼ˆç¼–è¾‘ä¼šè¯ï¼‰</li>
<li>å¤§æ–‡ä»¶ä¸Šä¼ ï¼ˆå›¾ç‰‡ã€èµ„æºï¼‰</li>
</ul>


<p><strong>æ‰©å±•ç­–ç•¥</strong>ï¼š</p>

<ul>
<li>å°†æ¸²æŸ“åçš„é¡µé¢ç¼“å­˜åœ¨ CDN ä¸­</li>
<li>ä½¿ç”¨åªè¯»å‰¯æœ¬è¿›è¡Œé¡µé¢æµè§ˆ</li>
<li>å°†å¤§æ–‡ä»¶å¤„ç†æ’é˜Ÿ</li>
<li>å®ç° WebSocket è¿æ¥æ± </li>
</ul>


<h2>è¦ç‚¹ï¼šé€‚ç”¨äºä»»ä½• Web åº”ç”¨ç¨‹åºçš„åŸåˆ™</h2>

<h2>ç³»ç»Ÿè®¾è®¡çš„é»„é‡‘æ³•åˆ™</h2>

<ol>
<li><strong>ä»ç®€å•å¼€å§‹ï¼Œè§„åˆ’å¤æ‚</strong>ï¼šä»å•ä½“åº”ç”¨å¼€å§‹ï¼Œä½†è¦é’ˆå¯¹å¾®æœåŠ¡è¿›è¡Œè®¾è®¡</li>
<li><strong>å¿«é€Ÿå¤±è´¥ï¼Œå¿«é€Ÿå­¦ä¹ </strong>ï¼šä»ç¬¬ä¸€å¤©å¼€å§‹æ„å»ºç›‘æ§å’ŒæŠ¥è­¦åŠŸèƒ½</li>
<li><strong>æ•°æ®ä¸ºç‹</strong>ï¼šå…ˆè®¾è®¡æ•°æ®æ¨¡å‹ï¼Œå…¶ä»–ä¸€åˆ‡éƒ½æ°´åˆ°æ¸ æˆ</li>
<li><strong>å®‰å…¨æ€§ä¸å¯æˆ–ç¼º</strong>ï¼šåœ¨æ¯ä¸€å±‚éƒ½æ„å»ºèº«ä»½éªŒè¯å’Œæˆæƒæœºåˆ¶</li>
<li><strong>æ€§èƒ½æ˜¯å…³é”®ç‰¹æ€§</strong>ï¼šç”¨æˆ·æ›´å®¹æ˜“æ³¨æ„åˆ°åº”ç”¨ç¨‹åºè¿è¡Œç¼“æ…¢ï¼Œè€Œä¸æ˜¯åŠŸèƒ½ç¼ºå¤±</li>
</ol>


<h2>æ¶æ„æ¸…å•</h2>

<p>åœ¨ç¼–å†™ç¬¬ä¸€è¡Œä»£ç ä¹‹å‰ç¼–å†™ä»£ç æ—¶ï¼Œè¯·é—®è‡ªå·±ï¼š</p>

<ul>
<li>[ ] æ ¸å¿ƒå®ä½“åŠå…¶å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>[ ] è¯¥ç³»ç»Ÿå¦‚ä½•å¤„ç† 10 å€äºå½“å‰æµé‡çš„æƒ…å†µï¼Ÿ</li>
<li>[ ] å•ç‚¹æ•…éšœç‚¹åœ¨å“ªé‡Œï¼Ÿ</li>
<li>[ ] ä¸åŒçš„å›¢é˜Ÿå°†å¦‚ä½•åœ¨è¯¥ç³»ç»Ÿä¸Šåä½œï¼Ÿ</li>
<li>[ ] å‡ºç°é—®é¢˜æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</li>
<li>[ ] æˆ‘ä»¬å°†å¦‚ä½•ç›‘æ§å’Œè°ƒè¯•é—®é¢˜ï¼Ÿ</li>
<li>[ ] å®‰å…¨éšæ‚£æ˜¯ä»€ä¹ˆï¼Ÿ</li>
</ul>


<h2>ğŸ“ äº’åŠ¨ç»ƒä¹ ï¼šä½ çš„ç³»ç»Ÿè®¾è®¡æ¨¡æ¿</h2>

<p><strong>åˆ›å»ºä½ çš„ä¸ªäººç³»ç»Ÿè®¾è®¡æ¨¡æ¿ï¼Œå¯ç”¨äºä»»ä½•é¡¹ç›®ï¼š</strong></p>

<ol>
<li><strong>ç»˜åˆ¶ä¸€ä¸ªåŒ…å«ä»¥ä¸‹éƒ¨åˆ†çš„ç©ºç™½æ¨¡æ¿ï¼š</strong></li>
</ol>


<pre><code class="bash">â”Œâ”€â”€â”€â”€â”€â”€ å®ä½“ä¸å…³ç³» â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€ æµé‡ä¸æ‰©å±• â”€â”€â”€â”€â”€â”  â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”Œâ”€ æ•…éšœç‚¹ â”€â”€â”€â”€â”€â”€
â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€ å›¢é˜Ÿè¾¹ç•Œ â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚ â”‚ â”‚ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>

<ol>
<li><p><strong>å¡«å†™æˆ‘ä»¬çš„é¡µé¢æ„å»ºå™¨ç¤ºä¾‹ï¼š</strong></p></li>
<li><p>å®ä½“ï¼šç”¨æˆ·ã€é¡¹ç›®ã€é¡µé¢ã€ç»„ä»¶</p></li>
<li>æµé‡ï¼šæµè§ˆæ—¶è¯»å–é‡å¤§ï¼Œç¼–è¾‘æ—¶å†™å…¥é‡å¤§</li>
<li>æ•…éšœï¼šæ•°æ®åº“å®•æœºã€CDN é€Ÿåº¦æ…¢ã€WebSocket æ–­å¼€è¿æ¥</li>
<li>å›¢é˜Ÿï¼šå‰ç«¯å›¢é˜Ÿã€API å›¢é˜Ÿã€åŸºç¡€è®¾æ–½å›¢é˜Ÿ</li>
</ol>


<p><strong>2. å¤åˆ¶æ­¤æ¨¡æ¿</strong> â€” å°†å…¶ç”¨äºæœªæ¥çš„æ¯ä¸ªé¡¹ç›®</p>

<p><strong>ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼š</strong> æ‹¥æœ‰ä¸€è‡´çš„æ€ç»´æ¡†æ¶å¯ä»¥é˜²æ­¢ä½ å¿˜è®°å…³é”®æ–¹é¢ã€‚ä½ çš„ç»˜å›¾å°†æˆä¸ºä½ çš„ç³»ç»Ÿè®¾è®¡æ¸…å•ï¼</p>

<h2>ä½ çš„ç»˜å›¾ä¹‹æ—…ï¼šä»è‰å›¾åˆ°ç³»ç»Ÿ</h2>

<p>å¦‚æœä½ å®Œæˆäº†æœ¬æ–‡çš„ç»˜å›¾ç»ƒä¹ ï¼Œé‚£ä¹ˆä½ ç°åœ¨æ‹¥æœ‰ï¼š</p>

<ol>
<li><strong>åˆ†å±‚æ¶æ„æ¨¡æ¿</strong>ï¼ˆç”¨äºåˆ†è§£ä»»ä½•å¤æ‚ç³»ç»Ÿï¼‰</li>
<li><strong>åˆ†è§£æ ‘æ–¹æ³•</strong>ï¼ˆç”¨äºç»„ç»‡å¼€å‘å·¥ä½œï¼‰</li>
<li><strong>æ‰©å±•æ¼”è¿›è·¯çº¿å›¾</strong>ï¼ˆç”¨äºè§„åˆ’å‘å±•é˜¶æ®µï¼‰</li>
<li><strong>é¤å…éšå–»å›¾</strong>ï¼ˆç”¨äºè§£é‡Šä¸‰å±‚æ¶æ„ï¼‰</li>
<li><strong>æ¶æ„æ¨¡å¼å¯¹æ¯”å›¾</strong>ï¼ˆç”¨äºé€‰æ‹©æ­£ç¡®çš„æ–¹æ³•ï¼‰</li>
<li><strong>ä¸‰å±‚å›¾è¡¨ç³»ç»Ÿ</strong>ï¼ˆç”¨äºåœ¨ä»»ä½•ç»†èŠ‚å±‚é¢è¿›è¡Œæ²Ÿé€šï¼‰</li>
<li><strong>æ•°æ®æµæ˜ å°„æŠ€æœ¯</strong>ï¼ˆç”¨äºç†è§£ç³»ç»Ÿäº¤äº’ï¼‰</li>
<li><strong>å¯å¤ç”¨ç³»ç»Ÿè®¾è®¡æ¨¡æ¿</strong>ï¼ˆç”¨äºä¸€è‡´çš„é¡¹ç›®è§„åˆ’ï¼‰</li>
</ol>


<p><strong>è¿™äº›æ‰‹ç»˜å›¾è¡¨æ¯”ä»»ä½•æ˜‚è´µçš„å·¥å…·éƒ½æ›´æœ‰ä»·å€¼</strong>ï¼Œå› ä¸ºï¼š</p>

<ul>
<li>é€šè¿‡ç»˜åˆ¶å®ƒä»¬ï¼Œä½ çš„å¤§è„‘å»ºç«‹äº†æ›´æ·±å±‚æ¬¡çš„è”ç³»</li>
<li>ä½ å¯ä»¥éšæ—¶éšåœ°é‡æ–°åˆ›å»ºå®ƒä»¬</li>
<li>å®ƒä»¬æ ¹æ®ä½ å¯¹ç³»ç»Ÿçš„ç†è§£è¿›è¡Œä¸ªæ€§åŒ–å®šåˆ¶</li>
<li>å®ƒä»¬å¼¥åˆäº†æŠ½è±¡æ¦‚å¿µä¸å®è·µä¹‹é—´çš„å·®è·å®æ–½</li>
</ul>


<p><strong>ä¿ç•™ä½ çš„å›¾çº¸ï¼</strong> æŠŠå®ƒä»¬è´´åœ¨ä½ çš„æ˜¾ç¤ºå™¨ä¸Šï¼Œç”¨æ‰‹æœºæ‹ç…§ï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ªâ€œç³»ç»Ÿè®¾è®¡é€Ÿå†™æœ¬â€ï¼Œè®©å®ƒéšç€æ¯ä¸ªé¡¹ç›®çš„è¿›å±•è€Œä¸æ–­æ›´æ–°ã€‚</p>

<h2>æ€»ç»“</h2>

<blockquote><p>â€œæ¶æ„å¸ˆèº«å¤„ä¸¤ä¸ªä¸–ç•Œä¹‹é—´ã€‚ä½ å¿…é¡»æ„¿æ„æ‰“ç ´åŸºæœ¬çš„å‡è®¾ã€‚â€â€”â€”å®‰è—¤å¿ é›„</p></blockquote>

<p>ç³»ç»Ÿè®¾è®¡å¹¶éè¦åˆ›é€ å®Œç¾çš„æ¶æ„ï¼Œè€Œæ˜¯è¦åšå‡ºæ˜æ™ºçš„æƒè¡¡ã€‚æ¯ä¸ªå†³ç­–éƒ½æœ‰å…¶åæœï¼Œæ¯ä¸ªæ¨¡å¼éƒ½æœ‰å…¶åˆ©å¼Šï¼Œæ¯ä¸ªè§£å†³æ–¹æ¡ˆéƒ½ä¼šäº§ç”Ÿæ–°çš„é—®é¢˜éœ€è¦è§£å†³ã€‚</p>

<p>æœ€å¥½çš„æ¶æ„å¸ˆå¹¶éç²¾é€šæ‰€æœ‰æ¨¡å¼å’ŒæŠ€æœ¯ï¼Œè€Œæ˜¯èƒ½å¤Ÿå€¾å¬éœ€æ±‚ã€ç†è§£çº¦æŸï¼Œå¹¶è®¾è®¡å‡ºèƒ½å¤Ÿä¸ç”¨æˆ·å’Œç»„ç»‡å’Œè°å…±å­˜çš„ç³»ç»Ÿã€‚</p>

<p>è®°ä½ï¼šä½ ä¸ä»…ä»…æ˜¯åœ¨æ„å»ºè½¯ä»¶ï¼Œä½ è¿˜åœ¨ä¸ºå›¢é˜Ÿæœªæ¥çš„æˆåŠŸå¥ å®šåŸºç¡€ã€‚æ„å»ºå¥½å®ƒï¼Œæ¸…æ™°åœ°è®°å½•å®ƒï¼Œå¹¶å§‹ç»ˆåšå¥½æ¼”è¿›çš„å‡†å¤‡ã€‚</p>

<p>ä¿—è¯è¯´ï¼Œâ€œå‡ å‘¨çš„ç¼–ç æ—¶é—´å¯ä»¥èŠ‚çœæ•°å°æ—¶çš„è§„åˆ’æ—¶é—´ã€‚â€ æŠ•èµ„äºç³»ç»Ÿè®¾è®¡ï¼Œæœªæ¥çš„ä½ ï¼ˆå’Œå›¢é˜Ÿï¼‰ä¼šæ„Ÿè°¢ä½ ã€‚</p>

<p>åƒä¸ªåº”ç”¨ç¨‹åºçš„æ—…ç¨‹å§‹äºä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„ç³»ç»Ÿã€‚ä»Šå¤©å°±å¼€å§‹åƒæ¶æ„å¸ˆä¸€æ ·æ€è€ƒï¼Œè§è¯ä½ çš„åº”ç”¨ç¨‹åºä»è„†å¼±çš„åŸå‹è½¬å˜ä¸ºç»å¾—èµ·æ—¶é—´è€ƒéªŒçš„å¼ºå¤§ã€å¯æ‰©å±•çš„å¹³å°ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android ViewModelæ•°æ®åŠ è½½ï¼šåŸºäºFlowæ¶æ„çš„æœ€ä½³å®è·µ]]></title>
    <link href="https://alexhilton.github.io/blog/2025/09/22/viewmodel-loading/"/>
    <updated>2025-09-22T22:50:00+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/09/22/viewmodel-loading</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ªã€ŒAndroid ViewModel Data Loading: Best Practices and Flow-Based Architectureã€ï¼ŒåŸæ–‡é“¾æ¥<a href="https://funkymuse.dev/posts/properly-load-data/">https://funkymuse.dev/posts/properly-load-data/</a>ï¼Œç”±FunkyMuseäº2025å¹´8æœˆ29æ—¥ã€‚</p></blockquote>

<p>Android å¼€å‘ä¸­çš„æ¶æ„è®¨è®ºç»å¸¸å¼•å‘æ¿€çƒˆçš„äº‰è®ºâ€”â€”æœ‰æ—¶è¤’è´¬ä¸ä¸€ã€‚æ’°å†™è¿™äº›ä¸»é¢˜çš„æ–‡ç« å¹¶ä¸å®¹æ˜“ï¼Œä½†è¿™æ­£æ˜¯å®ƒçš„ä»·å€¼æ‰€åœ¨ã€‚</p>

<p>æœ¬æ–‡é˜è¿°äº†æˆ‘å¯¹æ•°æ®åŠ è½½æ¨¡å¼çš„ç‹¬åˆ°è§è§£ï¼Œè¿™äº›è§è§£æºäºæˆ‘çš„ç»éªŒä»¥åŠè¿‘æœŸæ‰‹æœ¯åçš„æ¢å¤ï¼ˆå…¶ä¸­ä¸€æ¬¡æ‰‹æœ¯ä»åœ¨è¿›è¡Œä¸­ï¼‰ã€‚</p>

<p>ä¸å¦¨å°†æ­¤è§†ä¸ºæˆ‘åœ¨ 2025 å¹´å¯¹æ•°æ®åŠ è½½æ¨¡å¼çš„ç†è§£å’ŒæŠ€èƒ½çš„æ¦‚è¿°ã€‚</p>

<p>æˆ‘å¯èƒ½æ¯”å…¶ä»–äººæ›´æ™šåŠ å…¥è¿™åœºè®¨è®ºï¼Œä½†è¿Ÿåšæ€»æ¯”ä¸åšå¥½ã€‚</p>

<h2>æŒ‘æˆ˜ï¼šAndroid ViewModel ä¸­å¸¸è§çš„æ•°æ®åŠ è½½åæ¨¡å¼</h2>

<p>â€œå¤§å¤šæ•°â€Android å¼€å‘è€…ä½¿ç”¨ ViewModel æ¥ç®¡ç† UI çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€ç”±è§†å›¾ï¼ˆFragmentã€Activity æˆ–å¯ç»„åˆç»„ä»¶ï¼‰æ”¶é›†ã€‚ä¸ºäº†æ˜¾ç¤ºæœ‰æ„ä¹‰çš„å†…å®¹ï¼Œä½ éœ€è¦ä»çœŸå®æ•°æ®æºåŠ è½½æ•°æ®ï¼Œå°†å…¶è½¬æ¢ä¸ºè§†å›¾çŠ¶æ€ï¼Œç„¶åå…¬å¼€ä»¥ä¾›ä½¿ç”¨ã€‚</p>

<p>ä»¥å‰æ˜¯ LiveDataï¼Œç°åœ¨æ˜¯ Flowï¼Œå®ƒå……å½“è§†å›¾å’Œ ViewModel ä¹‹é—´çš„ç²˜åˆå‰‚ï¼ˆå¤§å¤šæ•°æƒ…å†µä¸‹ï¼‰ã€‚æœ‰ä¸€äº›è§£å†³æ–¹æ¡ˆä½¿ç”¨ <a href="https://github.com/cashapp/molecule">molecule</a>ï¼Œä½†è¿™è¶…å‡ºäº†æˆ‘ä»¬çš„è®¨è®ºèŒƒå›´ã€‚</p>

<p><a href=""><img src="https://funkymuse.dev/assets/img/load_data/zhui.png" title="auto auto" ></a></p>

<!-- more -->


<p>æ­£å¦‚è¿™ç¯‡ <a href="https://x.com/github_skydoves/status/1829315087611707848">Twitter è®¨è®º</a> æ‰€ç¤ºï¼Œå¤§å¤šæ•°å¼€å‘è€…åœ¨ <code>ViewModel</code> çš„ init {} å—ä¸­åŠ è½½æ•°æ®ã€‚è™½ç„¶è¿™ç§æ–¹æ³•çœ‹ä¼¼åˆä¹é€»è¾‘ï¼Œä½†å®ƒå¸¦æ¥äº†ä¸€äº›æ¶æ„é—®é¢˜ï¼ŒIan Lake å’Œå…¶ä»–äººè®¤ä¸ºè¿™æ˜¯åæ¨¡å¼â€”â€”åŒ…æ‹¬ä½¿ç”¨ <code>LaunchedEffect</code> è¿›è¡Œæ•°æ®åŠ è½½ã€‚</p>

<p><a href="https://funkymuse.dev/assets/img/load_data/jokes.png"><img src="https://funkymuse.dev/assets/img/load_data/jokes.png" alt="Irony" /></a></p>

<p>è®½åˆºçš„æ˜¯ï¼Œå³ä½¿æ˜¯å®˜æ–¹ç¤ºä¾‹æœ‰æ—¶ä¹Ÿä¼šä¸è¿™äº›æœ€ä½³åšæ³•ç›¸çŸ›ç›¾ï¼š</p>

<p><a href="https://funkymuse.dev/assets/img/load_data/irony.png"><img src="https://funkymuse.dev/assets/img/load_data/irony.png" alt="Irony" /></a></p>

<h3>å¼€å‘è€…ä¸ºä½•é€‰æ‹© init {} å—ï¼ˆä»¥åŠå®ƒä¸ºä½•å­˜åœ¨é—®é¢˜ï¼‰</h3>

<p>ViewModel çš„ init {} å—çš„å¸å¼•åŠ›æ˜¾è€Œæ˜“è§â€”â€”å®ƒç¡®ä¿æ•°æ®åŠ è½½åœ¨é…ç½®æ›´æ”¹åä¾ç„¶æœ‰æ•ˆï¼Œä»è€Œé¿å…äº†ä¸å¿…è¦çš„ API è°ƒç”¨æˆ–æ•°æ®åº“è¯»å–ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•ä¹Ÿå¸¦æ¥äº†å››ä¸ªå…³é”®é—®é¢˜ï¼š</p>

<h4>é—®é¢˜ 1ï¼šå¯¼èˆªè¿”å›æ ˆå¤æ‚åŒ–</h4>

<p>ä½¿ç”¨ init {} è¿›è¡Œæ•°æ®åŠ è½½æ—¶ï¼Œè¿”å›åˆ°åŒ…å«ç°æœ‰ ViewModel çš„å±å¹•ä¸ä¼šè§¦å‘é‡æ–°åˆå§‹åŒ–ã€‚è¿™è¿«ä½¿å¼€å‘è€…åœ¨ onStart æˆ– onResume ä¸­æ·»åŠ å˜é€šé€»è¾‘æ¥æ£€æŸ¥æ•°æ®æ–°é²œåº¦ï¼Œä»è€Œåˆ›å»ºéš¾ä»¥ç»´æŠ¤çš„æ„å¤§åˆ©é¢æ¡å¼ä»£ç ã€‚</p>

<h4>é—®é¢˜ 2ï¼šè°ƒåº¦ç¨‹åºç«äº‰æ¡ä»¶</h4>

<p>åœ¨ init {} ä¸­åŠ è½½æ•°æ®é€šå¸¸ä½¿ç”¨ viewModelScopeï¼Œå®ƒåœ¨ Dispatchers.Main.immediate ä¸Šè¿è¡Œã€‚è¿™ç§å³æ—¶è°ƒåº¦ç¨‹åºå¯èƒ½ä¼šå¯¼è‡´ç«äº‰æ¡ä»¶ï¼Œå³æ•°æ®å¤„ç†åœ¨ UI ç»„åˆä¹‹å‰å°±å·²å®Œæˆï¼Œå°¤å…¶æ˜¯åœ¨ Jetpack Compose åº”ç”¨ä¸­ã€‚</p>

<p><a href="https://funkymuse.dev/assets/img/load_data/darkness.png"><img src="https://funkymuse.dev/assets/img/load_data/darkness.png" alt="Darkness" /></a></p>

<h4>é—®é¢˜ #3ï¼šæ•°æ®è¿‡æœŸé—®é¢˜</h4>

<p>ç°ä»£ CRUD åº”ç”¨ç¨‹åºéœ€è¦æ›´æ–°æ•°æ®ã€‚ç”¨æˆ·å¯èƒ½ä¼šä»å…¶ä»–å±å¹•è¿”å›ï¼Œæˆ–è€…åœ¨ç›¸å½“é•¿ä¸€æ®µæ—¶é—´åä»æš‚åœçŠ¶æ€æ¢å¤ã€‚<code>init {}</code> æ–¹æ³•æ²¡æœ‰æä¾›å†…ç½®çš„æ•°æ®æ–°é²œåº¦éªŒè¯æœºåˆ¶ã€‚</p>

<h4>é—®é¢˜ #4ï¼šæµ‹è¯•å›°éš¾</h4>

<p>æ¯æ¬¡è¿è¡Œæµ‹è¯•æ—¶ï¼Œä½ éƒ½å¿…é¡»æ„å»º ViewModel æ‰èƒ½æˆåŠŸè¿è¡Œè¯¥ç‰¹å®šæµ‹è¯•ç”¨ä¾‹çš„ <code>init {}</code> ä»£ç å—ã€‚</p>

<h2>åŸºäº Flow çš„è§£å†³æ–¹æ¡ˆï¼šå°†å†·æµè½¬æ¢ä¸ºçƒ­æµ</h2>

<p>è¯¥è§£å†³æ–¹æ¡ˆåˆ©ç”¨ Kotlin Flowsâ€”â€”å…·ä½“æ¥è¯´ï¼Œä½¿ç”¨ StateFlow å’Œé€‚å½“çš„å…±äº«ç­–ç•¥å°†å†·æµè½¬æ¢ä¸ºçƒ­æµã€‚å¯ä»¥å°†å…¶è§†ä¸º Katy Perry çš„â€œHot N Coldâ€æ–¹æ³•ï¼Œä½†æ‰€æœ‰è¾¹ç¼˜æƒ…å†µçš„è¡Œä¸ºéƒ½æ˜¯å¯é¢„æµ‹çš„ã€‚</p>

<h3>æ„å»ºåŸºç¡€ï¼šç”¨ä¾‹å’Œ ViewModel ç»“æ„</h3>

<p><strong>è¯·æ³¨æ„ï¼Œæ­¤ä»£ç ä»…ç”¨äºæ¼”ç¤ºç›®çš„ï¼Œå¦‚ä½•æ„å»ºç”±ä½ å†³å®šï¼Œé™¤åŠ è½½éƒ¨åˆ†å¤–ï¼Œå¹¶éæœ€ä½³å®è·µ</strong></p>

<pre><code class="kotlin">inline fun &lt;reified T : ViewModel&gt; provideFactory(
    crossinline creator: () -&gt; T
) = viewModelFactory {
    initializer {
        creator()
    }
}
</code></pre>

<p><em>æ³¨æ„ï¼šæ­¤å·¥å‚æ¨¡å¼ä»…ç”¨äºæ¼”ç¤ºç›®çš„</em></p>

<p>æˆ‘ä»¬çš„ç”¨ä¾‹å¤„ç†æ•°æ®æ£€ç´¢ã€æ ¼å¼åŒ–å’Œä¸šåŠ¡é€»è¾‘è½¬æ¢ï¼š</p>

<pre><code class="kotlin">class GetUserDetailsUseCase private constructor(
    private val authRepository: AuthRepository = AuthRepository(),
    private val dispatcher: CoroutineDispatcher = Dispatchers.IO,
    private val billingCache: BillingCache = BillingCache.create(),
    private val dateFormatter: DateFormatter = DataFormatter()
) {
    suspend fun execute(): Result&lt;UserDetails&gt; =
        withContext(dispatcher) {
            val userDetails: Result&lt;UserDetailsResponseModel&gt; = authRepository.getUserDetails()

            userDetails.map { details -&gt;
                UserDetails(
                    creationDate = dateFormatter.format(
                        details.creationDate,
                        DateFormatter.Format.UTC_SHORT
                    ).getOrNull(),
                    avatarUrl = details.avatar,
                    isPremium = billingCache.isPremium(),
                    email = details.email
                )
            }
        }

    companion object {
        fun create() = GetUserDetailsUseCase()
    }
}
</code></pre>

<p>æ­¤ç”¨ä¾‹å°è£…äº†ä»å­˜å‚¨åº“æ£€ç´¢æ•°æ®ã€æ—¥æœŸæ ¼å¼åŒ–ã€é«˜çº§çŠ¶æ€éªŒè¯ä»¥åŠå‡†å¤‡ç”¨æˆ·ä¿¡æ¯ä»¥ä¾›æ˜¾ç¤ºã€‚</p>

<pre><code class="kotlin">internal class UserAccountDetailsViewModel private constructor(
    private val getUserDetailsUseCase: GetUserDetailsUseCase = GetUserDetailsUseCase.create(),
) : ViewModel() {
    data class ViewState(
        val isLoading: Boolean = false,
        val isError: Boolean = false,
        val userInfo: UserInfo? = null
    ) {
        data class UserInfo(
            val displayEmail: String,
            val avatarUrl: String?,
            val showPremiumBadge: Boolean,
            val memberSince: String?
        )
    }

    val userDetails: Flow&lt;ViewState&gt; = flow {
        emit(
            getUserDetailsUseCase.execute()
                .fold(
                    onSuccess = {
                        ViewState(
                            isLoading = false,
                            isError = false,
                            userInfo = ViewState.UserInfo(
                                displayEmail = it.email,
                                avatarUrl = it.avatarUrl,
                                showPremiumBadge = it.isPremium,
                                memberSince = it.creationDate?.toString()
                            )
                        )
                    },

                    onFailure = {
                        ViewState(isLoading = false, isError = true)
                    }
                )
        )
    }.stateIn(
        viewModelScope,
        SharingStarted.WhileSubscribed(5_000),
        ViewState(isLoading = true, isError = false)
    )

    companion object {
        fun factory() = provideFactory { UserAccountDetailsViewModel() }
    }
}
</code></pre>

<p>è¿™ç§æ–¹æ³•æœ‰å‡ ä¸ªå…³é”®ä¼˜åŠ¿ï¼š</p>

<ul>
<li><strong>æ•°æ®æ–°é²œåº¦</strong>ï¼š5 ç§’è¶…æ—¶æ—¶é—´ä¸ Android çš„ ANR é˜ˆå€¼ä¸€è‡´ï¼Œç¡®ä¿åœ¨è¶…æ—¶åæ”¶é›†å™¨é‡æ–°å‡ºç°æ—¶æ•°æ®èƒ½å¤Ÿåˆ·æ–°ã€‚</li>
<li><strong>é…ç½®å˜æ›´å¤„ç†</strong>ï¼šåœ¨è¶…æ—¶çª—å£å†…ï¼Œå³ä½¿é…ç½®å‘ç”Ÿå˜åŒ–ï¼Œæ•°æ®ä¹Ÿèƒ½æŒä¹…ä¿å­˜ã€‚</li>
<li><strong>èµ„æºæ•ˆç‡</strong>ï¼šé¿å…ä¸å¿…è¦çš„ç½‘ç»œè°ƒç”¨ï¼Œä»¥å®ç°å¿«é€Ÿå¯¼èˆªæ¨¡å¼ã€‚</li>
</ul>


<p><em>ä¸“ä¸šæç¤ºï¼šå¯¹äºéœ€è¦å®æ—¶æ•°æ®æ–°é²œåº¦çš„åº”ç”¨ç¨‹åºï¼Œè¯·å°†è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º 0</em></p>

<h3>æ·»åŠ ç”¨æˆ·äº¤äº’ï¼šå®ç°åˆ·æ–°åŠŸèƒ½</h3>

<p>å®é™…åº”ç”¨ç¨‹åºéœ€è¦ç”¨æˆ·ä¸»åŠ¨å‘èµ·çš„æ•°æ®åˆ·æ–°åŠŸèƒ½ã€‚äº§å“ç»ç†å–œæ¬¢æ»‘åŠ¨åˆ·æ–°ï¼Œä½†æˆ‘ä»¬çš„åŸºæœ¬æµç¨‹æ— æ³•é€‚åº”è¿™ç§æ¨¡å¼ã€‚è®©æˆ‘ä»¬æ¥å¢å¼ºæˆ‘ä»¬çš„æ¶æ„ï¼š</p>

<p>æˆ‘ä»¬ä½¿ç”¨åœ¨ä¸»æµç¨‹æ”¶é›†å™¨ä¸­è§¦å‘çš„ <code>MutableSharedFlow</code> æ¥å®ç°è¿™ä¸€ç‚¹ï¼š</p>

<pre><code class="kotlin">internal class UserAccountDetailsViewModel private constructor(
    private val getUserDetailsUseCase: GetUserDetailsUseCase = GetUserDetailsUseCase.create(),
) : ViewModel(), IntentAware&lt;UserAccountDetailsViewModel.ViewState.Intents&gt; {
    data class ViewState(
        val isLoading: Boolean = false,
        val isError: Boolean = false,
        val userInfo: UserInfo? = null
    ) {
        data class UserInfo(
            val displayEmail: String,
            val avatarUrl: String?,
            val showPremiumBadge: Boolean,
            val memberSince: String?
        )

        sealed class Intents {
            data object Refresh : Intents()
        }
    }

    private val refreshListener = MutableSharedFlow&lt;Unit&gt;()

    val userDetails: Flow&lt;ViewState&gt; = flow {
        emit(getUserDetailsState())
        refreshListener.collect {
            emit(ViewState(isLoading = true, isError = false))
            emit(getUserDetailsState())
        }
    }.stateIn(
        viewModelScope,
        SharingStarted.WhileSubscribed(5_000),
        ViewState(isLoading = true, isError = false)
    )

    private suspend fun getUserDetailsState(): ViewState = getUserDetailsUseCase.execute()
        .fold(
            onSuccess = {
                ViewState(
                    isLoading = false,
                    isError = false,
                    userInfo = ViewState.UserInfo(
                        displayEmail = it.email,
                        avatarUrl = it.avatarUrl,
                        showPremiumBadge = it.isPremium,
                        memberSince = it.creationDate?.toString()
                    )
                )
            },

            onFailure = {
                ViewState(isLoading = false, isError = true)
            }
        )

    override fun onIntent(intent: ViewState.Intents) {
        when (intent) {
            ViewState.Intents.Refresh -&gt; {
                viewModelScope.launch {
                    refreshListener.emit(Unit)
                }
            }
        }
    }

    companion object {
        fun factory() = provideFactory { UserAccountDetailsViewModel() }
    }
}
</code></pre>

<p>å®Œç¾ï¼æˆ‘ä»¬æˆåŠŸé‡æ„äº†é‡å¤çš„æ•°æ®åŠ è½½é€»è¾‘ï¼Œå¹¶å®ç°äº†åˆ·æ–°åŠŸèƒ½ã€‚ç„¶è€Œï¼Œè¿™è¿˜ä¸ç®—å®Œã€‚</p>

<h3>ä¼˜åŒ–çŠ¶æ€ç®¡ç†ï¼šæ¶ˆé™¤å†—ä½™çŠ¶æ€è¾“å‡º</h3>

<p>ä¸ºäº†é¿å…ä¸å¿…è¦çš„ UI æ›´æ–°ï¼Œæˆ‘ä»¬å°†æ·»åŠ  <code>distinctUntilChanged()</code> æ¥è¿‡æ»¤é‡å¤çš„çŠ¶æ€è¾“å‡ºã€‚</p>

<h3>å¤„ç†å¤æ‚çš„çŠ¶æ€æ›´æ–°</h3>

<p>å¯¹äºæ„å›¾ä¿®æ”¹ UI çŠ¶æ€è€Œä¸éœ€è¦é‡æ–°åŠ è½½æ•°æ®çš„åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æµç¨‹æ“ä½œä¸­è®¿é—®å½“å‰çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œåˆ‡æ¢ç”µå­é‚®ä»¶å¯è§æ€§â€”â€”è¿™éœ€è¦ä¿®æ”¹çŠ¶æ€è€Œä¸æ˜¯é‡æ–°åŠ è½½æ•°æ®ã€‚</p>

<pre><code class="kotlin">data class ViewState(
    val isLoading: Boolean = false,
    val isError: Boolean = false,
    val isEmailVisible: Boolean = false,
    val userInfo: UserInfo? = null
) {
    data class UserInfo(
        val displayEmail: String,
        val avatarUrl: String?,
        val showPremiumBadge: Boolean,
        val memberSince: String?
    )

    sealed class Intents {

        data object Refresh : Intents()
        data class ToggleEmailVisibility(val isEmailVisible: Boolean) : Intents()
    }

    sealed class StateParameters {
        data class EmailVisibilityChanged(val isEmailVisible: Boolean) : StateParameters()
        data object Refresh : StateParameters()
    }
}

private val refreshListener = MutableSharedFlow&lt;ViewState.StateParameters&gt;()

val userDetails: Flow&lt;ViewState&gt; = flow {
    emit(getUserDetailsState())

    refreshListener.collect { refreshParams -&gt;
        when (refreshParams) {
            is ViewState.StateParameters.EmailVisibilityChanged -&gt; {
                //do some changes here
            }

            ViewState.StateParameters.Refresh -&gt; {
                emit(ViewState(isLoading = true, isError = false))
                emit(getUserDetailsState())
            }
        }
    }
}
    .distinctUntilChanged()
    .stateIn(
        viewModelScope,
        SharingStarted.WhileSubscribed(5_000),
        ViewState(isLoading = true, isError = false)
    )
</code></pre>

<p>è¿™é‡Œçš„æŒ‘æˆ˜åœ¨äºå¦‚ä½•åœ¨æµç¨‹ä¸­è®¿é—®å½“å‰çŠ¶æ€ã€‚è®©æˆ‘ä»¬é€šè¿‡å†…éƒ¨è·Ÿè¸ªçŠ¶æ€æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>

<pre><code class="kotlin">internal class UserAccountDetailsViewModel private constructor(
    private val getUserDetailsUseCase: GetUserDetailsUseCase = GetUserDetailsUseCase.create(),
) : ViewModel(), IntentAware&lt;UserAccountDetailsViewModel.ViewState.Intents&gt; {
    data class ViewState(
        val isLoading: Boolean = false,
        val isError: Boolean = false,
        val isEmailVisible: Boolean = false,
        val userInfo: UserInfo? = null
    ) {
        data class UserInfo(
            val displayEmail: String,
            val avatarUrl: String?,
            val showPremiumBadge: Boolean,
            val memberSince: String?
        )

        sealed class Intents {
            data object Refresh : Intents()
            data class ToggleEmailVisibility(val isEmailVisible: Boolean) : Intents()
        }

        sealed class StateTriggers {
            data class EmailVisibilityChanged(val isEmailVisible: Boolean) : StateTriggers()
            data object Refresh : StateTriggers()
        }
    }

    private var currentState = ViewState(isLoading = true, isError = false)

    private val refreshListener = MutableSharedFlow&lt;ViewState.StateTriggers&gt;()

    val userDetails: Flow&lt;ViewState&gt; = flow {
        emit(getUserDetailsState())

        refreshListener.collect { refreshParams -&gt;
            when (refreshParams) {
                is ViewState.StateTriggers.EmailVisibilityChanged -&gt; {
                    emit(currentState.copy(isEmailVisible = refreshParams.isEmailVisible))
                }
                ViewState.StateTriggers.Refresh -&gt; {
                    emit(ViewState(isLoading = true, isError = false))
                    emit(getUserDetailsState())
                }
            }
        }
    }
        .distinctUntilChanged()
        .onEach {
            currentState = it
        }
        .stateIn(
            viewModelScope,
            SharingStarted.WhileSubscribed(5_000),
            currentState
        )

    private suspend fun getUserDetailsState(): ViewState = getUserDetailsUseCase.execute()
        .fold(
            onSuccess = {
                ViewState(
                    isLoading = false,
                    isError = false,
                    userInfo = ViewState.UserInfo(
                        displayEmail = it.email,
                        avatarUrl = it.avatarUrl,
                        showPremiumBadge = it.isPremium,
                        memberSince = it.creationDate?.toString()
                    )
                )
            },

            onFailure = {
                ViewState(isLoading = false, isError = true)
            }
        )

    override fun onIntent(intent: ViewState.Intents) {
        when (intent) {
            ViewState.Intents.Refresh -&gt; {
                viewModelScope.launch {
                    refreshListener.emit(ViewState.StateTriggers.Refresh)
                }
            }

            is ViewState.Intents.ToggleEmailVisibility -&gt; {
                viewModelScope.launch {
                    refreshListener.emit(ViewState.StateTriggers.EmailVisibilityChanged(intent.isEmailVisible))
                }
            }
        }
    }

    companion object {
        fun factory() = provideFactory { UserAccountDetailsViewModel() }
    }
}
</code></pre>

<h3>æ™ºèƒ½æ•°æ®ç¼“å­˜ï¼šæ¡ä»¶åŠ è½½ç­–ç•¥</h3>

<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å®ç°å¤æ‚çš„ç¼“å­˜è¡Œä¸ºäº†ã€‚ç”±äº <code>currentState</code> åœ¨ ViewModel ç”Ÿå‘½å‘¨æœŸå†…æŒç»­å­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç«‹å³å‘å‡ºç¼“å­˜æ•°æ®ï¼Œå¹¶ä»…åœ¨å¿…è¦æ—¶æœ‰æ¡ä»¶åœ°åŠ è½½æ–°æ•°æ®ï¼š</p>

<pre><code class="kotlin">internal class UserAccountDetailsViewModel private constructor(
    private val getUserDetailsUseCase: GetUserDetailsUseCase = GetUserDetailsUseCase.create(),
) : ViewModel(), IntentAware&lt;UserAccountDetailsViewModel.ViewState.Intents&gt; {
    data class ViewState(
        val isLoading: Boolean = false,
        val isError: Boolean = false,
        val isEmailVisible: Boolean = false,
        val userInfo: UserInfo? = null
    ) {
        val isDataLoaded get() = userInfo != null

        data class UserInfo(
            val displayEmail: String,
            val avatarUrl: String?,
            val showPremiumBadge: Boolean,
            val memberSince: String?
        )

        sealed class Intents {
            data object Refresh : Intents()
            data class ToggleEmailVisibility(val isEmailVisible: Boolean) : Intents()
        }

        sealed class StateTriggers {
            data class EmailVisibilityChanged(val isEmailVisible: Boolean) : StateTriggers()
            data object Refresh : StateTriggers()
        }
    }

    private var currentState = ViewState(isLoading = true, isError = false)

    private val refreshListener = MutableSharedFlow&lt;ViewState.StateTriggers&gt;()

    val userDetails: Flow&lt;ViewState&gt; = flow {
        emit(currentState)

        //i added error check just because this is for demonstration of this edge case

        if (currentState.isDataLoaded.not() || currentState.isError) {
            emit(getUserDetailsState())
        }

        refreshListener.collect { refreshParams -&gt;
            when (refreshParams) {
                is ViewState.StateTriggers.EmailVisibilityChanged -&gt; {
                    emit(currentState.copy(isEmailVisible = refreshParams.isEmailVisible))
                }

                ViewState.StateTriggers.Refresh -&gt; {
                    emit(ViewState(isLoading = true, isError = false))
                    emit(getUserDetailsState())
                }
            }
        }
    }
        .distinctUntilChanged()
        .onEach {
            currentState = it
        }

        .stateIn(
            viewModelScope,
            SharingStarted.WhileSubscribed(5_000),
            currentState
        )

    private suspend fun getUserDetailsState(): ViewState = getUserDetailsUseCase.execute()
        .fold(
            onSuccess = {
                ViewState(
                    isLoading = false,
                    isError = false,
                    userInfo = ViewState.UserInfo(
                        displayEmail = it.email,
                        avatarUrl = it.avatarUrl,
                        showPremiumBadge = it.isPremium,
                        memberSince = it.creationDate?.toString()
                    )
                )
            },

            onFailure = {
                ViewState(isLoading = false, isError = true)
            }
        )

    override fun onIntent(intent: ViewState.Intents) {
        when (intent) {
            ViewState.Intents.Refresh -&gt; {
                viewModelScope.launch {
                    refreshListener.emit(ViewState.StateTriggers.Refresh)
                }
            }

            is ViewState.Intents.ToggleEmailVisibility -&gt; {
                viewModelScope.launch {
                    refreshListener.emit(ViewState.StateTriggers.EmailVisibilityChanged(intent.isEmailVisible))
                }
            }
        }
    }

    companion object {
        fun factory() = provideFactory { UserAccountDetailsViewModel() }
    }
}
</code></pre>

<p>æ­¤æ¨¡å¼æä¾›æ™ºèƒ½ç¼“å­˜â€”â€”å³ä½¿åœ¨ 5 ç§’è¶…æ—¶åï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©æ˜¯å¦é‡æ–°è·å–æ•°æ®ï¼š</p>

<ul>
<li><strong>æ˜‚è´µçš„ API è°ƒç”¨</strong>ï¼šåœ¨ ViewModel ä¸­ç¼“å­˜æ•°æ®ä»¥å‡å°‘ç½‘ç»œå¼€é”€</li>
<li><strong>é™æ€åç«¯æ•°æ®</strong>ï¼šé¿å…å¯¹å¾ˆå°‘æ›´æ”¹çš„ä¿¡æ¯è¿›è¡Œä¸å¿…è¦çš„è¯·æ±‚</li>
<li><strong>å®æ—¶éœ€æ±‚</strong>ï¼šå¼ºåˆ¶åˆ·æ–°éœ€è¦æ›´æ–°æ•°æ®çš„åº”ç”¨ç¨‹åº</li>
</ul>


<h3>åˆ›å»ºå¯å¤ç”¨çš„æŠ½è±¡</h3>

<p>é‡å¤ç¼–å†™æ­¤æ¨¡å¼ä¼šå˜å¾—éå¸¸ç¹çã€‚è®©æˆ‘ä»¬ä» ViewModel æ‰©å±•å‡½æ•°å¼€å§‹ï¼Œåˆ›å»ºå¯å¤ç”¨çš„æŠ½è±¡ï¼š</p>

<pre><code class="kotlin">fun &lt;T, R&gt; ViewModel.loadData(
    initialState: T,
    loadData: suspend FlowCollector&lt;T&gt;.(currentState: T) -&gt; Unit,
    refreshMechanism: SharedFlow&lt;R&gt;? = null,
    timeout: Long = 5_000,
    refreshData: (suspend FlowCollector&lt;T&gt;.(currentState: T, refreshParams: R) -&gt; Unit)? = null,
): StateFlow&lt;T&gt; {

    if (refreshMechanism != null) {
        requireNotNull(refreshData) {
            "You've provided a refresh mechanism but no way to refresh the data"
        }
    }

    if (refreshData != null) {
        requireNotNull(refreshMechanism) {
            "You've provided a refresh data but no mechanism to refresh the data"
        }
    }

    var latestValue = initialState

    return flow {
        emit(latestValue)

        loadData(latestValue)

        refreshMechanism?.collect { refreshParams -&gt;
            if (refreshData != null) {
                refreshData(latestValue, refreshParams)
            }
        }
    }
        .distinctUntilChanged()
        .onEach {
            latestValue = it
        }
        .stateIn(
            scope = viewModelScope,
            started = SharingStarted.WhileSubscribed(timeout),
            initialValue = initialState
        )
}

fun &lt;T&gt; ViewModel.loadData(
    initialState: T,
    loadData: suspend FlowCollector&lt;T&gt;.(currentState: T) -&gt; Unit,
    timeout: Long = 5_000,
): StateFlow&lt;T&gt; {
    var latestValue = initialState

    return flow {
        emit(latestValue)
        loadData(latestValue)
    }
        .onEach {
            latestValue = it
        }
        .distinctUntilChanged()
        .stateIn(
            scope = viewModelScope,
            started = SharingStarted.WhileSubscribed(timeout),
            initialValue = initialState
        )
}
</code></pre>

<p>æœ‰äº†æˆ‘ä»¬æŠ½è±¡çš„æ‰©å±•å‡½æ•°ï¼ŒViewModel å˜å¾—æ›´åŠ ç®€æ´ï¼š</p>

<p><em>æ³¨æ„ï¼šæ­¤æŠ½è±¡æ¶µç›–äº† 90% çš„å¸¸è§ç”¨ä¾‹ï¼Œä½†ä¸æ”¯æŒå¤æ‚çš„æµç¨‹é“¾å¼æ“ä½œ</em></p>

<pre><code class="kotlin">internal class UserAccountDetailsViewModel private constructor(
    private val getUserDetailsUseCase: GetUserDetailsUseCase = GetUserDetailsUseCase.create(),
) : ViewModel(), IntentAware&lt;UserAccountDetailsViewModel.ViewState.Intents&gt; {
    data class ViewState(
        val isLoading: Boolean = false,
        val isError: Boolean = false,
        val isEmailVisible: Boolean = false,
        val userInfo: UserInfo? = null
    ) {
        val isDataLoaded get() = userInfo != null

        data class UserInfo(
            val displayEmail: String,
            val avatarUrl: String?,
            val showPremiumBadge: Boolean,
            val memberSince: String?
        )

        sealed class Intents {
            data object Refresh : Intents()
            data class ToggleEmailVisibility(val isEmailVisible: Boolean) : Intents()
        }

        sealed class StateTriggers {
            data class EmailVisibilityChanged(val isEmailVisible: Boolean) : StateTriggers()
            data object Refresh : StateTriggers()
        }
    }

    private val refreshListener = MutableSharedFlow&lt;ViewState.StateTriggers&gt;()

    val userDetails = loadData(
        initialState = ViewState(isLoading = true, isError = false),
        loadData = { currentState -&gt;
            if (currentState.isDataLoaded.not() || currentState.isError.not()) {
                emit(getUserDetailsState())
            }
        },
        refreshMechanism = refreshListener,
        refreshData = { currentState, refreshParams -&gt;
            when (refreshParams) {
                is ViewState.StateTriggers.EmailVisibilityChanged -&gt; {
                    emit(currentState.copy(isEmailVisible = refreshParams.isEmailVisible))
                }

                ViewState.StateTriggers.Refresh -&gt; {
                    emit(ViewState(isLoading = true, isError = false))
                    emit(getUserDetailsState())
                }
            }
        }
    )

    private suspend fun getUserDetailsState(): ViewState = getUserDetailsUseCase.execute()
        .fold(
            onSuccess = {
                ViewState(
                    isLoading = false,
                    isError = false,
                    userInfo = ViewState.UserInfo(
                        displayEmail = it.email,
                        avatarUrl = it.avatarUrl,
                        showPremiumBadge = it.isPremium,
                        memberSince = it.creationDate?.toString()
                    )
                )
            },

            onFailure = {
                ViewState(isLoading = false, isError = true)
            }
        )

    override fun onIntent(intent: ViewState.Intents) {
        when (intent) {
            ViewState.Intents.Refresh -&gt; {
                viewModelScope.launch {
                    refreshListener.emit(ViewState.StateTriggers.Refresh)
                }
            }

            is ViewState.Intents.ToggleEmailVisibility -&gt; {
                viewModelScope.launch {
                    refreshListener.emit(ViewState.StateTriggers.EmailVisibilityChanged(intent.isEmailVisible))
                }
            }
        }
    }

    companion object {
        fun factory() = provideFactory { UserAccountDetailsViewModel() }
    }
}
</code></pre>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºæ›´å¤æ‚çš„åŸºç±»æ¥æ¶ˆé™¤é‡å¤çš„ <code>refreshListener</code> å£°æ˜ï¼š</p>

<pre><code class="kotlin">abstract class ViewModelLoader&lt;State : Any, Intent : Any, Trigger : Any&gt; : ViewModel() {
    private val _trigger by lazy { MutableSharedFlow&lt;Trigger&gt;() }

    fun &lt;T&gt; loadData(
        initialState: T,
        loadData: suspend FlowCollector&lt;T&gt;.(currentState: T) -&gt; Unit,
        triggerData: (suspend FlowCollector&lt;T&gt;.(currentState: T, triggerParams: Trigger) -&gt; Unit)? = null,
        timeout: Long = 5000L, //matching ANR timeout in Android
    ): StateFlow&lt;T&gt; {
        var latestValue = initialState

        return flow {
            emit(latestValue)

            loadData(latestValue)

            if (triggerData != null) {
                _trigger.collect { triggerParams -&gt;
                    triggerData(this, latestValue, triggerParams)
                }
            }
        }
            .distinctUntilChanged()
            .onEach {
                latestValue = it
            }

            .stateIn(
                scope = viewModelScope,
                started = SharingStarted.WhileSubscribed(timeout),
                initialValue = initialState
            )
    }

    abstract val state: StateFlow&lt;State&gt;

    val currentState get() = state.value

    open fun onIntent(intent: Intent) {}

    protected fun sendTrigger(trigger: Trigger) {
        viewModelScope.launch {
            _trigger.emit(trigger)
        }
    }
}
</code></pre>

<p>æˆ‘ä»¬çš„æœ€ç»ˆå®ç°å°†å˜å¾—éå¸¸ç®€æ´ä¸”æ˜“äºç»´æŠ¤ï¼š</p>

<pre><code class="kotlin">internal class UserAccountDetailsViewModel private constructor(
    private val getUserDetailsUseCase: GetUserDetailsUseCase = GetUserDetailsUseCase.create(),
) : ViewModelLoader&lt;UserAccountDetailsViewModel.ViewState, UserAccountDetailsViewModel.ViewState.Intents, UserAccountDetailsViewModel.ViewState.StateTriggers&gt;() {
    data class ViewState(
        val isLoading: Boolean = false,
        val isError: Boolean = false,
        val isEmailVisible: Boolean = false,
        val userInfo: UserInfo? = null
    ) {
        val isDataLoaded get() = userInfo != null

        data class UserInfo(
            val displayEmail: String,
            val avatarUrl: String?,
            val showPremiumBadge: Boolean,
            val memberSince: String?
        )

        sealed class Intents {
            data object Refresh : Intents()
            data class ToggleEmailVisibility(val isEmailVisible: Boolean) : Intents()
        }

        sealed class StateTriggers {
            data class EmailVisibilityChanged(val isEmailVisible: Boolean) : StateTriggers()
            data object Refresh : StateTriggers()
        }
    }

    override val state = loadData(
        initialState = ViewState(isLoading = true, isError = false),
        loadData = { currentState -&gt;
            if (currentState.isDataLoaded.not() || currentState.isError.not()) {
                emit(getUserDetailsState())
            }
        },

        triggerData = { currentState, refreshParams -&gt;
            when (refreshParams) {
                is ViewState.StateTriggers.EmailVisibilityChanged -&gt; {
                    emit(currentState.copy(isEmailVisible = refreshParams.isEmailVisible))
                }

                ViewState.StateTriggers.Refresh -&gt; {
                    emit(ViewState(isLoading = true, isError = false))
                    emit(getUserDetailsState())
                }
            }
        }
    )

    private suspend fun getUserDetailsState(): ViewState = getUserDetailsUseCase.execute()

        .fold(
            onSuccess = {
                ViewState(
                    isLoading = false,
                    isError = false,
                    userInfo = ViewState.UserInfo(
                        displayEmail = it.email,
                        avatarUrl = it.avatarUrl,
                        showPremiumBadge = it.isPremium,
                        memberSince = it.creationDate?.toString()
                    )
                )
            },

            onFailure = {
                ViewState(isLoading = false, isError = true)
            }
        )

    override fun onIntent(intent: ViewState.Intents) {
        when (intent) {
            ViewState.Intents.Refresh -&gt; {
                sendTrigger(ViewState.StateTriggers.Refresh)
            }

            is ViewState.Intents.ToggleEmailVisibility -&gt; {
                sendTrigger(ViewState.StateTriggers.EmailVisibilityChanged(intent.isEmailVisible))
            }
        }
    }

    companion object {
        fun factory() = provideFactory { UserAccountDetailsViewModel() }
    }
}
</code></pre>

<h3>å¤„ç† UI çŠ¶æ€å¤æ‚æ€§</h3>

<p>æ­¤æŠ½è±¡ä½¿ç”¨å¸ƒå°”æ ‡å¿—ï¼ˆ<code>isLoading</code>ã€<code>isError</code>ï¼‰ï¼Œè¿™äº›æ ‡å¿—å¯èƒ½ä¼šåˆ›å»ºæ¨¡ç³ŠçŠ¶æ€ã€‚ä¸ºäº†æ›´æ¸…æ™°åœ°ç®¡ç†çŠ¶æ€ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¯†å°ç±»ï¼š</p>

<pre><code class="kotlin">@Immutable
sealed interface UIState {
    @Immutable
    data object Success : UIState
    @Immutable
    data object Error : UIState
    @Immutable
    data object Idle : UIState
    @Immutable
    data object Loading : UIState
}
</code></pre>

<p>å¯¹äºéœ€è¦åŒæ—¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼ˆä¾‹å¦‚ Snackbarsï¼‰å’Œç°æœ‰æ•°æ®çš„åœºæ™¯ï¼Œä½ å¯ä»¥åˆ›å»ºæ›´å¤æ‚çš„çŠ¶æ€æŒæœ‰è€…ï¼š</p>

<pre><code class="kotlin">@Immutable
data class UIStateHolder&lt;out T&gt;(
    val uiState: UIState = UIState.Idle,
    val payload: T? = null
)
</code></pre>

<p>è¿™ç§æ–¹æ³•å¯ä»¥å®ç°çµæ´»çš„ UI çŠ¶æ€ç®¡ç†ï¼ŒåŒæ—¶ä¿æŒ UI çŠ¶æ€å’Œæ•°æ®è´Ÿè½½ä¹‹é—´çš„æ˜ç¡®åˆ†ç¦»ï¼Œä½†å¯èƒ½ä¼šå¢åŠ è®¤çŸ¥è´Ÿè·ï¼Œå¹¶å¼•å…¥æ›´å¤šçš„æ˜ å°„è¡Œä¸ºå’Œè§£åŒ…é€»è¾‘ã€‚</p>

<h3>è¶…è¶Š ViewModel</h3>

<p>æ­¤æ¨¡å¼ä¸ä»…é™äº ViewModelã€‚é€šè¿‡æä¾›è‡ªå®šä¹‰åç¨‹ä½œç”¨åŸŸï¼Œä½ å¯ä»¥åœ¨ä»»ä½•ç»„ä»¶ï¼ˆå¯ç»„åˆç»„ä»¶ã€å­˜å‚¨åº“æˆ–ä¸šåŠ¡é€»è¾‘å±‚ï¼‰ä¸­ä½¿ç”¨æ­¤æ•°æ®åŠ è½½æ–¹æ³•ã€‚</p>

<h2>æµç»„åˆæ¨¡å¼</h2>

<p>è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹è¿˜åœ¨äºå¯ä»¥ç»„åˆå¤šä¸ªæ•°æ®æºã€‚ä»¥ä¸‹æ˜¯å¤„ç†å•æµå’ŒåŒæµçš„ç¤ºä¾‹ï¼š</p>

<pre><code class="kotlin">inline fun &lt;reified T, R&gt; ViewModel.loadFlow(
    initialState: R,
    flow: Flow&lt;T&gt;,
    crossinline transform: suspend CoroutineScope.(newValue: T, currentState: R) -&gt; R,
    timeout: Long = 0,
): StateFlow&lt;R&gt; {

    var latestValue = initialState

    return flow
        .map { newValue -&gt;
            coroutineScope {
                transform(newValue, latestValue)
            }
        }

        .onEach {
            latestValue = it
        }.stateIn(
            scope = viewModelScope,
            started = SharingStarted.WhileSubscribed(timeout),
            initialValue = latestValue
        )
}
</code></pre>

<p>ç»„åˆåŒæµçš„ç¤ºä¾‹ï¼š</p>

<pre><code class="kotlin">inline fun &lt;reified T1, reified T2, R&gt; ViewModel.loadFlow(
    initialState: R,
    flow1: Flow&lt;T1&gt;,
    flow2: Flow&lt;T2&gt;,
    crossinline transform: suspend CoroutineScope.(newValue1: T1, newValue2: T2, currentState: R) -&gt; R,
    timeout: Long = 0,
): StateFlow&lt;R&gt; {

    var latestValue = initialState

    return combine(flow1, flow2) { value1, value2 -&gt;
        coroutineScope {
            transform(value1, value2, latestValue)
        }
    }
        .onEach {
            latestValue = it
        }.stateIn(
            scope = viewModelScope,
            started = SharingStarted.WhileSubscribed(timeout),
            initialValue = latestValue
        )
}
</code></pre>

<p>è¿™äº›æ‰©å±•å…è®¸ä½ è½»æ¾ç»„åˆå¤šä¸ªæ•°æ®æºï¼ŒåŒæ—¶ä¿æŒç›¸åŒçš„æ™ºèƒ½ç¼“å­˜å’ŒçŠ¶æ€ç®¡ç†åŸåˆ™ã€‚</p>

<h3>æµ‹è¯•åŸºäºæµçš„ ViewModel</h3>

<p>åœ¨ç»“æŸä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ¢ç´¢å¦‚ä½•ä½¿ç”¨ fakes å’Œ Turbine è¿›è¡Œæµæµ‹è¯•ï¼Œæ­£ç¡®åœ°æµ‹è¯•æˆ‘ä»¬çš„ <code>UserAccountDetailsViewModel</code> å®ç°ã€‚</p>

<h4>ä½¿ç”¨ Fakes å’Œ Turbine è®¾ç½®æµ‹è¯•ä¾èµ–é¡¹</h4>

<pre><code class="kotlin">@OptIn(ExperimentalCoroutinesApi::class)
class UserAccountDetailsViewModelTest {
    private val testDispatcher = StandardTestDispatcher()

    private val fakeGetUserDetailsUseCase = FakeGetUserDetailsUseCase()

    private lateinit var viewModel: UserAccountDetailsViewModel

    @Before
    fun setUp() {
        Dispatchers.setMain(testDispatcher)
        viewModel = UserAccountDetailsViewModel(fakeGetUserDetailsUseCase)
    }

    @After
    fun tearDown() {
        Dispatchers.resetMain()
    }
}

// Fake implementation for realistic testing, this sounds funny to write haha
class FakeGetUserDetailsUseCase {
    private var shouldReturnError = false

    private var userDetailsToReturn: UserDetails? = null

    private var executionCount = 0

    fun setSuccessResponse(userDetails: UserDetails) {
        this.userDetailsToReturn = userDetails
        this.shouldReturnError = false
    }

    fun setErrorResponse() {
        this.shouldReturnError = true
        this.userDetailsToReturn = null
    }

    // Expose execution count when testing caching/performance behavior
    fun getExecutionCount() = executionCount

    fun reset() {
        executionCount = 0
    }

    suspend fun execute(): Result&lt;UserDetails&gt; {
        executionCount++

        delay(50) // Simulate network delay

        return if (shouldReturnError) {
            Result.failure(Exception("Network error"))
        } else {
            Result.success(userDetailsToReturn ?: createDefaultUserDetails())
        }
    }

    private fun createDefaultUserDetails() = UserDetails(
        email = "default@example.com",
        avatarUrl = null,
        isPremium = false,
        creationDate = "2023-01-01"
    )
}
</code></pre>

<h4>æˆåŠŸå’Œå¤±è´¥åœºæ™¯çš„å‚æ•°åŒ–æµ‹è¯•</h4>

<pre><code class="kotlin">@ParameterizedTest
@ValueSource(booleans = [true, false])
fun `should handle both success and error scenarios`(shouldSucceed: Boolean) = runTest {
    // Given

    if (shouldSucceed) {
        fakeGetUserDetailsUseCase.setSuccessResponse(
            UserDetails(
                email = "success@example.com",
                avatarUrl = "https://avatar.url",
                isPremium = true,
                creationDate = "2023-01-01"
            )
        )
    } else {
        fakeGetUserDetailsUseCase.setErrorResponse()
    }

    // When

    viewModel.state.test {
        advanceUntilIdle()

        // Then Focus on behavior, not implementation details

        if (shouldSucceed) {
            awaitItem() // Loading state

            val successState = awaitItem()

            assertThat(successState.isLoading).isFalse()

            assertThat(successState.isError).isFalse()

            assertThat(successState.userInfo?.displayEmail).isEqualTo("success@example.com")

            assertThat(successState.userInfo?.showPremiumBadge).isTrue()
        } else {
            awaitItem() // Loading state

            val errorState = awaitItem()

            assertThat(errorState.isLoading).isFalse()

            assertThat(errorState.isError).isTrue()

            assertThat(errorState.userInfo).isNull()
        }
    }
}

@Test
fun `should refresh data when refresh intent is triggered`() = runTest {
    // Given Initial successful load
    fakeGetUserDetailsUseCase.setSuccessResponse(
        UserDetails(
            email = "initial@example.com",
            avatarUrl = null,
            isPremium = false,
            creationDate = "2022-01-01"
        )
    )

    viewModel.state.test {
        advanceUntilIdle()

        awaitItem() // Loading

        val initialState = awaitItem() // Success

        assertThat(initialState.userInfo?.displayEmail).isEqualTo("initial@example.com")

        // Change response and trigger refresh
        fakeGetUserDetailsUseCase.setSuccessResponse(
            UserDetails(
                email = "refreshed@example.com",
                avatarUrl = "https://new-avatar.url",
                isPremium = true,
                creationDate = "2023-01-01"
            )
        )

        viewModel.onIntent(ViewState.Intents.Refresh)

        advanceUntilIdle()

        // Then
        awaitItem() // Loading during refresh

        val refreshedState = awaitItem() // New Success

        assertThat(refreshedState.isLoading).isFalse()

        assertThat(refreshedState.userInfo?.displayEmail).isEqualTo("refreshed@example.com")

        assertThat(refreshedState.userInfo?.showPremiumBadge).isTrue()

        // Verify both initial load and refresh were called
        assertThat(fakeGetUserDetailsUseCase.getExecutionCount()).isEqualTo(2)
    }
}
</code></pre>

<h4>æµ‹è¯•ä»… UI çŠ¶æ€å˜åŒ–</h4>

<pre><code class="kotlin">@Test
fun `should toggle email visibility without triggering data reload`() = runTest {
    // Given Successful initial load
    fakeGetUserDetailsUseCase.setSuccessResponse(
        UserDetails(
            email = "test@example.com",
            avatarUrl = null,
            isPremium = false,
            creationDate = "2023-01-01"
        )
    )

    viewModel.state.test {
        advanceUntilIdle()

        awaitItem() // Loading

        val loadedState = awaitItem() // Success

        assertThat(loadedState.userInfo?.displayEmail).isEqualTo("test@example.com")

        assertThat(loadedState.isEmailVisible).isFalse()

        // When Toggle email visibility

        viewModel.onIntent(ViewState.Intents.ToggleEmailVisibility(isEmailVisible = true))

        advanceUntilIdle()

        // Then
        val toggledState = awaitItem()

        assertThat(toggledState.isEmailVisible).isTrue()

        assertThat(toggledState.userInfo?.displayEmail).isEqualTo("test@example.com")

        assertThat(fakeGetUserDetailsUseCase.getExecutionCount()).isEqualTo(1)
    }
}
</code></pre>

<h4>æµ‹è¯•æ•°æ®ç¼“å­˜è¡Œä¸º</h4>

<pre><code class="kotlin">@Test
fun `should use cached data when returning to screen quickly`() = runTest {
    // Given

    fakeGetUserDetailsUseCase.setSuccessResponse(
        UserDetails(
            email = "cached@example.com",
            avatarUrl = null,
            isPremium = true,
            creationDate = "2023-01-01"
        )
    )

    // When First collection

    viewModel.state.test {
        advanceUntilIdle()

        awaitItem() // Loading

        val firstState = awaitItem() // Success

        assertThat(firstState.userInfo?.displayEmail).isEqualTo("cached@example.com")

        cancel() // Simulate leaving screen
    }

    // When Quick return (simulating navigation back within timeout)

    viewModel.state.test {
        advanceUntilIdle()

        // Then Should have cached data immediately (no Loadin)

        val cachedState = awaitItem()

        assertThat(cachedState.isLoading).isFalse()

        assertThat(cachedState.userInfo?.displayEmail).isEqualTo("cached@example.com")

        expectNoEvents()
    }

    assertThat(fakeGetUserDetailsUseCase.getExecutionCount()).isEqualTo(1)
}
</code></pre>

<h4>æµ‹è¯•é”™è¯¯æ¢å¤</h4>

<pre><code class="kotlin">@Test
fun `should recover from Error on successful refresh`() = runTest {
    // Given Initial error

    fakeGetUserDetailsUseCase.setErrorResponse()

    viewModel.state.test {
        advanceUntilIdle()

        awaitItem() // Loading

        val errorState = awaitItem() // Error

        assertThat(errorState.isError).isTrue()

        // When Fix the response and refresh

        fakeGetUserDetailsUseCase.setSuccessResponse(
            UserDetails(
                email = "recovered@example.com",
                avatarUrl = null,
                isPremium = false,
                creationDate = "2023-01-01"
            )
        )

        viewModel.onIntent(ViewState.Intents.Refresh)

        advanceUntilIdle()

        // Then Should recover successfully

        awaitItem() // Loading during refresh

        val recoveredState = awaitItem() // Success

        assertThat(recoveredState.isError).isFalse()

        assertThat(recoveredState.userInfo?.displayEmail).isEqualTo("recovered@example.com")

        assertThat(fakeGetUserDetailsUseCase.getExecutionCount()).isEqualTo(2)
    }
}
</code></pre>

<h3>ä¸ºä»€ä¹ˆè¦æµ‹è¯•åŸºäºæµçš„ ViewModel çš„åŸåˆ™</h3>

<p>å“¦â€¦â€¦è¿™å¯èƒ½ä¼šå¼•å‘ä¸€äº›äº‰è®ºï¼Œä½†è¿™é‡Œæœ‰ä¸€ç¯‡å¾ˆæ£’çš„æ–‡ç« ï¼Œå®ƒæä¾›äº†æ›´å¥½çš„æè¿°ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“æœ¬æ–‡å…³äºæˆ‘ä¸ºä»€ä¹ˆä½¿ç”¨ Fakes çš„ç›®çš„ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç®€çŸ­çš„æ€»ç»“ï¼Œå¯ä»¥è¡¥å……æ–‡ç« é¡¶éƒ¨</p>

<ol>
<li><strong>ä½¿ç”¨ Fakes è€Œé Mocks</strong>ï¼šFake æä¾›é€¼çœŸçš„è¡Œä¸ºï¼Œå¹¶ä¸”æ›´æ˜“äºç»´æŠ¤ï¼Œå°¤å…¶æ˜¯åœ¨å¦‚ä»Š LLM çš„å¸®åŠ©ä¸‹â€¦â€¦</li>
<li><strong>å‚æ•°åŒ–æµ‹è¯•</strong>ï¼šç”¨ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹åŒæ—¶æµ‹è¯•æˆåŠŸå’Œå¤±è´¥è·¯å¾„</li>
<li><strong>ä½¿ç”¨ Turbine è¿›è¡Œæµç¨‹æµ‹è¯•</strong>ï¼šç®€æ´ã€å¯Œæœ‰è¡¨ç°åŠ›çš„æµç¨‹æµ‹è¯•ï¼Œå¹¶è¿›è¡Œé€‚å½“çš„çŠ¶æ€éªŒè¯</li>
<li><strong>æµ‹è¯•çŠ¶æ€è½¬æ¢</strong>ï¼šéªŒè¯å®Œæ•´çš„çŠ¶æ€æµç¨‹ï¼Œè€Œä¸ä»…ä»…æ˜¯æœ€ç»ˆçŠ¶æ€</li>
<li><strong>è°¨æ…æ‰§è¡Œè®¡æ•°</strong>ï¼šä»…åœ¨æµ‹è¯•ç¼“å­˜ã€æ€§èƒ½æˆ–é‡è¯•è¡Œä¸ºæ—¶éªŒè¯è°ƒç”¨è®¡æ•°</li>
<li><strong>å…³æ³¨è¡Œä¸º</strong>ï¼šæµ‹è¯•ç”¨æˆ·ä½“éªŒï¼Œè€Œä¸æ˜¯å®ç°ç»†èŠ‚ï¼ˆæˆ‘æƒ³è¿™ä¸€ç‚¹æ˜¾è€Œæ˜“è§ï¼‰</li>
</ol>


<h3>ç»“è®º</h3>

<p>æœ¬æ–‡å¯¹ Android ViewModel ä¸­åŸºäºæµç¨‹çš„æ•°æ®åŠ è½½çš„æ¢ç´¢ï¼Œè§£å†³äº†ä¼ ç»Ÿ <code>init {}</code> å—æ–¹æ³•çš„æ ¹æœ¬æŒ‘æˆ˜ã€‚è™½ç„¶æ¶µç›–æ‰€æœ‰æ¶æ„å˜ä½“ä¼šå¾ˆç¹çï¼Œä½†è¯¥æ¨¡å¼æˆåŠŸå¤„ç†äº†å¤§çº¦ 90% çš„å¸¸è§ç”¨ä¾‹ã€‚</p>

<p>æŠ½è±¡åŸºç±»æ–¹æ³•ï¼ˆ<code>ViewModelLoader</code>ï¼‰æä¾›äº†æœ€å¯é¢„æµ‹å’Œå¯ç»´æŠ¤çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒæä¾›ï¼š</p>

<ul>
<li><strong>å¯é¢„æµ‹çš„çŠ¶æ€ç®¡ç†</strong>ï¼šæ¸…æ™°çš„çŠ¶æ€è§¦å‘å™¨å’Œæ„å›¾å¤„ç†</li>
<li><strong>å†…ç½®æµ‹è¯•æ”¯æŒ</strong>ï¼šå…·æœ‰é€‚å½“åç¨‹å¤„ç†çš„å¯æµ‹è¯•æ¶æ„</li>
<li><strong>çµæ´»æ€§</strong>ï¼šæ˜“äºæ‰©å±•æ•ˆæœå’Œæ··åˆ MVI æ¨¡å¼</li>
<li><strong>ç¼“å­˜å’Œåˆ·æ–°</strong>ï¼šç¼“å­˜å’Œåˆ·æ–°æœºåˆ¶ï¼ˆæœ¬æ–‡å°†å°½å¯èƒ½è¯¦ç»†åœ°ä»‹ç»ï¼‰</li>
</ul>


<h3>å…³é”®è¦ç‚¹</h3>

<ol>
<li><strong>åŸºäºæµçš„åŠ è½½</strong>æ¶ˆé™¤äº†ç«äº‰æ¡ä»¶ï¼Œæé«˜äº†æµ‹è¯•çš„ç®€æ˜“æ€§ï¼Œå¹¶è§£å†³äº† <code>init {}</code> å—ä¸­å›ºæœ‰çš„å›æ ˆé—®é¢˜</li>
<li><strong>å…·æœ‰é€‚å½“å…±äº«ç­–ç•¥çš„ StateFlow</strong> æä¾›äº†æœ€ä½³çš„ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥æ•°æ®ç®¡ç†</li>
<li><strong>æŠ½è±¡å±‚</strong>å‡å°‘äº†æ ·æ¿ä»£ç ï¼ŒåŒæ—¶ä¿æŒäº†çµæ´»æ€§</li>
<li><strong>å…¨é¢çš„æµ‹è¯•</strong>ç¡®ä¿æ‰€æœ‰ç”¨ä¾‹çš„å¯é æ€§</li>
</ol>


<p>è¯·è®°ä½ï¼Œè¿™åªæ˜¯ä¼—å¤šæ¶æ„æ–¹æ³•ä¸­çš„ä¸€ç§ï¼Œå®ƒè§£å†³äº†æˆ‘çš„é—®é¢˜ï¼Œä½†å¯èƒ½æ— æ³•è§£å†³ä½ çš„é—®é¢˜ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯äº†è§£æ½œåœ¨é—®é¢˜å¹¶è¯„ä¼°æ­¤è§£å†³æ–¹æ¡ˆæ˜¯å¦ç¬¦åˆä½ çš„ç‰¹å®šéœ€æ±‚ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆå°†ç»å†è®¸å¤šå˜åŒ–ï¼Œç”šè‡³å¯èƒ½è¢«æ·˜æ±°ã€‚æœ€è¿‘ï¼Œæˆ‘æ›´å¤šåœ°æŠ•å…¥åˆ°ä½¿ç”¨ Ktor è¿›è¡Œåç«¯å¼€å‘ï¼Œè¿™æœ¬èº«å°±æ˜¯ä¸€æ¬¡å¾ˆæ£’çš„ä½“éªŒã€‚</p>

<p>è¯¥æ¶æ„æˆåŠŸåœ°ä¸º iOS å’Œ Android å¹³å°ä¸Šçš„ <a href="https://wallhub.app/">WallHub</a> æä¾›äº†æ”¯æŒï¼Œè¯æ˜äº†å…¶åœ¨ç°å®ä¸–ç•Œä¸­çš„â€œå¯è¡Œæ€§â€ä»¥åŠè·¨å¹³å°é€‚åº”æ€§ï¼ˆå¦‚æœå¯ä»¥è¿™ä¹ˆè¯´çš„è¯ï¼‰ã€‚</p>

<p>ç»§ç»­æ½œæ°´ï¼Œç›´åˆ°ä¸‹ä¸€ç¯‡æ–‡ç« â€¦â€¦</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Androidåº”ç”¨çš„æ¶æ„æ¼”è¿›]]></title>
    <link href="https://alexhilton.github.io/blog/2025/09/13/architectual-evolution-of-an-android-app/"/>
    <updated>2025-09-13T20:34:01+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/09/13/architectual-evolution-of-an-android-app</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ªã€ŒArchitectural Evolution of and Android appã€ï¼ŒåŸæ–‡é“¾æ¥<a href="https://herrbert74.github.io/posts/architectural-evolution-of-an-app/">https://herrbert74.github.io/posts/architectural-evolution-of-an-app/</a>ï¼Œç”±Zsolt Bertalanå‘å¸ƒäº20258æœˆ19æ—¥ã€‚</p></blockquote>

<p><a href=""><img src="https://herrbert74.github.io/assets/img/posts/20250818_arch_evolution.jpg" title="auto auto" ></a></p>

<!-- more -->


<p>æœ¬æ–‡å°†è§£é‡Š Android åº”ç”¨åœ¨å‘å±•è¿‡ç¨‹ä¸­å¯èƒ½ç»å†çš„å„ä¸ªé˜¶æ®µã€‚ä¸åŒçš„æ¶æ„å¯èƒ½çœ‹èµ·æ¥æˆªç„¶ä¸åŒï¼ˆæ›´ä¸ç”¨è¯´å¯¹ç»†èŠ‚çš„ä¸åŒçœ‹æ³•ï¼‰ï¼Œä½†å…¶èƒŒåçš„ç†å¿µæ˜¯ç›¸åŒçš„ã€‚æˆ‘å°†é€šè¿‡æ•´æ´æ¶æ„ (Clean Architecture) å’Œæˆ‘çš„ <a href="https://github.com/herrbert74/FlickSlate">FlickSlate</a> ä»£ç åº“ï¼ˆé“¾æ¥ï¼š<a href="https://github.com/herrbert74/FlickSlate%EF%BC%89%E6%9D%A5%E8%A7%A3%E9%87%8A%E8%BF%99%E4%B8%80%E7%82%B9%E3%80%82">https://github.com/herrbert74/FlickSlate%EF%BC%89%E6%9D%A5%E8%A7%A3%E9%87%8A%E8%BF%99%E4%B8%80%E7%82%B9%E3%80%82</a></p>

<p>æˆ‘è¿˜æƒ³ä»‹ç»ä¸€ä¸‹å¤§å‹åº”ç”¨ä¸­çš„å¸¸è§æ¨¡å¼ï¼š<strong>è¶…çº§å±‚</strong> å’Œ <strong>åŠŸèƒ½ç»„</strong>ã€‚æ¯å½“æˆ‘å¼€å‘çš„åº”ç”¨è¾¾åˆ°ä¸€å®šè§„æ¨¡æ—¶ï¼Œéƒ½ä¼šç”¨åˆ°è¿™äº›æ¨¡å¼ï¼Œä½†æˆ‘ä»æœªåˆ¶å®šè¿‡ç›¸å…³çš„åŸºæœ¬è§„åˆ™ã€‚æˆ‘å¸Œæœ›æŠŠå®ƒä»¬å†™ä¸‹æ¥ï¼Œèƒ½è®©æˆ‘å’Œå…¶ä»–äººæ›´å®¹æ˜“ç†è§£ã€‚</p>

<h3>è¶…çº§å±‚</h3>

<p>ä½ å¯èƒ½è¿˜è®°å¾—æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼Œæˆ‘çš„åº”ç”¨æœ‰ä¸€ä¸ªç‹¬ç«‹çš„<strong>é¢†åŸŸå±‚</strong>ï¼Œ<strong>æ•°æ®å±‚å’Œå±•ç°å±‚ï¼ˆä»ç°åœ¨å¼€å§‹æ˜¯UIå±‚ï¼‰</strong>éƒ½ä¾èµ–äºå®ƒã€‚è¿™äº›æ˜¯åŸºæœ¬çš„æ°´å¹³å±‚ã€‚åŒ…å«å®ƒä»¬çš„å‚ç›´å±‚ä¹Ÿç§°ä¸ºåŠŸèƒ½å±‚ã€‚</p>

<p>æˆ‘åˆ›é€ äº† <strong>â€œè¶…çº§å±‚â€</strong> è¿™ä¸ªæœ¯è¯­ï¼Œæ˜¯ä¸ºäº†åœ¨åŸºæœ¬æ°´å¹³å±‚ä¹‹ä¸Šå¼•å…¥ä¸€ä¸ªæ›´å¹¿æ³›çš„å±‚æ¬¡ç»“æ„ã€‚æˆ‘ä»¬éœ€è¦å®ƒä»¬ï¼Œå› ä¸ºæ°´å¹³å±‚çš„èŒƒå›´å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¸ä»…å¯ä»¥æ¶µç›–åŠŸèƒ½å±‚ï¼Œè¿˜å¯ä»¥æ¶µç›–æ›´å¹¿æ³›çš„èŒƒå›´ã€‚æˆ‘å°†å®šä¹‰<strong>åŠŸèƒ½å±‚</strong>ã€<strong>åŠŸèƒ½ç»„</strong>ã€<strong>åº”ç”¨çº§ï¼ˆå…±äº«ï¼‰</strong>å’Œ<strong>å¤šåº”ç”¨çº§ï¼ˆåŸºç¡€ï¼‰</strong> è¶…çº§å±‚ã€‚</p>

<p>è¯·å‚é˜…ä¸‹å›¾ã€‚</p>

<p><img src="file:///Users/alexhilton/Downloads/arch-envolve-1.png" alt="" /></p>

<p>åœ¨æˆ‘ä¸Šé¢è§£é‡Šçš„åŸºæœ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœ‰<strong>åŠŸèƒ½å±‚</strong>ï¼Œå…¶ä¸­æ•´æ´æ¶æ„å±‚ä»…åœ¨åŠŸèƒ½å±‚å†…éƒ¨å¯è§ã€‚</p>

<p>æ¥ä¸‹æ¥ï¼Œ<strong>åŠŸèƒ½ç»„</strong>å±‚æ˜¯ä»‹äºåº”ç”¨èŒƒå›´å±‚å’ŒåŠŸèƒ½èŒƒå›´å±‚ä¹‹é—´çš„ä¸­é—´å±‚ã€‚ç”±äºå®ƒæ˜¯å¯¹è¶…çº§å±‚çš„æœ€åä¸”æœ€ä¸æ˜æ˜¾çš„è¡¥å……ï¼Œæˆ‘å°†åœ¨ç¨åè¯¦ç»†è®¨è®ºã€‚</p>

<p><strong>å…±äº«ã€é€šç”¨æˆ–åº”ç”¨èŒƒå›´å±‚</strong>é€šå¸¸åŒ…å«ä¸ä¸šåŠ¡ç›¸å…³æˆ–æ•´ä¸ªåº”ç”¨ç‹¬æœ‰çš„ç±»ã€‚è¿™æ˜¯å¯ä»¥æ·»åŠ é¢†åŸŸã€æ•°æ®å’Œ UI æ¨¡å—çš„æœ€ä½å±‚ã€‚</p>

<p><strong>åŸºç¡€å±‚ã€åŸºç¡€è®¾æ–½å±‚æˆ–åŸºç¡€ç»“æ„å±‚</strong>å¯ä»¥è·¨å¤šä¸ªåº”ç”¨ä½¿ç”¨ã€‚å®ƒä¸åŒ…å«é¢†åŸŸã€æ•°æ®æˆ– UI å±‚ï¼Œä½†åŒ…å«è¿™äº›å±‚ä¹‹é—´é€šç”¨çš„ç±»ã€‚æˆ‘é€šå¸¸æœ‰ä¸€ä¸ª<strong>Kotlin æ¨¡å—å’Œä¸€ä¸ª Android åŸºç¡€æ¨¡å—</strong>ã€‚æˆ‘åˆ›å»ºäº† <a href="https://bitbucket.org/babestudios/babestudiosbase/src/master/">BaBeStudios-Base</a> åº“é¡¹ç›®ï¼ˆ<a href="https://bitbucket.org/babestudios/babestudiosbase/src/master/%EF%BC%89%EF%BC%8C%E4%BB%A5%E4%BE%BF%E5%9C%A8%E5%A4%9A%E4%B8%AA%E5%BA%94%E7%94%A8%E4%B8%AD%E5%A4%8D%E7%94%A8%E8%BF%99%E4%BA%9B%E6%A8%A1%E5%9D%97%EF%BC%8C%E4%BD%86%E6%88%91%E7%9A%84%E5%BA%94%E7%94%A8%E4%B8%AD%E4%B9%9F%E6%9C%89%E4%B8%80%E4%BA%9B%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%9D%97%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%B0%9A%E6%9C%AA%E5%8C%85%E5%90%AB%E5%9C%A8%E8%AF%A5%E5%BA%93%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E4%BB%A3%E7%A0%81%E3%80%82">https://bitbucket.org/babestudios/babestudiosbase/src/master/%EF%BC%89%EF%BC%8C%E4%BB%A5%E4%BE%BF%E5%9C%A8%E5%A4%9A%E4%B8%AA%E5%BA%94%E7%94%A8%E4%B8%AD%E5%A4%8D%E7%94%A8%E8%BF%99%E4%BA%9B%E6%A8%A1%E5%9D%97%EF%BC%8C%E4%BD%86%E6%88%91%E7%9A%84%E5%BA%94%E7%94%A8%E4%B8%AD%E4%B9%9F%E6%9C%89%E4%B8%80%E4%BA%9B%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%9D%97%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%B0%9A%E6%9C%AA%E5%8C%85%E5%90%AB%E5%9C%A8%E8%AF%A5%E5%BA%93%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E4%BB%A3%E7%A0%81%E3%80%82</a> BaBeStudios-Base ä¹Ÿå¯ä» <a href="https://mvnrepository.com/artifact/io.bitbucket.babestudios">MavenCentral</a> è·å–ï¼Œä½†ç›®å‰å°šæ— ç›¸å…³æ–‡æ¡£ã€‚</p>

<p>éšç€åº”ç”¨ç¨‹åºè§„æ¨¡çš„æ‰©å¤§å’Œæ¨¡å—çš„å¼•å…¥ï¼Œä½ éœ€è¦å¼•å…¥ä¸Šè¿°å„å±‚ã€‚</p>

<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹éšç€åº”ç”¨ç¨‹åºè§„æ¨¡çš„æ‰©å¤§ï¼Œæˆ‘é€šå¸¸é‡‡å–çš„æ¨¡å—åŒ–æ­¥éª¤ã€‚</p>

<h3>æ­¥éª¤ 1ï¼šå•æ¨¡å—</h3>

<p>å½“ä½ ç¡®å®šåº”ç”¨ç¨‹åºè§„æ¨¡ä¸ä¼šè¶…è¿‡<strong>æœ€å¤§è§„æ¨¡</strong>ï¼Œæˆ–è€…æ—¶é—´ç´§è¿«æ—¶ï¼Œä½ å¯ä»¥é€‰æ‹©å•æ¨¡å—åº”ç”¨ç¨‹åºæˆ–å•ä½“åº”ç”¨ã€‚æˆ‘ä¸ç¡®å®šå•æ¨¡å—åº”ç”¨ç¨‹åºçš„æœ€å¤§è§„æ¨¡æ˜¯å¤šå°‘ã€‚è¿™å¯èƒ½å› äººè€Œå¼‚ã€‚</p>

<p>æ­¤æœ€å¤§è§„æ¨¡ä¹Ÿä¸åŒäº<strong>é˜ˆå€¼è§„æ¨¡ï¼Œä½ åº”è¯¥ä»è¯¥é˜ˆå€¼å¼€å§‹æ¨¡å—åŒ–åº”ç”¨ç¨‹åº</strong>ï¼Œæˆ–è€…æ›´é€šä¿—åœ°è¯´ï¼Œä½ åº”è¯¥ä»è¯¥é˜ˆå€¼åˆ‡æ¢åˆ°æµç¨‹çš„ä¸‹ä¸€æ­¥ã€‚æˆ‘è®¤ä¸ºé˜ˆå€¼å¤§å°è¿œå°äºå•æ¨¡å—åº”ç”¨ç¨‹åºçš„æœ€å¤§å¤§å°ï¼Œè¿™æ„å‘³ç€ä½ åº”è¯¥åœ¨è¾¾åˆ°è¯¥é™åˆ¶ä¹‹å‰å°±å¼€å§‹æ¨¡å—åŒ–ã€‚</p>

<p>å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºï¼Œæˆ‘ç”šè‡³å»ºè®®<strong>ä»æ¨¡å—åŒ–å¼€å§‹</strong>ï¼Œè€Œä¸æ˜¯ä»å•ä¸ªæ¨¡å—å¼€å§‹ï¼Œå› ä¸ºä¸æ¥è¿‘é™åˆ¶ï¼ˆæ¯”å¦‚ 10 æˆ– 20 kLOCï¼‰æ—¶æ‰å¼€å§‹æ¨¡å—åŒ–ç›¸æ¯”ï¼Œè¿™æ ·åšçš„å¼€é”€å’Œå¹²æ‰°ç¨‹åº¦è¦å°å¾—å¤šã€‚</p>

<p>è¿™æ˜¯ä¸€ä¸ªå•æ¨¡å—åº”ç”¨ç¨‹åºçš„åŒ…æ ‘ç¤ºä¾‹ã€‚</p>

<pre><code class="bash">â”œâ”€â”€ data
â”‚   â”œâ”€â”€ database
â”‚   â”œâ”€â”€ local
â”‚   â”œâ”€â”€ repository
â”‚   â””â”€â”€ remote
â”œâ”€â”€ domain
â”‚   â”œâ”€â”€ api
â”‚   â”œâ”€â”€ model
â”‚   â””â”€â”€ usecase
â”œâ”€â”€ presentation
â”‚   â”œâ”€â”€ master
â”‚   â””â”€â”€ detail
â””â”€â”€ shared
</code></pre>

<p>ä¸Šé¢å›¾ä¸­çš„å¶å­èŠ‚ç‚¹ä»£è¡¨åŒ…ï¼Œå®ƒä»¬å¯ä»¥åŒ…å«æ­¤å¤„æœªæ˜¾ç¤ºçš„å…¶ä»–åŒ…ã€‚ä¸‹é¢æˆ‘å°†å±•ç¤ºä¸€ä¸ªç±»ä¼¼çš„æ¨¡å—ç»“æ„ï¼Œå…¶ä¸­ä»¥å†’å·å¼€å¤´çš„åç§°ä»£è¡¨æ¨¡å—ï¼ŒåŒå†’å·ä»£è¡¨æ ¹æ¨¡å—ã€‚</p>

<h3>æ­¥éª¤ 2ï¼šç®€å•æ¨¡å—åŒ–</h3>

<p>å¯¹äº<strong>å°å‹åº”ç”¨ç¨‹åº</strong>ï¼Œæˆ‘ä½¿ç”¨ç®€å•æ¨¡å—åŒ–ï¼Œè€Œä¸æ˜¯ä¸‹ä¸€ç« çš„å®Œå…¨æ¨¡å—åŒ–ã€‚è¿™é‡Œæˆ‘ä»¬åªä»‹ç»<strong>æ¯ä¸ªåŠŸèƒ½çš„æ¨¡å—</strong>ã€‚æ¯ä¸ªåŠŸèƒ½å°†åŒ…å«ä¸€ä¸ªé¢†åŸŸæ¨¡å—ï¼Œä»¥åŠä¾èµ–äºé¢†åŸŸæ¨¡å—çš„æ•°æ®å’Œå‘ˆç°æ¨¡å—ï¼ˆåœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼‰ã€‚</p>

<p>æˆ‘ä»¬è¿˜å¼•å…¥äº†ä¸€ä¸ª<strong>å…±äº«æ¨¡å—</strong>ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰åŠŸèƒ½æ¨¡å—çš„é€šç”¨ä»£ç ã€‚</p>

<p>åº”ç”¨ç¨‹åºçš„è¶…å±‚ç”±ä¸€æ¡<strong>æ°´å¹³çº¿</strong>åˆ†éš”ã€‚æ¯ä¸ªå±‚éƒ½ä¾èµ–äºå…¶ä¸‹æ–¹çš„æ‰€æœ‰å±‚ã€‚æ•°æ®å’Œå‘ˆç°ä¾èµ–äºé¢†åŸŸæ¨¡å—ï¼Œä½†è¿™å¹¶æœªåœ¨å›¾ä¸­æ˜¾ç¤ºã€‚</p>

<pre><code class="bash">::feature:Feature A

â”œâ”€â”€ :feature/:featurea/:data
â”œâ”€â”€ :feature/:featurea/:domain 
â””â”€â”€ :feature/:featurea/:presentation  

::feature:Feature B

â”œâ”€â”€ :feature/:featureb/:data
â”œâ”€â”€ :feature/:featureb/:domain
â””â”€â”€ :feature/:featureb/:presentation 

 ::feature:Feature C  

â”œâ”€â”€ :feature/:featurec/:data
â”œâ”€â”€ :feature/:featurec/:domain 
â””â”€â”€ :feature/:featurec/:presentation


::shared:data

â”œâ”€â”€ database
â”œâ”€â”€ local
â”œâ”€â”€ repository
â””â”€â”€ remote

::shared:domain

â”œâ”€â”€ api
â”œâ”€â”€ model
â””â”€â”€ usecase

::shared:presentation

â”œâ”€â”€ compose
â”œâ”€â”€ design
â””â”€â”€ util


::base:kotlin  
</code></pre>

<h3>æ­¥éª¤ 4ï¼šåŠŸèƒ½ç»„</h3>

<p>å½“ä½ çš„åº”ç”¨å®Œå…¨æ¨¡å—åŒ–åï¼Œå…±äº«å±‚ä¼šé€æ¸æˆä¸ºå•ä½“åº”ç”¨ï¼Œå¹¶æˆä¸ºæ„å»ºè¿‡ç¨‹ä¸­çš„<strong>ç“¶é¢ˆ</strong>ã€‚</p>

<p>æˆ‘ç»å¸¸åœ¨è¶…è¿‡ä¸€å®šè§„æ¨¡çš„åº”ç”¨ï¼ˆå¤§çº¦ 50 åˆ° 80 kLOCï¼‰æ—¶é‡åˆ°è¿™ç§æƒ…å†µã€‚ä½ éœ€è¦å…±äº«å¤ªå¤šå†…å®¹ï¼Œå› æ­¤ä½ çš„<strong>å…±äº«é¢†åŸŸæ¨¡å—å’Œå±•ç¤ºæ¨¡å—</strong>å˜å¾—è¿‡å¤§ã€‚ä½ å¼€å§‹æ³¨æ„åˆ°ï¼Œåœ¨æ‰€æœ‰å‚ç›´æ¨¡å—ä¹‹é—´å…±äº«ä»£ç ä¹Ÿæ˜¯ä¸€ç§æµªè´¹ï¼Œå› ä¸ºä½ åªæƒ³åœ¨ä¸¤ä¸ªæˆ–æœ€å¤šä¸‰ä¸ªæˆ–å››ä¸ªæ¨¡å—ä¹‹é—´å…±äº«ä»£ç ã€‚ä½ ä¼šå‘ç°è¶Šæ¥è¶Šå¤šçš„æ–°ä»£ç è¢«æ·»åŠ åˆ°è¿™äº›æ¨¡å—ä¸­ï¼Œè€Œ<strong>å¢é‡ç¼“å­˜</strong>çš„æ•ˆç‡è¶Šæ¥è¶Šä½ï¼Œå› ä¸ºä½ é¢‘ç¹åœ°ä¿®æ”¹ä»£ç ï¼Œå¯¼è‡´å®ƒä»¬å¤±æ•ˆã€‚</p>

<p>ä½ å¯èƒ½ä¼šè¯´ï¼Œå¯ä»¥é€šè¿‡é€‚å½“åœ°é‡æ„å’Œæ„å»ºåº”ç”¨ç¨‹åºï¼Œæˆ–è€…å¤åˆ¶ä¸€äº›ä»£ç æ¥é¿å…è¿™ç§æƒ…å†µï¼Œä½†è¿™å¯èƒ½æ¯”ä½ æƒ³è±¡çš„è¦éš¾ã€‚æˆ‘å‘ç°è¿™äº›å»ºè®®å¹¶æ²¡æœ‰èµ·åˆ°ä»€ä¹ˆå¸®åŠ©ä½œç”¨ã€‚æˆ–è€…ä½ å¯èƒ½æ‰‹å¤´æœ‰ä¸€ä¸ªé—ç•™åº”ç”¨ï¼Œæ²¡æœ‰æ—¶é—´å®Œç¾åœ°é‡æ„æ‰€æœ‰å†…å®¹ã€‚</p>

<p>æˆ‘ç›®å‰è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯è¯†åˆ«<strong>åŠŸèƒ½ç»„</strong>ï¼Œå³ä¸€ç»„å…·æœ‰å¤§é‡å…¬å…±ä¾èµ–é¡¹çš„åŠŸèƒ½ã€‚è¿™æ ·ï¼Œä½ å°±å¯ä»¥é€šè¿‡åˆ›å»º<strong>æ›´å…·å‡èšåŠ›</strong>çš„æ¨¡å—ï¼Œæ°´å¹³æ‹†åˆ†å…±äº«å±‚ä¸­çš„éƒ¨åˆ†ä»£ç ã€‚</p>

<p>æˆ‘æœ€è¿‘å¼€å‘çš„æ‰€æœ‰å¤§å‹åº”ç”¨ä¸­éƒ½æœ‰ä¸¤ä¸ªä¸åŒçš„åŠŸèƒ½ç»„ã€‚</p>

<p>ç¬¬ä¸€ä¸ªåŠŸèƒ½ç»„ä¸<strong>æ ¸å¿ƒä¸šåŠ¡</strong>åŠŸèƒ½ç›¸å…³ï¼šä¾‹å¦‚ï¼Œä¸€ä¸ªæ¨¡å—å›´ç»•äº§å“åˆ—è¡¨ï¼Œå¦ä¸€ä¸ªæ¨¡å—å›´ç»•äº§å“è¯¦æƒ…ï¼Œç¬¬ä¸‰ä¸ªæ¨¡å—å›´ç»•æ”¶è—äº§å“ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªåŠŸèƒ½ç»„å‘½åä¸º<strong>äº§å“</strong>ã€‚å¦ä¸€ä¸ªåŠŸèƒ½ç»„å›´ç»•<strong>æ”¯ä»˜ã€å¹¿å‘Šæˆ–è®¢é˜…</strong>ï¼Œæˆ–è€…æœ‰æ—¶æ˜¯è¿™äº›åŠŸèƒ½çš„ç»„åˆã€‚è¿™å…³ç³»åˆ°åº”ç”¨çš„ç›ˆåˆ©æ–¹å¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†åŠŸèƒ½ç»„å‘½åä¸º<strong>â€œæ”¯ä»˜â€</strong>ã€‚</p>

<p>å¤§å‹åº”ç”¨ä¸­å¯èƒ½ä¼šæœ‰äº”ä¸ªæˆ–æ›´å¤šåŠŸèƒ½ç»„ã€‚æ¯ä¸ªåŠŸèƒ½ç»„å°†åŒ…å«é¢†åŸŸæ¨¡å—ã€æ•°æ®æ¨¡å—å’Œæ¼”ç¤ºæ¨¡å—ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚</p>

<pre><code class="bash">feature/Feature A

feature/Feature B

feature/Feature C

feature/Feature D

feature/Feature E

feature/Feature F


:data

:domain

:presentation


:kotlin-base  
</code></pre>

<h3>ä½•æ—¶ä½¿ç”¨å“ªä¸€æ­¥ï¼Ÿ</h3>

<p>ä½ è‚¯å®šå¸Œæœ›å°†å•ä½“åº”ç”¨ç”¨äºæ°¸è¿œä¸ä¼šæŠ•å…¥ç”Ÿäº§æˆ–ä¸€æ¬¡æ€§ä½¿ç”¨çš„åº”ç”¨ç¨‹åºã€‚è¿™äº›åº”ç”¨ç¨‹åºå¯ä»¥æ˜¯<strong>æ¦‚å¿µéªŒè¯</strong> (PoC, Proof of Concept) åº”ç”¨ç¨‹åºã€ç”¨äºç¬¬ä¸‰æ–¹é”™è¯¯çš„<strong>æœ€å°å¯å¤ç°ç¤ºä¾‹</strong> (MRE, Minimum Reproducible Example) åº”ç”¨ç¨‹åºï¼Œæˆ–ç”¨äºæ±‚èŒç”³è¯·çš„<strong>æµ‹è¯•æŒ‘æˆ˜</strong>åº”ç”¨ç¨‹åºã€‚</p>

<p>å¯¹äºæ‰€æœ‰å…¶ä»–æƒ…å†µï¼Œæˆ‘å»ºè®®å…ˆä»éƒ¨åˆ†æˆ–å®Œå…¨æ¨¡å—åŒ–å¼€å§‹ï¼Œç„¶åæ ¹æ®éœ€è¦å‡çº§åˆ°ä¸‹ä¸€æ­¥ï¼Œæˆ–è€…å°½å¯èƒ½æå‰å‡çº§ï¼Œä»¥å‡å°‘ä»¥åçš„éº»çƒ¦ã€‚</p>

<p>ä½ å¯ä»¥åœ¨æˆ‘çš„ <a href="https://github.com/herrbert74/FlickSlate">FlickSlate</a> ä»£ç åº“ï¼ˆé“¾æ¥ï¼š<a href="https://github.com/herrbert74/FlickSlate%EF%BC%89%E4%B8%AD%E6%89%BE%E5%88%B0%E4%B8%8A%E8%BF%B0%EF%BC%88%E5%A4%A7%E9%83%A8%E5%88%86%EF%BC%89%E5%86%85%E5%AE%B9%E7%9A%84%E6%9C%89%E6%95%88%E7%A4%BA%E4%BE%8B%EF%BC%8C%E6%88%91%E6%9C%80%E8%BF%91%E5%B0%86%E5%85%B6%E6%9B%B4%E6%96%B0%E5%88%B0%E4%BA%86%E5%AE%8C%E5%85%A8%E6%A8%A1%E5%9D%97%E5%8C%96%E9%98%B6%E6%AE%B5%E3%80%82%E8%99%BD%E7%84%B6%E4%B8%BA%E6%97%B6%E8%BF%87%E6%97%A9%EF%BC%8C%E4%BD%86%E6%9C%89%E5%8A%A9%E4%BA%8E%E6%BC%94%E7%A4%BA%E8%BF%99%E4%BA%9B%E5%8E%9F%E5%88%99%E3%80%82%E5%BD%93%E7%84%B6%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E9%81%BF%E5%85%8D%E4%BB%A5%E5%90%8E%E7%9A%84%E9%BA%BB%E7%83%A6%E3%80%82">https://github.com/herrbert74/FlickSlate%EF%BC%89%E4%B8%AD%E6%89%BE%E5%88%B0%E4%B8%8A%E8%BF%B0%EF%BC%88%E5%A4%A7%E9%83%A8%E5%88%86%EF%BC%89%E5%86%85%E5%AE%B9%E7%9A%84%E6%9C%89%E6%95%88%E7%A4%BA%E4%BE%8B%EF%BC%8C%E6%88%91%E6%9C%80%E8%BF%91%E5%B0%86%E5%85%B6%E6%9B%B4%E6%96%B0%E5%88%B0%E4%BA%86%E5%AE%8C%E5%85%A8%E6%A8%A1%E5%9D%97%E5%8C%96%E9%98%B6%E6%AE%B5%E3%80%82%E8%99%BD%E7%84%B6%E4%B8%BA%E6%97%B6%E8%BF%87%E6%97%A9%EF%BC%8C%E4%BD%86%E6%9C%89%E5%8A%A9%E4%BA%8E%E6%BC%94%E7%A4%BA%E8%BF%99%E4%BA%9B%E5%8E%9F%E5%88%99%E3%80%82%E5%BD%93%E7%84%B6%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E9%81%BF%E5%85%8D%E4%BB%A5%E5%90%8E%E7%9A%84%E9%BA%BB%E7%83%A6%E3%80%82</a></p>

<p>FlickSlate å°šæœªå‡çº§åˆ°åŠŸèƒ½ç»„ã€‚è¿™æ¯«æ— æ„ä¹‰ï¼Œå› ä¸ºå…±äº«å±‚è¿˜æ— æ³•æ‹†åˆ†ä¸ºåŠŸèƒ½ç»„ã€‚è¯¥åº”ç”¨æ²¡æœ‰ç›ˆåˆ©åŠŸèƒ½ï¼Œæ‰€ä»¥åªèƒ½å¯¹èŠ‚ç›®è¿›è¡Œåˆ†ç»„ï¼Œä¸è¿‡ç›®å‰å…±äº«å±‚å·²ç»å®Œç¾åœ°å®ç°äº†è¿™ä¸€ç‚¹ã€‚</p>

<p>è¿™ç¯‡æ–‡ç« ä¸»è¦æºäºæˆ‘å¯¹äº’è”ç½‘ä¸Šå…³äºä½•æ—¶ä»¥åŠå¦‚ä½•æ¨¡å—åŒ–çš„å»ºè®®ä¸€æ¦‚è€Œè®ºçš„ä¸æ»¡ï¼šè¦ä¹ˆå»ºè®®ä¸åŠ åŒºåˆ†åœ°è¿›è¡Œæ¨¡å—åŒ–ï¼Œè¦ä¹ˆæœ‰äººå¯¹ä»»ä½•è¿›è¡Œæ¨¡å—åŒ–çš„äººå¤§å–Šâ€œè¿‡åº¦å·¥ç¨‹â€ã€‚æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ åœ¨ä½•æ—¶ä»¥åŠå¦‚ä½•è¿›è¡Œæ¨¡å—åŒ–æ–¹é¢åšå‡ºæ›´æ˜æ™ºçš„å†³å®šã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[åœ¨Kotlin ViewModelä¸­æ­£ç¡®å¤„ç†ç›¸åŒçš„UIç»„ä»¶äº¤äº’]]></title>
    <link href="https://alexhilton.github.io/blog/2025/07/01/handling-ui-action/"/>
    <updated>2025-07-01T22:34:20+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/07/01/handling-ui-action</id>
    <content type="html"><![CDATA[<p>æœ¬æ–‡è¯‘è‡ªã€ŒHandling UI Actions the Right Way in Kotlin ViewModelsã€ï¼ŒåŸæ–‡é“¾æ¥<a href="https://proandroiddev.com/handling-ui-actions-the-right-way-in-kotlin-viewmodels-119a06bb43ef">https://proandroiddev.com/handling-ui-actions-the-right-way-in-kotlin-viewmodels-119a06bb43ef</a>ï¼Œç”±Vaibhav Jaiswalå‘å¸ƒäº2025å¹´4æœˆ16æ—¥ã€‚</p>

<p><a href=""><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MLROq8NAKOSnutBMj3WivQ.png" title="auto auto" ></a></p>

<!-- more -->


<h2>ç¼˜èµ·</h2>

<p>ä½œä¸ºAndroidå¼€å‘è€…ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°éœ€è¦åœ¨å¤šä¸ªViewModelä¸­å®ç°ç›¸åŒæˆ–è€…éå¸¸ç±»ä¼¼UIåŠŸèƒ½çš„æƒ…å†µã€‚</p>

<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰å¤šä¸ªé¡µé¢ï¼Œå®ƒä»¬å…·æœ‰ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ˜¾ç¤ºå¸–å­ã€æ’°å†™è¯„è®ºæˆ–å¤„ç†ç”¨æˆ·äº¤äº’ã€‚</p>

<p>åœ¨æ¯ä¸ªViewModelä¸­åˆ†åˆ«å¤„ç†è¿™äº›UIäº¤äº’å¾ˆå¿«å°±ä¼šå˜å¾—æ··ä¹±ï¼Œå¯¼è‡´å¤§é‡çš„ä»£ç é‡å¤ã€‚éšç€åº”ç”¨è§„æ¨¡çš„æ‰©å¤§å’Œé¡µé¢æ•°é‡çš„å¢åŠ ï¼Œè¿™ä¸ªé—®é¢˜ä¼šå˜å¾—æ›´åŠ æ£˜æ‰‹ï¼Œå¯¼è‡´ä»£ç åº“éš¾ä»¥ç»´æŠ¤ï¼Œå¹¶å¸¦æ¥å¯æ‰©å±•æ€§é—®é¢˜ã€‚</p>

<p>å¯¹äºè¿™ç§ä»£ç é‡å¤é—®é¢˜ï¼Œæˆ‘ä»¬Androidå¼€å‘è€…å¸¸ç”¨çš„å‡ ç§å¸¸è§è§£å†³æ–¹æ¡ˆåŒ…æ‹¬ï¼š</p>

<ul>
<li>é¢å¤–çš„è¾…åŠ©ç±»æ–¹æ³•</li>
<li>â€œç»§æ‰¿â€æˆ–â€œä½¿ç”¨å§”æ‰˜çš„ç»„åˆâ€æ–¹æ³•</li>
</ul>


<p>åœ¨ä»¥ä¸‹ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†æ¢è®¨è¿™äº›è§£å†³æ–¹æ¡ˆï¼Œäº†è§£æ¯ç§æ–¹æ³•å¦‚ä½•è§£å†³ä»£ç é‡å¤é—®é¢˜ï¼Œå¹¶é‡ç‚¹ä»‹ç»æ¯ç§æ–¹æ³•çš„å±€é™æ€§ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒåŸºäºè¿™äº›æƒ³æ³•ï¼Œå¹¶è§£å†³äº†å®ƒä»¬çš„å±€é™æ€§ï¼Œä»è€Œå®ç°äº†æ›´é«˜æ•ˆçš„UIäº¤äº’ç®¡ç†ã€‚</p>

<blockquote><p>è¿™ä¸ªè§£å†³æ–¹æ¡ˆæˆ‘å·²ç»åœ¨<a href="https://medial.app/"> Medial çš„åº”ç”¨</a>ï¼ˆé“¾æ¥ <a href="https://medial.app/%EF%BC%89%E4%BB%A3%E7%A0%81%E5%BA%93%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%BF%87%E4%BA%86%E2%80%94%E2%80%94%E5%B0%86">https://medial.app/%EF%BC%89%E4%BB%A3%E7%A0%81%E5%BA%93%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%BF%87%E4%BA%86%E2%80%94%E2%80%94%E5%B0%86</a> UIäº¤äº’å¤„ç†ä»£ç å˜æˆäº†è¿‘ä¹å³æ’å³ç”¨çš„ä½“éªŒã€‚</p></blockquote>

<p>æˆ‘çš„è§£å†³æ–¹æ¡ˆæ ¹æœ¬ä¸å»ºè®®ä½¿ç”¨ BaseViewModelï¼Œä¹Ÿä¸åŸºäº BaseViewModelã€‚BaseViewModel åªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œç”¨æ¥è¯´æ˜æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»ä»»ä½•å…¶ä»–ç±»/æ¥å£ç»§æ‰¿çš„åŠŸèƒ½ï¼Œè¿™äº›ç±»/æ¥å£å¯ä»¥æ˜¯ BaseViewModelã€ViewModelã€Decompose çš„ ComponentContext æˆ–å…¶ä»–ä»»ä½•ä¸œè¥¿ã€‚</p>

<h2>âš¡ï¸ TL;DR: å¤„ç†ViewModelä¸­çš„å…±äº«UIäº¤äº’</h2>

<p>å½“åœ¨å¤šä¸ªé¡µé¢ä¸Šæ˜¾ç¤ºç›¸åŒçš„UIç»„ä»¶æ—¶ï¼Œåœ¨æ¯ä¸ªViewModelä¸­å¤„ç†å®ƒä»¬çš„äº¤äº’ä¼šå¯¼è‡´é‡å¤å’Œé€»è¾‘æ··ä¹±ã€‚æˆ‘ä»¬æ¢ç´¢äº†ä¸‰ç§æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>

<ol>
<li>è¾…åŠ©ç±»æ–¹æ³•</li>
<li>â– ç®€å•ï¼Œä½†æ— æ³•è¦†å†™ä»»ä½•è¡Œä¸º</li>
<li>â– å¹¶éViewModelçš„ç›´æ¥åŠŸèƒ½</li>
<li>é€šè¿‡ Kotlin å§”æ‰˜è¿›è¡Œç»„åˆ</li>
<li>âœ… æ›´å¥½çš„è®¾è®¡ï¼Œæ”¯æŒè¦†å†™è¡Œä¸ºã€‚</li>
<li>â– æ— æ³•è®¿é—®viewModelScopeæˆ–å…¶ä»–ViewModelåŠŸèƒ½ã€‚</li>
<li>â– æ— æ³•ä»ä»»ä½•å…¶ä»–ç»§æ‰¿ç±»è®¿é—®ä»»ä½•å†…å®¹ã€‚</li>
<li>ğŸ’¡ æˆ‘çš„è§£å†³æ–¹æ¡ˆ â€” ä½¿ç”¨å¸¦æœ‰é»˜è®¤å‡½æ•°çš„æ¥å£</li>
<li>âœ… ç®€æ´ã€å¯å¤ç”¨ï¼Œæ”¯æŒè¦†å†™ï¼ˆOverrideï¼‰è¡Œä¸ºã€‚</li>
<li>âœ… å®Œå…¨è®¿é—®ViewModelåŠŸèƒ½æˆ–ä»»ä½•å…¶ä»–ç»§æ‰¿ç±»çš„åŠŸèƒ½ã€‚</li>
<li>âœ… åªéœ€ä»æ¥å£å®ç°å³å¯è½»æ¾æ’å…¥ä»»ä½• ViewModel</li>
</ol>


<p>æœ¬åšå®¢ä¸­çš„æ‰€æœ‰è§£å†³æ–¹æ¡ˆå‡åœ¨<a href="https://github.com/Vaibhav2002/Ui-Intreraction-Handler-Sample">æ­¤ç¤ºä¾‹é¡¹ç›®</a>ï¼ˆé“¾æ¥ <a href="https://github.com/Vaibhav2002/Ui-Intreraction-Handler-Sample%EF%BC%89%E4%B8%AD%E5%AE%9E%E7%8E%B0%EF%BC%9A">https://github.com/Vaibhav2002/Ui-Intreraction-Handler-Sample%EF%BC%89%E4%B8%AD%E5%AE%9E%E7%8E%B0%EF%BC%9A</a></p>

<h2>ğŸ—ï¸ è®¾ç½®</h2>

<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåç½®UI å…ƒç´ ï¼Œå®ƒæœ‰ä¸€äº›UI äº¤äº’ï¼Œå¹¶åƒ MVI å»ºè®®çš„é‚£æ ·ï¼Œåœ¨ä¸€ä¸ªå¯†å°çš„ç•Œé¢ä¸­å‘ˆç°ã€‚</p>

<pre><code class="Kotlin">sealed interface PostAction {
    data class Clicked(val id: String) : PostAction
    data class LikeClicked(val id: String) : PostAction
    data class ShareClicked(val id: String) : PostAction
}
</code></pre>

<p>æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ª BaseViewModel ç±»ï¼Œç”¨äºä¿å­˜æ¯ä¸ªViewModelæ‰€éœ€çš„é€šç”¨åŠŸèƒ½</p>

<pre><code class="Kotlin">abstract class BaseViewModel : ViewModel() {

    var showShackBar by mutableStateOf("")
    var showBottomSheet by mutableStateOf("")

    fun navigate() {
      // å®ç°
    }

    fun showSnackbar(message: String) {
      showSnackBar = message
    }
}
</code></pre>

<h3>é¢å¤–çš„è¾…åŠ©ç±»æ–¹æ³•</h3>

<p>åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„è¾…åŠ©ç±»æ¥å°è£…UIäº¤äº’çš„å¤„ç†ã€‚æˆ‘ä»¬å°†è¿™ä¸ªç±»ä½œä¸ºViewModelçš„ä¸€ä¸ªå±æ€§ã€‚</p>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè¾…åŠ©ç±» PostActionHandler æ¥å¤„ç†äº¤äº’ã€‚</p>

<pre><code class="Kotlin">class PostActionHandler(private val viewModel: BaseViewModel) {

    fun handleAction(action: PostAction) = when (action) {
        is PostAction.Clicked -&gt; viewModel.navigate()
        is PostAction.LikeClicked -&gt; viewModel.showSnackBar("Liked")
        is PostAction.ShareClicked -&gt; { /* å®ç° */ }
    }
}
</code></pre>

<p>ç°åœ¨ï¼Œåœ¨ PostScreenViewModel ä¸­æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª PostActionHandler å®ä¾‹</p>

<pre><code class="Kotlin">class PostScreenViewModel : BaseViewModel() {
    val actionHandler = PostActionHandler(this)
}

@Composable
fun PostScreen(viewModel: PostScreenViewModel) {
    PostItem(onAction = viewModel.actionHandler::handleAction)
}

@Composable
fun PostItem(onAction: (PostAction) -&gt; Unit) {

}
</code></pre>

<p>è™½ç„¶è¿™ç§æ–¹æ³•ç¡®å®è§£å†³äº†è·¨å¤šä¸ªViewModelé‡å¤ä»£ç çš„é—®é¢˜ï¼Œä½†å®ƒä¹Ÿå­˜åœ¨ä¸€äº›ä¸»è¦ç¼ºç‚¹ï¼Œè¿™äº›ç¼ºç‚¹åŒ…æ‹¬ï¼š</p>

<ul>
<li>ğŸš« è‡ªå®šä¹‰åŠŸèƒ½æœ‰é™ï¼šç”±äº PostActionHandler æ˜¯ä¸€ä¸ªå°è£…ç±»ï¼Œæˆ‘ä»¬æ— æ³•è¦†å†™ä»»ä½•è¡Œä¸ºã€‚</li>
<li>ğŸš« é€šè¿‡å±æ€§è®¿é—®ï¼šæˆ‘ä»¬ä¸æ˜¯å°†åŠŸèƒ½æ·»åŠ åˆ°ViewModelæœ¬èº«ï¼Œè€Œæ˜¯å°†å…¶ä½œä¸ºViewModelçš„ä¸€ä¸ªå±æ€§æ·»åŠ ã€‚</li>
</ul>


<p><strong>æ— æ³•è¦†å†™ï¼ˆOverrideï¼‰è¡Œä¸ºæ˜¯è¿™ç§æ–¹æ³•ä¸å»ºè®®ç”¨äºUIäº¤äº’å¤„ç†çš„ä¸»è¦åŸå› ã€‚</strong></p>

<h2>ğŸ§¬ ä½¿ç”¨ Kotlin å§”æ‰˜è¿›è¡Œç»„åˆï¼ˆä¼˜é›…ä½†å—é™çš„è§£å†³æ–¹æ¡ˆï¼‰</h2>

<p>è¿™æ˜¯äº’è”ç½‘ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜çš„æ ‡å‡†æ–¹æ³•ï¼Œä¹Ÿæ˜¯æœ€å—æ¨èçš„æ–¹æ³•ã€‚è¯¥è§£å†³æ–¹æ¡ˆåŸºäºç»§æ‰¿ï¼Œä½†ä¸æ˜¯ç»§æ‰¿è‡ªæŸä¸ªç±»ï¼Œè¿™æ ·å°±æ— æ³•å†æ‰©å±•ä»»ä½•ç±»ã€‚æˆ‘ä»¬åˆ©ç”¨ Kotlin å§”æ‰˜å°†å®ç°å§”æ‰˜ç»™å¦ä¸€ä¸ªç±»ï¼Œè¿™æ ·å°±æ— éœ€æ‰©å±•æŸä¸ªç±»ï¼Œä¹Ÿæ— éœ€å†ç»ˆæ­¢ç»§æ‰¿ã€‚</p>

<p>ä»¥ä¸‹æ˜¯æˆ‘ä»¬å®ç°è¯¥è§£å†³æ–¹æ¡ˆçš„æ–¹æ³•</p>

<pre><code class="Kotlin">interface PostActionHandler {
    suspend fun handleAction(action: PostAction)
}

class PostActionHandlerImpl : PostActionHandler {

    override fun handleAction(action: PostAction) = when (action) {
        is PostAction.Clicked -&gt; handlePostClick(action.id)
        is PostAction.LikeClicked -&gt; handleLikeClick(action.id)
        is PostAction.ShareClicked -&gt; handleShareClick(action.id)
    }

    private fun handlePostClick(id: String) { }

    private fun handleLikeClick(id: String) { }

    private fun handleShareClick(id: String) { }

}
</code></pre>

<p>è¿™å°±æ˜¯æˆ‘ä»¬çš„ä½¿ç”¨æ–¹æ³•</p>

<pre><code class="Kotlin">class PostViewModel : BaseViewModel(), PostActionHandler by PostActionHandlerImpl() {

}

@Composable
fun PostScreen(viewModel: PostViewModel) {
    PostItem(onAction = viewModel::handleAction)
}

@Composable
fun PostItem(onAction: (PostAction) -&gt; Unit) {

}
</code></pre>

<p>è¿™ç§æ–¹æ³•è§£å†³äº†é¢å¤–è¾…åŠ©ç±»æ–¹æ³•ä¸­å­˜åœ¨çš„æ‰€æœ‰é—®é¢˜ã€‚</p>

<ul>
<li>âœ… è¦†å†™è¡Œä¸ºï¼šé€šè¿‡ä½¿ç”¨æ¥å£å’Œå§”æ‰˜ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°è¦†å†™ä»»ä½•è¡Œä¸ºã€‚</li>
<li>âœ… æ›´ç®€æ´çš„è®¾è®¡ï¼šåŠŸèƒ½ç›´æ¥æˆä¸ºViewModelçš„ä¸€éƒ¨åˆ†ï¼Œå…è®¸æˆ‘ä»¬åƒè°ƒç”¨åŸç”ŸViewModelæ–¹æ³•ä¸€æ ·è°ƒç”¨è¿™äº›å‡½æ•°ã€‚</li>
</ul>


<p>ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•æœ‰ä¸€ä¸ªä¸»è¦ç¼ºç‚¹ï¼Œä½¿å…¶åœ¨å¤„ç†UIäº¤äº’å’ŒUIé€»è¾‘æ–¹é¢ä¸å¤Ÿå®Œå–„ã€‚</p>

<h3>è®¿é—®ä»å…¶ä»–ç±»ç»§æ‰¿çš„åŠŸèƒ½</h3>

<p>æ­¤æ¨¡å¼çš„ä¸€ä¸ªä¸»è¦æŒ‘æˆ˜æ˜¯æˆ‘ä»¬æ— æ³•è®¿é—®ä»å…¶ä»–ç±»ç»§æ‰¿çš„åŠŸèƒ½ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•ä¼ é€’å¼•ç”¨ã€‚</p>

<p>è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªé™åˆ¶å¸¦æ¥äº†å“ªäº›æŒ‘æˆ˜ï¼š</p>

<ul>
<li>æ— æ³•è®¿é—®ViewModelåŠŸèƒ½ï¼šæˆ‘ä»¬æ— æ³•ä»å®ç°ç±»è®¿é—®ä»»ä½•ViewModelåŠŸèƒ½ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ— æ³•åœ¨å®ç°ç±»ä¸­ä¼ é€’å½“å‰ç±»çš„å¼•ç”¨ã€‚</li>
<li>æ— æ³•ä½¿ç”¨ viewModelScopeï¼šæ­¤é™åˆ¶å¸¦æ¥çš„ä¸€ä¸ªä¸»è¦è­¦å‘Šæ˜¯ï¼Œæˆ‘ä»¬æ— æ³•ä½¿ç”¨ viewModelScopeï¼Œå› æ­¤æ— æ³•ç›´æ¥å¯åŠ¨åç¨‹ã€‚æˆ‘ä»¬å¿…é¡»åœ¨ viewModel ä¸­åˆ›å»ºåŒ…è£…å‡½æ•°ï¼Œè¿™ä¼šç ´åå¯é‡ç”¨æ€§ï¼Œå› ä¸ºç°åœ¨å¯ç»„åˆå‡½æ•°ä¼šè°ƒç”¨æˆ‘ä»¬çš„ViewModelå‡½æ•°ã€‚</li>
</ul>


<p>å½“æˆ‘ä»¬å°è¯•å°†å…¶ä½œä¸ºæ„é€ å‡½æ•°å‚æ•°ä¼ é€’æ—¶ï¼ŒAndroid Studio ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼š</p>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xcJAyapM8023-hqu06vwUw.png" alt="Kotlin Compiler showing error when passing â€œthisâ€" /></p>

<h2>ğŸ§© æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨æ¥å£é»˜è®¤å‡½æ•°è¿›è¡Œç»„åˆ</h2>

<p>åœ¨æˆ‘è‡ªå·±å®ç°ä½¿ç”¨å§”æ‰˜çš„ Composition æ–¹æ¡ˆæ—¶ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªéš¾é¢˜ï¼šå¦‚ä½•ä¼ é€’å½“å‰ViewModelçš„å¼•ç”¨æ¥è®¿é—®viewModelScope å’Œæˆ‘çš„ BaseViewModel åŠŸèƒ½ã€‚åæ¥æˆ‘æƒ³èµ·äº† Kotlin æ¥å£ä¸­çš„é»˜è®¤å‡½æ•°ï¼Œäºæ˜¯å°è¯•äº†è¿™ä¸ªæ–¹æ¡ˆï¼Œå®Œç¾åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p>

<p>é€šè¿‡è¿™ä¸ªæ–¹æ¡ˆï¼Œæˆ‘å¯ä»¥ï¼š</p>

<ul>
<li>ğŸ’¡ æ”¯æŒåŠŸèƒ½é‡å†™</li>
<li>ğŸ”— å®Œå…¨è®¿é—®æˆ‘çš„BaseViewModelå’ŒViewModel çš„åŠŸèƒ½ï¼Œä¾‹å¦‚viewModelScope ç­‰ï¼Œæˆ–ä»»ä½•å…¶ä»–ç±»çš„åŠŸèƒ½ã€‚</li>
<li>âŒ æ— éœ€å•ç‹¬çš„å®ç°ç±»</li>
</ul>


<blockquote><p>åœ¨æˆ‘ä»¬<a href="https://medial.app/"> Medial çš„åº”ç”¨</a>ï¼ˆé“¾æ¥ <a href="https://medial.app/%EF%BC%89%E7%94%9F%E4%BA%A7%E4%BB%A3%E7%A0%81%E4%B8%AD%EF%BC%8C%E6%88%91%E9%9B%86%E6%88%90%E4%BA%86%E8%BF%99%E4%B8%AA%E6%96%B9%E6%A1%88%EF%BC%8C%E4%BB%A5%E7%AE%80%E5%8C%96ViewModel%E5%A4%84%E7%90%86UI%E4%BA%A4%E4%BA%92%E7%9A%84%E6%96%B9%E5%BC%8F%E3%80%82%E7%BB%93%E6%9E%9C%E5%A6%82%E4%BD%95%EF%BC%9F%E6%AF%8F%E4%B8%AA%E6%96%B0%E9%A1%B5%E9%9D%A2%E5%8F%AA%E9%9C%80%E5%AE%9E%E7%8E%B0%E8%BF%99%E4%B8%AA%E6%8E%A5%E5%8F%A3%EF%BC%8C%E7%84%B6%E5%90%8E%EF%BC%8C%E5%AE%83%E5%B0%B1%E5%B9%B2%E5%87%80%E5%88%A9%E8%90%BD%E5%9C%B0%E8%8E%B7%E5%BE%97%E4%BA%86%E5%8A%9F%E8%83%BD%E3%80%82">https://medial.app/%EF%BC%89%E7%94%9F%E4%BA%A7%E4%BB%A3%E7%A0%81%E4%B8%AD%EF%BC%8C%E6%88%91%E9%9B%86%E6%88%90%E4%BA%86%E8%BF%99%E4%B8%AA%E6%96%B9%E6%A1%88%EF%BC%8C%E4%BB%A5%E7%AE%80%E5%8C%96ViewModel%E5%A4%84%E7%90%86UI%E4%BA%A4%E4%BA%92%E7%9A%84%E6%96%B9%E5%BC%8F%E3%80%82%E7%BB%93%E6%9E%9C%E5%A6%82%E4%BD%95%EF%BC%9F%E6%AF%8F%E4%B8%AA%E6%96%B0%E9%A1%B5%E9%9D%A2%E5%8F%AA%E9%9C%80%E5%AE%9E%E7%8E%B0%E8%BF%99%E4%B8%AA%E6%8E%A5%E5%8F%A3%EF%BC%8C%E7%84%B6%E5%90%8E%EF%BC%8C%E5%AE%83%E5%B0%B1%E5%B9%B2%E5%87%80%E5%88%A9%E8%90%BD%E5%9C%B0%E8%8E%B7%E5%BE%97%E4%BA%86%E5%8A%9F%E8%83%BD%E3%80%82</a></p></blockquote>

<p>è®©æˆ‘ä»¬æ¥æ¢ç´¢ä¸€ä¸‹è¿™ä¸ªæ–¹æ¡ˆæ˜¯å¦‚ä½•è§£å†³æˆ‘ä»¬çš„é—®é¢˜çš„ã€‚</p>

<h3>è®¾è®¡ ActionHandler æ¥å£</h3>

<pre><code class="Kotlin">interface PostActionHandler {

    val viewModel: BaseViewModel

    fun handleAction(action: PostAction) = viewModel.viewModelScope.launch {
        when (action) {
            is PostAction.Clicked -&gt; handlePostClick(action.id)
            is PostAction.LikeClicked -&gt; handleLikeClick(action.id)
            is PostAction.ShareClicked -&gt; handleShareClick(action.id)
        }
    }

    suspend fun handlePostClick(id: String) {
        viewModel.navigate()
    }

    suspend fun handleLikeClick(id: String) {
        viewModel.showToast("Liked")
    }

    suspend fun handleShareClick(id: String) {
        // å®ç°
    }

}
</code></pre>

<h3>è®©æˆ‘ä»¬çš„ViewModelå®ç°è¿™ä¸ªæ¥å£</h3>

<pre><code class="Kotlin">class PostViewModel : BaseViewModel(), PostActionHandler {

    // ä¼ å…¥å½“å‰çš„baseViewModel
    override valViewModel= this

    override fun handleShareClick(id: String) {
        // æ·»åŠ  overrideå®ç°
    }

}
</code></pre>

<h3>è¿™æ˜¯å®ƒåœ¨ Composable ä¸­çš„ä½¿ç”¨æ–¹å¼</h3>

<pre><code class="Kotlin">@Composable
private fun PostScreen(viewModel: PostViewModel) {
    PostItem(onAction = viewModel::handleAction)
}

@Composable
private fun PostItem(
    onAction: (PostAction) -&gt; Unit
) {

}
</code></pre>

<p>æ‰€ä»¥ï¼Œæ­£å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬åªéœ€è¦å®šä¹‰ viewModel å˜é‡ï¼Œå°±å¤§åŠŸå‘Šæˆäº†ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ViewModelå’Œ BaseViewModel æä¾›çš„æ‰€æœ‰åŠŸèƒ½äº†ã€‚</p>

<p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ˜¯å¦‚ä½•è§£å†³ä½¿ç”¨å§”æ‰˜è¿›è¡Œç»„åˆçš„ä¸»è¦ç¼ºç‚¹çš„ï¼š</p>

<ul>
<li>é€šè¿‡å°† viewModel å¼•ç”¨ä¿ç•™ä¸ºæ¥å£å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åœ¨ViewModelä¸­å®šä¹‰å®ƒã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿç›´æ¥è®¿é—® BaseViewModel æˆ–ä»»ä½•å…¶ä»–ViewModelæä¾›çš„æ‰€æœ‰åŠŸèƒ½ã€‚</li>
<li>æˆ‘ä»¬ç®€åŒ–äº† viewModelScope çš„ä½¿ç”¨ã€‚ç°åœ¨ï¼Œå¯åŠ¨åç¨‹ã€æ”¶é›†æµç¨‹ä»¥åŠæ‰§è¡Œå…¶ä»–ä»»åŠ¡éƒ½å˜å¾—éå¸¸ç®€å•ï¼Œæ— éœ€ä»»ä½•å¤æ‚çš„å˜é€šæ–¹æ³•æˆ– hackã€‚è¿™å°±æ˜¯æ­¤è§£å†³æ–¹æ¡ˆå¸¦æ¥çš„ä¼˜é›…å’Œç®€æ´ä¹‹å¤„ã€‚</li>
</ul>


<p>è¿™ç§æ–¹æ³•åªæœ‰ä¸€ä¸ªå°ç¼ºç‚¹ï¼Œé‚£å°±æ˜¯</p>

<ul>
<li>æˆ‘ä»¬å¿…é¡»åœ¨ViewModelä¸­å®šä¹‰æ‰€æœ‰æ¥å£å±æ€§ï¼Œè¿™åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸»è¦ä¼šå¼•ç”¨ Repository æˆ– Domain Layer ç±»ï¼Œä»¥åŠä¸€äº›å¯å˜çŠ¶æ€ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</li>
</ul>


<p>è¿™ä¸ªé—®é¢˜æ¯”æˆ‘ä»¬åœ¨è¿™ä¸ªè§£å†³æ–¹æ¡ˆä¸­å…‹æœçš„ç¼ºç‚¹è¦å°å¾—å¤šï¼Œè¿™ä½¿å¾—å®ƒæˆä¸ºå¤„ç†ä»»ä½•å…±äº«UIäº¤äº’æˆ–ä»»ä½•å…±äº«UIä¸šåŠ¡é€»è¾‘çš„æœ€ä½³è§£å†³æ–¹æ¡ˆã€‚</p>

<blockquote><p>å—¯ï¼Œè¿™ä¸€éƒ¨åˆ†æ¯”å‰é¢å‡ éƒ¨åˆ†ç®€å•å¾—å¤šã€‚è¿™é‡Œæ²¡æœ‰å¤æ‚çš„é—®é¢˜éœ€è¦æ·±å…¥ç ”ç©¶â€”â€”åªæ˜¯ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒç¡®å®åšåˆ°äº†å®ƒåº”è¯¥åšçš„äº‹æƒ…ï¼Œå¹¶è§£å†³äº†æˆ‘ä»¬æ‰€æœ‰çš„é—®é¢˜ã€‚</p></blockquote>

<h2>ğŸ¥·ğŸ» è®©æˆ‘ä»¬åœ¨å®é™…ç”¨ä¾‹ä¸­çœ‹çœ‹è¿™ä¸ªè§£å†³æ–¹æ¡ˆçš„å®é™…åº”ç”¨ã€‚</h2>

<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸»é¡µé¢ï¼Œå®ƒä»¥åˆ—è¡¨å½¢å¼æ˜¾ç¤ºå„ç§UIå…ƒç´ ï¼Œä¾‹å¦‚åŒ…å«å¸–å­å’Œæ–°é—»ç­‰é¡¹ç›®çš„åŠ¨æ€ã€‚æ¯ä¸ªå…ƒç´ éƒ½åŒ…å«ä¸€ç»„ç”¨æˆ·äº¤äº’ï¼Œä¾‹å¦‚ç‚¹èµå¸–å­ã€åˆ†äº«æ–°é—»æ–‡ç« æˆ–å¯¼èˆªåˆ°è¯¦æƒ…è§†å›¾ã€‚æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆå¯ä»¥å¸®åŠ©æˆ‘ä»¬é«˜æ•ˆåœ°å¤„ç†è·¨ä¸åŒViewModelçš„è¿™äº›äº¤äº’ï¼Œç¡®ä¿ä»¥å¯æ‰©å±•çš„æ–¹å¼å¤„ç†é€šç”¨åŠŸèƒ½ã€‚</p>

<h3>ä¸ºæ¯ä¸ªUIç»„ä»¶è®¾è®¡UIäº¤äº’</h3>

<p>ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ Kotlin çš„ Sealed æ¥å£ï¼Œåƒåœ¨å…¸å‹çš„ MVI æ¶æ„ä¸­ä¸€æ ·è®¾è®¡UIäº¤äº’ï¼š</p>

<pre><code class="Kotlin">sealed interface PostAction {

    data class Clicked(val post: Post) : PostAction
    data class LikeClicked(val post: Post) : PostAction
    data class ShareClicked(val post: Post) : PostAction

}
</code></pre>

<pre><code class="Kotlin">sealed interface NewsAction {

    data class Clicked(val news: News) : NewsAction
    data class LikeClicked(val news: News) : NewsAction
    data class BookmarkClicked(val news: News) : NewsAction

}
</code></pre>

<h3>åˆ›å»ºæˆ‘ä»¬çš„åŠ¨ä½œå¤„ç†ç¨‹åºæ¥å£</h3>

<pre><code class="Kotlin">interface PostActionHandler {

    val viewModel: BaseViewModel
    val postRepo: PostRepository

    fun handleAction(action: PostAction) = viewModel.viewModelScope.launch {
      when (action) {
          is PostAction.Clicked -&gt; handlePostClick(action.id)
          is PostAction.LikeClicked -&gt; handleLikeClick(action.id)
        }
    }

    suspend fun handlePostClick(id: String) {
      viewModel.navigate(......)
    }

    suspend fun handleLikeClick(id: String) {
      postRepo.like(id)
      viewModel.showSnackbar("Post Liked")
    }

}
</code></pre>

<pre><code class="Kotlin">interface NewsActionHandler {

    val viewModel: BaseViewModel
    val newsRepo: NewsRepository

    fun handleAction(action: NewsAction) = when (action) {
        is NewsAction.Clicked -&gt; handleNewsClick(action.id)
        is NewsAction.Bookmark -&gt; handleNewsBookmark(action.id)
    }

    fun handleNewsClick(id: String) {
      viewModel.navigate(.....)
    }

    fun handleNewsBookmark(id: String) {
      newsRepo.bookmark(id)
      viewModel.showSnackBar("News Bookmarked")
    }
}
</code></pre>

<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªæ•°æ®æ¨¡å‹åˆ›å»ºäº†ä¸€ä¸ª Action Handler æ¥å£ã€‚</p>

<p>æˆ‘ä»¬åœ¨è¿™é‡Œæ‰€åšçš„å°±æ˜¯éµå¾ªä¸Šä¸€èŠ‚æ‰€ç¤ºçš„æ¥å£è®¾è®¡ã€‚</p>

<ul>
<li>æˆ‘ä»¬æœ‰ä¸¤ä¸ªå±æ€§ï¼Œåˆ†åˆ«æ˜¯ViewModelå’ŒRepository ç±»ã€‚</li>
<li>æˆ‘ä»¬åˆ†åˆ«åˆ›å»ºäº†å¤„ç†æ¯ä¸ª Action çš„å‡½æ•°ã€‚å½“ç„¶ï¼Œè¿™æ˜¯å¯é€‰çš„ã€‚æˆ‘ä¿ç•™è¿™ç§æ–¹å¼æ˜¯ä¸ºäº†æ–¹ä¾¿è¦†å†™ä»»ä½•ç‰¹å®šçš„è¡Œä¸ºï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸ºæ¯ä¸ª Action ç±»å‹åˆ†åˆ«è°ƒç”¨ç›¸åº”çš„ Action å¤„ç†å‡½æ•°ã€‚</li>
</ul>


<h3>åˆ›å»º ViewModel</h3>

<p>è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªå®ç°è¿™ä¸¤ä¸ªæ¥å£çš„ ViewModelï¼Œä»¥ç»§æ‰¿å®ƒä»¬çš„åŠŸèƒ½ã€‚</p>

<pre><code class="Kotlin">class HomeViewModel : BaseViewModel(), PostActionHandler, NewsActionHandler {

    override val viewModel = this
    override val postRepo = PostRepository()
    override val newsRepo = NewsRepository()

    /**
      ViewModelå…¶ä½™ä»£ç 
    **/

}
</code></pre>

<p>ç„¶åï¼Œæˆ‘ä»¬åœ¨ViewModelä¸­å®šä¹‰å¿…è¦çš„å±æ€§ï¼ˆ viewModel ã€ postRepo å’Œ newsRepo ï¼‰ï¼Œè¿™äº›å±æ€§ä¼šè¢«ä¸¤ä¸ªæ¥å£ä½¿ç”¨ã€‚</p>

<p>è¿™ç§è®¾è®¡æ¶ˆé™¤äº†å†—ä½™ï¼Œå¹¶ä¿æŒäº†ä»£ç çš„ç®€æ´æ€§ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è®¾ç½®ä¸€æ¬¡å±æ€§ï¼Œåªè¦å±æ€§åç§°ç›¸åŒï¼Œä¸¤ä¸ªæ¥å£å°±å¯ä»¥æ— ç¼åœ°ä¸å…¶äº¤äº’ã€‚
è¿™ç§æ–¹æ³•ä¿æŒäº†ViewModelçš„ä¸­å¿ƒåœ°ä½ï¼ŒåŒæ—¶åˆå¯ä»¥è½»æ¾å¤„ç†ä¸åŒç»„ä»¶çš„UIäº¤äº’å’Œä¸šåŠ¡é€»è¾‘ã€‚</p>

<h2>ğŸªè¿æ¥ä¸€åˆ‡ï¼šå°†æ“ä½œè¿æ¥åˆ° UI</h2>

<pre><code class="Kotlin">@Composable
fun HomeScreen(viewModel: HomeViewModel) {
    LazyColumn {
        items(viewModel.items) {
            when(it) {
                is News -&gt; NewsCard(it, onAction = viewModel::handleAction)
                is Post -&gt; PostCard(it, onAction = viewModel::handleAction)
            }
        }
    }
}

@Composable
private fun NewsCard(
  news: News,
  onAction: (NewsAction) -&gt; Unit
) {

}

@Composable
private fun PostCard(
  post: Post,
  onAction: (PostAction) -&gt; Unit
) {

}
</code></pre>

<p>åœ¨æˆ‘ä»¬çš„UIç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†è¿™äº›å‡½æ•°ç”¨ä½œViewModelæœ¬èº«çš„å‡½æ•°ï¼Œè¿™æ ·å°±å®Œæˆäº†åœ¨ Screen ä¸­æ·»åŠ äº¤äº’å¤„ç†çš„åŠŸèƒ½ã€‚</p>

<ul>
<li>ç°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬æœ‰å¦ä¸€ä¸ªåªæ˜¾ç¤ºæ–°é—»çš„é¡µé¢ï¼ˆScreenï¼‰ã€‚æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯åœ¨ViewModelä¸­å®ç° NewsActionHandler æ¥å£â€”â€”å°±è¿™æ ·ï¼Œä¸€åˆ‡å°±ç»ªã€‚</li>
<li>æˆ‘ä»¬å¯ä»¥æ— ç¼åœ°ä» BaseViewModel æˆ–ViewModelè°ƒç”¨ä»»ä½•å‡½æ•°ï¼Œä»è€Œèƒ½å¤Ÿåœ¨ä¸€ä¸ªå•ä¸€çš„ã€é›†ä¸­çš„ä½ç½®å®ç°å®Œæ•´çš„ç«¯åˆ°ç«¯åŠŸèƒ½ã€‚å¦‚æœæˆ‘ä»¬åœ¨å¤šä¸ªä½ç½®æ˜¾ç¤ºç›¸åŒçš„æ•°æ®æ¨¡å‹ï¼Œè¿™å°†éå¸¸æœ‰åˆ©ã€‚</li>
</ul>


<h2>ğŸ“¦ æ•´åˆæ‰€æœ‰åŠŸèƒ½</h2>

<p>åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†åœ¨æ‰©å±•Android UIï¼ˆåŸºæœ¬ä¸Šæ˜¯ä»»ä½• UIï¼‰æ—¶æœ€å®¹æ˜“è¢«å¿½è§†çš„é—®é¢˜ä¹‹ä¸€ï¼Œå³è·¨ViewModelçš„é‡å¤UIäº¤äº’é€»è¾‘ã€‚æˆ‘ä»¬æ¢ç´¢äº†ä¸‰ç§ä¸åŒçš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>

<ol>
<li>è¾…åŠ©ç±» - ä¸€ç§å¿«é€Ÿè§£å†³æ–¹æ¡ˆï¼Œä½†å­˜åœ¨ä¸¥æ ¼çš„é™åˆ¶ã€‚</li>
<li>ä½¿ç”¨å§”æ‰˜è¿›è¡Œç»„åˆâ€”â€”ä¸€ç§æ›´ç°ä»£çš„ç»§æ‰¿é©±åŠ¨è§£å†³æ–¹æ¡ˆï¼Œ
ä½†å®ƒéš¾ä»¥ä»å¤–éƒ¨è®¿é—®åŠŸèƒ½ã€‚</li>
<li>ä½¿ç”¨é»˜è®¤å‡½æ•°çš„æ¥å£ï¼ˆæˆ‘çš„è§£å†³æ–¹æ¡ˆï¼‰â€”â€”ä¸€ç§å®ç”¨ã€ä¼˜é›…ä¸”çµæ´»çš„æ–¹æ³•ï¼Œå…‹æœäº†å‰ä¸¤ç§æ–¹æ³•çš„æ‰€æœ‰é™åˆ¶ã€‚</li>
</ol>


<p>é€šè¿‡åˆ©ç”¨ Kotlin çš„æ¥å£é»˜è®¤æ–¹æ³•å¹¶å°†ViewModelä½œä¸ºæ¥å£å†…éƒ¨çš„å±æ€§ï¼Œæˆ‘ä»¬è§£é”äº†å®Œæ•´çš„å¯æ‰©å±•æ€§ï¼Œå¹¶èƒ½å¤Ÿä»å…¶ä»–ç»§æ‰¿çš„ç±»/æ¥å£è®¿é—®æ‰©å±•åŠŸèƒ½ã€‚</p>

<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä»¥è¡¨æ ¼çš„å½¢å¼æ¯”è¾ƒä¸€ä¸‹æ¯ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p>

<table>
<thead>
<tr>
<th> å¥½å¤„                           </th>
<th> é€šè¿‡è¾…åŠ©ç±»                                       </th>
<th> ä½¿ç”¨å§”æ‰˜è¿›è¡Œç»„åˆ                             </th>
<th> å¸¦æœ‰é»˜è®¤å‡½æ•°çš„æ¥å£ (âœ… æœ€å¥½)         </th>
</tr>
</thead>
<tbody>
<tr>
<td> ğŸ” å¯é‡ç”¨æ€§                                 </td>
<td>  âœ… Yes        </td>
<td>  âœ… Yes         </td>
<td>  âœ… Yes </td>
</tr>
<tr>
<td> ğŸ§  è¦†å†™è¡Œä¸º                        </td>
<td> âŒ ä¸å¯èƒ½          </td>
<td> âœ… å¯ä»¥ï¼Œç”±äºç»§æ‰¿        </td>
<td> âœ…  å¯ä»¥ï¼Œç”±äºç»§æ‰¿           </td>
</tr>
<tr>
<td> ğŸ”— è®¿é—®ä»å…¶ä»–æ¥æºç»§æ‰¿çš„åŠŸèƒ½                 </td>
<td> âŒ ä¸å¯ä»¥ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå°è£…ç±»      </td>
<td> âŒ  ä¸å¯ä»¥ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•ä¼ é€’å½“å‰å¼•ç”¨       </td>
<td> âœ…  å¯ä»¥ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥å°†ç»§æ‰¿ç±»ä¿ç•™ä¸ºæ¥å£å±æ€§    </td>
</tr>
<tr>
<td> ğŸ—ï¸ è·¨é¡µé¢å¯æ‰©å±•æ€§                  </td>
<td> âš ï¸ å·®â€”â€”å½“é€»è¾‘è¿˜æ¶‰åŠè§†å›¾æ¨¡å‹ç‰¹å®šåŠŸèƒ½æ—¶ä¼šå˜å¾—å›°éš¾               </td>
<td> âœ… æ›´å¥½â€”â€”å¯é‡å¤ä½¿ç”¨çš„é€»è¾‘                    </td>
<td> âœ… æœ€ä½³â€”â€”è·¨é¡µé¢å³æ’å³ç”¨            </td>
</tr>
<tr>
<td> âœ… æœ€ä½³ç”¨ä¾‹                               </td>
<td> å¯¹äºéUIäº¤äº’å°è£…åŠŸèƒ½                   </td>
<td> ä¸šåŠ¡é€»è¾‘é‡ç”¨ï¼ŒéUIä¸Šä¸‹æ–‡            </td>
<td> å¤šä¸ªViewModelä¸­éœ€è¦çš„UIäº¤äº’ </td>
</tr>
</tbody>
</table>


<p>ä½ å¯ä»¥åœ¨<a href="https://github.com/Vaibhav2002/Ui-Intreraction-Handler-Sample">ä¸“ç”¨çš„ GitHub ä»£ç åº“</a>ï¼ˆé“¾æ¥ï¼š<a href="https://github.com/Vaibhav2002/Ui-Intreraction-Handler-Sample%EF%BC%89%E4%B8%AD%E6%8E%A2%E7%B4%A2%E6%9C%AC%E5%8D%9A%E5%AE%A2%E4%B8%AD%E6%8F%90%E5%88%B0%E7%9A%84%E6%89%80%E6%9C%89%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E3%80%82%E6%AC%A2%E8%BF%8E%E9%9A%8F%E6%84%8Fclone%E3%80%81fork%E6%88%96%E8%AF%95%E7%94%A8%E3%80%82">https://github.com/Vaibhav2002/Ui-Intreraction-Handler-Sample%EF%BC%89%E4%B8%AD%E6%8E%A2%E7%B4%A2%E6%9C%AC%E5%8D%9A%E5%AE%A2%E4%B8%AD%E6%8F%90%E5%88%B0%E7%9A%84%E6%89%80%E6%9C%89%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E3%80%82%E6%AC%A2%E8%BF%8E%E9%9A%8F%E6%84%8Fclone%E3%80%81fork%E6%88%96%E8%AF%95%E7%94%A8%E3%80%82</a></p>

<h2>âœŒï¸ å‘Šåˆ«</h2>

<p>æ€»è€Œè¨€ä¹‹ï¼Œå¸Œæœ›è¿™ç¯‡åšå®¢èƒ½å¸®åŠ©ä½ è§£é”ä¸€äº›å¼ºå¤§çš„æŠ€å·§ï¼Œæå‡ä½ çš„Kotlin å’ŒUIå¤„ç†çŸ¥è¯†ã€‚æœ‰äº†Kotlin çš„ç•Œé¢é»˜è®¤å‡½æ•°ï¼Œä½ çš„æ„å»ºå°†æ›´åŠ ç®€æ´ã€å¿«é€Ÿï¼Œå¹¶å…¼é¡¾é•¿æœŸå¯æ‰©å±•æ€§ã€‚</p>

<p>å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« å¹¶æƒ³éšæ—¶äº†è§£æœ€æ–°åŠ¨æ€ï¼š</p>

<ul>
<li>æŸ¥çœ‹æˆ‘çš„ LinkedInã€GitHub å’Œ X ä¸ªäººèµ„æ–™ï¼Œäº†è§£æˆ‘æ­£åœ¨åšçš„äº‹æƒ…ã€‚</li>
<li>æƒ³è¦æ›´å¤š Kotlin çš„é­”æ³•ï¼Ÿé˜…è¯»æˆ‘ä¹‹å‰çš„åšå®¢ï¼Œäº†è§£å¦ä¸€ç§å¯ä»¥è®©ä½ çš„ä»£ç åº“æ›´ç²¾ç®€ã€æ›´æ™ºèƒ½çš„æŠ€æœ¯ã€‚</li>
</ul>


<p>æ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œå¸Œæœ›ä½ å–œæ¬¢ï¼ğŸš€</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[MVIæ¶æ„ï¼šComposeä¸­çš„å“åº”å¼çŠ¶æ€ç®¡ç†]]></title>
    <link href="https://alexhilton.github.io/blog/2025/06/25/reactive-state-in-compose/"/>
    <updated>2025-06-25T22:32:21+08:00</updated>
    <id>https://alexhilton.github.io/blog/2025/06/25/reactive-state-in-compose</id>
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è¯‘è‡ªã€ŒReactive State Management in Compose â€” MVI Architectureã€ï¼ŒåŸæ–‡é“¾æ¥<a href="https://proandroiddev.com/reactive-state-management-in-compose-mvi-architecture-71546c9f1b52">https://proandroiddev.com/reactive-state-management-in-compose-mvi-architecture-71546c9f1b52</a>ï¼Œç”±Davies Adedayo AbdulGafarå‘å¸ƒäº2025å¹´4æœˆ22æ—¥ã€‚</p></blockquote>

<p>è¯‘æ³¨ï¼šåŸæ–‡ä½œè€…è™½ç„¶æ˜¯åŸºäºJetpack Composeæ¥å†™çš„ï¼Œä½†é‡ç‚¹è®¨è®ºçš„æ˜¯åº”ç”¨çš„MVIæ¶æ„æ–¹å¼ï¼Œæ¶‰åŠçš„éƒ½æ˜¯çº¯Kotlinè¯­è¨€å±‚é¢çš„ï¼Œä»¥åŠComposeå±‚é¢çš„ï¼Œå¹¶ä¸æ¶‰åŠå¹³å°ç‰¹æ€§ï¼Œå› æ­¤å®Œå…¨é€‚ç”¨äºè·¨å¹³å°çš„Compose Multiplatformã€‚</p>

<p><a href=""><img src="/Users/alexhilton/Downloads/banner_reactive.png" title="auto auto" ></a></p>

<!-- more -->


<h2>MVIæ˜¯ä»€ä¹ˆé¬¼</h2>

<h3>MVIæ¶æ„çš„åŸºæœ¬æ¦‚å¿µ</h3>

<p>MVIï¼ˆæ¨¡å‹-è§†å›¾-æ„å›¾ï¼‰æ¶æ„ä¸º Android åº”ç”¨ç¨‹åºä¸­å¯æ‰©å±•ã€ç¨³å¥ä¸”å¯æµ‹è¯•çš„ UI çŠ¶æ€ç®¡ç†æä¾›äº†ä¸€ç§ç»“æ„è‰¯å¥½çš„æ–¹æ³•ã€‚å®ƒå¼ºè°ƒä»£ç ç®€æ´å’Œå…³æ³¨ç‚¹åˆ†ç¦»ï¼ˆSeparation of Concernsï¼‰ï¼Œå°†åº”ç”¨ç¨‹åºåˆ’åˆ†ä¸ºä¸‰ä¸ªä¸»è¦ç»„ä»¶â€”â€”æ¨¡å‹(Model)ã€è§†å›¾(View)å’Œæ„å›¾(Intent)â€”â€”å®ƒä»¬å…±åŒæ„æˆä¸€ä¸ªå¾ªç¯ï¼šæ„å›¾ -> è§†å›¾æ¨¡å‹ -> æ¨¡å‹ -> è§†å›¾ï¼Œä»è€Œå®šä¹‰å•å‘æ•°æ®æµï¼ˆ<strong>è¯‘æ³¨ï¼š</strong>è¿™é‡Œçš„æ„å›¾Intentæ˜¯æ¶æ„ä¸­çš„ä¸€ä¸ªé€»è¾‘æ¦‚å¿µï¼Œä¸Androidç³»ç»Ÿä¸­çš„Intentæ²¡æœ‰å…³ç³»ï¼‰ã€‚æ­¤æ¶æ„æ¨¡å¼æä¾›çš„ä¸åŒè§’è‰²æœ‰åŠ©äºæ›´è½»æ¾åœ°ç†è§£å’Œç»´æŠ¤ UI çŠ¶æ€ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼ŒMVI ä¸ä»…ä»…æ˜¯ä¸€ç§æ¶æ„æ¨¡å¼ï¼Œè€Œæ˜¯ä¸€ä¸ªæ—¨åœ¨æµç•…å“åº”å˜åŒ–çš„å“åº”å¼ç³»ç»Ÿã€‚è¿™ç§å“åº”æ€§æ˜¯å…¶å®šä¹‰ç‰¹å¾ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯å…¶æœ€å¤§çš„ä¼˜åŠ¿ã€‚</p>

<ul>
<li>å•å‘æ•°æ®æµï¼šæŒ‡æ•°æ®ä»¥å•å‘æµåŠ¨â€”â€”ä»æ¨¡å‹æµå‘è§†å›¾ï¼Œå¹¶ä»¥æ„å›¾çš„å½¢å¼è¿”å›ã€‚è¿™ç¡®ä¿äº†æ¶æ„çš„æ¸…æ™°åº¦ã€å¯é¢„æµ‹æ€§å’Œæ˜“ç»´æŠ¤æ€§ã€‚</li>
<li>å…³æ³¨ç‚¹åˆ†ç¦»ï¼šæŒ‡æ¨¡å‹ã€è§†å›¾å’Œæ„å›¾ç»„ä»¶å…·æœ‰ä¸åŒçš„è§’è‰²ã€‚æ¨¡å‹ç®¡ç†çŠ¶æ€ï¼Œè§†å›¾å¤„ç† UI æ¸²æŸ“ï¼Œæ„å›¾æ•è·å¹¶ä¼ è¾¾ç”¨æˆ·æ“ä½œã€‚</li>
<li>ä¸å¯å˜æ€§ï¼ˆImmutabilityï¼‰ï¼šç¡®ä¿æ¨¡å‹çš„çŠ¶æ€ä¸€æ—¦è®¾ç½®ä¾¿ä¿æŒä¸å˜ã€‚è¿™ä¿è¯äº†å¯é¢„æµ‹æ€§ï¼Œæ¶ˆé™¤äº†æ„å¤–çš„å‰¯ä½œç”¨ï¼Œå¹¶ä¿ƒè¿›äº†ç¨³å®šå¯é çš„åº”ç”¨çŠ¶æ€ã€‚</li>
<li>å“åº”å¼ï¼šå½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒUI ä¼šè‡ªåŠ¨æ›´æ–°ã€‚</li>
</ul>


<p>è¯¥æ¶æ„åˆ†è§£ä¸ºä¸‰ä¸ªå’Œè°çš„ç»„ä»¶ï¼Œå®ƒä»¬ä»¥å“åº”å¼æµç¨‹ååŒå·¥ä½œï¼š</p>

<ul>
<li>æ¨¡å‹ (Model) æ˜¯å•ä¸€äº‹å®æ¥æºï¼Œå®ƒæ˜¯åº”ç”¨ç¨‹åºåœ¨ä»»ä½•ç‰¹å®šæ—¶åˆ»çš„çŠ¶æ€å¿«ç…§ã€‚å½“æ­¤çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒä¼šè§¦å‘æ•´ä¸ªç³»ç»Ÿçš„çº§è”å“åº”å¼æ›´æ–°ã€‚UI ä¼šåœ¨çŠ¶æ€å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°ï¼Œè¿™å‡¸æ˜¾äº†è¿™ä¸€æ ¸å¿ƒçš„å“åº”å¼åŸåˆ™ã€‚</li>
<li>è§†å›¾ (View) æ ¹æ®å½“å‰æ¨¡å‹çŠ¶æ€ä»¥å“åº”å¼æ–¹å¼æ¸²æŸ“ç”¨æˆ·æ‰€è§å†…å®¹ã€‚å®ƒè®¢é˜…çŠ¶æ€å˜åŒ–å¹¶è‡ªåŠ¨è¿›è¡Œè½¬æ¢ä»¥åæ˜ è¿™äº›å˜åŒ–ï¼Œè€Œæ— éœ€ä»»ä½•å‘½ä»¤å¼æ›´æ–°è°ƒç”¨ã€‚è¿™ç§å“åº”å¼æ¸²æŸ“æ­£æ˜¯ MVI å¦‚æ­¤å¼ºå¤§çš„åŸå› â€”â€”è§†å›¾å§‹ç»ˆä¸çŠ¶æ€åŒæ­¥ã€‚</li>
<li>æ„å›¾ (Intent) å®Œå–„äº†å“åº”å¼ç”µè·¯ï¼Œæ•è·ç”¨æˆ·äº¤äº’å¹¶å°†å…¶åé¦ˆå›ç³»ç»Ÿä»¥åˆ›å»ºæ–°çŠ¶æ€ã€‚è¿™å½¢æˆäº†ä¸€ä¸ªæŒç»­çš„åé¦ˆå¾ªç¯ï¼šç”¨æˆ·æ“ä½œè§¦å‘æ„å›¾ï¼Œæ„å›¾äº§ç”Ÿæ–°çŠ¶æ€ï¼Œæ–°çŠ¶æ€è§¦å‘ UI æ›´æ–°ã€‚</li>
</ul>


<p>å½“æˆ‘ä»¬è¯´ MVI å…·æœ‰å“åº”å¼ç‰¹æ€§æ—¶ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯æ•´ä¸ªç³»ç»Ÿéƒ½æ˜¯å›´ç»•è‡ªåŠ¨å“åº”å˜åŒ–è€Œæ„å»ºçš„ã€‚æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒUI æ— éœ€æ‰‹åŠ¨æ›´æ–°ï¼Œè€Œæ˜¯ä¼šè‡ªåŠ¨åæ˜ å½“å‰çŠ¶æ€ã€‚è¿™ç§å“åº”å¼ç‰¹æ€§èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªåŠ¨æ€ã€å“åº”è¿…é€Ÿçš„åº”ç”¨ç¨‹åºï¼Œè®©ç”¨æˆ·æ„Ÿè§‰ç”ŸåŠ¨æ´»æ³¼ã€‚</p>

<h3>MVIæ¶æ„çš„å…¸å‹å®ç°æ–¹å¼</h3>

<p>åœ¨åŸç”Ÿ Android å¼€å‘ä¸­ï¼ŒMVI çš„å¤§éƒ¨åˆ†å®ç°éƒ½æ”¾åœ¨ ViewModel ç±»ä¸­ã€‚ä»¥ä¸‹æ˜¯å®ç° MVI æ¨¡å¼çš„ä¸€ç§ç®€å•æ–¹æ³•ï¼š</p>

<ol>
<li>æˆ‘ä»¬æ‰“ç®—å»ºæ¨¡çš„ UI çŠ¶æ€å°†å®ç°ä¸ºä¸€ä¸ªä¸å¯å˜çš„ Kotlin æ•°æ®ç±»ï¼ˆdata classï¼‰ï¼Œå…¶å­—æ®µä¿å­˜ç€æˆ‘ä»¬æƒ³è¦åœ¨è§†å›¾ä¸­æ˜¾ç¤ºçš„çŠ¶æ€ã€‚</li>
<li>StateFlow æ˜¯å°†æ•´ä¸ªæ¶æ„ç»‘å®šåœ¨ä¸€èµ·çš„å“åº”å¼ç²˜åˆå‰‚ã€‚è¿™ä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒ…è£…äº†æ¨¡å‹ï¼Œå¹¶å°†å˜åŒ–é€šçŸ¥ç»™è§†å›¾ï¼Œä»¥ä¾¿å®ƒåæ˜ æ–°çš„çŠ¶æ€ã€‚è¿™ä¸ªå“åº”å¼ç®¡é“ç¡®ä¿ä»»ä½•çŠ¶æ€å˜åŒ–éƒ½ä¼šè‡ªåŠ¨ä¼ æ’­åˆ° UIã€‚</li>
<li>ç›®å‰ï¼Œæˆ‘ä»¬çš„æ„å›¾å¯ä»¥å®ç°ä¸º ViewModel ä¸­çš„å…¬å…±å‡½æ•°ã€‚è¿™äº›å‡½æ•°åº”è¯¥æ²¡æœ‰è¿”å›å€¼ï¼Œä»¥ç¡®ä¿è§†å›¾åªæ¥æ”¶æ¥è‡ªè§‚å¯Ÿè€…çš„çŠ¶æ€æ›´æ–°ã€‚ç±»ä¼¼äºå¯¹è±¡ä½œä¸ºç¼–ç¨‹è¯­è¨€ä¸­çš„ä¸€ç­‰å…¬æ°‘ï¼Œå¯ä»¥é€šè¿‡å¼•ç”¨ä¼ é€’ï¼ŒåŒæ ·ï¼Œå‡½æ•°ä¹Ÿä¾èµ–äºæ–¹æ³•å¼•ç”¨ã€‚æˆ‘ä»¬åˆ©ç”¨è¿™ä¸€ç‚¹å°†æ„å›¾ä¼ é€’ç»™ä½¿ç”¨å®ƒçš„ UI èŠ‚ç‚¹ã€‚æˆ‘ä»¬æ— éœ€ç¼–å†™å¤æ‚çš„ç±»æ¥å»ºæ¨¡æ„å›¾ï¼Œå› ä¸ºé‚£æ ·éœ€è¦é¢å¤–å®ç°æ„å›¾å¤„ç†ç¨‹åºã€‚</li>
</ol>


<p>ä»¥ä¸‹æ˜¯åœ¨ ViewModel ä¸­å®ç° MVI æ¨¡å¼çš„æ¨¡æ¿ã€‚</p>

<pre><code class="Kotlin">class ScreenViewModel() : ViewModel() {
  private val _uiState: MutableStateFlow&lt;MyModel&gt; = MutableStateFlow(MyModel(...)) // private observer object

  val uiState: StateFlow&lt;MyModel&gt; = _uiState // observer object exposed as an immutable instance

  fun doUpdateOnState(...) { ... } // public function serves as an intent
  fun doAnotherUpdate(...) { ... }
}

data class MyModel(...)
</code></pre>

<p>æ–°çŠ¶æ€åœ¨ ViewModel ä¸­ç”Ÿæˆï¼Œç„¶åç”±è§‚å¯Ÿ uiState çš„è§†å›¾ä½¿ç”¨ã€‚è¯·æ³¨æ„ï¼ŒIntent æ˜¯å¦‚ä½•ä½œä¸ºè§¦å‘çŠ¶æ€æ›´æ”¹çš„å›è°ƒä¼ é€’åˆ°å¯ç»„åˆé¡¹é¡µé¢çš„ã€‚</p>

<pre><code class="Kotlin">@Composable
 fun MyScreen(viewModel: ScreenViewModel) {
   val uiState: MyModel = viewModel.uiState.collectAsStateWithLifeCycle() // consumes the state produced in the viewModel

   MyScreenContent(
     uiState = uiState,
     doUpdate = viewModel::doUpdateOnState, // intent to do update
     doAnotherUpdate = viewModel::doAnotherUpdate // intent to do another update
   )
 }
</code></pre>

<p>è¿™ç§ååº”æ¨¡å¼é€šè¿‡ Kotlin çš„ StateFlow å®ç°ï¼š</p>

<pre><code class="Kotlin">private val _uiState: MutableStateFlow&lt;MyModel&gt; = MutableStateFlow(MyModel(...))
val uiState: StateFlow&lt;MyModel&gt; = _uiState
</code></pre>

<p>åœ¨ UI æ–¹é¢ï¼Œè¿™ç§ååº”æ€§é€šè¿‡æ”¶é›†æ“ä½œæ¥è¡¨è¾¾ï¼Œè¯¥æ“ä½œæ¶ˆè€—ä» viewModel ç”Ÿæˆçš„æ–°çŠ¶æ€ã€‚</p>

<pre><code class="Kotlin">val uiState = viewModel.uiState.collectAsStateWithLifeCycle()
</code></pre>

<p>è¿™è¡Œä»£ç å»ºç«‹äº†ä¸€ä¸ªå“åº”å¼è¿æ¥ï¼Œæ¯å½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶éƒ½ä¼šè‡ªåŠ¨åˆ·æ–° UIã€‚æ— éœ€æ‰‹åŠ¨åˆ·æ–°è°ƒç”¨æˆ–å¤æ‚çš„æ›´æ–°é€»è¾‘â€”â€”ç³»ç»Ÿæœ¬èº«å°±æ˜¯å“åº”å¼çš„ã€‚</p>

<h2>æ¡ˆä¾‹ç ”ç©¶</h2>

<p>è®©æˆ‘ä»¬é‡‡ç”¨æ›´å®ç”¨çš„æ–¹æ³•ï¼Œå®ç° MVI æ¨¡å¼æ¥ç®¡ç†é¡µé¢ çŠ¶æ€ã€‚ä¸‹å›¾æ˜¯ä¸€ä¸ªé¡µé¢ï¼Œç”¨æˆ·å¯ä»¥ä»ç»™å®šçš„é€‰é¡¹ä¸­é€‰æ‹©æ‰€æ˜¾ç¤ºé—®é¢˜çš„ç­”æ¡ˆã€‚</p>

<p><img src="https://miro.medium.com/v2/resize:fit:838/format:webp/0*uwa_-6EYNOhyNuNJ" alt="Case study" /></p>

<p>å›¾ç‰‡æ¥æº â€” <a href="https://github.com/android/compose-samples/tree/v2024.01.00/Jetsurvey">Compose ç¤ºä¾‹ Jetsurvey</a>ï¼ˆè¯‘æ³¨ï¼šé“¾æ¥æ˜¯<a href="https://github.com/android/compose-samples/tree/v2024.01.00/Jetsurvey%EF%BC%89%E3%80%82%E7%82%B9">https://github.com/android/compose-samples/tree/v2024.01.00/Jetsurvey%EF%BC%89%E3%80%82%E7%82%B9</a><a href="https://github.com/SahDavies/mvi-architecture-sample/">å‡»æ­¤</a>ï¼ˆè¯‘æ³¨ï¼šé“¾æ¥æ˜¯<a href="https://github.com/SahDavies/mvi-architecture-sample/%EF%BC%89%E5%A4%84%E6%9F%A5%E7%9C%8B%E5%AE%8C%E6%95%B4%E5%AE%9E%E7%8E%B0%E3%80%82">https://github.com/SahDavies/mvi-architecture-sample/%EF%BC%89%E5%A4%84%E6%9F%A5%E7%9C%8B%E5%AE%8C%E6%95%B4%E5%AE%9E%E7%8E%B0%E3%80%82</a></p>

<p>é¡µé¢åŒ…å«ä»¥ä¸‹çŠ¶æ€ï¼š</p>

<ol>
<li>é—®é¢˜</li>
<li>é€‰é¡¹åˆ—è¡¨</li>
<li>é—®é¢˜è®¡æ•°</li>
<li>é€‰æ‹©æŒ‡ç¤ºå™¨</li>
<li>å¯ç”¨/ç¦ç”¨æŒ‰é’®</li>
</ol>


<p>æ­¤å¤–ï¼Œé¡µé¢è¿˜æä¾›ä»¥ä¸‹ç”¨æˆ·æ“ä½œçš„è¾“å…¥ï¼š</p>

<ol>
<li>è·å–ä¸‹ä¸€ä¸ªé—®é¢˜</li>
<li>è·å–ä¸Šä¸€ä¸ªé—®é¢˜</li>
<li>é€‰æ‹©ä¸€ä¸ªé€‰é¡¹</li>
<li>å…³é—­/ç»“æŸæ“ä½œã€‚è¿™äº›æ“ä½œç”¨äºå°†ç”¨æˆ·çš„æ„å›¾ä¼ è¾¾ç»™åº”ç”¨ç¨‹åºã€‚</li>
</ol>


<p>ä¿å­˜é¡µé¢çŠ¶æ€çš„æ¨¡å‹å¯ä»¥è¿™æ ·å®ç°ï¼š</p>

<pre><code class="Kotlin">data class UiState(
  val questionCount: Int,
  val totalQuestion: Int,
  val question: Question,
  val userSelection: Option?
) {
  val hasNext: Boolean = questionCount &lt; totalQuestion
  val hasPrevious: Boolean = questionCount &gt; 1
}
</code></pre>

<p>å¦‚å‰æ‰€è¿°ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä½¿ç”¨å…¬å…±å‡½æ•°æ¥æè¿°æ„å›¾ï¼Œè¿™äº›å‡½æ•°æ²¡æœ‰è¿”å›å€¼ã€‚æˆ‘ä»¬åœ¨ä¸‹é¢åˆ—ä¸¾äº†å°†åœ¨ ViewModel ä¸­å®ç°çš„å‡½æ•°ã€‚</p>

<pre><code class="Kotlin">fun next() // åŠ è½½ä¸‹ä¸€ä¸ªé—®é¢˜
fun previous() // åŠ è½½ä¸Šä¸€ä¸ªé—®é¢˜
fun onOptionSelected(selection: Option) // æ¿€æ´»é€‰ä¸­é€‰é¡¹çš„æ ‡è¯†
</code></pre>

<p>åœ¨è§†å›¾ä¸­è°ƒç”¨çš„æ¯ä¸ªå‡½æ•°éƒ½ä¼šè§¦å‘ä¸€ä¸ªæ–°çš„çŠ¶æ€ä»¥ä¾›è§†å›¾ä½¿ç”¨ï¼Œè¿™æ ·æˆ‘ä»¬çš„é¡µé¢å°±æ˜¯å¯é¢„æµ‹å’Œå¯æµ‹è¯•çš„ï¼Œå› ä¸ºæ¯ä¸ªç”¨æˆ·äº¤äº’éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ä¸å¯å˜çŠ¶æ€ï¼Œå¯ä»¥åœ¨æµ‹è¯•æœŸé—´è¿›è¡Œæ¯”è¾ƒã€‚</p>

<pre><code class="Kotlin">@Composable
fun QuestionScreen(
    modifier: Modifier = Modifier,
    onDone: () -&gt; Unit
) {
    BackHandler { /* Do nothing */ }
    val viewModel = QuestionViewModel(getQuestions())
    val uiState by viewModel.uiState.collectAsStateWithLifecycle()

    QuestionScreenContent(
        uiState = uiState,
        onClickNext = viewModel::next,
        onClickPrevious = viewModel::previous,
        onOptionSelected = viewModel::onOptionSelected,
        onDone = onDone
    )
}
</code></pre>

<p>æ³¨æ„ï¼šå¹¶éæ‰€æœ‰å¸¦æœ‰çŠ¶æ€çš„é¡µé¢ç»„ä»¶éƒ½èƒ½ç”¨ MVI ç®¡ç†ã€‚æœ‰äº›ç»„ä»¶ç”±å•ç‹¬çš„çŠ¶æ€æŒæœ‰ç±»ç®¡ç†ï¼Œæœ‰äº›åˆ™ç”±å¯ç»„åˆç»„ä»¶æœ¬èº«çš„å†…éƒ¨çŠ¶æ€ç®¡ç†â€”â€”ä¾‹å¦‚ä¸Šå›¾ä¸­çš„è¿›åº¦æŒ‡ç¤ºå™¨ã€‚ä¸çœŸæ­£å¤„ç†ä¸šåŠ¡é€»è¾‘çš„çŠ¶æ€ä¸åº”è¯¥ä½¿ç”¨ MVI ç®¡ç†ã€‚</p>

<h2>è¶…è¶ŠåŸºæœ¬å“åº”å¼</h2>

<p>ä¸Šè¿°æ¡ˆä¾‹ç ”ç©¶åŸºäºæˆ‘ä»¬çš„é¡µé¢éœ€æ±‚ï¼Œä½¿ç”¨äº†ä¸€ä¸ªæ¨¡å‹çš„ç®€å•å®ç°ã€‚ç¼–å†™ MVI æ¨¡å¼çš„æ¨¡å‹å®ç°æœ‰å¾ˆå¤šæ–¹æ³•â€”â€”æ ¹æ®é¡µé¢éœ€æ±‚è¿›è¡Œå®ç°â€”â€”ä¾‹å¦‚ï¼Œä¸€ä¸ªåŒ…å«åŠ è½½å’Œé”™è¯¯çŠ¶æ€çš„é¡µé¢ã€‚é€šå¸¸ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨å¯†å°çš„ç±»å±‚æ¬¡ç»“æ„æ¥å®ç°â€”â€”å°½ç®¡å¦‚æ­¤ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä»¥ä¸åŒçš„æ–¹å¼å®ç°ä½ è‡ªå·±çš„æ¨¡å‹ã€‚</p>

<pre><code class="Kotlin">// è€ƒè™‘åŠ è½½å’Œé”™è¯¯çŠ¶æ€çš„æ¨¡å‹
internal sealed class UiState {
    object Loading : UiState()
    @Immutable
    class Content(val myModel: UiModel) : UiState()    
    @Immutable
    class Error(val error: ErrorUiModel): UiState()
}
</code></pre>

<p>è§†å›¾ä½¿ç”¨è¿™ç§æ–°ç±»å‹çš„æ–¹å¼ç•¥æœ‰ä¸åŒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre><code class="Kotlin"> @Composable
 fun MyScreenContent(uiState: UiState) {
    when(uiState) {
        is Loading -&gt; LoadingScreen() 
        is Error -&gt; ErrorScreen(uiState.error)
        is Content -&gt; ContentScreen(uiState.myModel)
    }
 }

fun LoadingScreen() { /* implementation block */ }
fun ErrorScreen(error: ErrorUiModel) { /* implementation block */ }
fun ContentScreen(content: UiModel) { /* implementation block */ }
</code></pre>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§æ¨¡å‹æ˜¯äº’æ–¥çš„â€”â€”å®ƒä¿è¯ä¸‰ä¸ªçŠ¶æ€ä¸ä¼šåŒæ—¶å‘ç”Ÿï¼Œè€Œæ˜¯ä¸€æ¬¡å‘ç”Ÿä¸€ä¸ªï¼Œè¿™æœ‰åŠ©äºé˜²æ­¢ UI çŠ¶æ€æ¸²æŸ“ä¸­å¸¸è§çš„é”™è¯¯ã€‚</p>

<h3>é‡å†™ Intent å®ç°</h3>

<p>Intent å®ç°ä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ  Reducer/Handler æ¥ä¿®æ”¹ï¼ŒReducer/Handler æ˜¯ ViewModel ä¸­çš„ä¸€ä¸ªå…¬å…±å‡½æ•°ï¼Œå®ƒä¼šè°ƒç”¨ç§æœ‰å®ç°ï¼ˆè¾…åŠ©å‡½æ•°ï¼‰æ¥æ‰§è¡Œæ“ä½œï¼Œå¹¶ä½¿ç”¨ when è¡¨è¾¾å¼åˆ†æ”¯åˆ°ç›¸åº”çš„æ“ä½œã€‚</p>

<pre><code class="Kotlin">Class HomeScreenViewModel() : ViewModel() {
    /*
    * Some class properties
    */

    // our reducer/handler
    fun onHomeAction(action: HomeAction) {
        when (action) {
            is HomeAction.CategorySelected -&gt; onCategorySelected(action.category)
            is HomeAction.TopicFollowed -&gt; onTopicFollowed(action.topic)
            is HomeAction.HomeCategorySelected -&gt; onHomeCategorySelected(action.category)
            is HomeAction.ToggleTopicFollowed -&gt; onToggleTopicFollowed(action.topic)
        }
    }

    private fun onCategorySelected(category: CategoryInfo) { ... }

    private fun onTopicFollowed(topic: TopicInfo) { ... }

    private fun onToggleTopicFollowed(topic: TopicInfo) { ... }

    private fun onHomeCategorySelected(category: HomeCategory) { ... }
}
</code></pre>

<p>ä¸ºäº†ä½¿æ­¤è®¾ç½®æ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¯†å°çš„æ¥å£å±‚æ¬¡ç»“æ„ï¼Œå¯¹åº”äºæ¯ä¸ªæ“ä½œï¼Œå…¶å­ç±»å±æ€§ç”¨äºä¿å­˜å‚æ•°ï¼Œç„¶åè¿™äº›å‚æ•°å°†é€šè¿‡è§†å›¾ä¸­çš„ reducer/handler ä¼ é€’ç»™è¿™äº›æ“ä½œã€‚</p>

<pre><code class="Kotlin">@Immutable
sealed interface HomeAction {
    data class CategorySelected(val category: CategoryInfo) : HomeAction
    data class HomeCategorySelected(val category: HomeCategory) : HomeAction
    data class TopicFollowed(val topic: TopicInfo) : HomeAction
    data class ToggleTopicFollowed(val topic: TopicInfo) : HomeAction
}
</code></pre>

<p>ä¸æˆ‘ä»¬ç¬¬ä¸€æ¬¡å®ç° Intent æ—¶éœ€è¦åœ¨è§†å›¾ä¸­ä½¿ç”¨æ–¹æ³•å¼•ç”¨ä¼ é€’æ‰€æœ‰æ“ä½œä¸åŒï¼Œè¿™é‡Œæˆ‘ä»¬åªéœ€è¦ä¼ é€’ Reducer/Handlerã€‚ç„¶åï¼Œå†³å®šéœ€è¦è°ƒç”¨å“ªä¸ªæ“ä½œçš„è´£ä»»å°±è½åœ¨äº†è°ƒç”¨è€…èº«ä¸Šã€‚</p>

<p>è¿™æ˜¯è§†å›¾ä¸­çš„æ ·å­</p>

<pre><code class="Kotlin">@Composable
fun HomeScreen(viewModel: HomeScreenViewModel, onNavigate: (String) -&gt; Unit) {

    HomeContent(
        modifier = Modifier.padding(contentPadding),
        onHomeAction = viewModel::onHomeAction,
        onNavigate = onNavigate,
    )

}
</code></pre>

<p>HomeContent å¯ç»„åˆå‡½æ•°ç°åœ¨è´Ÿè´£å†³å®šè°ƒç”¨å“ªä¸ªæ“ä½œï¼Œæ–¹æ³•æ˜¯å®ä¾‹åŒ–ä»¥ä¸‹ä»»æ„å¯¹è±¡ï¼Œç„¶åä½¿ç”¨å®ä¾‹åŒ–çš„å¯¹è±¡è°ƒç”¨ onHomeAction</p>

<pre><code class="Kotlin">    HomeAction.CategorySelected(category = CategoryInfo())
    HomeAction.HomeCategorySelected(category = HomeCategory())
    HomeAction.TopicFollowed(topic = TopicInfo())
    HomeAction.ToggleTopicFollowed(topic = TopicInfo())
</code></pre>

<p>è¯·å‚é˜…ä¸‹é¢çš„å®é™…æ“ä½œï¼</p>

<pre><code class="Kotlin">@Composable
private fun HomeContent(
    modifier: Modifier = Modifier,
    onHomeAction: (HomeAction) -&gt; Unit, // HomeActionæ˜¯ä¸€ä¸ªå¯†å°ç±»å‹å±‚æ¬¡
    onNavigate: (String) -&gt; Unit,
) {
    val homeCategory = HomeAction.HomeCategorySelected(CategoryInfo())
    onHomeAction(homeCategory) // triggers a state change
}
</code></pre>

<p>å³ä½¿å¢åŠ äº†å¤æ‚åº¦ï¼Œæ ¸å¿ƒçš„å“åº”å¼åŸåˆ™ä¾ç„¶ä¿æŒä¸å˜ã€‚Reducer åªæ˜¯æä¾›äº†ä¸€ç§æ›´æœ‰æ¡ç†çš„æ–¹å¼æ¥å¤„ç†æ„å›¾å¹¶ç”Ÿæˆæ–°çš„çŠ¶æ€ï¼Œè€Œä»çŠ¶æ€åˆ° UI çš„å“åº”å¼æµç¨‹ä¿æŒä¸å˜ã€‚</p>

<p>è¿™ç§å®ç°æ–¹å¼ä½¿å¾—è¿­ä»£æ„å»ºå˜å¾—ç®€å•â€”â€”æ— è®ºæˆ‘ä»¬éœ€è¦å¯¹æ„å›¾è¿›è¡Œä»€ä¹ˆæ›´æ”¹ï¼ˆæ— è®ºæ˜¯æ·»åŠ æ–°çš„æ„å›¾è¿˜æ˜¯åˆ é™¤ç°æœ‰çš„æ„å›¾ï¼‰ï¼Œéƒ½ä¸éœ€è¦åƒæˆ‘ä»¬æœ€åˆçš„å®ç°é‚£æ ·åœ¨å¾ˆå¤šåœ°æ–¹è¿›è¡Œé‡å†™ï¼›æˆ‘ä»¬åªéœ€åœ¨å¤„ç†ç¨‹åºä¸­æ³¨å†Œæ–°çš„æ“ä½œï¼Œç„¶ååœ¨è°ƒç”¨å¤„ç†ç¨‹åºæ—¶æ ¹æ®å…·ä½“æƒ…å†µå®ä¾‹åŒ–ä¸åŒçš„å¯¹è±¡å³å¯ã€‚</p>

<p>æ€»ç»“ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼ŒMVI æœ€ä¼˜é›…çš„æ–¹é¢åœ¨äºå®ƒå¦‚ä½•åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„å“åº”å¼é“¾è·¯ï¼š</p>

<ol>
<li>æ¨¡å‹å‘å‡ºçŠ¶æ€</li>
<li>è§†å›¾ä½¿ç”¨çŠ¶æ€å¹¶æ¸²æŸ“ UI</li>
<li>ç”¨æˆ·ä¸è§†å›¾çš„äº¤äº’ç”Ÿæˆæ„å›¾</li>
<li>æ„å›¾è¢«å¤„ç†ä»¥åˆ›å»ºæ–°çš„æ¨¡å‹</li>
<li>è¿™ä¸ªå¾ªç¯ä»¥å“åº”å¼çš„æ–¹å¼æŒç»­è¿›è¡Œ</li>
</ol>


<p>è¿™ç§ä¸é—´æ–­çš„å“åº”å¼å¾ªç¯ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºå§‹ç»ˆä¸ç”¨æˆ·æ“ä½œå’Œåç«¯æ•°æ®ä¿æŒåŒæ­¥ã€‚è¿™ä¸ä»…ä»…æ˜¯å“åº”å˜åŒ–â€”â€”è€Œæ˜¯åˆ›å»ºä¸€ä¸ªç³»ç»Ÿï¼Œè®©å˜åŒ–è‡ªç„¶åœ°é€šè¿‡é¢„å®šä¹‰çš„å“åº”å¼è·¯å¾„è¿›è¡Œã€‚</p>
]]></content>
  </entry>
  
</feed>
